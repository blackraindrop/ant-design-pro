(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(Ue,H,R){"use strict";var Y=R(67294),$=R(25282),v=R(23185),ee=R(4322),F=R(24770),J=R(89182),re=function(ne,je){var we={};for(var et in ne)Object.prototype.hasOwnProperty.call(ne,et)&&je.indexOf(et)<0&&(we[et]=ne[et]);if(ne!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Mt=0,et=Object.getOwnPropertySymbols(ne);Mt<et.length;Mt++)je.indexOf(et[Mt])<0&&Object.prototype.propertyIsEnumerable.call(ne,et[Mt])&&(we[et[Mt]]=ne[et[Mt]]);return we},Ee=(0,Y.forwardRef)(function(ne,je){var we=ne.chartRef,et=ne.style,Mt=et===void 0?{height:"inherit"}:et,nr=ne.className,_t=ne.loading,Xt=ne.loadingTemplate,Ct=ne.errorTemplate,ot=re(ne,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ut=(0,v.Z)($.TZ,ot),Jt=ut.chart,X=ut.container;return(0,Y.useEffect)(function(){(0,ee.J)(we,Jt.current)},[Jt.current]),(0,Y.useImperativeHandle)(je,function(){return{getChart:function(){return Jt.current}}}),Y.createElement(F.Z,{errorTemplate:Ct},_t&&Y.createElement(J.Z,{loadingTemplate:Xt}),Y.createElement("div",{className:nr,style:Mt,ref:X}))});H.Z=Ee},93343:function(Ue,H,R){"use strict";var Y=R(67294),$=R(25282),v=R(23185),ee=R(4322),F=R(24770),J=R(89182),re=function(ne,je){var we={};for(var et in ne)Object.prototype.hasOwnProperty.call(ne,et)&&je.indexOf(et)<0&&(we[et]=ne[et]);if(ne!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Mt=0,et=Object.getOwnPropertySymbols(ne);Mt<et.length;Mt++)je.indexOf(et[Mt])<0&&Object.prototype.propertyIsEnumerable.call(ne,et[Mt])&&(we[et[Mt]]=ne[et[Mt]]);return we},Ee=(0,Y.forwardRef)(function(ne,je){var we=ne.chartRef,et=ne.style,Mt=et===void 0?{height:"inherit"}:et,nr=ne.className,_t=ne.loading,Xt=ne.loadingTemplate,Ct=ne.errorTemplate,ot=re(ne,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ut=(0,v.Z)($.m,ot),Jt=ut.chart,X=ut.container;return(0,Y.useEffect)(function(){(0,ee.J)(we,Jt.current)},[Jt.current]),(0,Y.useImperativeHandle)(je,function(){return{getChart:function(){return Jt.current}}}),Y.createElement(F.Z,{errorTemplate:Ct},_t&&Y.createElement(J.Z,{loadingTemplate:Xt}),Y.createElement("div",{className:nr,style:Mt,ref:X}))});H.Z=Ee},64335:function(Ue,H,R){"use strict";var Y=R(67294),$=(0,Y.createContext)({});H.Z=$},21349:function(Ue,H,R){"use strict";var Y=R(84305),$=R(39559),v=R(53645),ee=R.n(v),F=R(67294),J=R(94184),re=R.n(J),Ee=R(64335),ne=function(we){var et=(0,F.useContext)(Ee.Z),Mt=we.children,nr=we.contentWidth,_t=we.className,Xt=we.style,Ct=(0,F.useContext)($.ZP.ConfigContext),ot=Ct.getPrefixCls,ut=we.prefixCls||ot("pro"),Jt=nr||et.contentWidth,X="".concat(ut,"-grid-content");return F.createElement("div",{className:re()(X,_t,{wide:Jt==="Fixed"}),style:Xt},F.createElement("div",{className:"".concat(ut,"-grid-content-children")},Mt))};H.Z=ne},66213:function(Ue,H,R){"use strict";R.d(H,{Z:function(){return v}});var Y=R(77608);function $(ee,F){for(;!Object.prototype.hasOwnProperty.call(ee,F)&&(ee=(0,Y.Z)(ee),ee!==null););return ee}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(F,J,re){var Ee=$(F,J);if(!!Ee){var ne=Object.getOwnPropertyDescriptor(Ee,J);return ne.get?ne.get.call(arguments.length<3?F:re):ne.value}},v.apply(this,arguments)}},31795:function(Ue,H,R){var Y=R(75752);Ue.exports.geometry=$,Ue.exports.ring=ee;function $(J){var re=0,Ee;switch(J.type){case"Polygon":return v(J.coordinates);case"MultiPolygon":for(Ee=0;Ee<J.coordinates.length;Ee++)re+=v(J.coordinates[Ee]);return re;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ee=0;Ee<J.geometries.length;Ee++)re+=$(J.geometries[Ee]);return re}}function v(J){var re=0;if(J&&J.length>0){re+=Math.abs(ee(J[0]));for(var Ee=1;Ee<J.length;Ee++)re-=Math.abs(ee(J[Ee]))}return re}function ee(J){var re,Ee,ne,je,we,et,Mt,nr=0,_t=J.length;if(_t>2){for(Mt=0;Mt<_t;Mt++)Mt===_t-2?(je=_t-2,we=_t-1,et=0):Mt===_t-1?(je=_t-1,we=0,et=1):(je=Mt,we=Mt+1,et=Mt+2),re=J[je],Ee=J[we],ne=J[et],nr+=(F(ne[0])-F(re[0]))*Math.sin(F(Ee[1]));nr=nr*Y.RADIUS*Y.RADIUS/2}return nr}function F(J){return J*Math.PI/180}},38163:function(Ue,H,R){var Y=R(31795);Ue.exports=$;function $(Ee,ne){switch(Ee&&Ee.type||null){case"FeatureCollection":return Ee.features=Ee.features.map(v($,ne)),Ee;case"GeometryCollection":return Ee.geometries=Ee.geometries.map(v($,ne)),Ee;case"Feature":return Ee.geometry=$(Ee.geometry,ne),Ee;case"Polygon":case"MultiPolygon":return ee(Ee,ne);default:return Ee}}function v(Ee,ne){return function(je){return Ee(je,ne)}}function ee(Ee,ne){return Ee.type==="Polygon"?Ee.coordinates=F(Ee.coordinates,ne):Ee.type==="MultiPolygon"&&(Ee.coordinates=Ee.coordinates.map(v(F,ne))),Ee}function F(Ee,ne){ne=!!ne,Ee[0]=J(Ee[0],ne);for(var je=1;je<Ee.length;je++)Ee[je]=J(Ee[je],!ne);return Ee}function J(Ee,ne){return re(Ee)===ne?Ee:Ee.reverse()}function re(Ee){return Y.ring(Ee)>=0}},70499:function(Ue){Ue.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Ue){Ue.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},27849:function(Ue,H,R){"use strict";R.r(H),R.d(H,{default:function(){return zP}});var Y={};R.r(Y),R.d(Y,{add:function(){return Zo},adjoint:function(){return Lr},clone:function(){return kt},copy:function(){return ur},create:function(){return Fe},determinant:function(){return kr},equals:function(){return ea},exactEquals:function(){return jo},frob:function(){return $o},fromQuat:function(){return qr},fromQuat2:function(){return Xr},fromRotation:function(){return Jr},fromRotationTranslation:function(){return _n},fromRotationTranslationScale:function(){return vi},fromRotationTranslationScaleOrigin:function(){return ni},fromScaling:function(){return Nr},fromTranslation:function(){return fr},fromValues:function(){return It},fromXRotation:function(){return Fn},fromYRotation:function(){return rr},fromZRotation:function(){return ar},frustum:function(){return an},getRotation:function(){return Qr},getScaling:function(){return Yr},getTranslation:function(){return Tr},identity:function(){return dr},invert:function(){return Sr},lookAt:function(){return Wa},mul:function(){return ss},multiply:function(){return Dr},multiplyScalar:function(){return co},multiplyScalarAndAdd:function(){return mi},ortho:function(){return Ni},orthoNO:function(){return oo},orthoZO:function(){return as},perspective:function(){return ci},perspectiveFromFieldOfView:function(){return ao},perspectiveNO:function(){return Yn},perspectiveZO:function(){return Ui},rotate:function(){return st},rotateX:function(){return Ut},rotateY:function(){return wr},rotateZ:function(){return Ur},scale:function(){return Ar},set:function(){return tr},str:function(){return So},sub:function(){return Qn},subtract:function(){return os},targetTo:function(){return Ko},translate:function(){return xr},transpose:function(){return _r}});var $=R(58024),v=R(39144),ee=R(13062),F=R(71230),J=R(89032),re=R(15746),Ee=R(95300),ne=R(7277),je=R(21010),we=R(67294),et=R(25282),Mt=R(23185),nr=R(4322),_t=R(24770),Xt=R(89182),Ct=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},ot=(0,we.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,o=n===void 0?{height:"inherit"}:n,u=e.className,d=e.loading,g=e.loadingTemplate,_=e.errorTemplate,E=Ct(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),M=(0,Mt.Z)(et.aC,E),P=M.chart,D=M.container;return(0,we.useEffect)(function(){(0,nr.J)(r,P.current)},[P.current]),(0,we.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),we.createElement(_t.Z,{errorTemplate:_},d&&we.createElement(Xt.Z,{loadingTemplate:g}),we.createElement("div",{className:u,style:o,ref:D}))}),ut=ot,Jt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},X=(0,we.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,o=n===void 0?{height:"inherit"}:n,u=e.className,d=e.loading,g=e.loadingTemplate,_=e.errorTemplate,E=Jt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),M=(0,Mt.Z)(et.kB,E),P=M.chart,D=M.container;return(0,we.useEffect)(function(){(0,nr.J)(r,P.current)},[P.current]),(0,we.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),we.createElement(_t.Z,{errorTemplate:_},d&&we.createElement(Xt.Z,{loadingTemplate:g}),we.createElement("div",{className:u,style:o,ref:D}))}),Yt=X,dt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},qe=(0,we.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,o=n===void 0?{height:"inherit"}:n,u=e.className,d=e.loading,g=e.loadingTemplate,_=e.errorTemplate,E=dt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),M=(0,Mt.Z)(et.Kj,E),P=M.chart,D=M.container;return(0,we.useEffect)(function(){(0,nr.J)(r,P.current)},[P.current]),(0,we.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),we.createElement(_t.Z,{errorTemplate:_},d&&we.createElement(Xt.Z,{loadingTemplate:g}),we.createElement("div",{className:u,style:o,ref:D}))}),ht=qe,$e=R(90829),Rt=R(21349),yr=R(92077),Rr=R.n(yr),Hr=R(2824),Te=R(3182),Ye=R(69610),ke=R(54941),At=R(81306),gt=R(19809),Ft=R(94043),qt=R.n(Ft),Cr=(0,we.createContext)({});function Hn(){return(0,we.useContext)(Cr)}var hn={},Ki={},Bn=function(i){return Ki[i]},Gn=function(i,r){Ki[i]=r},hi=function(i){return hn[i]},Wn=function(i,r){hn[i]=r},si={},aa={},Ri=34,Si=10,Vi=13;function ua(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function wi(e,i){var r=ua(e);return function(n,o){return i(r(n),o,e)}}function xa(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var o in n)o in i||r.push(i[o]=o)}),r}function An(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function yi(e){return e<0?"-"+An(-e,6):e>9999?"+"+An(e,6):An(e,4)}function zi(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":yi(e.getUTCFullYear(),4)+"-"+An(e.getUTCMonth()+1,2)+"-"+An(e.getUTCDate(),2)+(o?"T"+An(i,2)+":"+An(r,2)+":"+An(n,2)+"."+An(o,3)+"Z":n?"T"+An(i,2)+":"+An(r,2)+":"+An(n,2)+"Z":r||i?"T"+An(i,2)+":"+An(r,2)+"Z":"")}function $i(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(P,D){var Z,Q,ue=o(P,function(ve,Ne){if(Z)return Z(ve,Ne-1);Q=ve,Z=D?wi(ve,D):ua(ve)});return ue.columns=Q||[],ue}function o(P,D){var Z=[],Q=P.length,ue=0,ve=0,Ne,it=Q<=0,mt=!1;P.charCodeAt(Q-1)===Si&&--Q,P.charCodeAt(Q-1)===Vi&&--Q;function bt(){if(it)return aa;if(mt)return mt=!1,si;var Kt,or=ue,br;if(P.charCodeAt(or)===Ri){for(;ue++<Q&&P.charCodeAt(ue)!==Ri||P.charCodeAt(++ue)===Ri;);return(Kt=ue)>=Q?it=!0:(br=P.charCodeAt(ue++))===Si?mt=!0:br===Vi&&(mt=!0,P.charCodeAt(ue)===Si&&++ue),P.slice(or+1,Kt-1).replace(/""/g,'"')}for(;ue<Q;){if((br=P.charCodeAt(Kt=ue++))===Si)mt=!0;else if(br===Vi)mt=!0,P.charCodeAt(ue)===Si&&++ue;else if(br!==r)continue;return P.slice(or,Kt)}return it=!0,P.slice(or,Q)}for(;(Ne=bt())!==aa;){for(var Vt=[];Ne!==si&&Ne!==aa;)Vt.push(Ne),Ne=bt();D&&(Vt=D(Vt,ve++))==null||Z.push(Vt)}return Z}function u(P,D){return P.map(function(Z){return D.map(function(Q){return M(Z[Q])}).join(e)})}function d(P,D){return D==null&&(D=xa(P)),[D.map(M).join(e)].concat(u(P,D)).join(`
`)}function g(P,D){return D==null&&(D=xa(P)),u(P,D).join(`
`)}function _(P){return P.map(E).join(`
`)}function E(P){return P.map(M).join(e)}function M(P){return P==null?"":P instanceof Date?zi(P):i.test(P+="")?'"'+P.replace(/"/g,'""')+'"':P}return{parse:n,parseRows:o,format:d,formatBody:g,formatRows:_,formatRow:E,formatValue:M}}var ja=$i(","),me=ja.parse,Ln=ja.parseRows,Va=ja.format,fs=ja.formatBody,zt=ja.formatRows,ir=ja.formatRow,Ir=ja.formatValue,I=R(96156),sr=R(85061),On=R(38163),ui=R.n(On);function Zn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function nn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ti(e,i){var r=i.x,n=i.y,o=i.x1,u=i.y1,d=i.coordinates,g=[];return e.forEach(function(_,E){var M=[];if(r&&n&&(M=[parseFloat(_[r]),parseFloat(_[n])]),r&&n&&o&&u){var P=[parseFloat(_[r]),parseFloat(_[n])],D=[parseFloat(_[o]),parseFloat(_[u])];M=[P,D]}if(d){var Z="Polygon";Array.isArray(d[0])||(Z="Point"),Array.isArray(d[0])&&!Array.isArray(d[0][0])&&(Z="LineString");var Q={type:Z,coordinates:(0,sr.Z)(_[d])};ui()(Q,!0),M=Q.coordinates}var ue=nn(nn({},_),{},{_id:E,coordinates:M});g.push(ue)}),{dataArray:g}}var Mi=[{lng1:100,lat1:30,lng2:130,lat2:30}],Ya={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function hs(e,i){var r=me(e);return Ti(r,i)}var va=63710088e-1,Ra={centimeters:va*100,centimetres:va*100,degrees:va/111325,feet:va*3.28084,inches:va*39.37,kilometers:va/1e3,kilometres:va/1e3,meters:va,metres:va,miles:va/1609.344,millimeters:va*1e3,millimetres:va*1e3,nauticalmiles:va/1852,radians:1,yards:va*1.0936},Sa={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/va,yards:1.0936133},V={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function K(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function se(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return pe(i).geometry;case"Polygon":return Ve(i).geometry;case"MultiPoint":return Lt(i).geometry;case"MultiLineString":return vr(i).geometry;case"MultiPolygon":return Dt(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ta(e[0])||!ta(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return K(n,i,r)}function Ie(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return ge(n,i)}),r)}function Ve(e,i,r){r===void 0&&(r={});for(var n=0,o=e;n<o.length;n++){var u=o[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var g={type:"Polygon",coordinates:e};return K(g,i,r)}function rt(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return Ve(n,i)}),r)}function pe(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return K(n,i,r)}function De(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return pe(n,i)}),r)}function yt(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function vr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return K(n,i,r)}function Lt(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return K(n,i,r)}function Dt(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return K(n,i,r)}function gr(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return K(n,i,r)}function bn(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function ln(e,i){i===void 0&&(i="kilometers");var r=Ra[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Tt(e,i){i===void 0&&(i="kilometers");var r=Ra[i];if(!r)throw new Error(i+" units is invalid");return e/r}function on(e,i){return Wr(Tt(e,i))}function Vr(e){var i=e%360;return i<0&&(i+=360),i}function Wr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function ii(e){var i=e%360;return i*Math.PI/180}function en(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ln(Tt(e,i),r)}function Ci(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=V[i];if(!n)throw new Error("invalid original units");var o=V[r];if(!o)throw new Error("invalid final units");return e/n*o}function ta(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function gi(e){return!!e&&e.constructor===Object}function Pi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!ta(i))throw new Error("bbox must only contain numbers")})}function _i(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Jn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Xi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function La(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return La(e[0]);throw new Error("coordinates must only contain numbers")}function oa(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Ii(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Gi(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,o=e.features;n<o.length;n++){var u=o[n];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+u.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function tu(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function wa(e,i,r){if(e!==null)for(var n,o,u,d,g,_,E,M=0,P=0,D,Z=e.type,Q=Z==="FeatureCollection",ue=Z==="Feature",ve=Q?e.features.length:1,Ne=0;Ne<ve;Ne++){E=Q?e.features[Ne].geometry:ue?e.geometry:e,D=E?E.type==="GeometryCollection":!1,g=D?E.geometries.length:1;for(var it=0;it<g;it++){var mt=0,bt=0;if(d=D?E.geometries[it]:E,d!==null){_=d.coordinates;var Vt=d.type;switch(M=r&&(Vt==="Polygon"||Vt==="MultiPolygon")?1:0,Vt){case null:break;case"Point":if(i(_,P,Ne,mt,bt)===!1)return!1;P++,mt++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(i(_[n],P,Ne,mt,bt)===!1)return!1;P++,Vt==="MultiPoint"&&mt++}Vt==="LineString"&&mt++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(o=0;o<_[n].length-M;o++){if(i(_[n][o],P,Ne,mt,bt)===!1)return!1;P++}Vt==="MultiLineString"&&mt++,Vt==="Polygon"&&bt++}Vt==="Polygon"&&mt++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(bt=0,o=0;o<_[n].length;o++){for(u=0;u<_[n][o].length-M;u++){if(i(_[n][o][u],P,Ne,mt,bt)===!1)return!1;P++}bt++}mt++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(wa(d.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ca(e,i,r,n){var o=r;return wa(e,function(u,d,g,_,E){d===0&&r===void 0?o=u:o=i(o,u,d,g,_,E)},n),o}function ys(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ps(e,i,r){var n=r;return ys(e,function(o,u){u===0&&r===void 0?n=o:n=i(n,o,u)}),n}function ra(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Bu(e,i,r){var n=r;return ra(e,function(o,u){u===0&&r===void 0?n=o:n=i(n,o,u)}),n}function fo(e){var i=[];return wa(e,function(r){i.push(r)}),i}function Ba(e,i){var r,n,o,u,d,g,_,E,M,P,D=0,Z=e.type==="FeatureCollection",Q=e.type==="Feature",ue=Z?e.features.length:1;for(r=0;r<ue;r++){for(g=Z?e.features[r].geometry:Q?e.geometry:e,E=Z?e.features[r].properties:Q?e.properties:{},M=Z?e.features[r].bbox:Q?e.bbox:void 0,P=Z?e.features[r].id:Q?e.id:void 0,_=g?g.type==="GeometryCollection":!1,d=_?g.geometries.length:1,o=0;o<d;o++){if(u=_?g.geometries[o]:g,u===null){if(i(null,D,E,M,P)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(u,D,E,M,P)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(i(u.geometries[n],D,E,M,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}D++}}function eo(e,i,r){var n=r;return Ba(e,function(o,u,d,g,_){u===0&&r===void 0?n=o:n=i(n,o,u,d,g,_)}),n}function Ji(e,i){Ba(e,function(r,n,o,u,d){var g=r===null?null:r.type;switch(g){case null:case"Point":case"LineString":case"Polygon":return i(K(r,o,{bbox:u,id:d}),n,0)===!1?!1:void 0}var _;switch(g){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var M=r.coordinates[E],P={type:_,coordinates:M};if(i(K(P,o),n,E)===!1)return!1}})}function Go(e,i,r){var n=r;return Ji(e,function(o,u,d){u===0&&d===0&&r===void 0?n=o:n=i(n,o,u,d)}),n}function Ho(e,i){Ji(e,function(r,n,o){var u=0;if(!!r.geometry){var d=r.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var g,_=0,E=0,M=0;if(wa(r,function(P,D,Z,Q,ue){if(g===void 0||n>_||Q>E||ue>M){g=P,_=n,E=Q,M=ue,u=0;return}var ve=lineString([g,P],r.properties);if(i(ve,n,o,ue,u)===!1)return!1;u++,g=P})===!1)return!1}}})}function zu(e,i,r){var n=r,o=!1;return Ho(e,function(u,d,g,_,E){o===!1&&r===void 0?n=u:n=i(n,u,d,g,_,E),o=!0}),n}function _o(e,i){if(!e)throw new Error("geojson is required");Ji(e,function(r,n,o){if(r.geometry!==null){var u=r.geometry.type,d=r.geometry.coordinates;switch(u){case"LineString":if(i(r,n,o,0,0)===!1)return!1;break;case"Polygon":for(var g=0;g<d.length;g++)if(i(lineString(d[g],r.properties),n,o,g)===!1)return!1;break}}})}function Wo(e,i,r){var n=r;return _o(e,function(o,u,d,g){u===0&&r===void 0?n=o:n=i(n,o,u,d,g)}),n}function ma(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,u=i.segmentIndex||0,d=i.properties,g;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,g=e.features[r].geometry;break;case"Feature":d=d||e.properties,g=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":g=e;break;default:throw new Error("geojson is invalid")}if(g===null)return null;var _=g.coordinates;switch(g.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),lineString([_[u],_[u+1]],d,i);case"Polygon":return o<0&&(o=_.length+o),u<0&&(u=_[o].length+u-1),lineString([_[o][u],_[o][u+1]],d,i);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u-1),lineString([_[n][u],_[n][u+1]],d,i);case"MultiPolygon":return n<0&&(n=_.length+n),o<0&&(o=_[n].length+o),u<0&&(u=_[n][o].length-u-1),lineString([_[n][o][u],_[n][o][u+1]],d,i)}throw new Error("geojson is invalid")}function ho(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,u=i.coordIndex||0,d=i.properties,g;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,g=e.features[r].geometry;break;case"Feature":d=d||e.properties,g=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":g=e;break;default:throw new Error("geojson is invalid")}if(g===null)return null;var _=g.coordinates;switch(g.type){case"Point":return point(_,d,i);case"MultiPoint":return n<0&&(n=_.length+n),point(_[n],d,i);case"LineString":return u<0&&(u=_.length+u),point(_[u],d,i);case"Polygon":return o<0&&(o=_.length+o),u<0&&(u=_[o].length+u),point(_[o][u],d,i);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u),point(_[n][u],d,i);case"MultiPolygon":return n<0&&(n=_.length+n),o<0&&(o=_[n].length+o),u<0&&(u=_[n][o].length-u),point(_[n][o][u],d,i)}throw new Error("geojson is invalid")}function Xo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function to(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ru(e,i){var r=[],n={};if(e.features=e.features.filter(function(u){var d=u.geometry;return u!=null&&d&&d.type&&d.coordinates&&d.coordinates.length>0}),ui()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var o=0;return Ji(e,function(u,d){var g=Xi(u),_=d,E=to(to({},u.properties),{},{coordinates:g,_id:_});r.push(E)}),{dataArray:r,featureKeys:n}}function bc(e){var i=131,r=137,n=0;e+="x";for(var o=Math.floor(9007199254740991/r),u=0;u<e.length;u++)n>o&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(u);return n}function Os(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var ie=R(28481),xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Qe(e){this.message=e}Qe.prototype=new Error,Qe.prototype.name="InvalidCharacterError";function Ot(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Qe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,o,u,d=0;u=i.charAt(d++);~u&&(o=n%4?o*64+u:u,n++%4)?r+=String.fromCharCode(255&o>>(-2*n&6)):0)u=xe.indexOf(u);return r}function Fr(e){e=String(e);for(var i,r,n,o,u="",d=0,g=e.length%3;d<e.length;){if((r=e.charCodeAt(d++))>255||(n=e.charCodeAt(d++))>255||(o=e.charCodeAt(d++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|o,u+=xe.charAt(i>>18&63)+xe.charAt(i>>12&63)+xe.charAt(i>>6&63)+xe.charAt(i&63)}return g?u.slice(0,g-3)+"===".substring(g):u}var pt=R(6610),jt=R(5991),ro=function(){function e(i,r){(0,pt.Z)(this,e),this.buffers=i,this.type=r}return(0,jt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,o){throw new Error("not implemented")}}]),e}(),Qi;typeof window=="undefined"?Qi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Qi=window;var Ga=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Yo=Ga?my.getSystemInfoSync().pixelRatio:Qi.devicePixelRatio,En=R(10379),vn=R(46070),Qt=R(77608),No=function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()},be=R(63349);function Gs(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=nu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function nu(e,i){if(!!e){if(typeof e=="string")return ds(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ds(e,i)}}function ds(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var sa=new WeakMap,po=function(){function e(){(0,pt.Z)(this,e),sa.set(this,{})}return(0,jt.Z)(e,[{key:"addEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=sa.get(this);u||(u={}),u[r]||(u[r]=[]),u[r].push(n),sa.set(this,u),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=sa.get(this);if(u){var d=u[r];if(d&&d.length>0){for(var g=d.length;g--;g>0)if(d[g]===n){d.splice(g,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=sa.get(this)[r.type];if(n){var o=Gs(n),u;try{for(o.s();!(u=o.n()).done;){var d=u.value;d(r)}}catch(g){o.e(g)}finally{o.f()}}}}]),e}();function Xl(e){var i=Ec();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Ec(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uu=function(e){(0,En.Z)(r,e);var i=Xl(r);function r(){var n;return(0,pt.Z)(this,r),n=i.call(this),(0,I.Z)((0,be.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,jt.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var u=this.childNodes.findIndex(function(d){return d===o});return u>-1?this.childNodes.splice(u,1):null}}]),r}(po);function Sc(e){var i=Sl();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zu=function(e){(0,En.Z)(r,e);var i=Sc(r);function r(){var n;return(0,pt.Z)(this,r),n=i.call(this),(0,I.Z)((0,be.Z)(n),"className",void 0),(0,I.Z)((0,be.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,jt.Z)(r,[{key:"setAttribute",value:function(o,u){this[o]=u}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,u){this[o]=u}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(Uu),iu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ju,y,C,N;if(iu){var O=my.getSystemInfoSync();ju=O.screenWidth,y=O.screenHeight,C=O.windowWidth,N=O.windowHeight}else{var q=Qi.innerWidth,_e=Qi.innerHeight;ju=q,y=_e,C=q,N=_e}var We={width:ju,height:y,availWidth:C,availHeight:N,availLeft:0,availTop:0},lt=We.availWidth,vt=We.availHeight,lr={style:[]};function Er(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return lr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return lr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Mn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:lt+"px",height:vt+"px",margin:"0px",padding:"0px"})}function li(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=lt,e.clientHeight=vt),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function $n(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=lt,e.offsetHeight=vt)}function Yi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=lt,e.scrollHeight=vt)}function fa(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Pa(e){var i=Hi();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Hi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Mo(){}var _s=function(e){(0,En.Z)(r,e);var i=Pa(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1?arguments[1]:void 0;return(0,pt.Z)(this,r),n=i.call(this),(0,I.Z)((0,be.Z)(n),"className",void 0),(0,I.Z)((0,be.Z)(n),"children",void 0),(0,I.Z)((0,be.Z)(n),"focus",void 0),(0,I.Z)((0,be.Z)(n),"blur",void 0),(0,I.Z)((0,be.Z)(n),"insertBefore",void 0),(0,I.Z)((0,be.Z)(n),"appendChild",void 0),(0,I.Z)((0,be.Z)(n),"removeChild",void 0),(0,I.Z)((0,be.Z)(n),"remove",void 0),(0,I.Z)((0,be.Z)(n),"innerHTML",void 0),(0,I.Z)((0,be.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Mo,n.blur=Mo,n.insertBefore=Mo,n.appendChild=Mo,n.removeChild=Mo,n.remove=Mo,n.innerHTML="",n.tagName=o.toUpperCase(),Er((0,be.Z)(n),u),Mn((0,be.Z)(n)),fa((0,be.Z)(n)),li((0,be.Z)(n)),$n((0,be.Z)(n)),Yi((0,be.Z)(n)),n}return r}(Zu);function sl(e){var i=Gc();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vu=function(e){(0,En.Z)(r,e);var i=sl(r);function r(n){return(0,pt.Z)(this,r),i.call(this,n)}return(0,jt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(_s);function wc(e){var i=wu();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cu=function(e){(0,En.Z)(r,e);var i=wc(r);function r(){return(0,pt.Z)(this,r),i.call(this,"video")}return r}(Vu),xo={},ha={};function th(e,i){xo=e,xo.id=i,"tagName"in xo||(xo.tagName="CANVAS"),xo.type="canvas",Mixin.parentNode(xo),Mixin.style(xo),Mixin.classList(xo),Mixin.clientRegion(xo),Mixin.offsetRegion(xo),xo.focus=function(){},xo.blur=function(){}}function rh(e,i){var r=1024,n=1024;ha={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in ha||(ha.tagName="CANVAS"),Mixin.parentNode(ha),Mixin.style(ha),Mixin.classList(ha),Mixin.clientRegion(ha),Mixin.offsetRegion(ha),ha.getContext=function(o){if(o==="2d")return e},ha.focus=function(){},ha.blur=function(){}}function uo(){return xo}function Mf(){return ha}var fu=function e(){(0,pt.Z)(this,e);var i=uo(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Er(r),fa(r),Object.assign(r,{addEventListener:function(o,u){r["on".concat(o)]=u.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r},Rs={href:"",protocol:"",host:""};function Cc(e){var i=ul();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ba=function(e){(0,En.Z)(r,e);var i=Cc(r);function r(){return(0,pt.Z)(this,r),i.call(this,"body",0)}return(0,jt.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u,d){}},{key:"dispatchEvent",value:function(o){}}]),r}(_s),wl=function(e){(0,En.Z)(r,e);var i=Cc(r);function r(){return(0,pt.Z)(this,r),i.call(this,"html",0)}return(0,jt.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u){}},{key:"dispatchEvent",value:function(o){}}]),r}(_s),Yl={},es={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Rs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new fu:i==="video"?new cu:new _s(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){Yl[i]||(Yl[i]=[]),Yl[i].push(r)},removeEventListener:function(i,r){var n=Yl[i];if(n&&n.length>0){for(var o=n.length;o--;o>0)if(n[o]===r){n.splice(o,1);break}}},dispatchEvent:function(i){var r=i.type,n=Yl[r];if(n)for(var o=0;o<n.length;o++)n[o](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new No(i)}};es.documentElement=new wl,es.head=new _s("head"),es.body=new ba;var Pf=Object,nh=R(90484),ih=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,nh.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,jt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Hc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ll,Bo,Cu;if(Hc){var Gu=my.getSystemInfoSync();ll=Gu.system,Bo=Gu.platform,Cu=Gu.language}else{var zo={versions:function(){var e=Qi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Qi.navigator.browserLanguage||Qi.navigator.language).toLowerCase()};zo.versions.android?Bo="android":zo.versions.trident?Bo="IE":zo.versions.presto?Bo="Opera":zo.versions.webKit?Bo="webKit":zo.versions.gecko?Bo="Firefox":zo.versions.mobile?Bo="mobile":zo.versions.ios?Bo="ios":zo.versions.iPhone?Bo="iPhone":zo.versions.iPad?Bo="ipad":zo.versions.webApp?Bo="webApp":zo.versions.weixin?Bo="weixin":zo.versions.qq&&(Bo="qq"),ll=Qi.navigator.userAgent,Cu=zo.language}var Cl=ll.toLowerCase().indexOf("android")!==-1,Hu=Cl?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Hs="Mozilla/5.0 (".concat(Hu,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Cu),Wc={platform:Bo,language:Cu,appVersion:"5.0 (".concat(Hu,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Hs},Xc={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},Yc=0,Wu=0;function ql(e){var i=Date.now(),r=Math.max(Yc+23,i);return Wu=setTimeout(function(){e(Yc=r)},r-i),Wu}function Ac(e){var i=uo();return i.requestAnimationFrame?i.requestAnimationFrame(e):ql(e)}function qc(e){var i=uo();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Tc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,pt.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,jt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],o=r.type,u=ah(n),d="data:".concat(o,";base64, ");return d+u}}]),e}();function ah(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,o=0;o<n;o++)i+=String.fromCharCode(r[o]);return Fr(i)}var Mc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},cl={};function Kc(e){var i=$c();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function $c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Au=new Map,Jc=new Map,If=new Map,oh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Al(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Yh(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Al.call(this,"readystatechange",i)}var ts=function(e){(0,En.Z)(r,e);var i=Kc(r);function r(){var n;return(0,pt.Z)(this,r),n=i.call(this),(0,I.Z)((0,be.Z)(n),"onabort",void 0),(0,I.Z)((0,be.Z)(n),"onerror",void 0),(0,I.Z)((0,be.Z)(n),"onload",void 0),(0,I.Z)((0,be.Z)(n),"onloadstart",void 0),(0,I.Z)((0,be.Z)(n),"onprogress",void 0),(0,I.Z)((0,be.Z)(n),"ontimeout",void 0),(0,I.Z)((0,be.Z)(n),"onloadend",void 0),(0,I.Z)((0,be.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,be.Z)(n),"readyState",void 0),(0,I.Z)((0,be.Z)(n),"response",void 0),(0,I.Z)((0,be.Z)(n),"responseText",void 0),(0,I.Z)((0,be.Z)(n),"_responseType",void 0),(0,I.Z)((0,be.Z)(n),"responseXML",void 0),(0,I.Z)((0,be.Z)(n),"status",void 0),(0,I.Z)((0,be.Z)(n),"statusText",void 0),(0,I.Z)((0,be.Z)(n),"upload",void 0),(0,I.Z)((0,be.Z)(n),"withCredentials",void 0),(0,I.Z)((0,be.Z)(n),"timeout",void 0),(0,I.Z)((0,be.Z)(n),"_url",void 0),(0,I.Z)((0,be.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Au.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,jt.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=If.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=Jc.get("responseHeader");return Object.keys(o).map(function(u){return"".concat(u,": ").concat(o[u])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return Jc.get("responseHeader")[o]}},{key:"open",value:function(o,u,d){this._method=o,this._url=u}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,u){var d=Au.get("requestHeader");d[o]=u,Au.set("requestHeader",d)}},{key:"addEventListener",value:function(o,u){var d=this;typeof u=="function"&&(this["on"+o]=function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};g.target=g.target||d,u.call(d,g)})}},{key:"removeEventListener",value:function(o,u){this["on"+o]===u&&(this["on"+o]=null)}}]),r}(po);(0,I.Z)(ts,"UNSEND",void 0),(0,I.Z)(ts,"OPENED",void 0),(0,I.Z)(ts,"HEADERS_RECEIVED",void 0),(0,I.Z)(ts,"LOADING",void 0),(0,I.Z)(ts,"DONE",void 0),ts.UNSEND=0,ts.OPENED=1,ts.HEADERS_RECEIVED=2,ts.LOADING=3,ts.DONE=4;function Ha(e){var i=Kl();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Kl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tl=function(e){(0,En.Z)(r,e);var i=Ha(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,be.Z)(o),"touches",void 0),(0,I.Z)((0,be.Z)(o),"targetTouches",void 0),(0,I.Z)((0,be.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=uo(),o.currentTarget=uo(),o}return r}(No);function au(e){var i=e||{},r=i.x,n=r===void 0?0:r,o=i.y,u=o===void 0?0:o,d=i.clientX,g=d===void 0?0:d,_=i.clientY,E=_===void 0?0:_;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=u):(e.x=g,e.y=E)}function Di(e){return function(i){var r=new Tl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return au(n)}),r.touches.forEach(function(n){return au(n)}),r.targetTouches.forEach(function(n){return au(n)}),es.dispatchEvent(r)}}function ka(e){return function(i){i.type=e,es.dispatchEvent(i)}}var Ls=Di("touchstart"),Qc=Di("touchmove"),fl=Di("touchend"),ef=ka("mapCameaParams");function qh(e){var i=Kh();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Kh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pc=function(e){(0,En.Z)(r,e);var i=qh(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,be.Z)(o),"buttons",void 0),(0,I.Z)((0,be.Z)(o),"which",void 0),(0,I.Z)((0,be.Z)(o),"pointerId",void 0),(0,I.Z)((0,be.Z)(o),"bubbles",void 0),(0,I.Z)((0,be.Z)(o),"button",void 0),(0,I.Z)((0,be.Z)(o),"width",void 0),(0,I.Z)((0,be.Z)(o),"height",void 0),(0,I.Z)((0,be.Z)(o),"pressure",void 0),(0,I.Z)((0,be.Z)(o),"isPrimary",void 0),(0,I.Z)((0,be.Z)(o),"pointerType",void 0),(0,I.Z)((0,be.Z)(o),"altKey",void 0),(0,I.Z)((0,be.Z)(o),"ctrlKey",void 0),(0,I.Z)((0,be.Z)(o),"metaKey",void 0),(0,I.Z)((0,be.Z)(o),"shiftKey",void 0),o.target=uo(),o.currentTarget=uo(),o}return r}(No),$l=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Xu=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Po="touch";function Jl(e,i,r){for(var n=new Pc(e),o=0;o<$l.length;o++){var u=$l[o];n[u]=i[u]||Xu[o]}return n.type=e,n.target=uo(),n.currentTarget=uo(),n.buttons=Ql(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=mn(i),n.pointerType=Po,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Ql(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var qa=null;function mn(e){return qa===e.identifier}function no(e){qa===null&&(qa=e.identifier)}function Yu(e){qa===e.identifier&&(qa=null)}function qu(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var o=r[n];n===0&&e==="pointerdown"?no(o):(e==="pointerup"||e==="pointercancel")&&Yu(o);var u=Jl(e,o,i);es.dispatchEvent(u)}}}var hu=qu("pointerdown"),ks=qu("pointermove"),Of=qu("pointerup");function Kr(e){var i=tf();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rf=function(e){(0,En.Z)(r,e);var i=Kr(r);function r(n){return(0,pt.Z)(this,r),i.call(this,n)}return r}(No);function Tu(e){return function(i){i.type=e,es.dispatchEvent(i)}}var za=Tu("mousedown"),Ds=Tu("mousemove"),rf=Tu("mouseup"),Mu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ws=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),bo=Mu||ws,sh={atob:Ot,btoa:Fr,devicePixelRatio:Yo,Blob:ro,document:es,Element:Zu,Event:No,EventTarget:po,HTMLCanvasElement:Pf,HTMLElement:_s,HTMLMediaElement:Vu,HTMLVideoElement:cu,Image:fu,ImageData:ih,navigator:Wc,Node:Uu,requestAnimationFrame:Ac,cancelAnimationFrame:qc,screen:We,XMLHttpRequest:ts,performance:Xc,URL:Tc,WebGLRenderingContext:Mc,WebGL2RenderingContext:cl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};es.addEventListener(i,r,n)},removeEventListener:function(i,r,n){es.removeEventListener(i,r)},dispatchEvent:function(i){es.dispatchEvent(i)},innerWidth:We.availWidth,innerHeight:We.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ga=bo?sh:Qi,Lf=bo?ts:Qi.XMLHttpRequest,uh=bo?Rs:Qi.location;function Ws(e){var i=e;return typeof e=="string"&&(i=ga.document.getElementById(e)),i}function Cs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Oi(e){return Cs(e).split(/\s+/)}function pu(e){var i,r,n=ga==null||(i=ga.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var o in e)if(e[o]&&e[o]in n)return e[o];return e[0]}function pa(e,i,r){var n=ga.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function lo(e){var i=e.parentNode;i&&i.removeChild(e)}function Fs(e,i){if(e.classList!==void 0)for(var r=Oi(i),n=0,o=r.length;n<o;n++)e.classList.add(r[n]);else if(!Ns(e,i)){var u=Bs(e);vs(e,(u?u+" ":"")+i)}}function ou(e,i){e.classList!==void 0?e.classList.remove(i):vs(e,Cs((" "+Bs(e)+" ").replace(" "+i+" "," ")))}function Ns(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Bs(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function vs(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Bs(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Pn(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var wn=pu(["transform","WebkitTransform"]);function ec(e,i){e.style[wn]=i}function ms(){if(typeof Event=="function")ga.dispatchEvent(new Event("resize"));else{var e=ga.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ga,0),ga.dispatchEvent(e)}}function du(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function qo(){var e,i=ga.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(o){var u=o.split("="),d=(0,ie.Z)(u,2),g=d[0],_=d[1];return g==="initial-scale"});return n?n.split("=")[1]*1:1}var Ea=qo()<1?1:ga.devicePixelRatio,Ic=R(14665);function Oc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var da=R(51814);function Aa(e,i,r){return(0,da.Z)()?Aa=Reflect.construct:Aa=function(o,u,d){var g=[null];g.push.apply(g,u);var _=Function.bind.apply(o,g),E=new _;return d&&(0,Ic.Z)(E,d.prototype),E},Aa.apply(null,arguments)}function Rc(e){var i=typeof Map=="function"?new Map:void 0;return Rc=function(n){if(n===null||!Oc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,o)}function o(){return Aa(n,arguments,(0,Qt.Z)(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Ic.Z)(o,n)},Rc(e)}function Ml(e){var i=vu();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xs=function(e){(0,En.Z)(r,e);var i=Ml(r);function r(n,o,u){var d;return(0,pt.Z)(this,r),d=i.call(this,n),(0,I.Z)((0,be.Z)(d),"status",void 0),(0,I.Z)((0,be.Z)(d),"url",void 0),d.status=o,d.url=u,d.name=d.constructor.name,d.message=n,d}return(0,jt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Rc(Error));function Io(e){var i=new Lf;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var hl=function(i,r){var n=Io(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var o;try{o=JSON.parse(n.response)}catch(u){return r(u)}r(null,o)}else n.status===401?r(new Xs("".concat(n.statusText),n.status,i.url)):r(new Xs(n.statusText,n.status,i.url))},n.send(),n},mu=function(i,r){var n=Io(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var o=n.response;if(o.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:o,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Xs(n.statusText,n.status,i.url))},n.send(),n};function nf(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Pl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Il=function(i,r){return mu(i,function(n,o){if(n)r(n);else if(o){var u=new ga.Image;u.crossOrigin="anonymous";var d=ga.URL||ga.webkitURL;u.onload=function(){r(null,u),d.revokeObjectURL(u.src)};var g=new ga.Blob([new Uint8Array(o.data)],{type:"image/png"});u.src=o.data.byteLength?d.createObjectURL(g):Pl}})},Ol=2*Math.PI*6378137/2;function tc(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;pl(i,n)}),i}function pl(e,i){return Array.isArray(i[0])?i.forEach(function(r){pl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function lh(e,i){return Ku(e,i)}function Ku(e,i){return Array.isArray(e[0])?e.map(function(r){return Ku(r,i)}):i(e)}function Pu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=af(e,i);var n=e[0],o=e[1],u=n*Ol/180,d=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return d=d*Ol/180,r.enable&&(u=Number(u.toFixed(r.decimal)),d=Number(d.toFixed(r.decimal))),e.length===3?[u,d,e[2]]:[u,d]}function kf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],o=r/Ol*180,u=n/Ol*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),i!=null&&(o=Number(o.toFixed(i)),u=Number(u.toFixed(i))),e.length===3?[o,u,e[2]]:[o,u]}function dl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Ys(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function af(e,i){if(i===!1)return e;var r=dl(e[0]),n=Ys(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function gu(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,o=Math.PI/180,u=e[0]*o,d=r*o;d=Math.log(Math.tan(Math.PI/4+d/2));var g=.5/Math.PI,_=.5,E=-.5/Math.PI;return o=.5,u=n*(g*u+_),d=n*(E*d+o),[Math.floor(u),Math.floor(d)]}function ch(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,o=.5,u=256<<20,d=_slicedToArray(e,2),g=d[0],_=d[1];g=(g/u-r)/i,_=(_/u-o)/n,_=(Math.atan(Math.pow(Math.E,_))-Math.PI/4)*2,o=Math.PI/180;var E=_/o,M=g/o;return[M,E]}function rc(e,i,r){var n=ii(i[1]-e[1]),o=ii(i[0]-e[0]),u=ii(e[1]),d=ii(i[1]),g=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(d);return ln(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),r="meters")}function l(e){var i=Math.PI/180,r=85.0511287798,n=6378137,o=Math.max(Math.min(r,e[1]),-r),u=Math.sin(o*i),d=n*e[0]*i,g=n*Math.log((1+u)/(1-u))/2;return[d,g]}function f(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function c(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function p(e){return[[e[0],e[1]],[e[2],e[3]]]}var b=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,pt.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,jt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(o){return o===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function w(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var A=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,pt.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,jt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),o=n-this.timestamp;this.timestamp=n,o>=this.duration&&r()}}]),e}(),L=R(2650);function U(e){var i=L.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function W(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],o=i+r*256+n*65536-1;return o}function fe(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function he(e){var i=ga.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),o=null,u=e.positions[0],d=e.positions[e.positions.length-1],g=0;g<e.colors.length;++g){var _=(e.positions[g]-u)/(d-u);n.addColorStop(_,e.colors[g])}return r.fillStyle=n,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),bo?{data:o,width:256,height:1}:new ImageData(o,256,1)}var de;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(de||(de={}));var Le={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Oe(e,i,r){var n=e.classList;for(var o in Le)Le.hasOwnProperty(o)&&n.remove("l7-".concat(r,"-anchor-").concat(o));n.add("l7-".concat(r,"-anchor-").concat(i))}function Xe(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Ae(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function He(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function tt(e){if(e.length===0)throw new Error("mean requires at least one data point");return He(e)/e.length}function xt(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,o=1,u=1;u<e.length+1;u++)e[u]!==i?(o>n&&(n=o,r=i),o=1,i=e[u]):o++;return r*1}var Gt={min:Ae,max:Xe,mean:tt,sum:He,mode:xt};function Nt(e,i){return e.map(function(r){return r[i]})}function er(e,i){return Gt[e](i)}function mr(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(d){zr(e,function(g){d(g)})}),u={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return u}function zr(e,i){var r=e,n=[];if(typeof r=="string")Il({url:r},function(d,g){n.push(g),i(n)});else{var o=r.length,u=0;r.forEach(function(d){Il({url:d},function(g,_){u++,n.push(_),u===o&&i(n)})})}return mr}function Br(e,i){var r=i.extent,n=i.width,o=i.height,u=i.min,d=i.max,g={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:o,min:u,max:d,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return g}var sn=R(30236),kn=R.n(sn),Dn=R(47037),Cn=R.n(Dn),Fi=R(23560),$r=R.n(Fi),ai=R(50361),ri=R.n(ai),qn=R(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function jn(e,i,r,n){function o(u){return u instanceof r?u:new r(function(d){d(u)})}return new(r||(r=Promise))(function(u,d){function g(M){try{E(n.next(M))}catch(P){d(P)}}function _(M){try{E(n.throw(M))}catch(P){d(P)}}function E(M){M.done?u(M.value):o(M.value).then(g,_)}E((n=n.apply(e,i||[])).next())})}function pi(e,i){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,o,u,d;return d={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function g(E){return function(M){return _([E,M])}}function _(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(u=E[0]&2?o.return:E[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,E[1])).done)return u;switch(o=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,o=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){r.label=E[1];break}if(E[0]===6&&r.label<u[1]){r.label=u[1],u=E;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(E);break}u[2]&&r.ops.pop(),r.trys.pop();continue}E=i.call(e,r)}catch(M){E=[6,M],o=0}finally{n=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function Xn(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,u=[],d;try{for(;(i===void 0||i-- >0)&&!(o=n.next()).done;)u.push(o.value)}catch(g){d={error:g}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(d)throw d.error}}return u}function Vn(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Xn(arguments[i]));return e}function qi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Li(e,i){return i={exports:{}},e(i,i.exports),i.exports}var vo=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});qi(vo);var Oo=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];var u=n.pop();return r.call(this,n,u)}},e.exports=i.default});qi(Oo);var Ia=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=o,i.wrap=u;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof qn=="object"&&typeof qn.nextTick=="function";function o(g){setTimeout(g,0)}function u(g){return function(_){for(var E=[],M=arguments.length-1;M-- >0;)E[M]=arguments[M+1];return g(function(){return _.apply(void 0,E)})}}var d;r?d=setImmediate:n?d=qn.nextTick:d=o,i.default=u(d)});qi(Ia);var mo=Ia.fallback,zs=Ia.wrap,xs=Ia.hasSetImmediate,$u=Ia.hasNextTick,rs=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(Oo),n=o(Ia);function o(_){return _&&_.__esModule?_:{default:_}}function u(_){return(0,Eo.isAsync)(_)?function(){for(var E=[],M=arguments.length;M--;)E[M]=arguments[M];var P=E.pop(),D=_.apply(this,E);return d(D,P)}:(0,r.default)(function(E,M){var P;try{P=_.apply(this,E)}catch(D){return M(D)}if(P&&typeof P.then=="function")return d(P,M);M(null,P)})}function d(_,E){return _.then(function(M){g(E,null,M)},function(M){g(E,M&&M.message?M:new Error(M))})}function g(_,E,M){try{_(E,M)}catch(P){(0,n.default)(function(D){throw D},P)}}e.exports=i.default});qi(rs);var Eo=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(rs);function n(_){return _&&_.__esModule?_:{default:_}}function o(_){return _[Symbol.toStringTag]==="AsyncFunction"}function u(_){return _[Symbol.toStringTag]==="AsyncGenerator"}function d(_){return typeof _[Symbol.asyncIterator]=="function"}function g(_){if(typeof _!="function")throw new Error("expected a function");return o(_)?(0,r.default)(_):_}i.default=g,i.isAsync=o,i.isAsyncGenerator=u,i.isAsyncIterable=d});qi(Eo);var su=Eo.isAsyncIterable,Lc=Eo.isAsyncGenerator,nc=Eo.isAsync,As=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,o){if(o===void 0&&(o=n.length),!o)throw new Error("arity is undefined");function u(){for(var d=this,g=[],_=arguments.length;_--;)g[_]=arguments[_];return typeof g[o-1]=="function"?n.apply(this,g):new Promise(function(E,M){g[o-1]=function(P){for(var D=[],Z=arguments.length-1;Z-- >0;)D[Z]=arguments[Z+1];if(P)return M(P);E(D.length>1?D:D[0])},n.apply(d,g)})}return Object.defineProperty(u,"name",{configurable:!0,value:"awaitable("+n.name+")"}),u}e.exports=i.default});qi(As);var Ju=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=u(vo),n=u(Eo),o=u(As);function u(d){return d&&d.__esModule?d:{default:d}}i.default=(0,o.default)(function(d,g,_){var E=(0,r.default)(g)?[]:{};d(g,function(M,P,D){(0,n.default)(M)(function(Z){for(var Q,ue=[],ve=arguments.length-1;ve-- >0;)ue[ve]=arguments[ve+1];ue.length<2&&(Q=ue,ue=Q[0]),E[P]=ue,D(Z)})},function(M){return _(M,E)})},3),e.exports=i.default});qi(Ju);var Qu=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function o(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(n!==null){var g=n;n=null,g.apply(this,u)}}return Object.assign(o,n),o}e.exports=i.default});qi(Qu);var qs=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});qi(qs);var vl=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=_;var r=o(vo),n=o(qs);function o(E){return E&&E.__esModule?E:{default:E}}function u(E){var M=-1,P=E.length;return function(){return++M<P?{value:E[M],key:M}:null}}function d(E){var M=-1;return function(){var D=E.next();return D.done?null:(M++,{value:D.value,key:M})}}function g(E){var M=E?Object.keys(E):[],P=-1,D=M.length;return function(){var Q=M[++P];return P<D?{value:E[Q],key:Q}:null}}function _(E){if((0,r.default)(E))return u(E);var M=(0,n.default)(E);return M?d(M):g(E)}e.exports=i.default});qi(vl);var Us=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n===null)throw new Error("Callback was already called.");var d=n;n=null,d.apply(this,o)}}e.exports=i.default});qi(Us);var io=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});qi(io);var yu=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=n(io);function n(u){return u&&u.__esModule?u:{default:u}}function o(u,d,g,_){var E=!1,M=!1,P=!1,D=0,Z=0;function Q(){D>=d||P||E||(P=!0,u.next().then(function(Ne){var it=Ne.value,mt=Ne.done;if(!(M||E)){if(P=!1,mt){E=!0,D<=0&&_(null);return}D++,g(it,Z,ue),Z++,Q()}}).catch(ve))}function ue(Ne,it){if(D-=1,!M){if(Ne)return ve(Ne);if(Ne===!1){E=!0,M=!0;return}if(it===r.default||E&&D<=0)return E=!0,_(null);Q()}}function ve(Ne){M||(P=!1,E=!0,_(Ne))}Q()}e.exports=i.default});qi(yu);var Iu=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=g(Qu),n=g(vl),o=g(Us),u=g(yu),d=g(io);function g(_){return _&&_.__esModule?_:{default:_}}i.default=function(_){return function(E,M,P){if(P=(0,r.default)(P),_<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return P(null);if((0,Eo.isAsyncGenerator)(E))return(0,u.default)(E,_,M,P);if((0,Eo.isAsyncIterable)(E))return(0,u.default)(E[Symbol.asyncIterator](),_,M,P);var D=(0,n.default)(E),Z=!1,Q=!1,ue=0,ve=!1;function Ne(mt,bt){if(!Q)if(ue-=1,mt)Z=!0,P(mt);else if(mt===!1)Z=!0,Q=!0;else{if(bt===d.default||Z&&ue<=0)return Z=!0,P(null);ve||it()}}function it(){for(ve=!0;ue<_&&!Z;){var mt=D();if(mt===null){Z=!0,ue<=0&&P(null);return}ue+=1,M(mt.value,mt.key,(0,o.default)(Ne))}ve=!1}it()}},e.exports=i.default});qi(Iu);var _u=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=u(Iu),n=u(Eo),o=u(As);function u(g){return g&&g.__esModule?g:{default:g}}function d(g,_,E,M){return(0,r.default)(_)(g,(0,n.default)(E),M)}i.default=(0,o.default)(d,4),e.exports=i.default});qi(_u);var na=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=o(_u),n=o(As);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,g,_){return(0,r.default)(d,1,g,_)}i.default=(0,n.default)(u,3),e.exports=i.default});qi(na);var Zs=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(Ju),n=o(na);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,g){return(0,r.default)(n.default,d,g)}e.exports=i.default}),ns=qi(Zs),is=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,ns(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(o){r.apply(void 0,Vn(n.args)),o(null,i)})},e}(),ic=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=E(vo),n=E(io),o=E(_u),u=E(Qu),d=E(Us),g=E(Eo),_=E(As);function E(Z){return Z&&Z.__esModule?Z:{default:Z}}function M(Z,Q,ue){ue=(0,u.default)(ue);var ve=0,Ne=0,it=Z.length,mt=!1;it===0&&ue(null);function bt(Vt,Kt){Vt===!1&&(mt=!0),mt!==!0&&(Vt?ue(Vt):(++Ne===it||Kt===n.default)&&ue(null))}for(;ve<it;ve++)Q(Z[ve],ve,(0,d.default)(bt))}function P(Z,Q,ue){return(0,o.default)(Z,Infinity,Q,ue)}function D(Z,Q,ue){var ve=(0,r.default)(Z)?M:P;return ve(Z,(0,g.default)(Q),ue)}i.default=(0,_.default)(D,3),e.exports=i.default});qi(ic);var kc=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(ic),n=o(Ju);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,g){return(0,n.default)(r.default,d,g)}e.exports=i.default}),of=qi(kc),Ks=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return of(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(o){return jn(n,void 0,void 0,function(){return pi(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),o(null,i),[2]}})})})},e}(),ac=Li(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=d(Qu),n=d(Us),o=d(Eo),u=d(As);function d(_){return _&&_.__esModule?_:{default:_}}function g(_,E){if(E=(0,r.default)(E),!Array.isArray(_))return E(new Error("First argument to waterfall must be an array of functions"));if(!_.length)return E();var M=0;function P(Z){var Q=(0,o.default)(_[M++]);Q.apply(void 0,Z.concat([(0,n.default)(D)]))}function D(Z){for(var Q=[],ue=arguments.length-1;ue-- >0;)Q[ue]=arguments[ue+1];if(Z!==!1){if(Z||M===_.length)return E.apply(void 0,[Z].concat(Q));P(Q)}}P([])}i.default=(0,u.default)(g),e.exports=i.default}),uu=qi(ac),ml=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return uu(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var o=r();n(o?null:!1,o)}):this.tasks.push(function(n,o){var u=r();o(u?null:!1,i)})},e}(),Rl=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return ns(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var o=r();n(o,i)})},e}(),Ro=R(26729),Uo=R.n(Ro),Dc=R(69848),sf=R.n(Dc);function Df(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function uf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Df(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Df(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fh(e,i){var r=i.radius,n=r===void 0?40:r,o=i.maxZoom,u=o===void 0?18:o,d=i.minZoom,g=d===void 0?0:d,_=i.zoom,E=_===void 0?2:_;if(e.pointIndex){var M=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=$h(M),e}var P=new(sf())({radius:n,minZoom:g,maxZoom:u}),D={type:"FeatureCollection",features:[]};return D.features=e.dataArray.map(function(Z){return{type:"Feature",geometry:{type:"Point",coordinates:Z.coordinates},properties:uf({},Z)}}),P.load(D.features),P}function $h(e){return e.map(function(i,r){return uf({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function oc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function lf(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Ff(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,o=1;o<e.length;o++)n=i+e[o]*1,Math.abs(i)>=Math.abs(e[o])?r+=i-n+e[o]:r+=e[o]-n+i,i=n;return i+r*1}function jp(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ff(e)/e.length}var Ll={min:lf,max:oc,mean:jp,sum:Ff};function cf(e,i){return e.map(function(r){return r[i]*1})}function Jh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Vp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ff(e){var i=Qh();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Qh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Td(e,i){if(Array.isArray(i))return i}var Md=function(e){(0,En.Z)(r,e);var i=ff(r);function r(n,o){var u;return(0,pt.Z)(this,r),u=i.call(this),(0,I.Z)((0,be.Z)(u),"data",void 0),(0,I.Z)((0,be.Z)(u),"extent",void 0),(0,I.Z)((0,be.Z)(u),"hooks",{init:new is}),(0,I.Z)((0,be.Z)(u),"parser",{type:"geojson"}),(0,I.Z)((0,be.Z)(u),"transforms",[]),(0,I.Z)((0,be.Z)(u),"cluster",!1),(0,I.Z)((0,be.Z)(u),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,be.Z)(u),"mapService",void 0),(0,I.Z)((0,be.Z)(u),"invalidExtent",!1),(0,I.Z)((0,be.Z)(u),"originData",void 0),(0,I.Z)((0,be.Z)(u),"rawData",void 0),(0,I.Z)((0,be.Z)(u),"cfg",{}),(0,I.Z)((0,be.Z)(u),"clusterIndex",void 0),u.originData=n,u.initCfg(o),u.hooks.init.tap("parser",function(){u.excuteParser()}),u.hooks.init.tap("cluster",function(){u.initCluster()}),u.hooks.init.tap("transform",function(){u.executeTrans()}),u.init(),u}return(0,jt.Z)(r,[{key:"setData",value:function(o,u){this.rawData=o,this.originData=o,this.initCfg(u),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var u=this,d=this.clusterOptions,g=d.method,_=g===void 0?"sum":g,E=d.field,M=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,M.forEach(function(P){P.id||(P.properties.point_count=1)}),(E||$r()(_))&&(M=M.map(function(P){var D=P.id;if(D){var Z=u.clusterIndex.getLeaves(D,Infinity),Q=Z.map(function(Ne){return Ne.properties}),ue;if(Cn()(_)&&E){var ve=cf(Q,E);ue=Ll[_](ve)}$r()(_)&&(ue=_(Q)),P.properties.stat=ue}else P.properties.point_count=1;return P})),this.data=Bn("geojson")({type:"FeatureCollection",features:M}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var u=this.parser.type,d=u===void 0?"geojson":u;if(d==="geojson"&&!this.cluster){var g=o<this.originData.features.length?this.originData.features[o]:"null",_=ri()(g);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(M){return M._id===o});_.properties=E}return _}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,u){var d=this.data.dataArray.find(function(g){return g[o]===name});return d==null?void 0:d._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var u=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(u=f(p(this.extent),o)),u[0].concat(u[1])}},{key:"initCfg",value:function(o){this.cfg=kn()(this.cfg,o,Td);var u=this.cfg;u&&(u.parser&&(this.parser=u.parser),u.transforms&&(this.transforms=u.transforms),this.cluster=u.cluster||!1,u.clusterOptions&&(this.cluster=!0,this.clusterOptions=Vp(Vp({},this.clusterOptions),u.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,u=o.type||"geojson";if(u==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var d=Bn(u);this.data=d(this.originData,o),this.extent=tc(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,u=this.transforms;u.forEach(function(d){var g=d.type,_=hi(g)(o.data,d);Object.assign(o.data,_)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=fh(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Ro.EventEmitter);function Gp(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function hh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Pd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function Pd(e,i){if(!!e){if(typeof e=="string")return Fc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fc(e,i)}}function Fc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ep=6378e3;function Lo(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,u=o/(2*Math.PI*ep)*(256<<20)/2,d=ph(r,o),g=d.gridHash,_=d.gridOffset,E=Nf(g,_,i);return{yOffset:u,xOffset:u,radius:u,type:"grid",dataArray:E}}function ph(e,i){var r=Infinity,n=-Infinity,o,u=hh(e),d;try{for(u.s();!(d=u.n()).done;){var g=d.value;o=g.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,n=o>n?o:n)}}catch(mt){u.e(mt)}finally{u.f()}var _=(r+n)/2,E=Hp(i,_);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var M={},P=hh(e),D;try{for(P.s();!(D=P.n()).done;){var Z=D.value,Q=Z.coordinates[1],ue=Z.coordinates[0];if(Number.isFinite(Q)&&Number.isFinite(ue)){var ve=Math.floor((Q+90)/E.yOffset),Ne=Math.floor((ue+180)/E.xOffset),it="".concat(ve,"-").concat(Ne);M[it]=M[it]||{count:0,points:[]},M[it].count+=1,M[it].points.push(Z)}}}catch(mt){P.e(mt)}finally{P.f()}return{gridHash:M,gridOffset:E}}function Hp(e,i){var r=dh(e),n=vh(i,e);return{yOffset:r,xOffset:n}}function dh(e){return e/ep*(180/Math.PI)}function vh(e,i){return i/ep*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Nf(e,i,r){return Object.keys(e).reduce(function(n,o,u){var d=o.split("-"),g=parseInt(d[0],10),_=parseInt(d[1],10),E={};if(r.field&&r.method){var M=Nt(e[o].points,r.field);E[r.method]=Gt[r.method](M)}return Object.assign(E,{_id:u,coordinates:gu([-180+i.xOffset*(_+.5),-90+i.yOffset*(g+.5)]),rawData:e[o].points,count:e[o].count}),n.push(E),n},[])}var kl=Math.PI/3,Bf=[0,kl,2*kl,3*kl,4*kl,5*kl];function sc(e){return e[0]}function hf(e){return e[1]}function zf(){var e=0,i=0,r=1,n=1,o=sc,u=hf,d,g,_;function E(P){var D={},Z=[],Q,ue=P.length;for(Q=0;Q<ue;++Q)if(!(isNaN(Ne=+o.call(null,ve=P[Q],Q,P))||isNaN(it=+u.call(null,ve,Q,P)))){var ve,Ne,it,mt=Math.round(it=it/_),bt=Math.round(Ne=Ne/g-(mt&1)/2),Vt=it-mt;if(Math.abs(Vt)*3>1){var Kt=Ne-bt,or=bt+(Ne<bt?-1:1)/2,br=mt+(it<mt?-1:1),rn=Ne-or,dn=it-br;Kt*Kt+Vt*Vt>rn*rn+dn*dn&&(bt=or+(mt&1?1:-1)/2,mt=br)}var Or=bt+"-"+mt,In=D[Or];In?In.push(ve):(Z.push(In=D[Or]=[ve]),In.x=(bt+(mt&1)/2)*g,In.y=mt*_)}return Z}function M(P){var D=0,Z=0;return Bf.map(function(Q){var ue=Math.sin(Q)*P,ve=-Math.cos(Q)*P,Ne=ue-D,it=ve-Z;return D=ue,Z=ve,[Ne,it]})}return E.hexagon=function(P){return"m"+M(P==null?d:+P).join("l")+"z"},E.centers=function(){for(var P=[],D=Math.round(i/_),Z=Math.round(e/g),Q=D*_;Q<n+d;Q+=_,++D)for(var ue=Z*g+(D&1)*g/2;ue<r+g/2;ue+=g)P.push([ue,Q]);return P},E.mesh=function(){var P=M(d).slice(0,4).join("l");return E.centers().map(function(D){return"M"+D+"m"+P}).join("")},E.x=function(P){return arguments.length?(o=P,E):o},E.y=function(P){return arguments.length?(u=P,E):u},E.radius=function(P){return arguments.length?(d=+P,g=d*2*Math.sin(kl),_=d*1.5,E):d},E.size=function(P){return arguments.length?(e=i=0,r=+P[0],n=+P[1],E):[r-e,n-i]},E.extent=function(P){return arguments.length?(e=+P[0][0],i=+P[0][1],r=+P[1][0],n=+P[1][1],E):[[e,i],[r,n]]},E.radius(1)}function Uf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Dl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Uf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var mh=6378e3;function Zf(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,u=i.method,d=u===void 0?"sum":u,g=o/(2*Math.PI*mh)*(256<<20)/2,_=r.map(function(D){var Z=gu(D.coordinates),Q=(0,ie.Z)(Z,2),ue=Q[0],ve=Q[1];return Dl(Dl({},D),{},{coordinates:[ue,ve]})}),E=zf().radius(g).x(function(D){return D.coordinates[0]}).y(function(D){return D.coordinates[1]}),M=E(_),P={dataArray:M.map(function(D,Z){var Q;if(i.field&&d){var ue=Nt(D,i.field);D[d]=Gt[d](ue)}return Q={},(0,I.Z)(Q,i.method,D[d]),(0,I.Z)(Q,"count",D.length),(0,I.Z)(Q,"rawData",D),(0,I.Z)(Q,"coordinates",[D.x,D.y]),(0,I.Z)(Q,"_id",Z),Q}),radius:g,xOffset:g,yOffset:g,type:"hexagon"};return P}function jf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Nc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pf(e,i){var r=i.sourceField,n=i.targetField,o=i.data,u={};return o.forEach(function(d){u[d[r]]=d}),e.dataArray=e.dataArray.map(function(d){var g=d[n];return Nc(Nc({},d),u[g])}),e}function $s(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var Vf=Md;Gn("geojson",ru),Gn("image",mr),Gn("csv",hs),Gn("json",Ti),Gn("raster",Br),Wn("cluster",fh),Wn("filter",Gp),Wn("join",pf),Wn("map",$s),Wn("grid",Lo),Wn("hexagon",Zf);var Gf=Mi,Hf=Ya,gh=R(28660),Gr=R(86700),gl=R(84879),Ht={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Wp=R(31745),yh=R.n(Wp);function tp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Xp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function xu(e,i){if(!!e){if(typeof e=="string")return rp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rp(e,i)}}function rp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var uc=30;function df(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,o=e.buffer,u=e.maxCanvasWidth,d=e.mapping,g=d===void 0?{}:d,_=e.xOffset,E=_===void 0?0:_,M=e.yOffset,P=M===void 0?0:M,D=0,Z=E;Array.from(i).forEach(function(ue,ve){if(!g[ue]){var Ne=r(ue,ve);Z+uc>u&&(Z=0,D++),g[ue]={x:Z,y:P+D*uc,width:uc,height:uc,advance:Ne},Z+=uc}});var Q=n+o*2;return{mapping:g,xOffset:Z,yOffset:P+D*Q,canvasHeight:qp(P+(D+1)*Q)}}function el(e,i,r){var n=0,o=0,u=0,d=[],g={},_=Yp(e),E;try{for(_.s();!(E=_.n()).done;){var M=E.value;if(!g[M.id]){var P=M.size;n+P+i>r&&(np(g,d,o),n=0,o=u+o+i,u=0,d=[]),d.push({icon:M,xOffset:n}),n=n+P+i,u=Math.max(u,P)}}}catch(Z){_.e(Z)}finally{_.f()}d.length>0&&np(g,d,o);var D=qp(u+o+i);return{mapping:g,canvasHeight:D}}function np(e,i,r){var n=Yp(i),o;try{for(n.s();!(o=n.n()).done;){var u=o.value,d=u.icon,g=u.xOffset;e[d.id]=Xp(Xp({},d),{},{x:g,y:r,image:d.image,width:d.width,height:d.height})}}catch(_){n.e(_)}finally{n.f()}}function qp(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var tl,Bc;function lc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cc(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function cc(e,i){if(!!e){if(typeof e=="string")return ip(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ip(e,i)}}function ip(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _h(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function vf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_h(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_h(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ap=Od(),ya="sans-serif",fc="normal",ko=24,Js=3,Kp=.25,$p=8,Jp=1024,Id=1,Qp=1,op=3,dv=null;function Od(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function mf(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function sp(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var ed=(tl=(0,Gr.b2)(),tl(Bc=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new b(op))}return(0,jt.Z)(e,[{key:"scale",get:function(){return Qp}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ya,fontWeight:fc,characterSet:ap,fontSize:ko,buffer:Js,sdf:!0,cutoff:Kp,radius:$p,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(o){n.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=vf(vf({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&n.length===0)){var u=this.generateFontAtlas(this.key,n,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,o){var u=this.fontOptions,d=u.fontFamily,g=u.fontWeight,_=u.fontSize,E=u.buffer,M=u.sdf,P=u.radius,D=u.cutoff,Z=u.iconfont,Q=o&&o.data;Q||(Q=ga.document.createElement("canvas"),Q.width=Jp);var ue=Q.getContext("2d");mf(ue,d,_,g);var ve=df(vf({getFontWidth:function(ol){return ue.measureText(ol).width},fontHeight:_*Qp,buffer:E,characterSet:n,maxCanvasWidth:Jp},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),Ne=ve.mapping,it=ve.canvasHeight,mt=ve.xOffset,bt=ve.yOffset,Vt=ue.getImageData(0,0,Q.width,Q.height);if(Q.height=it,ue.putImageData(Vt,0,0),mf(ue,d,_,g),M){var Kt=new(yh())(_,E,P,D,d,g),or=ue.getImageData(0,0,Kt.size,Kt.size),br=lc(n),rn;try{for(br.s();!(rn=br.n()).done;){var dn=rn.value;if(Z){var Or=String.fromCharCode(parseInt(dn.replace("&#x","").replace(";",""),16)),In=Kt.draw(Or);sp(In,or)}else sp(Kt.draw(dn),or);ue.putImageData(or,Ne[dn].x,Ne[dn].y)}}catch(Ss){br.e(Ss)}finally{br.f()}}else{var Un=lc(n),di;try{for(Un.s();!(di=Un.n()).done;){var Fo=di.value;ue.fillText(Fo,Ne[Fo].x,Ne[Fo].y+_*Id)}}catch(Ss){Un.e(Ss)}finally{Un.f()}}return{xOffset:mt,yOffset:bt,mapping:Ne,data:Q,width:Q.width,height:Q.height}}},{key:"getKey",value:function(){return"key";var r,n,o,u,d,g,_,E}},{key:"getNewChars",value:function(r,n){var o=this.cache.get(r);if(!o)return n;var u=[],d=o.mapping,g=new Set(Object.keys(d)),_=new Set(n);return _.forEach(function(E){g.has(E)||u.push(E)}),u}}]),e}())||Bc),gf,Oa;function up(e){var i=Fl();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yf=3,xh=1024,Wf=64,B=(gf=(0,Gr.b2)(),gf(Oa=function(e){(0,En.Z)(r,e);var i=up(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"canvasHeight",128),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"canvas",void 0),(0,I.Z)((0,be.Z)(n),"iconData",void 0),(0,I.Z)((0,be.Z)(n),"iconMap",void 0),(0,I.Z)((0,be.Z)(n),"ctx",void 0),(0,I.Z)((0,be.Z)(n),"loadingImageCount",0),n}return(0,jt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ga.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,u){var d=this,g=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Wf}),this.updateIconMap(),this.loadImage(u).then(function(_){g=_;var E=d.iconData.find(function(M){return M.id===o});E&&(E.image=g,E.width=g.width,E.height=g.height),d.update()})}},{key:"addImageMini",value:function(o,u,d){var g=this,_=d.getSceneConfig().canvas,E=_.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Wf}),this.updateIconMap(),this.loadImageMini(u,_).then(function(M){E=M;var P=g.iconData.find(function(D){return D.id===o});P&&(P.image=E,P.width=E.width,P.height=E.height),g.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(u){return u.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=xh,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(u){var d=o.iconMap[u],g=d.x,_=d.y,E=d.image,M=d.width,P=M===void 0?64:M,D=d.height,Z=D===void 0?64:D,Q=Math.max(P,Z),ue=Q/Wf,ve=Z/ue,Ne=P/ue;E&&o.ctx.drawImage(E,g+(Wf-Ne)/2,_+(Wf-ve)/2,Ne,ve)})}},{key:"updateIconMap",value:function(){var o=el(this.iconData,yf,xh),u=o.mapping,d=o.canvasHeight;this.iconMap=u,this.canvasHeight=d}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var g=new Image;g.crossOrigin="anonymous",g.onload=function(){u(g)},g.onerror=function(){d(new Error("Could not load image at "+o))},g.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,u){return new Promise(function(d,g){var _=u.createImage();_.crossOrigin="anonymous",_.onload=function(){d(_)},_.onerror=function(){g(new Error("Could not load image at "+o))},_.src=o})}}]),r}(Ro.EventEmitter))||Oa),le=R(49685);function Fe(){var e=new le.WT(16);return le.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function kt(e){var i=new le.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function ur(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function It(e,i,r,n,o,u,d,g,_,E,M,P,D,Z,Q,ue){var ve=new le.WT(16);return ve[0]=e,ve[1]=i,ve[2]=r,ve[3]=n,ve[4]=o,ve[5]=u,ve[6]=d,ve[7]=g,ve[8]=_,ve[9]=E,ve[10]=M,ve[11]=P,ve[12]=D,ve[13]=Z,ve[14]=Q,ve[15]=ue,ve}function tr(e,i,r,n,o,u,d,g,_,E,M,P,D,Z,Q,ue,ve){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=u,e[5]=d,e[6]=g,e[7]=_,e[8]=E,e[9]=M,e[10]=P,e[11]=D,e[12]=Z,e[13]=Q,e[14]=ue,e[15]=ve,e}function dr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _r(e,i){if(e===i){var r=i[1],n=i[2],o=i[3],u=i[6],d=i[7],g=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=u,e[11]=i[14],e[12]=o,e[13]=d,e[14]=g}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Sr(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=i[4],g=i[5],_=i[6],E=i[7],M=i[8],P=i[9],D=i[10],Z=i[11],Q=i[12],ue=i[13],ve=i[14],Ne=i[15],it=r*g-n*d,mt=r*_-o*d,bt=r*E-u*d,Vt=n*_-o*g,Kt=n*E-u*g,or=o*E-u*_,br=M*ue-P*Q,rn=M*ve-D*Q,dn=M*Ne-Z*Q,Or=P*ve-D*ue,In=P*Ne-Z*ue,Un=D*Ne-Z*ve,di=it*Un-mt*In+bt*Or+Vt*dn-Kt*rn+or*br;return di?(di=1/di,e[0]=(g*Un-_*In+E*Or)*di,e[1]=(o*In-n*Un-u*Or)*di,e[2]=(ue*or-ve*Kt+Ne*Vt)*di,e[3]=(D*Kt-P*or-Z*Vt)*di,e[4]=(_*dn-d*Un-E*rn)*di,e[5]=(r*Un-o*dn+u*rn)*di,e[6]=(ve*bt-Q*or-Ne*mt)*di,e[7]=(M*or-D*bt+Z*mt)*di,e[8]=(d*In-g*dn+E*br)*di,e[9]=(n*dn-r*In-u*br)*di,e[10]=(Q*Kt-ue*bt+Ne*it)*di,e[11]=(P*bt-M*Kt-Z*it)*di,e[12]=(g*rn-d*Or-_*br)*di,e[13]=(r*Or-n*rn+o*br)*di,e[14]=(ue*mt-Q*Vt-ve*it)*di,e[15]=(M*Vt-P*mt+D*it)*di,e):null}function Lr(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=i[4],g=i[5],_=i[6],E=i[7],M=i[8],P=i[9],D=i[10],Z=i[11],Q=i[12],ue=i[13],ve=i[14],Ne=i[15];return e[0]=g*(D*Ne-Z*ve)-P*(_*Ne-E*ve)+ue*(_*Z-E*D),e[1]=-(n*(D*Ne-Z*ve)-P*(o*Ne-u*ve)+ue*(o*Z-u*D)),e[2]=n*(_*Ne-E*ve)-g*(o*Ne-u*ve)+ue*(o*E-u*_),e[3]=-(n*(_*Z-E*D)-g*(o*Z-u*D)+P*(o*E-u*_)),e[4]=-(d*(D*Ne-Z*ve)-M*(_*Ne-E*ve)+Q*(_*Z-E*D)),e[5]=r*(D*Ne-Z*ve)-M*(o*Ne-u*ve)+Q*(o*Z-u*D),e[6]=-(r*(_*Ne-E*ve)-d*(o*Ne-u*ve)+Q*(o*E-u*_)),e[7]=r*(_*Z-E*D)-d*(o*Z-u*D)+M*(o*E-u*_),e[8]=d*(P*Ne-Z*ue)-M*(g*Ne-E*ue)+Q*(g*Z-E*P),e[9]=-(r*(P*Ne-Z*ue)-M*(n*Ne-u*ue)+Q*(n*Z-u*P)),e[10]=r*(g*Ne-E*ue)-d*(n*Ne-u*ue)+Q*(n*E-u*g),e[11]=-(r*(g*Z-E*P)-d*(n*Z-u*P)+M*(n*E-u*g)),e[12]=-(d*(P*ve-D*ue)-M*(g*ve-_*ue)+Q*(g*D-_*P)),e[13]=r*(P*ve-D*ue)-M*(n*ve-o*ue)+Q*(n*D-o*P),e[14]=-(r*(g*ve-_*ue)-d*(n*ve-o*ue)+Q*(n*_-o*g)),e[15]=r*(g*D-_*P)-d*(n*D-o*P)+M*(n*_-o*g),e}function kr(e){var i=e[0],r=e[1],n=e[2],o=e[3],u=e[4],d=e[5],g=e[6],_=e[7],E=e[8],M=e[9],P=e[10],D=e[11],Z=e[12],Q=e[13],ue=e[14],ve=e[15],Ne=i*d-r*u,it=i*g-n*u,mt=i*_-o*u,bt=r*g-n*d,Vt=r*_-o*d,Kt=n*_-o*g,or=E*Q-M*Z,br=E*ue-P*Z,rn=E*ve-D*Z,dn=M*ue-P*Q,Or=M*ve-D*Q,In=P*ve-D*ue;return Ne*In-it*Or+mt*dn+bt*rn-Vt*br+Kt*or}function Dr(e,i,r){var n=i[0],o=i[1],u=i[2],d=i[3],g=i[4],_=i[5],E=i[6],M=i[7],P=i[8],D=i[9],Z=i[10],Q=i[11],ue=i[12],ve=i[13],Ne=i[14],it=i[15],mt=r[0],bt=r[1],Vt=r[2],Kt=r[3];return e[0]=mt*n+bt*g+Vt*P+Kt*ue,e[1]=mt*o+bt*_+Vt*D+Kt*ve,e[2]=mt*u+bt*E+Vt*Z+Kt*Ne,e[3]=mt*d+bt*M+Vt*Q+Kt*it,mt=r[4],bt=r[5],Vt=r[6],Kt=r[7],e[4]=mt*n+bt*g+Vt*P+Kt*ue,e[5]=mt*o+bt*_+Vt*D+Kt*ve,e[6]=mt*u+bt*E+Vt*Z+Kt*Ne,e[7]=mt*d+bt*M+Vt*Q+Kt*it,mt=r[8],bt=r[9],Vt=r[10],Kt=r[11],e[8]=mt*n+bt*g+Vt*P+Kt*ue,e[9]=mt*o+bt*_+Vt*D+Kt*ve,e[10]=mt*u+bt*E+Vt*Z+Kt*Ne,e[11]=mt*d+bt*M+Vt*Q+Kt*it,mt=r[12],bt=r[13],Vt=r[14],Kt=r[15],e[12]=mt*n+bt*g+Vt*P+Kt*ue,e[13]=mt*o+bt*_+Vt*D+Kt*ve,e[14]=mt*u+bt*E+Vt*Z+Kt*Ne,e[15]=mt*d+bt*M+Vt*Q+Kt*it,e}function xr(e,i,r){var n=r[0],o=r[1],u=r[2],d,g,_,E,M,P,D,Z,Q,ue,ve,Ne;return i===e?(e[12]=i[0]*n+i[4]*o+i[8]*u+i[12],e[13]=i[1]*n+i[5]*o+i[9]*u+i[13],e[14]=i[2]*n+i[6]*o+i[10]*u+i[14],e[15]=i[3]*n+i[7]*o+i[11]*u+i[15]):(d=i[0],g=i[1],_=i[2],E=i[3],M=i[4],P=i[5],D=i[6],Z=i[7],Q=i[8],ue=i[9],ve=i[10],Ne=i[11],e[0]=d,e[1]=g,e[2]=_,e[3]=E,e[4]=M,e[5]=P,e[6]=D,e[7]=Z,e[8]=Q,e[9]=ue,e[10]=ve,e[11]=Ne,e[12]=d*n+M*o+Q*u+i[12],e[13]=g*n+P*o+ue*u+i[13],e[14]=_*n+D*o+ve*u+i[14],e[15]=E*n+Z*o+Ne*u+i[15]),e}function Ar(e,i,r){var n=r[0],o=r[1],u=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*o,e[5]=i[5]*o,e[6]=i[6]*o,e[7]=i[7]*o,e[8]=i[8]*u,e[9]=i[9]*u,e[10]=i[10]*u,e[11]=i[11]*u,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function st(e,i,r,n){var o=n[0],u=n[1],d=n[2],g=Math.hypot(o,u,d),_,E,M,P,D,Z,Q,ue,ve,Ne,it,mt,bt,Vt,Kt,or,br,rn,dn,Or,In,Un,di,Fo;return g<le.Ib?null:(g=1/g,o*=g,u*=g,d*=g,_=Math.sin(r),E=Math.cos(r),M=1-E,P=i[0],D=i[1],Z=i[2],Q=i[3],ue=i[4],ve=i[5],Ne=i[6],it=i[7],mt=i[8],bt=i[9],Vt=i[10],Kt=i[11],or=o*o*M+E,br=u*o*M+d*_,rn=d*o*M-u*_,dn=o*u*M-d*_,Or=u*u*M+E,In=d*u*M+o*_,Un=o*d*M+u*_,di=u*d*M-o*_,Fo=d*d*M+E,e[0]=P*or+ue*br+mt*rn,e[1]=D*or+ve*br+bt*rn,e[2]=Z*or+Ne*br+Vt*rn,e[3]=Q*or+it*br+Kt*rn,e[4]=P*dn+ue*Or+mt*In,e[5]=D*dn+ve*Or+bt*In,e[6]=Z*dn+Ne*Or+Vt*In,e[7]=Q*dn+it*Or+Kt*In,e[8]=P*Un+ue*di+mt*Fo,e[9]=D*Un+ve*di+bt*Fo,e[10]=Z*Un+Ne*di+Vt*Fo,e[11]=Q*Un+it*di+Kt*Fo,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Ut(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[4],d=i[5],g=i[6],_=i[7],E=i[8],M=i[9],P=i[10],D=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=u*o+E*n,e[5]=d*o+M*n,e[6]=g*o+P*n,e[7]=_*o+D*n,e[8]=E*o-u*n,e[9]=M*o-d*n,e[10]=P*o-g*n,e[11]=D*o-_*n,e}function wr(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[0],d=i[1],g=i[2],_=i[3],E=i[8],M=i[9],P=i[10],D=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=u*o-E*n,e[1]=d*o-M*n,e[2]=g*o-P*n,e[3]=_*o-D*n,e[8]=u*n+E*o,e[9]=d*n+M*o,e[10]=g*n+P*o,e[11]=_*n+D*o,e}function Ur(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[0],d=i[1],g=i[2],_=i[3],E=i[4],M=i[5],P=i[6],D=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=u*o+E*n,e[1]=d*o+M*n,e[2]=g*o+P*n,e[3]=_*o+D*n,e[4]=E*o-u*n,e[5]=M*o-d*n,e[6]=P*o-g*n,e[7]=D*o-_*n,e}function fr(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Nr(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Jr(e,i,r){var n=r[0],o=r[1],u=r[2],d=Math.hypot(n,o,u),g,_,E;return d<le.Ib?null:(d=1/d,n*=d,o*=d,u*=d,g=Math.sin(i),_=Math.cos(i),E=1-_,e[0]=n*n*E+_,e[1]=o*n*E+u*g,e[2]=u*n*E-o*g,e[3]=0,e[4]=n*o*E-u*g,e[5]=o*o*E+_,e[6]=u*o*E+n*g,e[7]=0,e[8]=n*u*E+o*g,e[9]=o*u*E-n*g,e[10]=u*u*E+_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Fn(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ar(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _n(e,i,r){var n=i[0],o=i[1],u=i[2],d=i[3],g=n+n,_=o+o,E=u+u,M=n*g,P=n*_,D=n*E,Z=o*_,Q=o*E,ue=u*E,ve=d*g,Ne=d*_,it=d*E;return e[0]=1-(Z+ue),e[1]=P+it,e[2]=D-Ne,e[3]=0,e[4]=P-it,e[5]=1-(M+ue),e[6]=Q+ve,e[7]=0,e[8]=D+Ne,e[9]=Q-ve,e[10]=1-(M+Z),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Xr(e,i){var r=new le.WT(3),n=-i[0],o=-i[1],u=-i[2],d=i[3],g=i[4],_=i[5],E=i[6],M=i[7],P=n*n+o*o+u*u+d*d;return P>0?(r[0]=(g*d+M*n+_*u-E*o)*2/P,r[1]=(_*d+M*o+E*n-g*u)*2/P,r[2]=(E*d+M*u+g*o-_*n)*2/P):(r[0]=(g*d+M*n+_*u-E*o)*2,r[1]=(_*d+M*o+E*n-g*u)*2,r[2]=(E*d+M*u+g*o-_*n)*2),_n(e,i,r),e}function Tr(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Yr(e,i){var r=i[0],n=i[1],o=i[2],u=i[4],d=i[5],g=i[6],_=i[8],E=i[9],M=i[10];return e[0]=Math.hypot(r,n,o),e[1]=Math.hypot(u,d,g),e[2]=Math.hypot(_,E,M),e}function Qr(e,i){var r=new le.WT(3);Yr(r,i);var n=1/r[0],o=1/r[1],u=1/r[2],d=i[0]*n,g=i[1]*o,_=i[2]*u,E=i[4]*n,M=i[5]*o,P=i[6]*u,D=i[8]*n,Z=i[9]*o,Q=i[10]*u,ue=d+M+Q,ve=0;return ue>0?(ve=Math.sqrt(ue+1)*2,e[3]=.25*ve,e[0]=(P-Z)/ve,e[1]=(D-_)/ve,e[2]=(g-E)/ve):d>M&&d>Q?(ve=Math.sqrt(1+d-M-Q)*2,e[3]=(P-Z)/ve,e[0]=.25*ve,e[1]=(g+E)/ve,e[2]=(D+_)/ve):M>Q?(ve=Math.sqrt(1+M-d-Q)*2,e[3]=(D-_)/ve,e[0]=(g+E)/ve,e[1]=.25*ve,e[2]=(P+Z)/ve):(ve=Math.sqrt(1+Q-d-M)*2,e[3]=(g-E)/ve,e[0]=(D+_)/ve,e[1]=(P+Z)/ve,e[2]=.25*ve),e}function vi(e,i,r,n){var o=i[0],u=i[1],d=i[2],g=i[3],_=o+o,E=u+u,M=d+d,P=o*_,D=o*E,Z=o*M,Q=u*E,ue=u*M,ve=d*M,Ne=g*_,it=g*E,mt=g*M,bt=n[0],Vt=n[1],Kt=n[2];return e[0]=(1-(Q+ve))*bt,e[1]=(D+mt)*bt,e[2]=(Z-it)*bt,e[3]=0,e[4]=(D-mt)*Vt,e[5]=(1-(P+ve))*Vt,e[6]=(ue+Ne)*Vt,e[7]=0,e[8]=(Z+it)*Kt,e[9]=(ue-Ne)*Kt,e[10]=(1-(P+Q))*Kt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ni(e,i,r,n,o){var u=i[0],d=i[1],g=i[2],_=i[3],E=u+u,M=d+d,P=g+g,D=u*E,Z=u*M,Q=u*P,ue=d*M,ve=d*P,Ne=g*P,it=_*E,mt=_*M,bt=_*P,Vt=n[0],Kt=n[1],or=n[2],br=o[0],rn=o[1],dn=o[2],Or=(1-(ue+Ne))*Vt,In=(Z+bt)*Vt,Un=(Q-mt)*Vt,di=(Z-bt)*Kt,Fo=(1-(D+Ne))*Kt,Ss=(ve+it)*Kt,ol=(Q+mt)*or,xc=(ve-it)*or,bl=(1-(D+ue))*or;return e[0]=Or,e[1]=In,e[2]=Un,e[3]=0,e[4]=di,e[5]=Fo,e[6]=Ss,e[7]=0,e[8]=ol,e[9]=xc,e[10]=bl,e[11]=0,e[12]=r[0]+br-(Or*br+di*rn+ol*dn),e[13]=r[1]+rn-(In*br+Fo*rn+xc*dn),e[14]=r[2]+dn-(Un*br+Ss*rn+bl*dn),e[15]=1,e}function qr(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=r+r,g=n+n,_=o+o,E=r*d,M=n*d,P=n*g,D=o*d,Z=o*g,Q=o*_,ue=u*d,ve=u*g,Ne=u*_;return e[0]=1-P-Q,e[1]=M+Ne,e[2]=D-ve,e[3]=0,e[4]=M-Ne,e[5]=1-E-Q,e[6]=Z+ue,e[7]=0,e[8]=D+ve,e[9]=Z-ue,e[10]=1-E-P,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function an(e,i,r,n,o,u,d){var g=1/(r-i),_=1/(o-n),E=1/(u-d);return e[0]=u*2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2*_,e[6]=0,e[7]=0,e[8]=(r+i)*g,e[9]=(o+n)*_,e[10]=(d+u)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=d*u*2*E,e[15]=0,e}function Yn(e,i,r,n,o){var u=1/Math.tan(i/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(n-o),e[10]=(o+n)*d,e[14]=2*o*n*d):(e[10]=-1,e[14]=-2*n),e}var ci=Yn;function Ui(e,i,r,n,o){var u=1/Math.tan(i/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(n-o),e[10]=o*d,e[14]=o*n*d):(e[10]=-1,e[14]=-n),e}function ao(e,i,r,n){var o=Math.tan(i.upDegrees*Math.PI/180),u=Math.tan(i.downDegrees*Math.PI/180),d=Math.tan(i.leftDegrees*Math.PI/180),g=Math.tan(i.rightDegrees*Math.PI/180),_=2/(d+g),E=2/(o+u);return e[0]=_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((d-g)*_*.5),e[9]=(o-u)*E*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function oo(e,i,r,n,o,u,d){var g=1/(i-r),_=1/(n-o),E=1/(u-d);return e[0]=-2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(i+r)*g,e[13]=(o+n)*_,e[14]=(d+u)*E,e[15]=1,e}var Ni=oo;function as(e,i,r,n,o,u,d){var g=1/(i-r),_=1/(n-o),E=1/(u-d);return e[0]=-2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(i+r)*g,e[13]=(o+n)*_,e[14]=u*E,e[15]=1,e}function Wa(e,i,r,n){var o,u,d,g,_,E,M,P,D,Z,Q=i[0],ue=i[1],ve=i[2],Ne=n[0],it=n[1],mt=n[2],bt=r[0],Vt=r[1],Kt=r[2];return Math.abs(Q-bt)<le.Ib&&Math.abs(ue-Vt)<le.Ib&&Math.abs(ve-Kt)<le.Ib?dr(e):(M=Q-bt,P=ue-Vt,D=ve-Kt,Z=1/Math.hypot(M,P,D),M*=Z,P*=Z,D*=Z,o=it*D-mt*P,u=mt*M-Ne*D,d=Ne*P-it*M,Z=Math.hypot(o,u,d),Z?(Z=1/Z,o*=Z,u*=Z,d*=Z):(o=0,u=0,d=0),g=P*d-D*u,_=D*o-M*d,E=M*u-P*o,Z=Math.hypot(g,_,E),Z?(Z=1/Z,g*=Z,_*=Z,E*=Z):(g=0,_=0,E=0),e[0]=o,e[1]=g,e[2]=M,e[3]=0,e[4]=u,e[5]=_,e[6]=P,e[7]=0,e[8]=d,e[9]=E,e[10]=D,e[11]=0,e[12]=-(o*Q+u*ue+d*ve),e[13]=-(g*Q+_*ue+E*ve),e[14]=-(M*Q+P*ue+D*ve),e[15]=1,e)}function Ko(e,i,r,n){var o=i[0],u=i[1],d=i[2],g=n[0],_=n[1],E=n[2],M=o-r[0],P=u-r[1],D=d-r[2],Z=M*M+P*P+D*D;Z>0&&(Z=1/Math.sqrt(Z),M*=Z,P*=Z,D*=Z);var Q=_*D-E*P,ue=E*M-g*D,ve=g*P-_*M;return Z=Q*Q+ue*ue+ve*ve,Z>0&&(Z=1/Math.sqrt(Z),Q*=Z,ue*=Z,ve*=Z),e[0]=Q,e[1]=ue,e[2]=ve,e[3]=0,e[4]=P*ve-D*ue,e[5]=D*Q-M*ve,e[6]=M*ue-P*Q,e[7]=0,e[8]=M,e[9]=P,e[10]=D,e[11]=0,e[12]=o,e[13]=u,e[14]=d,e[15]=1,e}function So(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function $o(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Zo(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function os(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function co(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function mi(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function jo(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function ea(e,i){var r=e[0],n=e[1],o=e[2],u=e[3],d=e[4],g=e[5],_=e[6],E=e[7],M=e[8],P=e[9],D=e[10],Z=e[11],Q=e[12],ue=e[13],ve=e[14],Ne=e[15],it=i[0],mt=i[1],bt=i[2],Vt=i[3],Kt=i[4],or=i[5],br=i[6],rn=i[7],dn=i[8],Or=i[9],In=i[10],Un=i[11],di=i[12],Fo=i[13],Ss=i[14],ol=i[15];return Math.abs(r-it)<=le.Ib*Math.max(1,Math.abs(r),Math.abs(it))&&Math.abs(n-mt)<=le.Ib*Math.max(1,Math.abs(n),Math.abs(mt))&&Math.abs(o-bt)<=le.Ib*Math.max(1,Math.abs(o),Math.abs(bt))&&Math.abs(u-Vt)<=le.Ib*Math.max(1,Math.abs(u),Math.abs(Vt))&&Math.abs(d-Kt)<=le.Ib*Math.max(1,Math.abs(d),Math.abs(Kt))&&Math.abs(g-or)<=le.Ib*Math.max(1,Math.abs(g),Math.abs(or))&&Math.abs(_-br)<=le.Ib*Math.max(1,Math.abs(_),Math.abs(br))&&Math.abs(E-rn)<=le.Ib*Math.max(1,Math.abs(E),Math.abs(rn))&&Math.abs(M-dn)<=le.Ib*Math.max(1,Math.abs(M),Math.abs(dn))&&Math.abs(P-Or)<=le.Ib*Math.max(1,Math.abs(P),Math.abs(Or))&&Math.abs(D-In)<=le.Ib*Math.max(1,Math.abs(D),Math.abs(In))&&Math.abs(Z-Un)<=le.Ib*Math.max(1,Math.abs(Z),Math.abs(Un))&&Math.abs(Q-di)<=le.Ib*Math.max(1,Math.abs(Q),Math.abs(di))&&Math.abs(ue-Fo)<=le.Ib*Math.max(1,Math.abs(ue),Math.abs(Fo))&&Math.abs(ve-Ss)<=le.Ib*Math.max(1,Math.abs(ve),Math.abs(Ss))&&Math.abs(Ne-ol)<=le.Ib*Math.max(1,Math.abs(Ne),Math.abs(ol))}var ss=Dr,Qn=os,ki,la,wo=(ki=(0,Gr.b2)(),ki(la=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,jt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Fe(),Sr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,ie.Z)(r,2),o=n[0],u=n[1];return[o,u]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var o=fr(Fe(),[r,n,0]);this.jitteredProjectionMatrix=Dr(Fe(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Dr(Fe(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||la),rl,Pe;function Bt(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wt(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function wt(e,i){if(!!e){if(typeof e=="string")return pn(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pn(e,i)}}function pn(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Zi=(rl=(0,Gr.b2)(),rl(Pe=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,jt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Ht.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var o=n.get(Ht.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Bt(this.controls),n;try{for(r.s();!(n=r.n()).done;){var o=n.value;o.remove()}}catch(u){r.e(u)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",o=this.controlContainer=pa("div",n+"control-container",this.container);function u(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],g=d.map(function(_){return n+_}).join(" ");r[d.join("")]=pa("div",g,o)}u(["top","left"]),u(["top","right"]),u(["bottom","left"]),u(["bottom","right"]),u(["top","center"]),u(["right","center"]),u(["left","center"]),u(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&lo(this.controlCorners[r]);this.controlContainer&&lo(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Pe),Se,ce,Ge=(Se=(0,Gr.b2)(),Se(ce=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,jt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||ce),ct,Pt,Je=(ct=(0,Gr.b2)(),ct(Pt=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,jt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}}]),e}())||Pt),Be=R(82492),nt=R.n(Be),ye={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Ze=ye,Ce,ft;function Et(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function pr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Et(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Et(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zr={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},jr={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},tn=(Ce=(0,Gr.b2)(),Ce(ft=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,jt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Ze[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=pr(pr({},Zr),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,o){this.layerConfigCache[n]=pr({},nt()({},this.sceneConfigCache[r],jr,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||ft);function $t(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function hr(e,i,r,n,o){var u={};return Object.keys(n).forEach(function(d){u[d]=n[d]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=r.slice().reverse().reduce(function(d,g){return g(e,i,d)||d},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,i,u),u=null),u}function un(){var e=new le.WT(4);return le.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Sn(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function xn(e,i,r,n){var o=new le.WT(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o}function gn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Kn(e,i,r,n,o){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e}function Ta(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function gs(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ua(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function _a(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Nl(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function js(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function yl(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Ou(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function td(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function bu(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function zc(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function bh(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],u=i[3]-e[3];return Math.hypot(r,n,o,u)}function Sm(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],u=i[3]-e[3];return r*r+n*n+o*o+u*u}function us(e){var i=e[0],r=e[1],n=e[2],o=e[3];return Math.hypot(i,r,n,o)}function rd(e){var i=e[0],r=e[1],n=e[2],o=e[3];return i*i+r*r+n*n+o*o}function _f(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function Rd(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Ld(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],d=r*r+n*n+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),e[0]=r*d,e[1]=n*d,e[2]=o*d,e[3]=u*d,e}function vv(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function lp(e,i,r,n){var o=r[0]*n[1]-r[1]*n[0],u=r[0]*n[2]-r[2]*n[0],d=r[0]*n[3]-r[3]*n[0],g=r[1]*n[2]-r[2]*n[1],_=r[1]*n[3]-r[3]*n[1],E=r[2]*n[3]-r[3]*n[2],M=i[0],P=i[1],D=i[2],Z=i[3];return e[0]=P*E-D*_+Z*g,e[1]=-(M*E)+D*d-Z*u,e[2]=M*_-P*d+Z*o,e[3]=-(M*g)+P*u-D*o,e}function xf(e,i,r,n){var o=i[0],u=i[1],d=i[2],g=i[3];return e[0]=o+n*(r[0]-o),e[1]=u+n*(r[1]-u),e[2]=d+n*(r[2]-d),e[3]=g+n*(r[3]-g),e}function wm(e,i){i=i||1;var r,n,o,u,d,g;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,d=r*r+n*n;while(d>=1);do o=glMatrix.RANDOM()*2-1,u=glMatrix.RANDOM()*2-1,g=o*o+u*u;while(g>=1);var _=Math.sqrt((1-d)/g);return e[0]=i*r,e[1]=i*n,e[2]=i*o*_,e[3]=i*u*_,e}function nd(e,i,r){var n=i[0],o=i[1],u=i[2],d=i[3];return e[0]=r[0]*n+r[4]*o+r[8]*u+r[12]*d,e[1]=r[1]*n+r[5]*o+r[9]*u+r[13]*d,e[2]=r[2]*n+r[6]*o+r[10]*u+r[14]*d,e[3]=r[3]*n+r[7]*o+r[11]*u+r[15]*d,e}function l0(e,i,r){var n=i[0],o=i[1],u=i[2],d=r[0],g=r[1],_=r[2],E=r[3],M=E*n+g*u-_*o,P=E*o+_*n-d*u,D=E*u+d*o-g*n,Z=-d*n-g*o-_*u;return e[0]=M*E+Z*-d+P*-_-D*-g,e[1]=P*E+Z*-g+D*-d-M*-_,e[2]=D*E+Z*-_+M*-g-P*-d,e[3]=i[3],e}function bs(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Xf(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Cm(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function t(e,i){var r=e[0],n=e[1],o=e[2],u=e[3],d=i[0],g=i[1],_=i[2],E=i[3];return Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(u-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))}var a=null,s=null,h=null,m=null,x=null,S=null,T=null,k=function(){var e=un();return function(i,r,n,o,u,d){var g,_;for(r||(r=4),n||(n=0),o?_=Math.min(o*r+n,i.length):_=i.length,g=n;g<_;g+=r)e[0]=i[g],e[1]=i[g+1],e[2]=i[g+2],e[3]=i[g+3],u(e,e,d),i[g]=e[0],i[g+1]=e[1],i[g+2]=e[2],i[g+3]=e[3];return i}}(),z=Math.PI/180,j=512,G=4003e4;function te(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,o=n===void 0?0:n,u=e.scale,d=e.highPrecision,g=d===void 0?!1:d,_=e.flipY,E=_===void 0?!1:_;u=u!==void 0?u:Math.pow(2,o);var M={},P=j*u,D=Math.cos(r*z),Z=P/360,Q=Z/D,ue=P/G/D;if(M.pixelsPerMeter=[ue,-ue,ue],M.metersPerPixel=[1/ue,-1/ue,1/ue],M.pixelsPerDegree=[Z,-Q,ue],M.degreesPerPixel=[1/Z,-1/Q,1/ue],g){var ve=z*Math.tan(r*z)/D,Ne=Z*ve/2,it=P/G*ve,mt=it/Q*ue;M.pixelsPerDegree2=[0,-Ne,it],M.pixelsPerMeter2=[mt,0,mt],E&&(M.pixelsPerDegree2[1]=-M.pixelsPerDegree2[1],M.pixelsPerMeter2[1]=-M.pixelsPerMeter2[1])}return E&&(M.pixelsPerMeter[1]=-M.pixelsPerMeter[1],M.metersPerPixel[1]=-M.metersPerPixel[1],M.pixelsPerDegree[1]=-M.pixelsPerDegree[1],M.degreesPerPixel[1]=-M.degreesPerPixel[1]),M}var oe;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(oe||(oe={}));var Me={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Re,Ke,ze,at,St,Zt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Wt=(Re=(0,Gr.b2)(),Ke=(0,Gr.f3)(Ht.ICameraService),Re(ze=(at=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),$t(this,"cameraService",St,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,jt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),u=te({latitude:o[1],zoom:r}),d=u.pixelsPerMeter,g=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=g,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===oe.LNGLAT||this.coordinateSystem===oe.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===oe.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===oe.P20_OFFSET&&this.calculateLnglatOffset(o,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,o,u){var d=te({latitude:r[1],zoom:n,scale:o,flipY:u,highPrecision:!0}),g=d.pixelsPerMeter,_=d.pixelsPerDegree,E=d.pixelsPerDegree2,M=this.cameraService.getViewMatrix(),P=this.cameraService.getProjectionMatrix(),D=Dr([],P,M),Z=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=nd([],[Z[0],Z[1],0,1],D),M=this.cameraService.getViewMatrixUncentered()||M,D=Dr([],P,M),D=Dr([],D,Zt),this.cameraService.setViewProjectionMatrix(D),this.pixelsPerMeter=g,this.pixelsPerDegree=_,this.pixelsPerDegree2=E}}]),e}(),St=hr(at.prototype,"cameraService",[Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at))||ze),cr=R(20396),Mr=R.n(cr),Pr;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Pr||(Pr={}));var Rn,cn,Nn,fn,Ai;function ei(e){var i=Tn();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Tn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ji={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},xi=(Rn=(0,Gr.b2)(),cn=(0,Gr.f3)(Ht.IMapService),Rn(Nn=(fn=function(e){(0,En.Z)(r,e);var i=ei(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),$t((0,be.Z)(n),"mapService",Ai,(0,be.Z)(n)),(0,I.Z)((0,be.Z)(n),"hammertime",void 0),(0,I.Z)((0,be.Z)(n),"lastClickTime",0),(0,I.Z)((0,be.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,be.Z)(n),"clickTimer",void 0),(0,I.Z)((0,be.Z)(n),"$containter",void 0),(0,I.Z)((0,be.Z)(n),"onDrag",function(g){var _=n.interactionEvent(g);_.type=ji[_.type],n.emit(Pr.Drag,_)}),(0,I.Z)((0,be.Z)(n),"onHammer",function(g){g.srcEvent.stopPropagation();var _=n.interactionEvent(g);n.emit(Pr.Hover,_)}),(0,I.Z)((0,be.Z)(n),"onTouch",function(g){var _=g.touches[0];n.onHover({x:_.pageX,y:_.pageY,type:"touch"})}),(0,I.Z)((0,be.Z)(n),"onHover",function(g){var _=g.clientX,E=g.clientY,M=_,P=E,D=g.type,Z=n.mapService.getMapContainer();if(Z)if(bo)M=M-Z.left-0,P=P-Z.top-0;else{var Q=Z.getBoundingClientRect(),ue=Q.top,ve=Q.left;M=M-ve-Z.clientLeft,P=P-ue-Z.clientTop}var Ne=n.mapService.containerToLngLat([M,P]);if(D==="click"){if(!bo&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(M,P,Ne);return}if(D==="touch"){n.isDoubleTap(M,P,Ne);return}D!=="click"&&D!=="dblclick"&&n.emit(Pr.Hover,{x:M,y:P,lngLat:Ne,type:D,target:g})}),n}return(0,jt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Pr.Hover)}},{key:"triggerHover",value:function(o){var u=o.x,d=o.y;this.emit(Pr.Hover,{x:u,y:d})}},{key:"triggerSelect",value:function(o){this.emit(Pr.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(Pr.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if(bo)ga.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var u=new(Mr()).Manager(o);u.add(new(Mr()).Tap({event:"dblclick",taps:2})),u.add(new(Mr()).Tap({event:"click"})),u.add(new(Mr()).Pan({threshold:0,pointers:0})),u.add(new(Mr()).Press({})),u.on("dblclick click",this.onHammer),u.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=u}}},{key:"removeEventListenerOnMap",value:function(){if(bo)ga.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var u=o.type,d=o.pointerType,g,_;d==="touch"?(_=Math.floor(o.pointers[0].clientY),g=Math.floor(o.pointers[0].clientX)):(_=Math.floor(o.srcEvent.y),g=Math.floor(o.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var M=E.getBoundingClientRect(),P=M.top,D=M.left;g-=D,_-=P}var Z=this.mapService.containerToLngLat([g,_]);return{x:g,y:_,lngLat:Z,type:u,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,u,d){var g=this,_=new Date().getTime(),E="click";_-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-u)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(Pr.Hover,{x:o,y:u,lngLat:d,type:E})):(this.lastClickTime=_,this.lastClickXY=[o,u],this.clickTimer=setTimeout(function(){E="click",g.emit(Pr.Hover,{x:o,y:u,lngLat:d,type:E})},400))}}]),r}(Uo()),Ai=hr(fn.prototype,"mapService",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fn))||Nn),bi=R(92137),zn=R(87757),ti=R.n(zn),so=0;function Co(e){if(bo)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(so++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function go(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var u;o==null||(u=o.classList)===null||u===void 0||u.forEach(function(d){(d==="l7-marker"||d==="l7-popup")&&(n=!1)})}}),n}var ae;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ae||(ae={}));var yo,Jo,Qo,Ts,ls,Ms,Ka,cs,Wi,Da,Ma;function ia(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Vs(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ia(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ia(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ps=(yo=(0,Gr.b2)(),Jo=(0,Gr.f3)(Ht.IRendererService),Qo=(0,Gr.f3)(Ht.IGlobalConfigService),Ts=(0,Gr.f3)(Ht.IInteractionService),ls=(0,Gr.f3)(Ht.ILayerService),yo(Ms=(Ka=function(){function e(){var i=this;(0,pt.Z)(this,e),$t(this,"rendererService",cs,this),$t(this,"configService",Wi,this),$t(this,"interactionService",Da,this),$t(this,"layerService",Ma,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var o,u=n.x,d=n.y,g=n.lngLat,_=n.type,E=n.target,M=!1,P=i.rendererService,D=P.getViewportSize,Z=P.readPixels,Q=P.getContainer,ue=i.getContainerSize(Q()),ve=ue.width,Ne=ue.height;ve*=Ea,Ne*=Ea;var it=r.getLayerConfig(),mt=it.enableHighlight,bt=it.enableSelect,Vt=u*Ea,Kt=d*Ea;if(Vt>ve-1*Ea||Vt<0||Kt>Ne-1*Ea||Kt<0)return!1;var or;if(or=Z({x:Math.floor(Vt/i.pickBufferScale),y:Math.floor((Ne-(d+1)*Ea)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),or[0]!==0||or[1]!==0||or[2]!==0){var br=W(or),rn=r.getSource().getFeatureById(br);br!==r.getCurrentPickId()&&_==="mousemove"&&(_="mouseenter");var dn={x:u,y:d,type:_,lngLat:g,featureId:br,feature:rn,target:E};rn&&(M=!0,r.setCurrentPickId(br),i.triggerHoverOnLayer(r,dn))}else{var Or={x:u,y:d,lngLat:g,type:r.getCurrentPickId()!==null&&_==="mousemove"?"mouseout":"un"+_,featureId:null,target:E,feature:null};i.triggerHoverOnLayer(r,Vs(Vs({},Or),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Or),r.setCurrentPickId(null)}if(mt&&i.highlightPickedFeature(r,or),bt&&_==="click"&&((o=or)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var In=W(or);r.getCurrentSelectedId()===null||In!==r.getCurrentSelectedId()?(i.selectFeature(r,or),r.setCurrentSelectedId(In)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return M})}return(0,jt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,o=n.createTexture2D,u=n.createFramebuffer,d=n.getViewportSize,g=n.getContainer,_=this.getContainerSize(g()),E=_.width,M=_.height;E*=Ea,M*=Ea,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=u({color:o({width:Math.round(E/this.pickBufferScale),height:Math.round(M/this.pickBufferScale),wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.interactionService.on(Pr.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,bi.Z)(ti().mark(function n(o,u,d){var g=this,_,E,M,P;return ti().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:_=this.rendererService,E=_.useFramebuffer,M=_.clear,P=_.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){M({framebuffer:g.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var Q=g.pickBox(o,u);d(Q)});case 3:case"end":return Z.stop()}},n,this)}));function r(n,o,u){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var o=this,u=n.map(function(Or){var In=Or<0?0:Or;return Math.floor(In*Ea/o.pickBufferScale)}),d=(0,ie.Z)(u,4),g=d[0],_=d[1],E=d[2],M=d[3],P=this.rendererService,D=P.getViewportSize,Z=P.readPixels,Q=P.getContainer,ue=this.getContainerSize(Q()),ve=ue.width,Ne=ue.height;if(ve*=Ea,Ne*=Ea,g>(ve-1)*Ea/this.pickBufferScale||E<0||_>(Ne-1)*Ea/this.pickBufferScale||M<0)return[];var it,mt=Math.min(ve/this.pickBufferScale,E)-g,bt=Math.min(Ne/this.pickBufferScale,M)-_;it=Z({x:g,y:Math.floor(Ne/this.pickBufferScale-(M+1)),width:mt,height:bt,data:new Uint8Array(mt*bt*4),framebuffer:this.pickingFBO});for(var Vt=[],Kt={},or=0;or<it.length/4;or=or+1){var br=it.slice(or*4,or*4+4),rn=W(br);if(rn!==-1&&!Kt[rn]){var dn=r.getSource().getFeatureById(rn);Vt.push(dn),Kt[rn]=!0}}return Vt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Ea,height:r.height/Ea}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,bi.Z)(ti().mark(function n(o){var u;return ti().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){g.next=2;break}return g.abrupt("return");case 2:if(this.alreadyInPicking=!0,u=new Date().getTime(),!(u-this.lastPickTime>10||o.type==="contextmenu")){g.next=7;break}return g.next=7,this.pickingLayers(o);case 7:this.lastPickTime=u,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),o=n.width,u=n.height;o*=Ea,u*=Ea,(this.width!==o||this.height!==u)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(u/this.pickBufferScale)}),this.width=o,this.height=u)}},{key:"pickingLayers",value:function(){var i=(0,bi.Z)(ti().mark(function n(o){var u=this,d,g,_,E,M;return ti().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:d=this.rendererService,g=d.getViewportSize,_=d.useFramebuffer,E=d.clear,M=d.getContainer,this.resizePickingFBO(),_(this.pickingFBO,function(){var Z=u.layerService.getRenderList();Z.filter(function(Q){return Q.needPick(o.type)}).reverse().some(function(Q){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Q.hooks.beforePickingEncode.call(),Q.renderModels(!0),Q.hooks.afterPickingEncode.call();var ue=u.pickFromPickingFBO(Q,o);return ue&&!Q.getLayerConfig().enablePropagation})});case 3:case"end":return D.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){go(n)&&r.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(r,n){var o=(0,ie.Z)(n,3),u=o[0],d=o[1],g=o[2];r.hooks.beforeHighlight.call([u,d,g])}},{key:"selectFeature",value:function(r,n){var o=(0,ie.Z)(n,3),u=o[0],d=o[1],g=o[2];r.hooks.beforeSelect.call([u,d,g])}}]),e}(),cs=hr(Ka.prototype,"rendererService",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wi=hr(Ka.prototype,"configService",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=hr(Ka.prototype,"interactionService",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=hr(Ka.prototype,"layerService",[ls],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka))||Ms),$a=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,pt.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,jt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Do,Es,ca,Bl,Eu,Ru,Ao,zl,nl,Eh=(Do=(0,Gr.b2)(),Es=(0,Gr.f3)(Ht.IRendererService),ca=(0,Gr.f3)(Ht.IMapService),Bl=(0,Gr.f3)(Ht.IGlobalConfigService),Do(Eu=(Ru=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"clock",new $a),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),$t(this,"renderService",Ao,this),$t(this,"mapService",zl,this),$t(this,"configService",nl,this)}return(0,jt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"remove",value:function(r,n){if(n){var o=n.layerChildren.indexOf(r);o>-1&&n.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){this.alreadyInRendering||!this.enableRender||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(n,o){return n.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ga.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=U(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){ga.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Ao=hr(Ru.prototype,"renderService",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zl=hr(Ru.prototype,"mapService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nl=hr(Ru.prototype,"configService",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru))||Eu),Ul=R(81253),Sh=R(14293),Lu=R.n(Sh),wh=function(){function e(i){var r=this;(0,pt.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return n.map(function(u,d){var g,_=(g=r.scale)===null||g===void 0?void 0:g.scalers[d].func,E=_(u);return E})}),this.setProps(i)}return(0,jt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var o,u=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,sr.Z)(r));if(!Lu()(u))return[u]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),id=["buffer","update","name"],hc,Ch,cp,fp,Zl,Ah;function Yf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function pc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hp(e){return new Promise(function(i){return setTimeout(i,e)})}var ad=(hc={},(0,I.Z)(hc,ae.FLOAT,4),(0,I.Z)(hc,ae.UNSIGNED_BYTE,1),(0,I.Z)(hc,ae.UNSIGNED_SHORT,2),hc),od=(Ch=(0,Gr.b2)(),cp=(0,Gr.f3)(Ht.IRendererService),Ch(fp=(Zl=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),$t(this,"rendererService",Ah,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,jt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new wh(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,o){var u=this.getLayerStyleAttribute(r);u||(u=this.registerStyleAttribute(pc(pc({},n),{},{name:r})));var d=n.scale;d&&u&&(u.scale=d,u.needRescale=!0,u.needRemapping=!0,u.needRegenerateVertices=!0,o&&o.featureRange&&(u.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,o=this.getLayerStyleAttribute(r),u=o==null||(n=o.scale)===null||n===void 0?void 0:n.scalers;return u&&u[0]?u[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,d=this.attributes.find(function(bt){return bt.name===r});if(d&&d.descriptor){var g=d.descriptor,_=g.update,E=g.buffer,M=g.size,P=M===void 0?0:M,D=ad[E.type||ae.FLOAT];if(_){var Z=this.featureLayout,Q=Z.elements,ue=Z.sizePerElement,ve=Q.slice(o,u);if(!ve.length)return;var Ne=ve[0].offset,it=Ne*P*D,mt=ve.map(function(bt,Vt){for(var Kt=bt.featureIdx,or=bt.vertices,br=bt.normals,rn=or.length/ue,dn=[],Or=0;Or<rn;Or++){var In=br?br.slice(Or*3,Or*3+3):[];dn.push.apply(dn,(0,sr.Z)(_(n[Kt],Kt,or.slice(Or*ue,Or*ue+ue),Vt,In)))}return dn}).reduce(function(bt,Vt){return bt.push.apply(bt,(0,sr.Z)(Vt)),bt},[]);d.vertexAttribute.updateBuffer({data:mt,offset:it})}}}},{key:"createAttributesAndIndices",value:function(r,n,o){var u=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var d=this.attributes.map(function(it){return it.resetDescriptor(),it.descriptor}),g=0,_=[],E=[],M=[],P=3;r.forEach(function(it,mt){var bt=u.triangulation(it,o),Vt=bt.indices,Kt=bt.vertices,or=bt.normals,br=bt.size;Vt.forEach(function(In){E.push(In+g)}),P=br;var rn=Kt.length/br;u.featureLayout.sizePerElement=P,u.featureLayout.elements.push({featureIdx:mt,vertices:Kt,normals:or,offset:g}),g+=rn;for(var dn=function(Un){var di=(or==null?void 0:or.slice(Un*3,Un*3+3))||[],Fo=Kt.slice(Un*br,Un*br+br);d.forEach(function(Ss,ol){if(Ss&&Ss.update){var xc;(xc=Ss.buffer.data).push.apply(xc,(0,sr.Z)(Ss.update(it,mt,Fo,Un,di)))}})},Or=0;Or<rn;Or++)dn(Or)});var D=this.rendererService,Z=D.createAttribute,Q=D.createBuffer,ue=D.createElements,ve={};d.forEach(function(it,mt){if(it){var bt=it.buffer,Vt=it.update,Kt=it.name,or=(0,Ul.Z)(it,id),br=Z(pc({buffer:Q(bt)},or));ve[it.name||""]=br,u.attributes[mt].vertexAttribute=br}});var Ne=ue({data:E,type:ae.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:ve,elements:Ne},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ah=hr(Zl.prototype,"rendererService",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl))||fp),Th=R(67709),pp=R.n(Th),dp,Mh,Ph,Ih,vp,qf,mp,Kf,Oh,bf,Rh,$f,sd,kd,ud,Dd,ld,Qs,Lh,To,_l,mv,Uc,cd,Fd,gp,jl,yp,kh,_p,xp,fd,Nd;function bp(e){var i=gv();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function gv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yv=(dp=(0,Gr.b2)(),Mh=(0,Gr.f3)(Ht.SceneID),Ph=(0,Gr.f3)(Ht.IIconService),Ih=(0,Gr.f3)(Ht.IFontService),vp=(0,Gr.f3)(Ht.IControlService),qf=(0,Gr.f3)(Ht.IGlobalConfigService),mp=(0,Gr.f3)(Ht.IMapService),Kf=(0,Gr.f3)(Ht.ICoordinateSystemService),Oh=(0,Gr.f3)(Ht.IRendererService),bf=(0,Gr.f3)(Ht.ILayerService),Rh=(0,Gr.f3)(Ht.ICameraService),$f=(0,Gr.f3)(Ht.IInteractionService),sd=(0,Gr.f3)(Ht.IPickingService),kd=(0,Gr.f3)(Ht.IShaderModuleService),ud=(0,Gr.f3)(Ht.IMarkerService),Dd=(0,Gr.f3)(Ht.IPopupService),dp(ld=(Qs=function(e){(0,En.Z)(r,e);var i=bp(r);function r(){var n;return(0,pt.Z)(this,r),n=i.call(this),(0,I.Z)((0,be.Z)(n),"destroyed",!1),(0,I.Z)((0,be.Z)(n),"loaded",!1),(0,I.Z)((0,be.Z)(n),"loadFont",!1),(0,I.Z)((0,be.Z)(n),"fontFamily",""),$t((0,be.Z)(n),"id",Lh,(0,be.Z)(n)),$t((0,be.Z)(n),"iconService",To,(0,be.Z)(n)),$t((0,be.Z)(n),"fontService",_l,(0,be.Z)(n)),$t((0,be.Z)(n),"controlService",mv,(0,be.Z)(n)),$t((0,be.Z)(n),"configService",Uc,(0,be.Z)(n)),$t((0,be.Z)(n),"map",cd,(0,be.Z)(n)),$t((0,be.Z)(n),"coordinateSystemService",Fd,(0,be.Z)(n)),$t((0,be.Z)(n),"rendererService",gp,(0,be.Z)(n)),$t((0,be.Z)(n),"layerService",jl,(0,be.Z)(n)),$t((0,be.Z)(n),"cameraService",yp,(0,be.Z)(n)),$t((0,be.Z)(n),"interactionService",kh,(0,be.Z)(n)),$t((0,be.Z)(n),"pickingService",_p,(0,be.Z)(n)),$t((0,be.Z)(n),"shaderModuleService",xp,(0,be.Z)(n)),$t((0,be.Z)(n),"markerService",fd,(0,be.Z)(n)),$t((0,be.Z)(n),"popupService",Nd,(0,be.Z)(n)),(0,I.Z)((0,be.Z)(n),"inited",!1),(0,I.Z)((0,be.Z)(n),"initPromise",void 0),(0,I.Z)((0,be.Z)(n),"rendering",!1),(0,I.Z)((0,be.Z)(n),"$container",void 0),(0,I.Z)((0,be.Z)(n),"canvas",void 0),(0,I.Z)((0,be.Z)(n),"markerContainer",void 0),(0,I.Z)((0,be.Z)(n),"hooks",void 0),(0,I.Z)((0,be.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),ms(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,be.Z)(n),"handleMapCameraChanged",function(o){n.cameraService.update(o),n.render()}),n.hooks={init:new Ks},n}return(0,jt.Z)(r,[{key:"init",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,bi.Z)(ti().mark(function d(){return ti().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(E){u.map.onCameraChanged(function(M){u.cameraService.init(),u.cameraService.update(M),u.map.version!=="GAODE2.x"&&E()}),u.map.version!=="GAODE2.x"?u.map.init():E()});case 2:if(!(u.map.version==="GAODE2.x"&&u.map.initViewPort)){_.next=6;break}return _.next=5,u.map.init();case 5:u.map.initViewPort();case 6:u.map.onCameraChanged(u.handleMapCameraChanged),u.map.addMarkerContainer(),u.markerService.addMarkers(),u.markerService.addMarkerLayers(),u.popupService.initPopup(),u.interactionService.init(),u.interactionService.on(Pr.Drag,u.addSceneEvent.bind(u));case 13:case"end":return _.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,bi.Z)(ti().mark(function d(){var g,_;return ti().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(g=Co(u.configService.getSceneConfig(u.id).id||""),u.$container=g,!g){M.next=11;break}return u.canvas=pa("canvas","",g),u.setCanvas(),M.next=7,u.rendererService.init(u.canvas,u.configService.getSceneConfig(u.id));case 7:pp()(u.$container,u.handleWindowResized),ga.matchMedia&&((_=ga.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||_===void 0||_.addListener(u.handleWindowResized)),M.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:u.pickingService.init(u.id);case 13:case"end":return M.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,bi.Z)(ti().mark(function d(){return ti().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(E){u.map.onCameraChanged(function(M){u.cameraService.init(),u.cameraService.update(M),u.map.version!=="GAODE2.x"&&E()}),u.map.initMiniMap()});case 2:u.map.onCameraChanged(u.handleMapCameraChanged),u.interactionService.init(),u.interactionService.on(Pr.Drag,u.addSceneEvent.bind(u));case 5:case"end":return _.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,bi.Z)(ti().mark(function d(){var g;return ti().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(g=o.canvas,u.$container=g||null,!u.$container){E.next=7;break}return E.next=5,u.rendererService.init(o.canvas,u.configService.getSceneConfig(u.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:u.pickingService.init(u.id);case 9:case"end":return E.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var n=(0,bi.Z)(ti().mark(function u(){return ti().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.rendering||this.destroyed)){g.next=2;break}return g.abrupt("return");case 2:if(this.rendering=!0,this.inited){g.next=15;break}return g.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){g.next=10;break}return g.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return g.stop()}},u,this)}));function o(){return n.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,u){this.fontFamily=o;var d=document.createElement("style");d.type="text/css",d.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(u,`') format('woff2'),
            url('`).concat(u,`') format('woff'),
            url('`).concat(u,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(d),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var u,d=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0];this.render();var g=o==="jpg"?d==null?void 0:d.toDataURL("image/jpeg"):d==null?void 0:d.toDataURL("image/png");return g}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=pa("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Th.unbind)(this.$container,this.handleWindowResized),ga.matchMedia){var d;(d=ga.matchMedia("screen and (min-resolution: 2dppx)"))===null||d===void 0||d.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,u,d=Ea,g=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E&&(E.width=g*d,E.height=_*d),this.rendererService.viewport({x:0,y:0,width:d*g,height:d*_})}},{key:"setCanvas",value:function(){var o,u,d=Ea,g=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E.width=g*d,E.height=_*d,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(Ro.EventEmitter),Lh=hr(Qs.prototype,"id",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=hr(Qs.prototype,"iconService",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=hr(Qs.prototype,"fontService",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mv=hr(Qs.prototype,"controlService",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uc=hr(Qs.prototype,"configService",[qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cd=hr(Qs.prototype,"map",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fd=hr(Qs.prototype,"coordinateSystemService",[Kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=hr(Qs.prototype,"rendererService",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jl=hr(Qs.prototype,"layerService",[bf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=hr(Qs.prototype,"cameraService",[Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=hr(Qs.prototype,"interactionService",[$f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=hr(Qs.prototype,"pickingService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=hr(Qs.prototype,"shaderModuleService",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fd=hr(Qs.prototype,"markerService",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=hr(Qs.prototype,"popupService",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qs))||ld),_v=R(44908),Bd=R.n(_v);function xv(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var ku=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ep(e){var i={};return e=e.replace(ku,function(r,n,o){var u=o.split(":"),d=u[0].trim(),g="";switch(u.length>1&&(g=u[1].trim()),n){case"bool":g=g==="true";break;case"float":case"int":g=Number(g);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":g?g=g.replace("[","").replace("]","").split(",").reduce(function(_,E){return _.push(Number(E.trim())),_},[]):g=new Array(xv(n)).fill(0);break;default:}return i[d]=g,"uniform ".concat(n," ").concat(d,`;
`)}),{content:e,uniforms:i}}var zd,Vl;function bv(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Dh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bv(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ef="#define PI 3.14159265359",Fh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Nh=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Bh=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,zh=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Ev=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Sv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,wv=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Cv=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Ud=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Zd=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Zc=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Av=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,jd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Vd=/precision\s+(high|low|medium)p\s+float/,Tv=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Gd=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Mv=(zd=(0,Gr.b2)(),zd(Vl=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,jt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ef,fs:Ef}),this.registerModule("decode",{vs:Fh,fs:""}),this.registerModule("projection",{vs:wv,fs:""}),this.registerModule("project",{vs:Sv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Cv}),this.registerModule("lighting",{vs:Bh,fs:""}),this.registerModule("light",{vs:Nh,fs:""}),this.registerModule("picking",{vs:Ev,fs:zh}),this.registerModule("styleMapping",{vs:Ud,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:jd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Zd,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Zc,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Av,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var o=n.vs,u=n.fs,d=n.uniforms,g=Ep(o),_=g.content,E=g.uniforms,M=Ep(u),P=M.content,D=M.uniforms;this.rawContentCache[r]={fs:P,uniforms:Dh(Dh(Dh({},E),D),d),vs:_}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,u=this.rawContentCache[r].fs,d=this.processModule(o,[],"vs"),g=d.content,_=d.includeList,E=this.processModule(u,[],"fs"),M=E.content,P=E.includeList,D=M,Z=Bd()(_.concat(P).concat(r)).reduce(function(Q,ue){return Dh(Dh({},Q),n.rawContentCache[ue].uniforms)},{});return Vd.test(M)||(D=Tv+M),this.moduleCache[r]={fs:D.trim(),uniforms:Z,vs:g.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,o){var u=this,d=r.replace(Gd,function(g,_){var E=_.split(" "),M=E[0].replace(/"/g,"");if(n.indexOf(M)>-1)return"";var P=u.rawContentCache[M][o];n.push(M);var D=u.processModule(P,n,o),Z=D.content;return Z});return{content:d,includeList:n}}}]),e}())||Vl),Sp=R(66213),dc;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(dc||(dc={}));var Hd,Uh,Wd,Zh,Pv,wp=(Hd=(0,Gr.b2)(),Uh=(0,Gr.f3)(Ht.IShaderModuleService),Hd(Wd=(Zh=function(){function e(){(0,pt.Z)(this,e),$t(this,"shaderModuleService",Pv,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,jt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return dc.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ht.IRendererService),this.cameraService=r.getContainer().get(Ht.ICameraService),this.mapService=r.getContainer().get(Ht.IMapService),this.interactionService=r.getContainer().get(Ht.IInteractionService),this.layerService=r.getContainer().get(Ht.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Pv=hr(Zh.prototype,"shaderModuleService",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zh))||Wd),Iv,Ov;function Am(e){var i=Tm();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Tm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mm=(Iv=(0,Gr.b2)(),Iv(Ov=function(e){(0,En.Z)(r,e);var i=Am(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,u){(0,Sp.Z)((0,Qt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(wp))||Ov),Rv,Lv,kv,xl,Cp;function Dv(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ap(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function Ap(e,i){if(!!e){if(typeof e=="string")return Xd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xd(e,i)}}function Xd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Dx=(Rv=(0,Gr.b2)(),Lv=(0,Gr.f3)(Ht.IPostProcessor),Rv(kv=(xl=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"passes",[]),$t(this,"postProcessor",Cp,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,jt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,bi.Z)(ti().mark(function n(){var o,u,d;return ti().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=Dv(this.passes),_.prev=1,o.s();case 3:if((u=o.n()).done){_.next=9;break}return d=u.value,_.next=7,d.render(this.layer);case 7:_.next=3;break;case 9:_.next=14;break;case 11:_.prev=11,_.t0=_.catch(1),o.e(_.t0);case 14:return _.prev=14,o.f(),_.finish(14);case 17:this.layer.renderModels();case 18:case"end":return _.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===dc.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,o){r.init(this.layer,n),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Cp=hr(xl.prototype,"postProcessor",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl))||kv),c0,f0;function h0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function p0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?h0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fx(e){var i=Nx();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Nx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bx=(c0=(0,Gr.b2)(),c0(f0=function(e){(0,En.Z)(r,e);var i=Fx(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,be.Z)(n),"layer",void 0),(0,I.Z)((0,be.Z)(n),"width",0),(0,I.Z)((0,be.Z)(n),"height",0),(0,I.Z)((0,be.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,be.Z)(n),"pickFromPickingFBO",function(g){var _=g.x,E=g.y,M=g.lngLat,P=g.type;if(!(!n.layer.isVisible()||!n.layer.needPick(P))){var D=n.rendererService,Z=D.getViewportSize,Q=D.readPixels,ue=D.useFramebuffer,ve=Z(),Ne=ve.width,it=ve.height,mt=n.layer.getLayerConfig(),bt=mt.enableHighlight,Vt=mt.enableSelect,Kt=_*Ea,or=E*Ea;if(!(Kt>Ne||Kt<0||or>it||or<0)){var br;ue(n.pickingFBO,function(){var rn;if(br=Q({x:Math.round(Kt),y:Math.round(it-(E+1)*Ea),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),br[0]!==0||br[1]!==0||br[2]!==0){var dn=W(br),Or=n.layer.getSource().getFeatureById(dn),In={x:_,y:E,type:P,lngLat:M,featureId:dn,feature:Or};Or&&(n.layer.setCurrentPickId(dn),n.triggerHoverOnLayer(In))}else{var Un={x:_,y:E,lngLat:M,type:n.layer.getCurrentPickId()===null?"un"+P:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(p0(p0({},Un),{},{type:"unpick"})),n.triggerHoverOnLayer(Un),n.layer.setCurrentPickId(null)}bt&&n.highlightPickedFeature(br),Vt&&P==="click"&&((rn=br)===null||rn===void 0?void 0:rn.toString())!==[0,0,0,0].toString()&&n.selectFeature(br)})}}}),n}return(0,jt.Z)(r,[{key:"getType",value:function(){return dc.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,u){(0,Sp.Z)((0,Qt.Z)(r.prototype),"init",this).call(this,o,u),this.layer=o;var d=this.rendererService,g=d.createTexture2D,_=d.createFramebuffer,E=d.getViewportSize,M=E(),P=M.width,D=M.height;this.pickingFBO=_({color:g({width:P,height:D,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.interactionService.on(Pr.Hover,this.pickFromPickingFBO),this.interactionService.on(Pr.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Pr.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var u=this;if(!this.alreadyInRendering){var d=this.rendererService,g=d.getViewportSize,_=d.useFramebuffer,E=d.clear,M=g(),P=M.width,D=M.height;this.alreadyInRendering=!0,(this.width!==P||this.height!==D)&&(this.pickingFBO.resize({width:P,height:D}),this.width=P,this.height=D),_(this.pickingFBO,function(){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Z=u.layer.multiPassRenderer.getRenderFlag();u.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),u.layer.multiPassRenderer.setRenderFlag(Z),u.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var u=(0,ie.Z)(o,3),d=u[0],g=u[1],_=u[2];this.layer.hooks.beforeHighlight.call([d,g,_]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var u=(0,ie.Z)(o,3),d=u[0],g=u[1],_=u[2];this.layer.hooks.beforeSelect.call([d,g,_]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var u=o.featureId,d=fe(u);this.selectFeature(new Uint8Array(d))}},{key:"highlightFeatureHandle",value:function(o){var u=o.featureId,d=fe(u);this.highlightPickedFeature(new Uint8Array(d))}}]),r}(wp))||f0),zx=R(11700),Ux=R.n(zx),Zx=R(68929),jx=R.n(Zx),d0,v0,m0,Pm,g0;function y0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Yd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?y0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Vx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jh=(d0=(0,Gr.b2)(),v0=(0,Gr.f3)(Ht.IShaderModuleService),d0(m0=(Pm=function(){function e(){(0,pt.Z)(this,e),$t(this,"shaderModuleService",g0,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",Vx),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,jt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return dc.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ht.IRendererService);var o=this.rendererService,u=o.createAttribute,d=o.createBuffer,g=o.createModel,_=this.setupShaders(),E=_.vs,M=_.fs,P=_.uniforms;this.model=g({vs:E,fs:M,attributes:{a_Position:u({buffer:d({data:[-4,-4,4,-4,0,4],type:ae.FLOAT}),size:2})},uniforms:Yd(Yd({u_Texture:null},P),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var n=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,d=u.useFramebuffer,g=u.getViewportSize,_=u.clear,E=g(),M=E.width,P=E.height;d(this.renderToScreen?null:o.getWriteFBO(),function(){_({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),n.model.draw({uniforms:Yd({u_Texture:o.getReadFBO(),u_ViewportSize:[M,P]},n.convertOptionsToUniforms(n.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Yd(Yd({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(o){Lu()(r[o])||(n["u_".concat(Ux()(jx()(o)))]=r[o])}),n}}]),e}(),g0=hr(Pm.prototype,"shaderModuleService",[v0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm))||m0),_0,x0;function b0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function E0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?b0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gx(e){var i=Hx();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Hx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Xx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Yx=(_0=(0,Gr.b2)(),_0(x0=function(e){(0,En.Z)(r,e);var i=Gx(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Xx,fs:Wx});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,g=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,M=_.height;return{vs:u,fs:d,uniforms:E0(E0({},g),{},{u_ViewportSize:[E,M]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Lu()(o.blurRadius)||(u.u_BlurDir=[o.blurRadius,0]),u}}]),r}(jh))||x0),S0,w0;function C0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function A0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?C0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qx(e){var i=Kx();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $x=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Jx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qx=(S0=(0,Gr.b2)(),S0(w0=function(e){(0,En.Z)(r,e);var i=qx(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Jx,fs:$x});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,g=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,M=_.height;return{vs:u,fs:d,uniforms:A0(A0({},g),{},{u_ViewportSize:[E,M]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Lu()(o.blurRadius)||(u.u_BlurDir=[0,o.blurRadius]),u}}]),r}(jh))||w0),T0,M0;function P0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function I0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?P0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eb(e){var i=tb();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,nb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ib=(T0=(0,Gr.b2)(),T0(M0=function(e){(0,En.Z)(r,e);var i=eb(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:nb,fs:rb});var o=this.shaderModuleService.getModule("colorhalftone-pass"),u=o.vs,d=o.fs,g=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,M=_.height;return{vs:u,fs:d,uniforms:I0(I0({},g),{},{u_ViewportSize:[E,M]})}}}]),r}(jh))||M0),O0,R0;function ab(e){var i=ob();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lb=(O0=(0,Gr.b2)(),O0(R0=function(e){(0,En.Z)(r,e);var i=ab(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ub,fs:sb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(jh))||R0),L0,k0;function D0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function F0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?D0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cb(e){var i=fb();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function fb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,db=(L0=(0,Gr.b2)(),L0(k0=function(e){(0,En.Z)(r,e);var i=cb(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:pb,fs:hb});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),u=o.vs,d=o.fs,g=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,M=_.height;return{vs:u,fs:d,uniforms:F0(F0({},g),{},{u_ViewportSize:[E,M]})}}}]),r}(jh))||k0),N0,B0;function z0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function U0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?z0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vb(e){var i=mb();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,yb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_b=(N0=(0,Gr.b2)(),N0(B0=function(e){(0,En.Z)(r,e);var i=vb(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:yb,fs:gb});var o=this.shaderModuleService.getModule("ink-pass"),u=o.vs,d=o.fs,g=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,M=_.height;return{vs:u,fs:d,uniforms:U0(U0({},g),{},{u_ViewportSize:[E,M]})}}}]),r}(jh))||B0),Z0,j0;function xb(e){var i=bb();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wb=(Z0=(0,Gr.b2)(),Z0(j0=function(e){(0,En.Z)(r,e);var i=xb(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Sb,fs:Eb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(jh))||j0),V0,G0;function Cb(e){var i=Ab();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Mb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Pb=(V0=(0,Gr.b2)(),V0(G0=function(e){(0,En.Z)(r,e);var i=Cb(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Tb,fs:Mb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(jh))||G0),H0,W0,X0,Y0,hd,q0,Ib=(H0=(0,Gr.b2)(),W0=(0,Gr.f3)(Ht.IRendererService),X0=(0,Gr.zY)(),H0(Y0=(hd=function(){function e(){(0,pt.Z)(this,e),$t(this,"rendererService",q0,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,jt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var i=(0,bi.Z)(ti().mark(function n(o){var u,d;return ti().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:u=0;case 1:if(!(u<this.passes.length)){_.next=10;break}return d=this.passes[u],d.setRenderToScreen(this.isLastEnabledPass(u)),_.next=6,d.render(o);case 6:u!==this.passes.length-1&&this.swap();case 7:u++,_.next=1;break;case 10:case"end":return _.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,o){r.init(n,o),this.passes.push(r)}},{key:"insert",value:function(r,n,o,u){r.init(o,u),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),q0=hr(hd.prototype,"rendererService",[W0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hr(hd.prototype,"init",[X0],Object.getOwnPropertyDescriptor(hd.prototype,"init"),hd.prototype),hd))||Y0),K0,$0;function Ob(e){var i=Rb();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Rb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lb=(K0=(0,Gr.b2)(),K0($0=function(e){(0,En.Z)(r,e);var i=Ob(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getType",value:function(){return dc.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,u){(0,Sp.Z)((0,Qt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(o){var u=this.rendererService,d=u.useFramebuffer,g=u.clear;d(null,function(){g({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(wp))||$0),J0,Q0,eg,Im,tg;function rg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ng(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kb(e){var i=Db();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fb=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,ig=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Nb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function ag(e,i){for(var r=0,n=1/i,o=e;o>0;)r=r+n*(o%i),o=Math.floor(o/i),n=n/i;return r}var Bb=1,zb=(J0=(0,Gr.b2)(),Q0=(0,Gr.f3)(Ht.IShaderModuleService),J0(eg=(Im=function(e){(0,En.Z)(r,e);var i=kb(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),$t((0,be.Z)(n),"shaderModuleService",tg,(0,be.Z)(n)),(0,I.Z)((0,be.Z)(n),"haltonSequence",[]),(0,I.Z)((0,be.Z)(n),"accumulatingId",0),(0,I.Z)((0,be.Z)(n),"frame",0),(0,I.Z)((0,be.Z)(n),"timer",void 0),(0,I.Z)((0,be.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,be.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,be.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,be.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,be.Z)(n),"blendModel",void 0),(0,I.Z)((0,be.Z)(n),"outputModel",void 0),(0,I.Z)((0,be.Z)(n),"copyModel",void 0),n}return(0,jt.Z)(r,[{key:"getType",value:function(){return dc.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,u){(0,Sp.Z)((0,Qt.Z)(r.prototype),"init",this).call(this,o,u);var d=this.rendererService,g=d.createFramebuffer,_=d.createTexture2D;this.sampleRenderTarget=g({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.prevRenderTarget=g({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.outputRenderTarget=g({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.copyRenderTarget=g({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([ag(E,2),ag(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",Fb),this.outputModel=this.createTriangleModel("copy-pass",ig,{blend:{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE_MINUS_SRC_ALPHA,srcAlpha:ae.ONE,dstAlpha:ae.ONE_MINUS_SRC_ALPHA},equation:{rgb:ae.FUNC_ADD,alpha:ae.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",ig)}},{key:"render",value:function(o){var u=this,d=this.rendererService,g=d.clear,_=d.getViewportSize,E=d.useFramebuffer,M=_(),P=M.width,D=M.height;this.sampleRenderTarget.resize({width:P,height:D}),this.prevRenderTarget.resize({width:P,height:D}),this.outputRenderTarget.resize({width:P,height:D}),this.copyRenderTarget.resize({width:P,height:D}),this.resetFrame(),this.stopAccumulating();var Z=o.multiPassRenderer.getPostProcessor().getReadFBO();E(Z,function(){g({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Z}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var Q=function ue(ve){!u.accumulatingId||ve!==u.accumulatingId||u.isFinished()||(u.doRender(o),ga.requestAnimationFrame(function(){ue(ve)}))};this.accumulatingId=Bb++,this.timer=ga.setTimeout(function(){Q(u.accumulatingId)},50)}},{key:"doRender",value:function(o){var u=this,d=this.rendererService,g=d.clear,_=d.getViewportSize,E=d.useFramebuffer,M=_(),P=M.width,D=M.height,Z=o.getLayerConfig(),Q=Z.jitterScale,ue=Q===void 0?1:Q,ve=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ve[0]*2-1)/P*ue,(ve[1]*2-1)/D*ue),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){g({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var Ne=o.getLayerConfig();E(this.outputRenderTarget,function(){u.blendModel.draw({uniforms:{u_opacity:Ne.opacity||1,u_MixRatio:u.frame===0?1:.9,u_Diffuse1:u.sampleRenderTarget,u_Diffuse2:u.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():u.prevRenderTarget}})}),this.frame===0&&g({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){u.outputModel.draw({uniforms:{u_Texture:u.outputRenderTarget}})}),E(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){u.copyModel.draw({uniforms:{u_Texture:u.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var it=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=it,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ga.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,u,d){this.shaderModuleService.registerModule(o,{vs:Nb,fs:u});var g=this.shaderModuleService.getModule(o),_=g.vs,E=g.fs,M=g.uniforms,P=this.rendererService,D=P.createAttribute,Z=P.createBuffer,Q=P.createModel;return Q(ng({vs:_,fs:E,attributes:{a_Position:D({buffer:Z({data:[-4,-4,4,-4,0,4],type:ae.FLOAT}),size:2})},uniforms:ng({},M),depth:{enable:!1},count:3},d))}}]),r}(wp),tg=hr(Im.prototype,"shaderModuleService",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im))||eg),pd=new Gr.W2;pd.bind(Ht.IGlobalConfigService).to(tn).inSingletonScope(),pd.bind(Ht.IShaderModuleService).to(Mv).inSingletonScope(),(0,Gr.GW)((0,Gr.b2)(),Ro.EventEmitter),pd.bind(Ht.IEventEmitter).to(Ro.EventEmitter);var og=(0,gl.Z)(pd,!1),qd=function(i){var r=og.lazyInject(i);return function(n,o,u){r.call(this,n,o),u&&(u.initializer=function(){return n[o]})}},qP=function(i){var r=og.lazyMultiInject(i);return function(n,o,u){r.call(this,n,o),u&&(u.initializer=function(){return n[o]})}},Gl=pd,Ub=0;function Zb(){var e=new Gr.W2;return e.parent=pd,e.bind(Ht.SceneID).toConstantValue("".concat(Ub++)),e.bind(Ht.ILayerService).to(Eh).inSingletonScope(),e.bind(Ht.ISceneService).to(yv).inSingletonScope(),e.bind(Ht.ICameraService).to(wo).inSingletonScope(),e.bind(Ht.ICoordinateSystemService).to(Wt).inSingletonScope(),e.bind(Ht.IInteractionService).to(xi).inSingletonScope(),e.bind(Ht.IPickingService).to(Ps).inSingletonScope(),e.bind(Ht.IControlService).to(Zi).inSingletonScope(),e.bind(Ht.IMarkerService).to(Ge).inSingletonScope(),e.bind(Ht.IIconService).to(B).inSingletonScope(),e.bind(Ht.IFontService).to(ed).inSingletonScope(),e.bind(Ht.IPopupService).to(Je).inSingletonScope(),e.bind(Ht.INormalPass).to(Mm).whenTargetNamed("clear"),e.bind(Ht.INormalPass).to(Bx).whenTargetNamed("pixelPicking"),e.bind(Ht.INormalPass).to(Lb).whenTargetNamed("render"),e.bind(Ht.INormalPass).to(zb).whenTargetNamed("taa"),e.bind(Ht.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Ht.INormalPass,r)}}),e.bind(Ht.IPostProcessingPass).to(lb).whenTargetNamed("copy"),e.bind(Ht.IPostProcessingPass).to(Yx).whenTargetNamed("blurH"),e.bind(Ht.IPostProcessingPass).to(Qx).whenTargetNamed("blurV"),e.bind(Ht.IPostProcessingPass).to(wb).whenTargetNamed("noise"),e.bind(Ht.IPostProcessingPass).to(Pb).whenTargetNamed("sepia"),e.bind(Ht.IPostProcessingPass).to(ib).whenTargetNamed("colorHalftone"),e.bind(Ht.IPostProcessingPass).to(db).whenTargetNamed("hexagonalPixelate"),e.bind(Ht.IPostProcessingPass).to(_b).whenTargetNamed("ink"),e.bind(Ht.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Ht.IPostProcessingPass,r);return n.setName(r),n}}),e}function jb(e){var i=new Gr.W2;return i.parent=e,i.bind(Ht.IStyleAttributeService).to(od).inSingletonScope(),i.bind(Ht.IMultiPassRenderer).to(Dx).inSingletonScope(),i.bind(Ht.IPostProcessor).to(Ib).inSingletonScope(),i}var KP=R(74691),Vb=null;function $P(e){return Vb.indexOf(e)}var Gb=2,JP=4,Hb=64,QP=128,Wb=256,Xb=512,e3=8192,t3=16384,r3=32768,Yb=null,sg=131072,n3=262144,qb=524288,i3=1048576,Kb=2097152,a3=4194304,$b=8388608,Jb=16777216,Qb=null;function Fv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function o3(e){var i=e.color,r=e.radius,n=e.tileX,o=e.tileY,u=e.shape,d=e.opacity,g=e.stroke,_=e.strokeWidth,E=e.strokeOpacity,M=[],P=[],D=[],Z=[Fv(i[0],i[1]),Fv(i[2],i[3])],Q=[Fv(g[0],g[1]),Fv(g[2],g[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(ue){var ve=_slicedToArray(ue,2),Ne=ve[0],it=ve[1];M.push([].concat(Z,[(Ne+1)*$b+(it+1)*Kb+getShapeIndex(u)*sg+r,(n+512)*qb+(o+512)*Hb])),P.push([].concat(Q,[_,E])),D.push([d,0,0,0])}),{packedBuffer:M,packedBuffer2:P,packedBuffer3:D}}function s3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Qb+r*Jb+n*sg+r*Yb+n*Xb+r*Wb+n*Gb+r}var vc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(vc||(vc={}));var eu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(eu||(eu={}));var Vh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Vh||(Vh={}));var Ei;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Ei||(Ei={}));var eE=["mapload","mapchange"],Tp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Om=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Gh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Gh||(Gh={}));function ug(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function lg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ug(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ug(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tE(e){var i=rE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nE=0,Nv=function(e){(0,En.Z)(r,e);var i=tE(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this),(0,I.Z)((0,be.Z)(o),"controlOption",void 0),(0,I.Z)((0,be.Z)(o),"container",void 0),(0,I.Z)((0,be.Z)(o),"sceneContainer",void 0),(0,I.Z)((0,be.Z)(o),"mapsService",void 0),(0,I.Z)((0,be.Z)(o),"renderService",void 0),(0,I.Z)((0,be.Z)(o),"layerService",void 0),(0,I.Z)((0,be.Z)(o),"controlService",void 0),(0,I.Z)((0,be.Z)(o),"isShow",void 0),o.controlOption=lg(lg({},o.getDefault()),n||{}),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.TOPRIGHT,name:"".concat(nE++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Gh.BOTTOMRIGHT,u=this.controlService;return u&&u.removeControl(this),this.controlOption.position=o,u&&u.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(Ht.IMapService),this.renderService=o.get(Ht.IRendererService),this.layerService=o.get(Ht.ILayerService),this.controlService=o.get(Ht.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var u=this.container,d=this.controlOption.position,g=this.controlService.controlCorners[d];return Fs(u,"l7-control"),d.indexOf("bottom")!==-1?g.insertBefore(u,g.firstChild):g.appendChild(u),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Fs(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ou(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;lo(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var u=this.mapsService.getContainer();u!==null&&u.focus()}}}]),r}(Ro.EventEmitter);function iE(e){var i=aE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function aE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u3=function(e){(0,En.Z)(r,e);var i=iE(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,be.Z)(o),"layerControlInputs",void 0),(0,I.Z)((0,be.Z)(o),"layers",void 0),(0,I.Z)((0,be.Z)(o),"lastZIndex",void 0),(0,I.Z)((0,be.Z)(o),"handlingClick",void 0),(0,I.Z)((0,be.Z)(o),"layersLink",void 0),(0,I.Z)((0,be.Z)(o),"baseLayersList",void 0),(0,I.Z)((0,be.Z)(o),"separator",void 0),(0,I.Z)((0,be.Z)(o),"overlaysList",void 0),(0,I.Z)((0,be.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),w(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,be.Z)(o)),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Gh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(u){u.layer.on("remove",o.onLayerChange),u.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,u){return this.addLayer(o,u,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),u=o.height;Fs(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var d=u-(this.container.offsetTop+50);return d<this.form.clientHeight?(Fs(this.form,"l7-control-layers-scrollbar"),this.form.style.height=d+"px"):ou(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ou(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(u){u.layer.off("remove",o.onLayerChange),u.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",u=this.container=pa("div",o),d=this.controlOption.collapsed;u.setAttribute("aria-haspopup","true");var g=this.form=pa("form",o+"-list");d&&(this.mapsService.on("click",this.collapse),u.addEventListener("mouseenter",this.expand),u.addEventListener("mouseleave",this.collapse)),this.layersLink=pa("a",o+"-toggle",u);var _=this.layersLink;_.title="Layers",d||this.expand(),this.baseLayersList=pa("div",o+"-base",g),this.separator=pa("div",o+"-separator",g),this.overlaysList=pa("div",o+"-overlays",g),u.appendChild(g)}},{key:"initLayers",value:function(){var o=this,u=this.controlOption,d=u.baseLayers,g=d===void 0?{}:d,_=u.overlayers,E=_===void 0?{}:_;Object.keys(g).forEach(function(M,P){o.addLayer(g[M],M,!1)}),Object.keys(E).forEach(function(M,P){o.addLayer(E[M],M,!0)})}},{key:"update",value:function(){if(!this.container)return this;Pn(this.baseLayersList),Pn(this.overlaysList),this.layerControlInputs=[];var o,u,d,g,_=0;for(d=0;d<this.layers.length;d++)g=this.layers[d],this.addItem(g),u=u||g.overlay,o=o||!g.overlay,_+=g.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&_>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=u&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,u,d,g=this.mapsService.getZoom(),_=o.length-1;_>=0;_--)if(u=o[_],d=this.layerService.getLayer(u.layerId),d&&d.inited){var E=d.getMinZoom(),M=d.getMaxZoom();u.disabled=g<E||g>M}}},{key:"addLayer",value:function(o,u,d){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:u,overlay:d});var g=this.controlOption,_=g.sortLayers,E=g.sortFunction,M=g.autoZIndex;_&&this.layers.sort(function(P,D){return E(P.layer,D.layer,P.name,D.name)}),M&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var u=this.layerService.getLayer(o.target.layerId),d=u!=null&&u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;d&&this.emit(d,u)}},{key:"createRadioElement",value:function(o,u){var d='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",g=document.createElement("div");return g.innerHTML=d,g.firstChild}},{key:"addItem",value:function(o){var u=document.createElement("label"),d=this.layerService.getLayer(o.layer.id),g=d&&d.inited&&o.layer.isVisible(),_;o.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="l7-control-layers-selector",_.defaultChecked=g):_=this.createRadioElement("l7-base-layers",g),this.layerControlInputs.push(_),_.layerId=o.layer.id,_.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+o.name;var M=document.createElement("div");u.appendChild(M),M.appendChild(_),M.appendChild(E);var P=o.overlay?this.overlaysList:this.baseLayersList;return P.appendChild(u),this.checkDisabledLayers(),u}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,u,d,g=[],_=[];this.handlingClick=!0;for(var E=o.length-1;E>=0;E--)u=o[E],d=this.layerService.getLayer(u.layerId),u.checked?g.push(d):u.checked||_.push(d);_.forEach(function(M){M.hide()}),g.forEach(function(M){M.show()}),this.handlingClick=!1}}]),r}(Nv);function oE(e){var i=sE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function sE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uE=function(e){(0,En.Z)(r,e);var i=oE(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",u=pa("div",o),d=pa("a","l7-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://antv.alipay.com/l7",d.setAttribute("aria-label","AntV logo"),d.setAttribute("rel","noopener nofollow"),u.appendChild(d),u}},{key:"onRemove",value:function(){return null}}]),r}(Nv);function lE(e){var i=cE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function cE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l3=function(e){(0,En.Z)(r,e);var i=lE(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,be.Z)(o),"mScale",void 0),(0,I.Z)((0,be.Z)(o),"iScale",void 0),w(["update"],(0,be.Z)(o)),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",u=pa("div",o);this.addScales(o+"-line",u);var d=this.controlOption.updateWhenIdle;return this.mapsService.on(d?"moveend":"mapmove",this.update),this.mapsService.on(d?"zoomend":"zoomchange",this.update),this.update(),u}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,u=this.controlOption.maxWidth,d=o.getSize()[1]/2,g=o.containerToLngLat([0,d]),_=o.containerToLngLat([u,d]),E=rc([g.lng,g.lat],[_.lng,_.lat]);this.updateScales(E)}},{key:"updateScales",value:function(o){var u=this.controlOption,d=u.metric,g=u.imperial;d&&o&&this.updateMetric(o),g&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var u=this.getRoundNum(o),d=u<1e3?u+" m":u/1e3+" km";this.updateScale(this.mScale,d,u/o)}},{key:"updateImperial",value:function(o){var u=o*3.2808399,d,g,_;u>5280?(d=u/5280,g=this.getRoundNum(d),this.updateScale(this.iScale,g+" mi",g/d)):(_=this.getRoundNum(u),this.updateScale(this.iScale,_+" ft",_/u))}},{key:"updateScale",value:function(o,u,d){var g=this.controlOption.maxWidth;o.style.width=Math.round(g*d)+"px",o.innerHTML=u}},{key:"getRoundNum",value:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),d=o/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,u*d}},{key:"addScales",value:function(o,u){var d=this.controlOption,g=d.metric,_=d.imperial;g&&(this.mScale=pa("div",o,u)),_&&(this.iScale=pa("div",o,u))}}]),r}(Nv);function fE(e){var i=hE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function hE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c3=function(e){(0,En.Z)(r,e);var i=fE(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,be.Z)(o),"disabled",void 0),(0,I.Z)((0,be.Z)(o),"zoomInButton",void 0),(0,I.Z)((0,be.Z)(o),"zoomOutButton",void 0),w(["updateDisabled","zoomIn","zoomOut"],(0,be.Z)(o)),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{position:Gh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",u=pa("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",u,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",u,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),u}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,u,d,g,_){var E=pa("a",d,g);return E.innerHTML=o,E.title=u,E.href="javascript:void(0)",E.addEventListener("click",_),E}},{key:"updateDisabled",value:function(){var o=this.mapsService,u="l7-disabled";ou(this.zoomInButton,u),ou(this.zoomOutButton,u),(this.disabled||o.getZoom()<=o.getMinZoom())&&Fs(this.zoomOutButton,u),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Fs(this.zoomInButton,u)}}]),r}(Nv);function cg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function fg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pE(e){var i=dE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function dE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hg=function(e){(0,En.Z)(r,e);var i=pE(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this),(0,I.Z)((0,be.Z)(o),"markerOption",void 0),(0,I.Z)((0,be.Z)(o),"defaultMarker",void 0),(0,I.Z)((0,be.Z)(o),"popup",void 0),(0,I.Z)((0,be.Z)(o),"mapsService",void 0),(0,I.Z)((0,be.Z)(o),"sceneSerive",void 0),(0,I.Z)((0,be.Z)(o),"lngLat",void 0),(0,I.Z)((0,be.Z)(o),"scene",void 0),(0,I.Z)((0,be.Z)(o),"added",!1),(0,I.Z)((0,be.Z)(o),"eventHandle",function(u){o.emit(u.type,{target:u,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=fg(fg({},o.getDefault()),n),w(["update","onMove","onUp","addDragHandler","onMapClick"],(0,be.Z)(o)),o.init(),o}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:de.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(Ht.IMapService),this.sceneSerive=o.get(Ht.ISceneService);var u=this.markerOption,d=u.element,g=u.draggable;return this.mapsService.getMarkerContainer().appendChild(d),this.registerMarkerEvent(d),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&lo(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var u=this;if(!this.added)return this.once("added",function(){u.setElement(o)}),this;var d=this.markerOption.element;return d&&lo(d),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var u=this.popup;return u?(u.isOpen()||u.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var u=this.popup;return u&&u.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.anchor;this.updatePosition(),ec(u,"".concat(Le[d]))}}},{key:"onMapClick",value:function(o){var u=this.markerOption.element;this.popup&&u&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.offsets,g=this.lngLat,_=g.lng,E=g.lat,M=this.mapsService.getBounds(),P=this.mapsService.lngLatToContainer([_,E]);if(u){u.style.display="block",u.style.whiteSpace="nowrap";var D=this.mapsService.getContainer(),Z=0,Q=0;if(D&&(Z=D.scrollWidth,Q=D.scrollHeight),Math.abs(M[0][0])>180||Math.abs(M[1][0])>180){if(P.x>Z){var ue=this.mapsService.lngLatToContainer([_-360,E]);P.x=ue.x}if(P.x<0){var ve=this.mapsService.lngLatToContainer([_+360,E]);P.x=ve.x}}(P.x>Z||P.x<0||P.y>Q||P.y<0)&&(u.style.display="none"),u.style.left=P.x+d[0]+"px",u.style.top=P.y-d[1]+"px"}}}},{key:"init",value:function(){var o=this,u=this.markerOption.element,d=this.markerOption,g=d.color,_=d.anchor;if(!u){this.defaultMarker=!0,u=pa("div"),this.markerOption.element=u;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var M=document.createElementNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),M.setAttributeNS(null,"fill",g),E.appendChild(M),u.appendChild(E)}Fs(u,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(P){var D,Z,Q=((D=o.markerOption)===null||D===void 0?void 0:D.style)&&((Z=o.markerOption)===null||Z===void 0?void 0:Z.style[P]);u&&(u.style[P]=Q)}),u.addEventListener("click",function(P){o.onMapClick(P)}),u.addEventListener("click",this.eventHandle),Oe(u,_,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(Ro.EventEmitter);function pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vE(e){var i=mE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function mE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f3=function(e){(0,En.Z)(r,e);var i=vE(r);function r(n){var o,u;return(0,pt.Z)(this,r),u=i.call(this),(0,I.Z)((0,be.Z)(u),"markers",[]),(0,I.Z)((0,be.Z)(u),"markerLayerOption",void 0),(0,I.Z)((0,be.Z)(u),"clusterIndex",void 0),(0,I.Z)((0,be.Z)(u),"points",[]),(0,I.Z)((0,be.Z)(u),"clusterMarkers",[]),(0,I.Z)((0,be.Z)(u),"mapsService",void 0),(0,I.Z)((0,be.Z)(u),"scene",void 0),(0,I.Z)((0,be.Z)(u),"zoom",void 0),(0,I.Z)((0,be.Z)(u),"bbox",void 0),u.markerLayerOption=nt()(u.getDefault(),n),w(["update"],(0,be.Z)(u)),u.zoom=((o=u.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,u}return(0,jt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(Ht.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var u=this.markerLayerOption.cluster;u&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var u=this.markers.indexOf(o);u>-1&&this.markers.splice(u,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(u){u.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,u){var d=o.getLnglat(),g=d.lng,_=d.lat,E={geometry:{type:"Point",coordinates:[g,_]},properties:dg(dg({},o.getExtData()),{},{marker_id:u})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,u=o.radius,d=o.minZoom,g=d===void 0?0:d,_=o.maxZoom;this.clusterIndex=new(sf())({radius:u,minZoom:g,maxZoom:_}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,u){var d=this,g=o[0].concat(o[1]),_=this.clusterIndex.getClusters(g,u);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],_.forEach(function(E){var M,P=d.markerLayerOption.clusterOption,D=P.field,Z=P.method;if(E.properties&&(M=E.properties)!==null&&M!==void 0&&M.cluster_id){var Q,ue=d.getLeaves((Q=E.properties)===null||Q===void 0?void 0:Q.cluster_id);if(E.properties.clusterData=ue,D&&Z){var ve=ue==null?void 0:ue.map(function(Vt){var Kt=(0,I.Z)({},D,Vt.properties[D]);return Kt}),Ne=Nt(ve,D),it=er(Z,Ne),mt="point_"+Z;E.properties[mt]=it.toFixed(2)}}var bt=d.clusterMarker(E);d.clusterMarkers.push(bt),bt.addTo(d.scene)})}},{key:"getLeaves",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,u,d):null}},{key:"clusterMarker",value:function(o){var u=this.markerLayerOption.clusterOption,d=u,g=d.element,_=g===void 0?this.generateElement.bind(this):g,E=new hg({element:_(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(o){var u=o.properties.marker_id;return this.markers[u]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!c(this.bbox,u))&&(this.bbox=f(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var u=pa("div","l7-marker-cluster"),d=pa("div","",u),g=pa("span","",d),_=this.markerLayerOption.clusterOption,E=_.field,M=_.method;o.properties.point_count=o.properties.point_count||1;var P=E&&M?o.properties["point_"+M]||o.properties[E]:o.properties.point_count;return g.textContent=P,u}}]),r}(Ro.EventEmitter);function vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gE(e){var i=yE();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function yE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gg=function(e){(0,En.Z)(r,e);var i=gE(r);function r(n){var o;return(0,pt.Z)(this,r),o=i.call(this),(0,I.Z)((0,be.Z)(o),"popupOption",void 0),(0,I.Z)((0,be.Z)(o),"mapsService",void 0),(0,I.Z)((0,be.Z)(o),"sceneSerive",void 0),(0,I.Z)((0,be.Z)(o),"lngLat",void 0),(0,I.Z)((0,be.Z)(o),"content",void 0),(0,I.Z)((0,be.Z)(o),"closeButton",void 0),(0,I.Z)((0,be.Z)(o),"timeoutInstance",void 0),(0,I.Z)((0,be.Z)(o),"container",void 0),(0,I.Z)((0,be.Z)(o),"tip",void 0),(0,I.Z)((0,be.Z)(o),"scene",void 0),o.popupOption=mg(mg({},o.getdefault()),n),w(["update","onClickClose","remove"],(0,be.Z)(o)),o}return(0,jt.Z)(r,[{key:"addTo",value:function(o){var u=this;return this.mapsService=o.get(Ht.IMapService),this.sceneSerive=o.get(Ht.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){u.mapsService.on("click",u.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var u=window.document.createDocumentFragment(),d=window.document.createElement("body"),g;for(d.innerHTML=o;g=d.firstChild,!!g;)u.appendChild(g);return this.setDOMContent(u)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&lo(this.content),this.content=pa("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=pa("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,u,d){var g=window.document.createElement(o);return u!==void 0&&(g.className=u),d&&d.appendChild(g),g}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:de.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,u=this.lngLat,d=this.popupOption,g=d.className,_=d.maxWidth,E=d.anchor;if(!(!this.mapsService||!u||!this.content)){var M=this.mapsService.getMarkerContainer();if(!this.container&&M){this.container=this.creatDom("div","l7-popup",M),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),g&&g.split(" ").forEach(function(D){return o.container.classList.add(D)});var P=this.popupOption.stopPropagation;P&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(D){o.container.addEventListener(D,function(Z){Z.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}_&&this.container.style.maxWidth!==_&&(this.container.style.maxWidth=_),this.updatePosition(),ec(this.container,"".concat(Le[E])),Oe(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,u=o.lng,d=o.lat,g=this.popupOption.offsets,_=this.mapsService.lngLatToContainer([u,d]);this.container.style.left=_.x+g[0]+"px",this.container.style.top=_.y-g[1]+"px"}}}]),r}(Ro.EventEmitter);function _E(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var d=i.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(i.createTextNode(e)),o.appendChild(d),d}}_E(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var xE=R(88307),bE=R.n(xE),EE=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,o=r.offset,u=r.stride,d=r.normalized,g=r.size,_=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:o||0,stride:u||0,normalized:d||!1,divisor:_||0},g&&(this.attribute.size=g)}return(0,jt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Jf,Kd,Qf,mc,$d,Hh,Jd,Bv,Sf,Mp,Su,wf,Cf,zv,SE=(Jf={},(0,I.Z)(Jf,ae.POINTS,"points"),(0,I.Z)(Jf,ae.LINES,"lines"),(0,I.Z)(Jf,ae.LINE_LOOP,"line loop"),(0,I.Z)(Jf,ae.LINE_STRIP,"line strip"),(0,I.Z)(Jf,ae.TRIANGLES,"triangles"),(0,I.Z)(Jf,ae.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(Jf,ae.TRIANGLE_STRIP,"triangle strip"),Jf),yg=(Kd={},(0,I.Z)(Kd,ae.STATIC_DRAW,"static"),(0,I.Z)(Kd,ae.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(Kd,ae.STREAM_DRAW,"stream"),Kd),Rm=(Qf={},(0,I.Z)(Qf,ae.BYTE,"int8"),(0,I.Z)(Qf,ae.UNSIGNED_INT,"int16"),(0,I.Z)(Qf,ae.INT,"int32"),(0,I.Z)(Qf,ae.UNSIGNED_BYTE,"uint8"),(0,I.Z)(Qf,ae.UNSIGNED_SHORT,"uint16"),(0,I.Z)(Qf,ae.UNSIGNED_INT,"uint32"),(0,I.Z)(Qf,ae.FLOAT,"float"),Qf),wE=(mc={},(0,I.Z)(mc,ae.ALPHA,"alpha"),(0,I.Z)(mc,ae.LUMINANCE,"luminance"),(0,I.Z)(mc,ae.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(mc,ae.RGB,"rgb"),(0,I.Z)(mc,ae.RGBA,"rgba"),(0,I.Z)(mc,ae.RGBA4,"rgba4"),(0,I.Z)(mc,ae.RGB5_A1,"rgb5 a1"),(0,I.Z)(mc,ae.RGB565,"rgb565"),(0,I.Z)(mc,ae.DEPTH_COMPONENT,"depth"),(0,I.Z)(mc,ae.DEPTH_STENCIL,"depth stencil"),mc),CE=($d={},(0,I.Z)($d,ae.DONT_CARE,"dont care"),(0,I.Z)($d,ae.NICEST,"nice"),(0,I.Z)($d,ae.FASTEST,"fast"),$d),_g=(Hh={},(0,I.Z)(Hh,ae.NEAREST,"nearest"),(0,I.Z)(Hh,ae.LINEAR,"linear"),(0,I.Z)(Hh,ae.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(Hh,ae.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(Hh,ae.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(Hh,ae.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Hh),xg=(Jd={},(0,I.Z)(Jd,ae.REPEAT,"repeat"),(0,I.Z)(Jd,ae.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(Jd,ae.MIRRORED_REPEAT,"mirror"),Jd),AE=(Bv={},(0,I.Z)(Bv,ae.NONE,"none"),(0,I.Z)(Bv,ae.BROWSER_DEFAULT_WEBGL,"browser"),Bv),TE=(Sf={},(0,I.Z)(Sf,ae.NEVER,"never"),(0,I.Z)(Sf,ae.ALWAYS,"always"),(0,I.Z)(Sf,ae.LESS,"less"),(0,I.Z)(Sf,ae.LEQUAL,"lequal"),(0,I.Z)(Sf,ae.GREATER,"greater"),(0,I.Z)(Sf,ae.GEQUAL,"gequal"),(0,I.Z)(Sf,ae.EQUAL,"equal"),(0,I.Z)(Sf,ae.NOTEQUAL,"notequal"),Sf),bg=(Mp={},(0,I.Z)(Mp,ae.FUNC_ADD,"add"),(0,I.Z)(Mp,ae.MIN_EXT,"min"),(0,I.Z)(Mp,ae.MAX_EXT,"max"),(0,I.Z)(Mp,ae.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Mp,ae.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Mp),Uv=(Su={},(0,I.Z)(Su,ae.ZERO,"zero"),(0,I.Z)(Su,ae.ONE,"one"),(0,I.Z)(Su,ae.SRC_COLOR,"src color"),(0,I.Z)(Su,ae.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Su,ae.SRC_ALPHA,"src alpha"),(0,I.Z)(Su,ae.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Su,ae.DST_COLOR,"dst color"),(0,I.Z)(Su,ae.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Su,ae.DST_ALPHA,"dst alpha"),(0,I.Z)(Su,ae.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Su,ae.CONSTANT_COLOR,"constant color"),(0,I.Z)(Su,ae.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Su,ae.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Su,ae.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Su,ae.SRC_ALPHA_SATURATE,"src alpha saturate"),Su),ME=(wf={},(0,I.Z)(wf,ae.NEVER,"never"),(0,I.Z)(wf,ae.ALWAYS,"always"),(0,I.Z)(wf,ae.LESS,"less"),(0,I.Z)(wf,ae.LEQUAL,"lequal"),(0,I.Z)(wf,ae.GREATER,"greater"),(0,I.Z)(wf,ae.GEQUAL,"gequal"),(0,I.Z)(wf,ae.EQUAL,"equal"),(0,I.Z)(wf,ae.NOTEQUAL,"notequal"),wf),dd=(Cf={},(0,I.Z)(Cf,ae.ZERO,"zero"),(0,I.Z)(Cf,ae.KEEP,"keep"),(0,I.Z)(Cf,ae.REPLACE,"replace"),(0,I.Z)(Cf,ae.INVERT,"invert"),(0,I.Z)(Cf,ae.INCR,"increment"),(0,I.Z)(Cf,ae.DECR,"decrement"),(0,I.Z)(Cf,ae.INCR_WRAP,"increment wrap"),(0,I.Z)(Cf,ae.DECR_WRAP,"decrement wrap"),Cf),PE=(zv={},(0,I.Z)(zv,ae.FRONT,"front"),(0,I.Z)(zv,ae.BACK,"back"),zv),IE=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,o=r.usage,u=r.type;this.buffer=i.buffer({data:n,usage:yg[o||ae.STATIC_DRAW],type:Rm[u||ae.UNSIGNED_BYTE]})}return(0,jt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,o=r.offset;this.buffer.subdata(n,o)}}]),e}(),OE=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,o=r.usage,u=r.type,d=r.count;this.elements=i.elements({data:n,usage:yg[o||ae.STATIC_DRAW],type:Rm[u||ae.UNSIGNED_BYTE],count:d})}return(0,jt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),RE=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,o=r.height,u=r.color,d=r.colors,g=r.depth,_=r.stencil,E={width:n,height:o};Array.isArray(d)&&(E.colors=d.map(function(M){return M.get()})),u&&typeof u!="boolean"&&(E.color=u.get()),this.framebuffer=i.framebuffer(E)}return(0,jt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.framebuffer.resize(n,o)}}]),e}(),LE=R(36719),kE=R.n(LE),DE=R(68630),FE=R.n(DE);function Eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function vd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Eg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var NE=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,o=r.fs,u=r.attributes,d=r.uniforms,g=r.primitive,_=r.count,E=r.elements,M=r.depth,P=r.blend,D=r.stencil,Z=r.cull,Q=r.instances,ue={};this.options=r,d&&(this.uniforms=this.extractUniforms(d),Object.keys(d).forEach(function(mt){ue[mt]=i.prop(mt)}));var ve={};Object.keys(u).forEach(function(mt){ve[mt]=u[mt].get()});var Ne={attributes:ve,frag:o,uniforms:ue,vert:n,primitive:SE[g===void 0?ae.TRIANGLES:g]};Q&&(Ne.instances=Q),_&&(Ne.count=_),E&&(Ne.elements=E.get()),this.initDepthDrawParams({depth:M},Ne),this.initBlendDrawParams({blend:P},Ne),this.initStencilDrawParams({stencil:D},Ne),this.initCullDrawParams({cull:Z},Ne),this.drawCommand=i(Ne);var it=ri()(Ne);it.blend.enable=!1,it.blend.func={dstAlpha:"one",dstRGB:"one minus src alpha",srcAlpha:"one",srcRGB:"src alpha"},this.drawPickCommand=i(it),this.drawParams=Ne}return(0,jt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=vd(vd({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var o=vd(vd({},this.uniforms),this.extractUniforms(r.uniforms||{})),u={};Object.keys(o).forEach(function(d){var g=(0,nh.Z)(o[d]);g==="boolean"||g==="number"||Array.isArray(o[d])||o[d].BYTES_PER_ELEMENT?u[d]=o[d]:u[d]=o[d].get()}),n?this.drawPickCommand(u):this.drawCommand(u)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var o=r.depth;o&&(n.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:TE[o.func||ae.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var o=r.blend;if(o){var u=o.enable,d=o.func,g=o.equation,_=o.color,E=_===void 0?[0,0,0,0]:_;n.blend={enable:!!u,func:{srcRGB:Uv[d&&d.srcRGB||ae.SRC_ALPHA],srcAlpha:Uv[d&&d.srcAlpha||ae.SRC_ALPHA],dstRGB:Uv[d&&d.dstRGB||ae.ONE_MINUS_SRC_ALPHA],dstAlpha:Uv[d&&d.dstAlpha||ae.ONE_MINUS_SRC_ALPHA]},equation:{rgb:bg[g&&g.rgb||ae.FUNC_ADD],alpha:bg[g&&g.alpha||ae.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,n){var o=r.stencil;if(o){var u=o.enable,d=o.mask,g=d===void 0?-1:d,_=o.func,E=_===void 0?{cmp:ae.ALWAYS,ref:0,mask:-1}:_,M=o.opFront,P=M===void 0?{fail:ae.KEEP,zfail:ae.KEEP,zpass:ae.KEEP}:M,D=o.opBack,Z=D===void 0?{fail:ae.KEEP,zfail:ae.KEEP,zpass:ae.KEEP}:D;n.stencil={enable:!!u,mask:g,func:vd(vd({},E),{},{cmp:ME[E.cmp]}),opFront:{fail:dd[P.fail],zfail:dd[P.zfail],zpass:dd[P.zpass]},opBack:{fail:dd[Z.fail],zfail:dd[Z.zfail],zpass:dd[Z.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var o=r.cull;if(o){var u=o.enable,d=o.face,g=d===void 0?ae.BACK:d;n.cull={enable:!!u,face:PE[g]}}}},{key:"extractUniforms",value:function(r){var n=this,o={};return Object.keys(r).forEach(function(u){n.extractUniformsRecursively(u,r[u],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,n,o,u){var d=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||kE()(n)||n===""||"resize"in n){o["".concat(u&&u+".").concat(r)]=n;return}FE()(n)&&Object.keys(n).forEach(function(g){d.extractUniformsRecursively(g,n[g],o,"".concat(u&&u+".").concat(r))}),Array.isArray(n)&&n.forEach(function(g,_){Object.keys(g).forEach(function(E){d.extractUniformsRecursively(E,g[E],o,"".concat(u&&u+".").concat(r,"[").concat(_,"]"))})})}}]),e}(),BE=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,o=r.type,u=o===void 0?ae.UNSIGNED_BYTE:o,d=r.width,g=r.height,_=r.flipY,E=_===void 0?!1:_,M=r.format,P=M===void 0?ae.RGBA:M,D=r.mipmap,Z=D===void 0?!1:D,Q=r.wrapS,ue=Q===void 0?ae.CLAMP_TO_EDGE:Q,ve=r.wrapT,Ne=ve===void 0?ae.CLAMP_TO_EDGE:ve,it=r.aniso,mt=it===void 0?0:it,bt=r.alignment,Vt=bt===void 0?1:bt,Kt=r.premultiplyAlpha,or=Kt===void 0?!1:Kt,br=r.mag,rn=br===void 0?ae.NEAREST:br,dn=r.min,Or=dn===void 0?ae.NEAREST:dn,In=r.colorSpace,Un=In===void 0?ae.BROWSER_DEFAULT_WEBGL:In;this.width=d,this.height=g;var di={width:d,height:g,type:Rm[u],format:wE[P],wrapS:xg[ue],wrapT:xg[Ne],mag:_g[rn],min:_g[Or],alignment:Vt,flipY:E,colorSpace:AE[Un],premultiplyAlpha:or,aniso:mt};n&&(di.data=n),typeof Z=="number"?di.mipmap=CE[Z]:typeof Z=="boolean"&&(di.mipmap=Z),this.texture=i.texture(di)}return(0,jt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.texture.resize(n,o),this.width=n,this.height=o}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),Sg,wg,zE=(Sg=(0,Gr.b2)(),Sg(wg=function(){function e(){var i=this;(0,pt.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new NE(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new EE(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new IE(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new OE(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new BE(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new RE(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,o=r.depth,u=r.stencil,d=r.framebuffer,g=d===void 0?null:d,_={color:n,depth:o,stencil:u};_.framebuffer=g===null?g:g.get(),i.gl.clear(_)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,o=r.y,u=r.width,d=r.height;i.gl._gl.viewport(n,o,u,d),i.width=u,i.height=d,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,o=r.x,u=r.y,d=r.width,g=r.height,_={x:o,y:u,width:d,height:g};return n&&(_.framebuffer=n.get()),i.gl.read(_)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(bo)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.gl.destroy()})}return(0,jt.Z)(e,[{key:"init",value:function(){var i=(0,bi.Z)(ti().mark(function n(o,u){var d=this;return ti().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.canvas=o,_.next=3,new Promise(function(E,M){bE()({canvas:d.canvas,attributes:{alpha:!0,antialias:u.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:u.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(D,Z){(D||!Z)&&M(D),E(Z)}})});case 3:this.gl=_.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return _.stop()}},n,this)}));function r(n,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||wg);function Cg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var UE=function(){function e(i){(0,pt.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,o=i.canvas,u=i.hasBaseMap,d=Zb();this.container=d,n.setContainer(d,r,o,u),d.bind(Ht.IRendererService).to(zE).inSingletonScope(),this.sceneService=d.get(Ht.ISceneService),this.mapService=d.get(Ht.IMapService),this.iconService=d.get(Ht.IIconService),this.fontService=d.get(Ht.IFontService),this.controlService=d.get(Ht.IControlService),this.layerService=d.get(Ht.ILayerService),this.markerService=d.get(Ht.IMarkerService),this.interactionService=d.get(Ht.IInteractionService),this.popupService=d.get(Ht.IPopupService),bo?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,jt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var u=new r(n);u.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=jb(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(o){var u=(0,ie.Z)(o,2),d=u[0],g=u[1];n.fontService.addIconFont(d,g)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){bo?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Om.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Om.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Om.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var o=this.sceneService.getSceneConfig(),u=o.fitBoundsOptions,d=o.animate;this.mapService.fitBounds(r,n||Ag(Ag({},u),{},{animate:d}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Ht.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ws(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,o=r.logoPosition;n&&this.addControl(new uE({position:o}))}}]),e}(),ZE=R(13218),Du=R.n(ZE),Tg,Mg,Pg,Lm,Ig;function jE(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}var VE=(Tg=(0,Gr.b2)(),Mg=(0,Gr.f3)(Ht.IGlobalConfigService),Tg(Pg=(Lm=function(){function e(){(0,pt.Z)(this,e),$t(this,"configService",Ig,this),(0,I.Z)(this,"enabled",void 0)}return(0,jt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.rendererService,d=n.postProcessingPassFactory,g=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var _=r.getLayerConfig(),E=_.enableMultiPassRenderer,M=_.passes,P=M===void 0?[]:M;o.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,P,d,g),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,n,o,u){var d=r.multiPassRenderer,g=r.getLayerConfig(),_=g.enablePicking,E=g.enableTAA;return _&&d.add(u("pixelPicking")),d}}]),e}(),Ig=hr(Lm.prototype,"configService",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm))||Pg),Wh,Og=(Wh={},(0,I.Z)(Wh,vc.additive,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Wh,vc.none,{enable:!1}),(0,I.Z)(Wh,vc.normal,{enable:!0,func:{srcRGB:ae.SRC_ALPHA,dstRGB:ae.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Wh,vc.subtractive,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE,srcAlpha:ae.ZERO,dstAlpha:ae.ONE_MINUS_SRC_COLOR},equation:{rgb:ae.FUNC_SUBTRACT,alpha:ae.FUNC_SUBTRACT}}),(0,I.Z)(Wh,vc.max,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE},equation:{rgb:ae.MAX_EXT}}),(0,I.Z)(Wh,vc.min,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE},equation:{rgb:ae.MIN_EXT}}),Wh),GE=R(81763),Za=R.n(GE),HE=R(1469),Pp=R.n(HE),h3=1024;function il(e,i,r,n,o){i.updateStyleAttribute(e,r,n,o)}function WE(e,i){e.opacity&&Zv("opacity",i,e.opacity),e.strokeWidth&&Zv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Zv("strokeOpacity",i,e.strokeOpacity),e.stroke&&XE("stroke",i,e.stroke),e.offsets&&Rg("offsets",i,e.offsets),e.textOffset&&Rg("textOffset",i,e.textOffset),e.thetaOffset&&Zv("thetaOffset",i,e.thetaOffset)}function Zv(e,i,r){Cn()(r)?il(e,i,r,function(n){return n}):Za()(r)?il(e,i,[r],void 0):Pp()(r)&&r.length===2?Cn()(r[0])&&$r()(r[1])||Cn()(r[0])&&Pp()(r[1])&&Za()(r[1][0])&&Za()(r[1][1])?il(e,i,r[0],r[1]):il(e,i,[1],void 0):il(e,i,[1],void 0)}function Rg(e,i,r){Cn()(r)?il(e,i,r,function(n){return n}):Pp()(r)&&r.length===2&&Cn()(r[0])&&$r()(r[1])?il(e,i,r[0],r[1]):Pp()(r)&&r.length===2&&Za()(r[0])&&Za()(r[1])?il(e,i,r,void 0):il(e,i,[0,0],void 0)}function XE(e,i,r){Cn()(r)?il(e,i,r,void 0):Pp()(r)&&r.length===2&&(Cn()(r[0])&&$r()(r[1])||Cn()(r[0])&&Pp()(r[1])&&r[1].length>0)?il(e,i,r[0],r[1]):il(e,i,"#fff",void 0)}var YE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function qE(e,i,r){typeof i=="string"&&typeof r=="string"&&i!==r&&YE.map(function(n){n.includes(i)&&n.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var KE=["passes"],$E=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Lg,kg,jv,Dg,Fg;function JE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=QE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function QE(e,i){if(!!e){if(typeof e=="string")return Ng(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ng(e,i)}}function Ng(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Bg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Fu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function e2(e){var i=t2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function t2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zg=0,Ip=(Lg=qd(Ht.IGlobalConfigService),kg=qd(Ht.IShaderModuleService),jv=function(e){(0,En.Z)(r,e);var i=e2(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,pt.Z)(this,r),n=i.call(this),(0,I.Z)((0,be.Z)(n),"id","".concat(zg++)),(0,I.Z)((0,be.Z)(n),"name","".concat(zg)),(0,I.Z)((0,be.Z)(n),"type",void 0),(0,I.Z)((0,be.Z)(n),"visible",!0),(0,I.Z)((0,be.Z)(n),"zIndex",0),(0,I.Z)((0,be.Z)(n),"minZoom",void 0),(0,I.Z)((0,be.Z)(n),"maxZoom",void 0),(0,I.Z)((0,be.Z)(n),"inited",!1),(0,I.Z)((0,be.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,be.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,be.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,be.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,be.Z)(n),"rendering",void 0),(0,I.Z)((0,be.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,be.Z)(n),"hooks",{init:new Rl,afterInit:new Rl,beforeRender:new Rl,beforeRenderData:new ml,afterRender:new is,beforePickingEncode:new is,afterPickingEncode:new is,beforeHighlight:new is(["pickedColor"]),afterHighlight:new is,beforeSelect:new is(["pickedColor"]),afterSelect:new is,beforeDestroy:new is,afterDestroy:new is}),(0,I.Z)((0,be.Z)(n),"models",[]),(0,I.Z)((0,be.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,be.Z)(n),"plugins",void 0),(0,I.Z)((0,be.Z)(n),"sourceOption",void 0),(0,I.Z)((0,be.Z)(n),"layerModel",void 0),(0,I.Z)((0,be.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,be.Z)(n),"layerChildren",[]),$t((0,be.Z)(n),"configService",Dg,(0,be.Z)(n)),$t((0,be.Z)(n),"shaderModuleService",Fg,(0,be.Z)(n)),(0,I.Z)((0,be.Z)(n),"cameraService",void 0),(0,I.Z)((0,be.Z)(n),"coordinateService",void 0),(0,I.Z)((0,be.Z)(n),"iconService",void 0),(0,I.Z)((0,be.Z)(n),"fontService",void 0),(0,I.Z)((0,be.Z)(n),"pickingService",void 0),(0,I.Z)((0,be.Z)(n),"rendererService",void 0),(0,I.Z)((0,be.Z)(n),"layerService",void 0),(0,I.Z)((0,be.Z)(n),"interactionService",void 0),(0,I.Z)((0,be.Z)(n),"mapService",void 0),(0,I.Z)((0,be.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,be.Z)(n),"layerSource",void 0),(0,I.Z)((0,be.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,be.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,be.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,be.Z)(n),"container",void 0),(0,I.Z)((0,be.Z)(n),"encodedData",void 0),(0,I.Z)((0,be.Z)(n),"configSchema",void 0),(0,I.Z)((0,be.Z)(n),"currentPickId",null),(0,I.Z)((0,be.Z)(n),"rawConfig",void 0),(0,I.Z)((0,be.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,be.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,be.Z)(n),"scaleOptions",{}),(0,I.Z)((0,be.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,be.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,be.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var u=n.getLayerConfig(),d=u.autoFit,g=u.fitBoundsOptions;d&&n.fitBounds(g),n.emit("dataUpdate"),n.reRender()}),n.name=o.name||n.id,n.zIndex=o.zIndex||0,n.rawConfig=o,n}return(0,jt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Fu(Fu({},this.needUpdateConfig),o);else{var u=this.container.get(Ht.SceneID);WE(o,this),this.configService.setLayerConfig(u,this.id,Fu(Fu(Fu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,u){this.container=o,this.sceneContainer=u}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,u=this.container.get(Ht.SceneID),d=this.rawConfig.enableMultiPassRenderer,g=d===void 0?!1:d;this.configService.setLayerConfig(u,this.id,{enableMultiPassRenderer:g}),this.iconService=this.container.get(Ht.IIconService),this.fontService=this.container.get(Ht.IFontService),this.rendererService=this.container.get(Ht.IRendererService),this.layerService=this.container.get(Ht.ILayerService),this.interactionService=this.container.get(Ht.IInteractionService),this.pickingService=this.container.get(Ht.IPickingService),this.mapService=this.container.get(Ht.IMapService),this.cameraService=this.container.get(Ht.ICameraService),this.coordinateService=this.container.get(Ht.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(Ht.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ht.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ht.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ht.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(P){var D=P.attributeName,Z=P.attributeField,Q=P.attributeValues,ue=P.updateOptions;o.styleAttributeService.updateStyleAttribute(D,{scale:Fu({field:Z},o.splitValuesAndCallbackInAttribute(Q,o.getLayerConfig()[D]))},ue)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ht.ILayerPlugin);var _=JE(this.plugins),E;try{for(_.s();!(E=_.n()).done;){var M=E.value;M.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(P){_.e(P)}finally{_.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Fu(Fu({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),u=o.animateOption;u!=null&&u.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,u,d){return this.updateStyleAttribute("color",o,u,d),this}},{key:"texture",value:function(o,u,d){return this.updateStyleAttribute("texture",o,u,d),this}},{key:"rotate",value:function(o,u,d){return this.updateStyleAttribute("rotate",o,u,d),this}},{key:"size",value:function(o,u,d){return this.updateStyleAttribute("size",o,u,d),this}},{key:"filter",value:function(o,u,d){return this.updateStyleAttribute("filter",o,u,d),this}},{key:"shape",value:function(o,u,d){var g,_,E,M=(g=this.styleAttributeService)===null||g===void 0||(_=g.getLayerStyleAttribute("shape"))===null||_===void 0||(E=_.scale)===null||E===void 0?void 0:E.field,P=o;return this.updateStyleAttribute("shape",o,u,d),qE(this,M,P),this}},{key:"label",value:function(o,u,d){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:u,updateOptions:d}),this}},{key:"animate",value:function(o){var u={};return Du()(o)?(u.enable=!0,u=Fu(Fu({},u),o)):u.enable=o,this.updateLayerConfig({animateOption:u}),this}},{key:"source",value:function(o,u){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:u},this)}},{key:"setData",value:function(o,u){var d=this;return this.inited?this.layerSource.setData(o,u):this.on("inited",function(){d.layerSource.setData(o,u)}),this}},{key:"style",value:function(o){var u=this,d=o.passes,g=(0,Ul.Z)(o,KE);return d&&jE(d).forEach(function(_){var E=u.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(_[0]);E&&E.updateOptions(_[1])}),this.rawConfig=Fu(Fu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,u){return Du()(o)?this.scaleOptions=Fu(Fu({},this.scaleOptions),o):this.scaleOptions[o]=u,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var u={};return u.enableHighlight=Du()(o)?!0:o,Du()(o)?(u.enableHighlight=!0,o.color&&(u.highlightColor=o.color),o.mix&&(u.activeMix=o.mix)):u.enableHighlight=!!o,this.updateLayerConfig(u),this}},{key:"setActive",value:function(o,u){var d=this;if(Du()(o)){var g=o.x,_=g===void 0?0:g,E=o.y,M=E===void 0?0:E;this.updateLayerConfig({highlightColor:Du()(u)?u.color:this.getLayerConfig().highlightColor,activeMix:Du()(u)?u.mix:this.getLayerConfig().activeMix}),this.pick({x:_,y:M})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Du()(u)?u.color:this.getLayerConfig().highlightColor,activeMix:Du()(u)?u.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(fe(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"select",value:function(o){var u={};return u.enableSelect=Du()(o)?!0:o,Du()(o)?(u.enableSelect=!0,o.color&&(u.selectColor=o.color),o.mix&&(u.selectMix=o.mix)):u.enableSelect=!!o,this.updateLayerConfig(u),this}},{key:"setSelect",value:function(o,u){var d=this;if(Du()(o)){var g=o.x,_=g===void 0?0:g,E=o.y,M=E===void 0?0:E;this.updateLayerConfig({selectColor:Du()(u)?u.color:this.getLayerConfig().selectColor,selectMix:Du()(u)?u.mix:this.getLayerConfig().selectMix}),this.pick({x:_,y:M})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Du()(u)?u.color:this.getLayerConfig().selectColor,selectMix:Du()(u)?u.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(fe(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),u=this.getLayerConfig(),d=u.visible,g=u.minZoom,_=g===void 0?-Infinity:g,E=u.maxZoom,M=E===void 0?Infinity:E;return!!d&&o>=_&&o<=M}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),u=o.minZoom;return u}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),u=o.maxZoom;return u}},{key:"get",value:function(o){var u=this.getLayerConfig();return u[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var u=this.getSource(),d=u.extent,g=d.some(function(_){return Math.abs(_)===Infinity});return g?this:(this.mapService.fitBounds([[d[0],d[1]],[d[2],d[3]]],o),this)}},{key:"destroy",value:function(){var o;this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(),this.encodedData=null,this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var u=this.styleAttributeService.getLayerAttributeScale(o);if(u){if(u.ticks){var d=u.ticks().map(function(_){return(0,I.Z)({value:_},o,u(_))});return d}else if(u.invertExtent){var g=u.range().map(function(_){return(0,I.Z)({value:u.invertExtent(_)},o,_)});return g}}else return[]}},{key:"pick",value:function(o){var u=o.x,d=o.y;this.interactionService.triggerHover({x:u,y:d})}},{key:"boxSelect",value:function(o,u){this.pickingService.boxPickLayer(this,o,u)}},{key:"buildLayerModel",value:function(o){var u=o.moduleName,d=o.vertexShader,g=o.fragmentShader,_=o.triangulation,E=o.segmentNumber,M=(0,Ul.Z)(o,$E);this.shaderModuleService.registerModule(u,{vs:d,fs:g});var P=this.shaderModuleService.getModule(u),D=P.vs,Z=P.fs,Q=P.uniforms,ue=this.rendererService.createModel,ve=this.styleAttributeService.createAttributesAndIndices(this.encodedData,_,E),Ne=ve.attributes,it=ve.elements;return ue(Fu({attributes:Ne,uniforms:Q,fs:Z,vs:D,elements:it,blend:Og[vc.normal]},M))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var u=this.getLayerConfig(),d=u.enableHighlight,g=d===void 0?!0:d,_=u.enableSelect,E=_===void 0?!0:_,M=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&E&&(M=!0),o==="mousemove"&&(g||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(M=!0),this.isVisible()&&M}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(o){var u=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:u.layerModel.getUninforms()},o)})),this}},{key:"updateStyleAttribute",value:function(o,u,d,g){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Fu({field:u},this.splitValuesAndCallbackInAttribute(d,this.getLayerConfig()[u]))},g):this.pendingStyleAttributes.push({attributeName:o,attributeField:u,attributeValues:d,updateOptions:g})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,u){return{values:$r()(o)?void 0:o||u,callback:$r()(o)?o:void 0}}}]),r}(Ro.EventEmitter),Dg=hr(jv.prototype,"configService",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fg=hr(jv.prototype,"shaderModuleService",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jv),r2=R(18446),md=R.n(r2),Ug,Zg,Vv,jg,Vg;function n2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function i2(e,i){if(!!e){if(typeof e=="string")return Gg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gg(e,i)}}function Gg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Is=(Ug=qd(Ht.IGlobalConfigService),Zg=qd(Ht.IShaderModuleService),Vv=function(){function e(i){(0,pt.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),$t(this,"configService",jg,this),$t(this,"shaderModuleService",Vg,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Ht.IRendererService),this.styleAttributeService=i.getContainer().get(Ht.IStyleAttributeService),this.mapService=i.getContainer().get(Ht.IMapService),this.iconService=i.getContainer().get(Ht.IIconService),this.fontService=i.getContainer().get(Ht.IFontService),this.cameraService=i.getContainer().get(Ht.ICameraService),this.layerService=i.getContainer().get(Ht.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:ae.NEAREST,min:ae.NEAREST,width:1,height:1}))}return(0,jt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return md()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),md()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),md()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),md()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),md()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),md()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Za()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Za()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Za()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Za()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Cn()(r)?!!(0,L.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=U(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Pp()(r)&&r.length===2&&Za()(r[0])&&Za()(r[1]))}},{key:"patchMod",value:function(r,n){for(var o=0;o<n;o++)r.push(-1)}},{key:"patchData",value:function(r,n,o){var u=n2(o),d;try{for(u.s();!(d=u.n()).done;){var g=d.value,_=g.attr,E=g.count,M=n[_];M!==void 0?_==="stroke"?r.push.apply(r,(0,sr.Z)(U(M))):_==="offsets"?this.isOffsetStatic(M)?r.push(-M[0],M[1]):r.push(0,0):r.push(Za()(M)?M:1):this.patchMod(r,E)}}catch(P){u.e(P)}finally{u.f()}}},{key:"calDataFrame",value:function(r,n,o){for(var u=n.length,d=Math.ceil(u*r/this.DATA_TEXTURE_WIDTH),g=d*this.DATA_TEXTURE_WIDTH,_=[],E=0;E<u;E++){var M=n[E];this.patchData(_,M,o)}for(var P=_.length;P<g;P++)_.push(-1);return{data:_,width:this.DATA_TEXTURE_WIDTH,height:d}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,o=n===void 0?"normal":n;return Og[vc[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),jg=hr(Vv.prototype,"configService",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vg=hr(Vv.prototype,"shaderModuleService",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv),a2=R(9187),Af=R.n(a2),Hg=100,p3=36,d3=40;function Wg(e){return e/180*Math.acos(-1)}function Xg(e){var i=Wg(e[0])+Math.PI/2,r=Wg(e[1]),n=Hg+Math.random()*.4,o=n*Math.cos(r)*Math.cos(i),u=n*Math.cos(r)*Math.sin(i),d=n*Math.sin(r);return[u,d,o]}function v3(e,i){var r=mat4.create(),n=mat4.create(),o=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var d=typeof i.segments!="undefined"?i.segments:32,g=2+d,_=2*g,E=[],M=[],P=[],D=[],Z=[],Q=[],ue=0;ue<=g;ue++){for(var ve=ue/g,Ne=ve*Math.PI,it=0;it<=_;it++){var mt=it/_,bt=mt*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Ne),mat4.identity(r),mat4.rotateY(r,r,bt),vec3.transformMat4(u,o,n),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),P.push(u.slice()),D.push.apply(D,_toConsumableArray(u.slice())),vec3.normalize(u,u),Z.push.apply(Z,_toConsumableArray(u.slice())),Q.push([mt,1-ve]),D.push(mt,1-ve)}if(ue>0)for(var Vt=P.length,Kt=Vt-2*(_+1);Kt+_+2<Vt;Kt++)E.push([Kt,Kt+1,Kt+_+1]),M.push(Kt,Kt+1,Kt+_+1),E.push([Kt+_+1,Kt+1,Kt+_+2]),M.push(Kt+_+1,Kt+1,Kt+_+2)}return{cells:E,positions:P,uvs:Q,positionsArr:D,indicesArr:M,normalArr:Z}}var Bi=R(31437),Gv=Bi.Ue(),m3=Bi.Ue(),Nu=Bi.Ue(),gd=Bi.Ue(),Hv=Bi.Ue();function Yg(e,i,r,n,o){Bi.IH(e,r,n),Bi.Fv(e,e),i=Bi.al(-e[1],e[0]);var u=Bi.al(-r[1],r[0]);return[o/Bi.AK(i,u),i]}function yd(e,i){return Bi.t8(e,-i[1],i[0])}function Wv(e,i,r){return Bi.lu(e,i,r),Bi.Fv(e,e),e}function qg(e,i){return e[0]===i[0]&&e[1]===i[1]}function g3(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var o2=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,pt.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",Bi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,jt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var u=r.length,d=o.startIndex,g=1;g<u;g++){var _=r[g-1],E=n[g-1],M=r[g],P=n[g],D=g<r.length-1?r[g+1]:null,Z=g<n.length-1?n[g+1]:null,Q=this.segment_gaode2(o,d,_,M,D,E,P,Z);d+=Q}if(this.dash)for(var ue=0;ue<o.positions.length/6;ue++)o.positions[ue*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=n.startIndex,d=1;d<o;d++){var g=r[d-1],_=r[d],E=d<r.length-1?r[d+1]:null,M=this.segment(n,u,g,_,E);u+=M}if(this.dash)for(var P=0;P<n.positions.length/6;P++)n.positions[P*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,o,u,d,g,_,E){var M=0,P=r.indices,D=r.positions,Z=r.normals,Q=this.cap==="square",ue=this.join==="bevel",ve=gu([_[0],_[1]]),Ne=gu([g[0],g[1]]);Wv(Nu,u,o);var it=0;if(this.dash&&(it=this.lineSegmentDistance(ve,Ne),this.totalDistance+=it),this.normal||(this.normal=Bi.Ue(),yd(this.normal,Nu)),!this.started)if(this.started=!0,Q){var mt=Bi.Ue(),bt=Bi.Ue();Bi.IH(mt,this.normal,Nu),Bi.IH(bt,this.normal,Nu),Z.push(bt[0],bt[1],0),Z.push(mt[0],mt[1],0),D.push(o[0],o[1],o[2]|0,this.totalDistance-it,-this.thickness,o[2]|0),D.push(o[0],o[1],o[2]|0,this.totalDistance-it,this.thickness,o[2]|0)}else this.extrusions(D,Z,o,this.normal,this.thickness,this.totalDistance-it);if(P.push(n+0,n+1,n+2),d){qg(u,d)&&Bi.IH(d,u,Bi.Fv(d,Bi.$X(d,u,o))),Wv(gd,d,u);var or=Yg(Hv,Bi.Ue(),Nu,gd,this.thickness),br=(0,ie.Z)(or,2),rn=br[0],dn=br[1],Or=Bi.AK(Hv,this.normal)<0?-1:1,In=ue;if(!In&&this.join==="miter"){var Un=rn;Un>this.miterLimit&&(In=!0)}In?(Z.push(this.normal[0],this.normal[1],0),Z.push(dn[0],dn[1],0),D.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Or,u[2]|0),D.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*Or,u[2]|0),P.push.apply(P,(0,sr.Z)(this.lastFlip!==-Or?[n,n+2,n+3]:[n+2,n+1,n+3])),P.push(n+2,n+3,n+4),yd(Gv,gd),Bi.JG(this.normal,Gv),Z.push(this.normal[0],this.normal[1],0),D.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*Or,u[2]|0),M+=3):(this.extrusions(D,Z,u,dn,rn,this.totalDistance),P.push.apply(P,(0,sr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Or=-1,Bi.JG(this.normal,dn),M+=2),this.lastFlip=Or}else{if(yd(this.normal,Nu),Q){var Vt=Bi.Ue(),Kt=Bi.Ue();Bi.lu(Kt,Nu,this.normal),Bi.IH(Vt,Nu,this.normal),Z.push(Kt[0],Kt[1],0),Z.push(Vt[0],Vt[1],0),D.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),D.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(D,Z,u,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,sr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),M+=2}return M}},{key:"segment",value:function(r,n,o,u,d){var g=0,_=r.indices,E=r.positions,M=r.normals,P=this.cap==="square",D=this.join==="bevel",Z=gu([u[0],u[1]]),Q=gu([o[0],o[1]]);Wv(Nu,Z,Q);var ue=0;if(this.dash&&(ue=this.lineSegmentDistance(Z,Q),this.totalDistance+=ue),this.normal||(this.normal=Bi.Ue(),yd(this.normal,Nu)),!this.started)if(this.started=!0,P){var ve=Bi.Ue(),Ne=Bi.Ue();Bi.IH(ve,this.normal,Nu),Bi.IH(Ne,this.normal,Nu),M.push(Ne[0],Ne[1],0),M.push(ve[0],ve[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance-ue,-this.thickness,o[2]|0),E.push(o[0],o[1],o[2]|0,this.totalDistance-ue,this.thickness,o[2]|0)}else this.extrusions(E,M,o,this.normal,this.thickness,this.totalDistance-ue);if(_.push(n+0,n+1,n+2),d){var bt=gu([d[0],d[1]]);qg(Z,bt)&&Bi.IH(bt,Z,Bi.Fv(bt,Bi.$X(bt,Z,Q))),Wv(gd,bt,Z);var Vt=Yg(Hv,Bi.Ue(),Nu,gd,this.thickness),Kt=(0,ie.Z)(Vt,2),or=Kt[0],br=Kt[1],rn=Bi.AK(Hv,this.normal)<0?-1:1,dn=D;if(!dn&&this.join==="miter"){var Or=or;Or>this.miterLimit&&(dn=!0)}dn?(M.push(this.normal[0],this.normal[1],0),M.push(br[0],br[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*rn,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*rn,u[2]|0),_.push.apply(_,(0,sr.Z)(this.lastFlip!==-rn?[n,n+2,n+3]:[n+2,n+1,n+3])),_.push(n+2,n+3,n+4),yd(Gv,gd),Bi.JG(this.normal,Gv),M.push(this.normal[0],this.normal[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*rn,u[2]|0),g+=3):(this.extrusions(E,M,u,br,or,this.totalDistance),_.push.apply(_,(0,sr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),rn=-1,Bi.JG(this.normal,br),g+=2),this.lastFlip=rn}else{if(yd(this.normal,Nu),P){var it=Bi.Ue(),mt=Bi.Ue();Bi.lu(mt,Nu,this.normal),Bi.IH(it,Nu,this.normal),M.push(mt[0],mt[1],0),M.push(it[0],it[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(E,M,u,this.normal,this.thickness,this.totalDistance);_.push.apply(_,(0,sr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),g+=2}return g}},{key:"extrusions",value:function(r,n,o,u,d,g){n.push(u[0],u[1],0),n.push(u[0],u[1],0),r.push(o[0],o[1],o[2]|0,g,-d,o[2]|0),r.push(o[0],o[1],o[2]|0,g,d,o[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var o=n[0]-r[0],u=n[1]-r[1];return Math.sqrt(o*o+u*u)}}]),e}();function Op(e){if(Za()(e[0]))return e;if(Za()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Za()(e[0][0][0])){var i=e,r=0,n=0,o=0;return i.forEach(function(u){u.forEach(function(d){r+=d[0],n+=d[1],o++})}),[r/o,n/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function s2(e){for(var i=e[0],r=e[1],n=e[0],o=e[1],u=0,d=0,g=0,_=0;_<e.length;_+=2){var E=e[_],M=e[_+1];E&&M&&(i=Math.max(E,i),r=Math.max(M,r),n=Math.min(E,n),o=Math.min(M,o),u+=E,d+=M,g++)}return{center:[u/g,d/g],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-o,2))/2}}var Xa=R(77160);function u2(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,o=Af().flatten(e),u=o.vertices,d=o.dimensions,g=[],_=[],E=0;E<u.length/d;E++)d===2?g.push(u[E*2],u[E*2+1],1):g.push(u[E*3],u[E*3+1],1);var M=Af()(o.vertices,o.holes,o.dimensions);_.push.apply(_,(0,sr.Z)(M));for(var P=function(Q){var ue=o.vertices.slice(Q*d,(Q+1)*d),ve=o.vertices.slice((Q+1)*d,(Q+2)*d);ve.length===0&&(ve=o.vertices.slice(0,d));var Ne=g.length/3;g.push(ue[0],ue[1],1,ve[0],ve[1],1,ue[0],ue[1],0,ve[0],ve[1],0),_.push.apply(_,(0,sr.Z)([0,2,1,2,3,1].map(function(it){return it+Ne})))},D=0;D<n;D++)P(D);return{positions:g,index:_}}function l2(e){var i=Af().flatten(e),r=Af()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Kg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,u=Af().flatten(e),d=u.vertices,g=u.dimensions,_=[],E=[],M=[],P=0;P<d.length/g;P++)g===2?_.push(d[P*2],d[P*2+1],1,-1,-1):_.push(d[P*3],d[P*3+1],1,-1,-1),M.push(0,0,1);var D=Af()(u.vertices,u.holes,u.dimensions);E.push.apply(E,(0,sr.Z)(D));for(var Z=function(ve){var Ne=u.vertices.slice(ve*g,(ve+1)*g),it=u.vertices.slice((ve+1)*g,(ve+2)*g);it.length===0&&(it=u.vertices.slice(0,g));var mt=_.length/5;_.push(Ne[0],Ne[1],1,0,0,it[0],it[1],1,.1,0,Ne[0],Ne[1],0,0,.8,it[0],it[1],0,.1,.8);var bt=c2([it[0],it[1],1],[Ne[0],Ne[1],0],[Ne[0],Ne[1],1],i);M.push.apply(M,(0,sr.Z)(bt).concat((0,sr.Z)(bt),(0,sr.Z)(bt),(0,sr.Z)(bt))),E.push.apply(E,(0,sr.Z)([1,2,0,3,2,1].map(function(Vt){return Vt+mt})))},Q=0;Q<o;Q++)Z(Q);return{positions:_,index:E,normals:M}}function c2(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Xa.create(),u=Xa.create(),d=Xa.create();n&&(e=Pu(e),i=Pu(i),r=Pu(r));var g=Xa.fromValues.apply(Xa,(0,sr.Z)(e)),_=Xa.fromValues.apply(Xa,(0,sr.Z)(i)),E=Xa.fromValues.apply(Xa,(0,sr.Z)(r));Xa.sub(o,E,_),Xa.sub(u,g,_),Xa.cross(d,o,u);var M=Xa.create();return Xa.normalize(M,d),M}var gc,Rp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Rp||(Rp={}));var Lp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Lp||(Lp={}));function Qd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],o=0;o<e;o++)n.push(r*o+i*Math.PI/12);var u=n.map(function(d){var g=Math.sin(d+Math.PI/4),_=Math.cos(d+Math.PI/4);return[g,_,0]});return u}function $g(){return Qd(30)}function Jg(){return Qd(4)}function Qg(){return Qd(3)}function ey(){return Qd(6,1)}function ty(){return Qd(5)}var _d=(gc={},(0,I.Z)(gc,Lp.CIRCLE,$g),(0,I.Z)(gc,Lp.HEXAGON,ey),(0,I.Z)(gc,Lp.TRIANGLE,Qg),(0,I.Z)(gc,Lp.SQUARE,Jg),(0,I.Z)(gc,Lp.PENTAGON,ty),(0,I.Z)(gc,Rp.CYLINDER,$g),(0,I.Z)(gc,Rp.HEXAGONCOLUMN,ey),(0,I.Z)(gc,Rp.TRIANGLECOLUMN,Qg),(0,I.Z)(gc,Rp.SQUARECOLUMN,Jg),(0,I.Z)(gc,Rp.PENTAGONCOLUMN,ty),gc),Xv={};function ry(e){var i=Op(e.coordinates);return{vertices:[].concat((0,sr.Z)(i),(0,sr.Z)(i),(0,sr.Z)(i),(0,sr.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function f2(e){var i=Op(e.coordinates),r=Xg(i);return{vertices:[].concat((0,sr.Z)(r),(0,sr.Z)(r),(0,sr.Z)(r),(0,sr.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function ny(e){var i=e.shape,r=g2(i,!1),n=r.positions,o=r.index,u=r.normals;return{vertices:n,indices:o,normals:u,size:5}}function iy(e){var i=Op(e.coordinates);return{vertices:(0,sr.Z)(i),indices:[0],size:i.length}}function h2(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,o=new o2({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var u=i;Array.isArray(u[0][0])||(u=[i]);var d=r;Array.isArray(d[0][0])||(d=[r]);for(var g=0;g<u.length;g++){var _=u[g],E=d[g];o.extrude_gaode2(_,E)}}else{var M=i;Array.isArray(M[0][0])||(M=[i]),M.forEach(function(D){o.extrude(D)})}var P=o.complex;return{vertices:P.positions,indices:P.indices,normals:P.normals,size:6}}function p2(e){var i=e.coordinates,r=Af().flatten(i),n=r.vertices,o=r.dimensions,u=r.holes;return{indices:Af()(n,u,o),vertices:n,size:o}}function d2(e){var i=e.coordinates,r=Af().flatten(i),n=r.vertices,o=r.dimensions,u=r.holes;return{indices:Af()(n,u,o),vertices:v2(n),size:o+4}}function v2(e){for(var i=[],r=s2(e),n=r.center,o=r.radius,u=0;u<e.length;u+=2){var d=e[u],g=e[u+1];i.push.apply(i,[d,g,0].concat((0,sr.Z)(n),[o]))}return i}function ay(e){var i=e.coordinates,r=Kg(i,!0),n=r.positions,o=r.index,u=r.normals;return{vertices:n,indices:o,normals:u,size:5}}function oy(e){var i=e.shape,r=_2(i),n=r.positions,o=r.index;return{vertices:n,indices:o,size:3}}function sy(e){var i=e.coordinates,r=[].concat((0,sr.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,sr.Z)(i[1]),[0,1,0],(0,sr.Z)(i[0]),[0,0,1],(0,sr.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Yv(e,i){for(var r=i||30,n=e.coordinates,o=[],u=[],d=function(E){o.push(E,1,E,n[0][0],n[0][1],n[1][0],n[1][1],E,-1,E,n[0][0],n[0][1],n[1][0],n[1][1]),E!==r-1&&u.push.apply(u,(0,sr.Z)([0,1,2,1,3,2].map(function(M){return E*2+M})))},g=0;g<r;g++)d(g);return{vertices:o,indices:u,size:7}}function m2(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=qv(-1,1),o=qv(1,1),u=qv(-1,-1),d=qv(1,-1),g=[].concat((0,sr.Z)(i),(0,sr.Z)(n),(0,sr.Z)(i),(0,sr.Z)(u),(0,sr.Z)(i),(0,sr.Z)(d),(0,sr.Z)(i),(0,sr.Z)(o)),_=[0,1,2,3,0,2];return{vertices:g,indices:_,size:5}}function g2(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Xv&&Xv[e])return Xv[e];var r=_d[e]?_d[e]():_d.cylinder(),n=Kg([r],i);return Xv[e]=n,n}function y3(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),u,d,g,_=vec3.create(),E=vec3.create(),M=vec3.create(),P=0,D=i.length;P<D;P+=3){u=i[P+0]*3,d=i[P+1]*3,g=i[P+2]*3;var Z=[e[u],e[u+1]],Q=[e[d],e[d+1]],ue=[e[g],e[g+1]];n&&(Z=lngLatToMeters(Z),Q=lngLatToMeters(Q),ue=lngLatToMeters(ue));var ve=Z,Ne=_slicedToArray(ve,2),it=Ne[0],mt=Ne[1],bt=vec3.fromValues(it,mt,e[u+2]),Vt=Q,Kt=_slicedToArray(Vt,2),or=Kt[0],br=Kt[1],rn=vec3.fromValues(or,br,e[d+2]),dn=ue,Or=_slicedToArray(dn,2),In=Or[0],Un=Or[1],di=vec3.fromValues(In,Un,e[g+2]);vec3.sub(_,di,rn),vec3.sub(E,bt,rn),vec3.cross(M,_,E),o[u]+=_[0],o[u+1]+=_[1],o[u+2]+=_[2],o[d]+=_[0],o[d+1]+=_[1],o[d+2]+=_[2],o[g]+=_[0],o[g+1]+=_[1],o[g+2]+=_[2]}return y2(o),o}function y2(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),o=vec3.create();vec3.normalize(o,n),e.set(o,i)}}function _3(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function _2(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=_d[e]?_d[e]():_d.circle(),n=i.indexOf(e)===-1?l2([r]):u2([r]);return n}function qv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function x3(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function b3(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function x2(e){var i=b2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E2=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,S2=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,w2=function(e){(0,En.Z)(r,e);var i=x2(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"cityCenter",void 0),(0,I.Z)((0,be.Z)(n),"cityMinSize",void 0),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.baseColor,_=g===void 0?"rgb(16,16,16)":g,E=o.brightColor,M=E===void 0?"rgb(255,176,38)":E,P=o.windowColor,D=P===void 0?"rgb(30,60,89)":P,Z=o.time,Q=Z===void 0?0:Z,ue=o.sweep,ve=ue===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4}:ue;return{u_cityCenter:this.cityCenter,u_cityMinSize:this.cityMinSize*ve.sweepRadius,u_circleSweep:ve.enable?1:0,u_circleSweepColor:U(ve.sweepColor).slice(0,3),u_circleSweepSpeed:ve.sweepSpeed,u_opacity:d,u_baseColor:U(_),u_brightColor:U(M),u_windowColor:U(D),u_time:this.layer.getLayerAnimateTime()||Q}}},{key:"calCityGeo",value:function(){var o=(0,ie.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],g=o[2],_=o[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(g+u)/2,(_+d)/2]);var E=this.mapService.lngLatToCoord([g,_]),M=this.mapService.lngLatToCoord([u,d]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-M[0],2)+Math.pow(E[1]-M[1],2))/4}else{var P=g-u,D=_-d;this.cityCenter=[(g+u)/2,(_+d)/2],this.cityMinSize=Math.sqrt(Math.pow(P,2)+Math.pow(D,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:S2,fragmentShader:E2,triangulation:ay})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(u,d,g,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?10:E;return Array.isArray(M)?[M[0]]:[M]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(u,d,g,_){var E=u.size;return[g[3],g[4]]}}})}}]),r}(Is);function C2(e){var i=A2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function A2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T2=function(e){(0,En.Z)(r,e);var i=C2(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","PolygonLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new w2(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Ip);function M2(e){var i=P2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function P2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I2=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,O2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,R2=function(e){(0,En.Z)(r,e);var i=M2(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,g=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:g||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:I2,fragmentShader:O2,triangulation:oy,depth:{enable:!1},primitive:ae.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(u,d){var g=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[g[0],g[1],0]}}})}}]),r}(Is);function L2(e){var i=k2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function k2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,F2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,N2=function(e){(0,En.Z)(r,e);var i=L2(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,g=o.angle;return{u_opacity:u||1,u_coverage:d||1,u_angle:g||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:D2,fragmentShader:F2,triangulation:ny,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(u,d,g,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(u,d){var g=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[g[0],g[1],0]}}})}}]),r}(Is);function B2(e,i){for(var r=[],n=[],o=[],u=e+1,d=i+1,g=e/2,_=i/2,E=0;E<d;E++)for(var M=E-_,P=0;P<u;P++){var D=P-g;n.push(D/g,-M/_,0),o.push(P/e),o.push(1-E/i)}for(var Z=0;Z<i;Z++)for(var Q=0;Q<e;Q++){var ue=Q+u*Z,ve=Q+u*(Z+1),Ne=Q+1+u*(Z+1),it=Q+1+u*Z;r.push(ue,ve,it),r.push(ve,Ne,it)}return{vertices:n,indices:r,uvs:o}}var uy,ly;function cy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function fy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z2(e){var i=U2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,j2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,V2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,G2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,H2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,W2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,hy=(uy=(0,Gr.b2)(),uy(ly=function(e){(0,En.Z)(r,e);var i=z2(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"colorTexture",void 0),(0,I.Z)((0,be.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,be.Z)(n),"intensityModel",void 0),(0,I.Z)((0,be.Z)(n),"colorModel",void 0),(0,I.Z)((0,be.Z)(n),"shapeType",void 0),n}return(0,jt.Z)(r,[{key:"render",value:function(){var o=this,u=this.rendererService,d=u.clear,g=u.useFramebuffer;g(this.heatmapFramerBuffer,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,u=this.rendererService,d=u.createFramebuffer,g=u.clear,_=u.getViewportSize,E=u.createTexture2D,M=u.useFramebuffer,P=this.styleAttributeService.getLayerStyleAttribute("shape"),D=(P==null||(o=P.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=D,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=D==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Z=_(),Q=Z.width,ue=Z.height;return this.heatmapFramerBuffer=d({color:E({width:Math.floor(Q/4),height:Math.floor(ue/4),wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE,min:ae.LINEAR,mag:ae.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ei.Attribute,descriptor:{name:"a_Dir",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(u,d,g,_){return[g[3],g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?1:E;return[M]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:H2,fragmentShader:G2,triangulation:m2,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:ae.ONE,srcAlpha:1,dstRGB:ae.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:W2,fs:V2});var o=this.shaderModuleService.getModule("heatmapColor"),u=o.vs,d=o.fs,g=o.uniforms,_=this.rendererService,E=_.createAttribute,M=_.createElements,P=_.createBuffer,D=_.createModel;return D({vs:u,fs:d,attributes:{a_Position:E({buffer:P({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:ae.FLOAT}),size:3}),a_Uv:E({buffer:P({data:[0,1,1,1,0,0,1,0],type:ae.FLOAT}),size:2})},uniforms:fy({},g),depth:{enable:!1},blend:this.getBlend(),count:6,elements:M({data:[0,2,1,2,3,1],type:ae.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.intensity,g=d===void 0?10:d,_=o.radius,E=_===void 0?5:_;this.intensityModel.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:g}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=Fe();Sr(d,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,sr.Z)(d)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,u=o(),d=u.width,g=u.height,_=B2(d/4,g/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:j2,fs:Z2});var E=this.shaderModuleService.getModule("heatmap3dColor"),M=E.vs,P=E.fs,D=E.uniforms,Z=this.rendererService,Q=Z.createAttribute,ue=Z.createElements,ve=Z.createBuffer,Ne=Z.createModel;return Ne({vs:M,fs:P,attributes:{a_Position:Q({buffer:ve({data:_.vertices,type:ae.FLOAT}),size:3}),a_Uv:Q({buffer:ve({data:_.uvs,type:ae.FLOAT}),size:2})},primitive:ae.TRIANGLES,uniforms:fy({},D),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:ae.SRC_ALPHA,srcAlpha:1,dstRGB:ae.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ue({data:_.indices,type:ae.UNSIGNED_INT,count:_.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var u=this.layer.getLayerConfig(),d=u.rampColors,g=he(d);this.colorTexture=o({data:new Uint8Array(g.data),width:g.width,height:g.height,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE,min:ae.NEAREST,mag:ae.NEAREST,flipY:!1})}}]),r}(Is))||ly);function X2(e){var i=Y2();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,K2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,$2=function(e){(0,En.Z)(r,e);var i=X2(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,g=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:g||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:K2,fragmentShader:q2,triangulation:oy,depth:{enable:!1},primitive:ae.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(u,d){var g=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[g[0],g[1],0]}}})}}]),r}(Is),J2={heatmap:hy,heatmap3d:hy,grid:R2,grid3d:N2,hexagon:$2},Q2=J2;function eS(e){var i=tS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function tS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rS=function(e){(0,En.Z)(r,e);var i=eS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","HeatMapLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new Q2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){return d.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=this.getLayerConfig(),g=d.shape3d,_=this.getSource(),E=_.data.type,M=(u==null||(o=u.scale)===null||o===void 0?void 0:o.field)||"heatmap";return M==="heatmap"||M==="heatmap3d"?"heatmap":E==="hexagon"?(g==null?void 0:g.indexOf(M))===-1?"hexagon":"grid3d":E==="grid"?(g==null?void 0:g.indexOf(M))===-1?"grid":"grid3d":"heatmap"}}]),r}(Ip);function nS(e){var i=iS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,oS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,sS=function(e){(0,En.Z)(r,e);var i=nS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,u=this.layer.getSource(),d=this.rendererService.createTexture2D;if(this.texture=d({height:0,width:0}),bo){var g=this.layerService.sceneService.getSceneConfig().canvas,_=g.createImage();_.crossOrigin="anonymous",_.src=u.data.originData,_.onload=function(){o.texture=d({data:_,width:_.width,height:_.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else u.data.images.then(function(E){o.texture=d({data:E[0],width:E[0].width,height:E[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:oS,fragmentShader:aS,triangulation:sy,primitive:ae.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(u,d,g,_){return[g[3],g[4]]}}})}}]),r}(Is),uS={image:sS},lS=uS;function cS(e){var i=fS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=function(e){(0,En.Z)(r,e);var i=cS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","ImageLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new lS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={image:{}};return u[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Ip);function pS(e){var i=dS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function dS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,mS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,gS={solid:0,dash:1},yS=function(e){(0,En.Z)(r,e);var i=pS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"updateTexture",function(){var g=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=g({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,g=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,M=o.lineType,P=M===void 0?"solid":M,D=o.dashArray,Z=D===void 0?[10,5]:D,Q=o.forward,ue=Q===void 0?!0:Q,ve=o.lineTexture,Ne=ve===void 0?!1:ve,it=o.iconStep,mt=it===void 0?100:it,bt=o.segmentNumber,Vt=bt===void 0?30:bt,Kt=o.thetaOffset,or=Kt===void 0?.314:Kt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:or})){this.judgeStyleAttributes({opacity:u,thetaOffset:or});var br=this.layer.getEncodedData(),rn=this.calDataFrame(this.cellLength,br,this.cellProperties),dn=rn.data,Or=rn.width,In=rn.height;this.rowCount=In,this.dataTexture=this.cellLength>0&&dn.length>0?this.createTexture2D({flipY:!0,data:dn,format:ae.LUMINANCE,type:ae.FLOAT,width:Or,height:In}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}Z.length===2&&Z.push(0,0);var Un=0,di=[0,0,0,0],Fo=[0,0,0,0];return d&&g&&(di=U(d),Fo=U(g),Un=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Za()(or)?or:0,u_opacity:Za()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Vt,u_line_type:gS[P||"solid"],u_dash_array:Z,u_blur:.9,u_lineDir:ue?1:-1,u_texture:this.texture,u_line_texture:Ne?1:0,u_icon_step:mt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Un,u_sourceColor:di,u_targetColor:Fo}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:mS,fragmentShader:vS,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(d,g,_,E){var M=d.size,P=M===void 0?1:M;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(d,g,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(d,g,_,E){var M=o.iconService.getIconMap(),P=d.texture,D=M[P]||{x:0,y:0},Z=D.x,Q=D.y;return[Z,Q]}}})}}]),r}(Is);function _S(e){var i=xS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ES=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,SS={solid:0,dash:1},wS=function(e){(0,En.Z)(r,e);var i=_S(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"updateTexture",function(){var g=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=g({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,g=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,M=o.lineType,P=M===void 0?"solid":M,D=o.dashArray,Z=D===void 0?[10,5]:D,Q=o.lineTexture,ue=Q===void 0?!1:Q,ve=o.iconStep,Ne=ve===void 0?100:ve,it=o.segmentNumber,mt=it===void 0?30:it,bt=o.globalArcHeight,Vt=bt===void 0?10:bt;Z.length===2&&Z.push(0,0);var Kt=0,or=[0,0,0,0],br=[0,0,0,0];if(d&&g&&(or=U(d),br=U(g),Kt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var rn=this.layer.getEncodedData(),dn=this.calDataFrame(this.cellLength,rn,this.cellProperties),Or=dn.data,In=dn.width,Un=dn.height;this.rowCount=Un,this.dataTexture=this.cellLength>0&&Or.length>0?this.createTexture2D({flipY:!0,data:Or,format:ae.LUMINANCE,type:ae.FLOAT,width:In,height:Un}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Hg,u_global_height:Vt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:mt,u_line_type:SS[P]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:ue?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Kt,u_sourceColor:or,u_targetColor:br}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:ES,fragmentShader:bS,triangulation:Yv,blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(d,g,_,E){var M=d.size,P=M===void 0?1:M;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(d,g,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(d,g,_,E){var M=o.iconService.getIconMap(),P=d.texture,D=M[P]||{x:0,y:0},Z=D.x,Q=D.y;return[Z,Q]}}})}}]),r}(Is);function CS(e){var i=AS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,MS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,PS=function(e){(0,En.Z)(r,e);var i=CS(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,g=o.targetColor,_=o.forward,E=_===void 0?!0:_,M=o.segmentNumber,P=M===void 0?30:M,D=o.thetaOffset,Z=D===void 0?.314:D,Q=0,ue=[0,0,0,0],ve=[0,0,0,0];return d&&g&&(ue=U(d),ve=U(g),Q=1),{u_thetaOffset:Z,u_opacity:Za()(u)?u:1,segmentNumber:P,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:Q,u_sourceColor:ue,u_targetColor:ve}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:MS,fragmentShader:TS,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?1:E;return Array.isArray(M)?[M[0]]:[M]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(u,d,g,_){return[g[3],g[4],g[5],g[6]]}}})}}]),r}(Is);function IS(e){var i=OS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,LS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,kS={solid:0,dash:1},DS=function(e){(0,En.Z)(r,e);var i=IS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"updateTexture",function(){var g=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=g({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,g=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,M=o.lineType,P=M===void 0?"solid":M,D=o.dashArray,Z=D===void 0?[10,5]:D,Q=o.lineTexture,ue=Q===void 0?!1:Q,ve=o.iconStep,Ne=ve===void 0?100:ve,it=o.segmentNumber,mt=it===void 0?30:it;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var bt=0,Vt=[0,0,0,0],Kt=[0,0,0,0];if(d&&g&&(Vt=U(d),Kt=U(g),bt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var or=this.layer.getEncodedData(),br=this.calDataFrame(this.cellLength,or,this.cellProperties),rn=br.data,dn=br.width,Or=br.height;this.rowCount=Or,this.dataTexture=this.cellLength>0&&rn.length>0?this.createTexture2D({flipY:!0,data:rn,format:ae.LUMINANCE,type:ae.FLOAT,width:dn,height:Or}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:mt,u_line_type:kS[P]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:ue?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:bt,u_sourceColor:Vt,u_targetColor:Kt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:LS,fragmentShader:RS,triangulation:Yv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(d,g,_,E){var M=d.size,P=M===void 0?1:M;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ei.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(d,g,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(d,g,_,E){var M=o.iconService.getIconMap(),P=d.texture,D=M[P]||{x:0,y:0},Z=D.x,Q=D.y;return[Z,Q]}}})}}]),r}(Is);function FS(e){var i=NS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function NS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
// varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = (vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
    // gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,zS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float((a_Position.z)) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,US={solid:0,dash:1},py=function(e){(0,En.Z)(r,e);var i=FS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"updateTexture",function(){var g=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=g({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,g=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,M=o.lineType,P=M===void 0?"solid":M,D=o.dashArray,Z=D===void 0?[10,5,0,0]:D,Q=o.lineTexture,ue=Q===void 0?!1:Q,ve=o.iconStep,Ne=ve===void 0?100:ve,it=o.vertexHeightScale,mt=it===void 0?20:it;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var bt=0,Vt=[0,0,0,0],Kt=[0,0,0,0];if(d&&g&&(Vt=U(d),Kt=U(g),bt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var or=this.layer.getEncodedData(),br=this.calDataFrame(this.cellLength,or,this.cellProperties),rn=br.data,dn=br.width,Or=br.height;this.rowCount=Or,this.dataTexture=this.cellLength>0&&rn.length>0?this.createTexture2D({flipY:!0,data:rn,format:ae.LUMINANCE,type:ae.FLOAT,width:dn,height:Or}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(u)?u:1,u_textureBlend:E==="normal"?0:1,u_line_type:US[P],u_dash_array:Z,u_texture:this.texture,u_line_texture:ue?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:bt,u_sourceColor:Vt,u_targetColor:Kt,u_vertexScale:mt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:zS,fragmentShader:BS,triangulation:h2,primitive:ae.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.lineType,g=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ei.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,M,P,D){return[P[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ei.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,M,P,D){return[P[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(E,M,P,D){var Z=E.size,Q=Z===void 0?1:Z;return Array.isArray(Q)?[Q[0],Q[1]]:[Q,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(E,M,P,D,Z){return Z}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ei.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,M,P,D){return[P[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(E,M,P,D){var Z=o.iconService.getIconMap(),Q=E.texture,ue=Z[Q]||{x:0,y:0},ve=ue.x,Ne=ue.y;return[ve,Ne]}}})}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var g=new Image;g.crossOrigin="anonymous",g.onload=function(){u(g)},g.onerror=function(){d(new Error("Could not load image at "+o))},g.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(Is),ZS={arc:yS,arcmini:PS,arc3d:wS,greatcircle:DS,line:py},jS=ZS;function VS(e){var i=GS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function GS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HS=function(e){(0,En.Z)(r,e);var i=VS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","LineLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new jS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return u[o]}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d||"line"}}]),r}(Ip);function WS(e){var i=XS();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,qS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,dy=function(e){(0,En.Z)(r,e);var i=WS(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.sourceColor,_=o.targetColor,E=o.opacityLinear,M=E===void 0?{enable:!1,dir:"up"}:E,P=o.lightEnable,D=P===void 0?!0:P;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Z=this.layer.getEncodedData(),Q=this.calDataFrame(this.cellLength,Z,this.cellProperties),ue=Q.data,ve=Q.width,Ne=Q.height;this.rowCount=Ne,this.dataTexture=this.cellLength>0&&ue.length>0?this.createTexture2D({flipY:!0,data:ue,format:ae.LUMINANCE,type:ae.FLOAT,width:ve,height:Ne}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}var it=0,mt=[0,0,0,0],bt=[0,0,0,0];return g&&_&&(mt=U(g),bt=U(_),it=1),{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1,u_linearColor:it,u_sourceColor:mt,u_targetColor:bt,u_opacitylinear:Number(M.enable),u_opacitylinear_dir:M.dir==="up"?1:0,u_lightEnable:Number(D)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.depth,d=u===void 0?!0:u;return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:qS,fragmentShader:YS,triangulation:ny,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?ae.FRONT:ae.BACK},depth:{enable:d}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(d,g,_,E){var M=d.size;if(M){var P=[];return Array.isArray(M)&&(P=M.length===2?[M[0],M[0],M[1]]:M),Array.isArray(M)||(P=[M,M,M]),P}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(d,g,_,E,M){return M}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ei.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(d,g){var _=Op(d.coordinates);return o?Xg([_[0],_[1]]):[_[0],_[1],0]}}})}}]),r}(Is),kp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(kp||(kp={}));function KS(e){var i=$S();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function $S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
    
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }
}
`,QS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
  }
  
  

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,vy=function(e){(0,En.Z)(r,e);var i=KS(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"meter2coord",1),(0,I.Z)((0,be.Z)(n),"isMeter",!1),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.strokeOpacity,_=g===void 0?1:g,E=o.strokeWidth,M=E===void 0?0:E,P=o.stroke,D=P===void 0?"rgba(0,0,0,0)":P,Z=o.offsets,Q=Z===void 0?[0,0]:Z,ue=o.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeOpacity:_,strokeWidth:M,stroke:D,offsets:Q})){this.judgeStyleAttributes({opacity:d,strokeOpacity:_,strokeWidth:M,stroke:D,offsets:Q});var ve=this.layer.getEncodedData(),Ne=this.calDataFrame(this.cellLength,ve,this.cellProperties),it=Ne.data,mt=Ne.width,bt=Ne.height;this.rowCount=bt,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:ae.LUMINANCE,type:ae.FLOAT,width:mt,height:bt}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:ue==="additive"?1:0,u_globel:this.mapService.version===kp.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1,u_stroke_opacity:Za()(_)?_:1,u_stroke_width:Za()(M)?M:0,u_stroke_color:this.getStrokeColor(D),u_offsets:this.isOffsetStatic(Q)?Q:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ry)}},{key:"initModels",value:function(){var o=this.layer.getLayerConfig(),u=o.unit,d=u===void 0?"l7size":u,g=this.mapService.version;return d==="meter"&&g!==kp.L7MAP&&g!==kp.GLOBEL&&g!==kp.MAPBOX&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var o=(0,ie.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],g=o[2],_=o[3],E=[(u+g)/2,(d+_)/2],M=this.mapService.meterToCoord(E,[u,d]),P=this.mapService.meterToCoord(E,[g===u?g+.1:g,_===d?d+.1:_]);this.meter2coord=(M+P)/2}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:QS,fragmentShader:JS,triangulation:o?f2:ry,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ei.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(g,_,E,M){var P;if(u){var D=(0,ie.Z)(E,3),Z=D[0],Q=D[1],ue=D[2],ve=Xa.fromValues(0,0,1),Ne=Xa.fromValues(Z,0,ue),it=Z>=0?Xa.angle(ve,Ne):Math.PI*2-Xa.angle(ve,Ne),mt=Math.PI*2-Math.asin(Q/100),bt=Fe();wr(bt,bt,it),Ut(bt,bt,mt);var Vt=Xa.fromValues(1,1,0);Xa.transformMat4(Vt,Vt,bt),Xa.normalize(Vt,Vt);var Kt=Xa.fromValues(-1,1,0);Xa.transformMat4(Kt,Kt,bt),Xa.normalize(Kt,Kt);var or=Xa.fromValues(-1,-1,0);Xa.transformMat4(or,or,bt),Xa.normalize(or,or);var br=Xa.fromValues(1,-1,0);Xa.transformMat4(br,br,bt),Xa.normalize(br,br),P=[].concat((0,sr.Z)(Vt),(0,sr.Z)(Kt),(0,sr.Z)(or),(0,sr.Z)(br))}else P=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var rn=M%4*3;return[P[rn],P[rn+1],P[rn+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(g,_,E,M){var P=g.size,D=P===void 0?5:P;return Array.isArray(D)?[D[0]*o.meter2coord]:[D*o.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ei.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(g,_,E,M){var P=g.shape,D=P===void 0?2:P,Z=o.layer.getLayerConfig().shape2d,Q=Z.indexOf(D);return[Q]}}})}}]),r}(Is);function ew(e){var i=tw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rw=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,nw=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,iw=function(e){(0,En.Z)(r,e);var i=ew(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:nw,fragmentShader:rw,triangulation:iy,primitive:ae.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(d,g,_,E){var M=d.size;return Array.isArray(M)?[M[0]]:[M]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(d,g,_,E){var M=o.fontService.mapping,P=d.shape,D=o.fontService.getGlyph(P),Z=M[D],Q=Z.x,ue=Z.y;return[Q,ue]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.texture=o({data:u,mag:ae.LINEAR,min:ae.LINEAR,width:u.width,height:u.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.fontWeight,g=d===void 0?"normal":d,_=u.fontFamily,E=_===void 0?"sans-serif":_,M=this.layer.getEncodedData(),P=[];M.forEach(function(D){var Z=D.shape,Q=Z===void 0?"":Z;Q=Q.toString();var ue=o.fontService.getGlyph(Q);P.indexOf(ue)===-1&&P.push(ue)}),this.fontService.setFontOptions({characterSet:P,fontWeight:g,fontFamily:E,fontSize:48})}}]),r}(Is);function aw(e){var i=ow();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sw=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,uw=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,gy=function(e){(0,En.Z)(r,e);var i=aw(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"updateTexture",function(){var g=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.renderLayers();return}n.texture=g({data:n.iconService.getCanvas(),mag:ae.LINEAR,min:ae.LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.offsets,g=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:g})){this.judgeStyleAttributes({opacity:u,offsets:g});var _=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,_,this.cellProperties),M=E.data,P=E.width,D=E.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&M.length>0?this.createTexture2D({flipY:!0,data:M,format:ae.LUMINANCE,type:ae.FLOAT,width:P,height:D}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Za()(u)?u:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:uw,fragmentShader:sw,triangulation:iy,primitive:ae.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(d,g,_,E){var M=d.size,P=M===void 0?5:M;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(d,g,_,E){var M=o.iconService.getIconMap(),P=d.shape,D=M[P]||{x:0,y:0},Z=D.x,Q=D.y;return[Z,Q]}}})}}]),r}(Is);function lw(e){var i=cw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,hw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function pw(e){var i=e.coordinates;return{vertices:(0,sr.Z)(i),indices:[0],size:i.length}}var yy=function(e){(0,En.Z)(r,e);var i=lw(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.offsets,_=g===void 0?[0,0]:g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:_})){this.judgeStyleAttributes({opacity:d,offsets:_});var E=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,E,this.cellProperties),P=M.data,D=M.width,Z=M.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ae.LUMINANCE,type:ae.FLOAT,width:D,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:hw,fragmentShader:fw,triangulation:pw,depth:{enable:!1},primitive:ae.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?1:E;return Array.isArray(M)?[M[0]]:[M]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:vc.additive}}}]),r}(Is);function dw(e){var i=vw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,gw=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function yw(e){var i=e.coordinates;return{vertices:(0,sr.Z)(i),indices:[0],size:i.length}}var _w=function(e){(0,En.Z)(r,e);var i=dw(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.offsets,_=g===void 0?[0,0]:g,E=o.blend,M=o.strokeOpacity,P=M===void 0?1:M,D=o.strokeWidth,Z=D===void 0?0:D,Q=o.stroke,ue=Q===void 0?"#fff":Q;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:_})){this.judgeStyleAttributes({opacity:d,offsets:_});var ve=this.layer.getEncodedData(),Ne=this.calDataFrame(this.cellLength,ve,this.cellProperties),it=Ne.data,mt=Ne.width,bt=Ne.height;this.rowCount=bt,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:ae.LUMINANCE,type:ae.FLOAT,width:mt,height:bt}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_additive:E==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1,u_offsets:this.isOffsetStatic(_)?_:[0,0],u_stroke_opacity:Za()(P)?P:1,u_stroke_width:Za()(Z)?Z:0,u_stroke_color:this.getStrokeColor(ue)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:gw,fragmentShader:mw,triangulation:yw,depth:{enable:!1},primitive:ae.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?1:E;return Array.isArray(M)?[M[0]]:[M]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:vc.additive}}}]),r}(Is);function xw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function bw(e,i){if(!!e){if(typeof e=="string")return _y(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _y(e,i)}}function _y(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ew=function(){function e(i,r,n){(0,pt.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var u=0;u<this.xCellCount*this.yCellCount;u++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,jt.Z)(e,[{key:"insert",value:function(r,n,o,u,d){this.forEachCell(n,o,u,d,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}},{key:"query",value:function(r,n,o,u,d){return this.queryHitTest(r,n,o,u,!1,d)}},{key:"hitTest",value:function(r,n,o,u,d){return this.queryHitTest(r,n,o,u,!0,d)}},{key:"insertBoxCell",value:function(r,n,o,u,d,g){this.boxCells[d].push(g)}},{key:"queryHitTest",value:function(r,n,o,u,d,g){if(o<0||r>this.width||u<0||n>this.height)return d?!1:[];var _=[];if(r<=0&&n<=0&&this.width<=o&&this.height<=u){if(d)return!0;for(var E=0;E<this.boxKeys.length;E++)_.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return g?_.filter(g):_}var M={hitTest:d,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,o,u,this.queryCell,_,M,g),d?_.length>0:_}},{key:"queryCell",value:function(r,n,o,u,d,g,_,E){var M=_.seenUids,P=this.boxCells[d];if(P!==null){var D=this.bboxes,Z=xw(P),Q;try{for(Z.s();!(Q=Z.n()).done;){var ue=Q.value;if(!M.box[ue]){M.box[ue]=!0;var ve=ue*4;if(r<=D[ve+2]&&n<=D[ve+3]&&o>=D[ve+0]&&u>=D[ve+1]&&(!E||E(this.boxKeys[ue]))){if(_.hitTest)return g.push(!0),!0;g.push({key:this.boxKeys[ue],x1:D[ve],y1:D[ve+1],x2:D[ve+2],y2:D[ve+3]})}}}}catch(Ne){Z.e(Ne)}finally{Z.f()}}return!1}},{key:"forEachCell",value:function(r,n,o,u,d,g,_,E){for(var M=this.convertToXCellCoord(r),P=this.convertToYCellCoord(n),D=this.convertToXCellCoord(o),Z=this.convertToYCellCoord(u),Q=M;Q<=D;Q++)for(var ue=P;ue<=Z;ue++){var ve=this.xCellCount*ue+Q;if(d.call(this,r,n,o,u,ve,g,_,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),Sw=Ew,ww=function(){function e(i,r){(0,pt.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new Sw(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,jt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,u=r.x2+r.anchorPointX+this.viewportPadding,d=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,o,u,d)||this.grid.hitTest(n,o,u,d)?{box:[]}:{box:[n,o,u,d]}}},{key:"insertCollisionBox",value:function(r,n){var o={featureIndex:n};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,o){var u=xn(n,o,0,1),d=un(),g=It.apply(Y,(0,sr.Z)(r));return nd(d,u,g),{x:(d[0]/d[3]+1)/2*this.width+this.viewportPadding,y:(-d[1]/d[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,o,u){return o>=0&&r<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}}]),e}();function xy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Cw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function Cw(e,i){if(!!e){if(typeof e=="string")return by(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return by(e,i)}}function by(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ey(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Sy(e,i,r,n,o){if(!!o){var u=e[n],d=u.glyph;if(d)for(var g=i[d].advance*u.scale,_=(e[n].x+g)*o,E=r;E<=n;E++)e[E].x-=_}}function wy(e,i,r,n,o,u,d){var g=(i-r)*o,_=(-n*d+.5)*u,E=xy(e),M;try{for(E.s();!(M=E.n()).done;){var P=M.value;P.x+=g,P.y+=_}}catch(D){E.e(D)}finally{E.f()}}function Aw(e,i,r,n,o,u,d){var g=-8,_=0,E=g,M=0,P=e.positionedGlyphs,D=u==="right"?1:u==="left"?0:.5,Z=P.length;r.forEach(function(it){if(it.split("").forEach(function(bt){var Vt=i[bt],Kt=0;Vt&&(P.push({glyph:bt,x:_,y:E+Kt,vertical:!1,scale:1,metrics:Vt}),_+=Vt.advance+d)}),P.length!==Z){var mt=_-d;M=Math.max(mt,M),Sy(P,i,Z,P.length-1,D)}_=0,E-=n+5});var Q=Ey(o),ue=Q.horizontalAlign,ve=Q.verticalAlign;wy(P,D,ue,ve,M,n,r.length);var Ne=E-g;e.top+=-ve*Ne,e.bottom=e.top-Ne,e.left+=-ue*M,e.right=e.left+M}function Tw(e,i,r,n,o,u,d){var g=-8,_=0,E=g,M=0,P=e.positionedGlyphs,D=u==="right"?1:u==="left"?0:.5,Z=P.length;r.forEach(function(it){var mt=i[it],bt=0;if(mt&&(P.push({glyph:it,x:_,y:E+bt,vertical:!1,scale:1,metrics:mt}),_+=mt.advance+d),P.length!==Z){var Vt=_-d;M=Math.max(Vt,M),Sy(P,i,Z,P.length-1,D)}_=0,E-=n+5});var Q=Ey(o),ue=Q.horizontalAlign,ve=Q.verticalAlign;wy(P,D,ue,ve,M,n,r.length);var Ne=E-g;e.top+=-ve*Ne,e.bottom=e.top-Ne,e.left+=-ue*M,e.right=e.left+M}function Mw(e,i,r,n,o,u){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],g=arguments.length>7?arguments[7]:void 0,_=e.split(`
`),E=[],M={positionedGlyphs:E,top:d[1],bottom:d[1],left:d[0],right:d[0],lineCount:_.length,text:e};return g?Tw(M,i,_,r,n,o,u):Aw(M,i,_,r,n,o,u),E.length?M:!1}function Pw(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,o=n===void 0?[]:n,u=[],d=xy(o),g;try{for(d.s();!(g=d.n()).done;){var _=g.value,E=_.metrics,M=4,P=E.advance*_.scale/2,D=r?[_.x+P,_.y]:[0,0],Z=r?[0,0]:[_.x+P+i[0],_.y+i[1]],Q=(0-M)*_.scale-P+Z[0],ue=(0-M)*_.scale+Z[1],ve=Q+E.width*_.scale,Ne=ue+E.height*_.scale,it={x:Q,y:ue},mt={x:ve,y:ue},bt={x:Q,y:Ne},Vt={x:ve,y:Ne};u.push({tl:it,tr:mt,bl:bt,br:Vt,tex:E,glyphOffset:D})}}catch(Kt){d.e(Kt)}finally{d.f()}return u}function Iw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ow(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,g;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,g=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw g}}}}function Ow(e,i){if(!!e){if(typeof e=="string")return Cy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cy(e,i)}}function Cy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Rw(e){var i=Lw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ay=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ty=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function My(e){var i=this,r=e.id,n=[],o=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var u=i.glyphInfoMap[r].centroid,d=u.length===2?[u[0],u[1],0]:u;return i.glyphInfoMap[r].glyphQuads.forEach(function(g,_){n.push.apply(n,(0,sr.Z)(d).concat([g.tex.x,g.tex.y+g.tex.height,g.tl.x,g.tl.y],(0,sr.Z)(d),[g.tex.x+g.tex.width,g.tex.y+g.tex.height,g.tr.x,g.tr.y],(0,sr.Z)(d),[g.tex.x+g.tex.width,g.tex.y,g.br.x,g.br.y],(0,sr.Z)(d),[g.tex.x,g.tex.y,g.bl.x,g.bl.y])),o.push(0+_*4,1+_*4,2+_*4,2+_*4,3+_*4,0+_*4)}),{vertices:n,indices:o,size:7}}var Py=function(e){(0,En.Z)(r,e);var i=Rw(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,be.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"currentZoom",-1),(0,I.Z)((0,be.Z)(n),"extent",void 0),(0,I.Z)((0,be.Z)(n),"textureHeight",0),(0,I.Z)((0,be.Z)(n),"textCount",0),(0,I.Z)((0,be.Z)(n),"preTextStyle",{}),(0,I.Z)((0,be.Z)(n),"buildModels",function(){return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ty,fragmentShader:Ay,triangulation:My.bind((0,be.Z)(n)),depth:{enable:!1},blend:n.getBlend()})]}),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.stroke,_=g===void 0?"#fff":g,E=o.strokeWidth,M=E===void 0?0:E,P=o.textAnchor,D=P===void 0?"center":P,Z=o.textAllowOverlap,Q=Z===void 0?!1:Z,ue=o.halo,ve=ue===void 0?.5:ue,Ne=o.gamma,it=Ne===void 0?2:Ne,mt=this.fontService,bt=mt.canvas,Vt=mt.mapping;if(Object.keys(Vt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Vt).length),this.preTextStyle={textAnchor:D,textAllowOverlap:Q},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeWidth:M,stroke:_})){this.judgeStyleAttributes({opacity:d,strokeWidth:M,stroke:_});var Kt=this.layer.getEncodedData(),or=this.calDataFrame(this.cellLength,Kt,this.cellProperties),br=or.data,rn=or.width,dn=or.height;this.rowCount=dn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:ae.LUMINANCE,type:ae.FLOAT,width:rn,height:dn}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1,u_stroke_width:Za()(M)?M:0,u_stroke_color:this.getStrokeColor(_),u_sdf_map:this.texture,u_halo_blur:ve,u_gamma_scale:it,u_sdf_map_size:[bt.width,bt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,d=u===void 0?"center":u,g=o.textAllowOverlap,_=g===void 0?!0:g;return this.preTextStyle={textAnchor:d,textAllowOverlap:_},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),u=o.textAllowOverlap,d=u===void 0?!1:u,g=this.mapService.getZoom(),_=this.mapService.getBounds(),E=c(this.extent,_);return!d&&(Math.abs(this.currentZoom-g)>1||!E)||d!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ei.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.rotate,M=E===void 0?0:E;return Array.isArray(M)?[M[0]]:[M]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ei.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(u,d,g,_){return[g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?12:E;return Array.isArray(M)?[M[0]]:[M]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ei.Attribute,descriptor:{name:"a_tex",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(u,d,g,_){return[g[3],g[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return f(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,g=o.fontFamily,_=g===void 0?"sans-serif":g,E=this.layer.getEncodedData(),M=[];E.forEach(function(P){var D=P.shape,Z=D===void 0?"":D;Z=Z.toString();var Q=Iw(Z),ue;try{for(Q.s();!(ue=Q.n()).done;){var ve=ue.value;M.indexOf(ve)===-1&&M.push(ve)}}catch(Ne){Q.e(Ne)}finally{Q.f()}}),this.fontService.setFontOptions({characterSet:M,fontWeight:d,fontFamily:_,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,g=o.fontFamily,_=g===void 0?"sans-serif":g,E=this.layer.getEncodedData(),M=[];E.forEach(function(P){var D=P.shape,Z=D===void 0?"":D;Z="".concat(Z),M.indexOf(Z)===-1&&M.push(Z)}),this.fontService.setFontOptions({characterSet:M,fontWeight:d,fontFamily:_,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var u=this,d=this.fontService.mapping,g=this.layer.getLayerConfig(),_=g.spacing,E=_===void 0?2:_,M=g.textAnchor,P=M===void 0?"center":M,D=this.layer.getEncodedData();this.glyphInfo=D.map(function(Z){var Q=Z.shape,ue=Q===void 0?"":Q,ve=Z.id,Ne=Z.size,it=Ne===void 0?1:Ne,mt=Z.textOffset,bt=mt===void 0?[0,0]:mt,Vt=Mw(ue.toString(),d,it,P,"left",E,bt,o),Kt=Pw(Vt,bt,!1);return Z.shaping=Vt,Z.glyphQuads=Kt,Z.centroid=Op(Z.coordinates),Z.originCentroid=Z.version==="GAODE2.x"?Op(Z.originCoordinates):Z.originCentroid=Z.centroid,u.glyphInfoMap[ve]={shaping:Vt,glyphQuads:Kt,centroid:Op(Z.coordinates)},Z})}},{key:"filterGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.padding,g=d===void 0?[4,4]:d,_=u.textAllowOverlap,E=_===void 0?!1:_;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var M=this.rendererService.getViewportSize(),P=M.width,D=M.height,Z=new ww(P,D),Q=this.glyphInfo.filter(function(ue){var ve=ue.shaping,Ne=ue.id,it=Ne===void 0?0:Ne,mt=ue.version==="GAODE2.x"?ue.originCentroid:ue.centroid,bt=ue.size,Vt=bt/24,Kt=o.mapService.lngLatToContainer(mt),or=Z.placeCollisionBox({x1:ve.left*Vt-g[0],x2:ve.right*Vt+g[0],y1:ve.top*Vt-g[1],y2:ve.bottom*Vt+g[1],anchorPointX:Kt.x,anchorPointY:Kt.y}),br=or.box;return br&&br.length?(Z.insertCollisionBox(br,it),!0):!1});Q.forEach(function(ue){o.glyphInfoMap[ue.id]=ue})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),u=o.iconfont,d=u===void 0?!1:u;d?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(d)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.textureHeight=u.height,this.texture&&this.texture.destroy(),this.texture=o({data:u,mag:ae.LINEAR,min:ae.LINEAR,width:u.width,height:u.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ty,fragmentShader:Ay,triangulation:My.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Is),kw={fill:vy,image:gy,normal:yy,simplePoint:_w,extrude:dy,text:Py,icon:iw},Dw=kw;function Fw(e){var i=Nw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bw=function(e){(0,En.Z)(r,e);var i=Fw(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","PointLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new Dw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return u[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,g=u.shape3d,_=this.iconService.getIconMap(),E=o.find(function(P){return P.hasOwnProperty("shape")});if(E){var M=E.shape;return M==="dot"?"normal":M==="simple"?"simplePoint":(d==null?void 0:d.indexOf(M))!==-1?"fill":(g==null?void 0:g.indexOf(M))!==-1?"extrude":_.hasOwnProperty(M)?"image":this.fontService.getGlyph(M)!==""?"icon":"text"}else return"normal"}}]),r}(Ip);function zw(e){var i=Uw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,Vw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Gw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Hw=function(e){(0,En.Z)(r,e);var i=zw(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var g=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,g,this.cellProperties),E=_.data,M=_.width,P=_.height;this.rowCount=P,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:ae.LUMINANCE,type:ae.FLOAT,width:M,height:P}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.pickLight,d=u===void 0?!1:u;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:d?Vw:Gw,fragmentShader:d?jw:Zw,triangulation:ay})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ei.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(u,d,g,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ei.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(u,d,g,_){var E=u.size,M=E===void 0?10:E;return Array.isArray(M)?[M[0]]:[M]}}})}}]),r}(Is);function Ww(e){var i=Xw();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function Xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,qw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Kw=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,$w=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Jw=function(e){(0,En.Z)(r,e);var i=Ww(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.opacityLinear,_=g===void 0?{enable:!1,dir:"in"}:g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var E=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,E,this.cellProperties),P=M.data,D=M.width,Z=M.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ae.LUMINANCE,type:ae.FLOAT,width:D,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(d)?d:1,u_opacitylinear:Number(_.enable),u_dir:_.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:d.enable?Kw:$w,fragmentShader:d.enable?qw:Yw,triangulation:d.enable?d2:p2,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;d.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Ei.Attribute,descriptor:{name:"a_linear",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(_,E,M,P,D){return[M[3],M[4],M[5]]}}})}}]),r}(Is),Qw={fill:Jw,line:py,extrude:Hw,text:Py,point_fill:vy,point_image:gy,point_normal:yy,point_extrude:dy},eC=Qw;function tC(e){var i=rC();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iy=function(e){(0,En.Z)(r,e);var i=tC(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","PolygonLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new eC[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d==="fill"?"fill":d==="extrude"?"extrude":d==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,g=u.shape3d,_=this.iconService.getIconMap(),E=o.find(function(P){return P.hasOwnProperty("shape")});if(E){var M=E.shape;return M==="dot"?"point_normal":(d==null?void 0:d.indexOf(M))!==-1?"point_fill":(g==null?void 0:g.indexOf(M))!==-1?"point_extrude":_.hasOwnProperty(M)?"point_image":"text"}else return"fill"}}]),r}(Ip);function nC(e){var i=iC();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,oC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Oy=function(e){(0,En.Z)(r,e);var i=nC(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"texture",void 0),(0,I.Z)((0,be.Z)(n),"colorTexture",void 0),n}return(0,jt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,g=o.clampLow,_=g===void 0?!0:g,E=o.clampHigh,M=E===void 0?!0:E,P=o.noDataValue,D=P===void 0?-9999999:P,Z=o.domain,Q=Z===void 0?[0,1]:Z;return this.updateColorTexure(),{u_opacity:d||1,u_texture:this.texture,u_domain:Q,u_clampLow:_,u_clampHigh:typeof M!="undefined"?M:_,u_noDataValue:D,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),u=this.rendererService.createTexture2D,d=o.data.dataArray[0];this.texture=u({data:d.data,width:d.width,height:d.height,format:ae.LUMINANCE,type:ae.FLOAT});var g=this.layer.getLayerConfig(),_=g.rampColors,E=he(_);return this.colorTexture=u({data:E.data,width:E.width,height:E.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:oC,fragmentShader:aC,triangulation:sy,primitive:ae.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ei.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(u,d,g,_){return[g[3],g[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),d=u.rampColors,g=he(d);this.colorTexture=o({data:g.data,width:g.width,height:g.height,flipY:!1})}}]),r}(Is),sC={raster:Oy,raster3d:Oy},uC=sC;function lC(e){var i=cC();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=function(e){(0,En.Z)(r,e);var i=lC(r);function r(){var n;(0,pt.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),(0,I.Z)((0,be.Z)(n),"type","RasterLayer"),n}return(0,jt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new uC[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={raster:{},raster3d:{}};return u[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Ip),Ry,Ly,ky,Dy,Fy,ev,Ny,By,zy;function Uy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function hC(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Uy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var pC=(Ry=(0,Gr.b2)(),Ly=(0,Gr.f3)(Ht.IGlobalConfigService),ky=(0,Gr.f3)(Ht.IMapService),Dy=(0,Gr.f3)(Ht.IFontService),Ry(Fy=(ev=function(){function e(){(0,pt.Z)(this,e),$t(this,"configService",Ny,this),$t(this,"mapService",By,this),$t(this,"fontService",zy,this)}return(0,jt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:u})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:u}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var d=u.getLayerStyleAttributes()||[],g=u.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,E=d.filter(function(P){return P.needRemapping}),M=_;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(M=_.filter(function(P){return o.applyAttributeMapping(g,P)[0]})),E.length&&(g!=null&&g.needRemapping?(r.setEncodedData(o.mapping(d,M)),g.needRemapping=!1):r.setEncodedData(o.mapping(E,M,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var o=this,u=n.styleAttributeService,d=u.getLayerStyleAttributes()||[],g=u.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,E=_;g!=null&&g.scale&&(E=_.filter(function(M){return o.applyAttributeMapping(g,M)[0]})),r.setEncodedData(this.mapping(d,E))}},{key:"mapping",value:function(r,n,o){var u=this,d=n.map(function(g,_){var E=o?o[_]:{},M=hC({id:g._id,coordinates:g.coordinates},E);return r.filter(function(P){return P.scale!==void 0}).forEach(function(P){var D=u.applyAttributeMapping(P,g);P.needRemapping=!1,P.name==="color"&&(D=D.map(function(Z){return U(Z)})),M[P.name]=Array.isArray(D)&&D.length===1?D[0]:D,P.name==="shape"&&(M.shape=u.fontService.getIconFontKey(M[P.name]))}),M});return d.length>0&&this.mapService.version==="GAODE2.x"&&(typeof d[0].coordinates[0]=="number"?d.filter(function(g){return!g.originCoordinates}).map(function(g){g.version="GAODE2.x",g.originCoordinates=ri()(g.coordinates),g.coordinates=u.mapService.lngLatToCoord(g.coordinates)}):d.filter(function(g){return!g.originCoordinates}).map(function(g){g.version="GAODE2.x",g.originCoordinates=ri()(g.coordinates),g.coordinates=u.mapService.lngLatToCoords(g.coordinates)})),d}},{key:"applyAttributeMapping",value:function(r,n){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],d=[];return u.forEach(function(g){var _,E=g.field;(n.hasOwnProperty(E)||((_=r.scale)===null||_===void 0?void 0:_.type)==="variable")&&d.push(n[E])}),r.mapping?r.mapping(d):[]}}]),e}(),Ny=hr(ev.prototype,"configService",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=hr(ev.prototype,"mapService",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=hr(ev.prototype,"fontService",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev))||Fy),Zy,jy,dC=(Zy=(0,Gr.b2)(),Zy(jy=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,jt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Ht.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var u=r.sourceOption||{data:Gf,options:Hf},d=u.data,g=u.options;r.setSource(new Vf(d,g))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||u})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),o=n.cluster,u=n.clusterOptions,d=u.zoom,g=d===void 0?0:d,_=u.maxZoom,E=_===void 0?16:_,M=this.mapService.getZoom()-1,P=r.dataState.dataSourceNeedUpdate;return o&&(P||Math.abs(g-M)>1)&&E>g?(n.updateClusterData(Math.floor(M)),!0):!1}}]),e}())||jy);function km(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Vy(e){return e.length===1&&(e=vC(e)),{left:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var u=n+o>>>1;e(i[u],r)<0?n=u+1:o=u}return n},right:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var u=n+o>>>1;e(i[u],r)>0?o=u:n=u+1}return n}}}function vC(e){return function(i,r){return km(e(i),r)}}var Gy=Vy(km),mC=Gy.right,E3=Gy.left,Kv=mC;function gC(e,i){var r=e.length,n=-1,o,u,d;if(i==null){for(;++n<r;)if((o=e[n])!=null&&o>=o)for(u=d=o;++n<r;)(o=e[n])!=null&&(u>o&&(u=o),d<o&&(d=o))}else for(;++n<r;)if((o=i(e[n],n,e))!=null&&o>=o)for(u=d=o;++n<r;)(o=i(e[n],n,e))!=null&&(u>o&&(u=o),d<o&&(d=o));return[u,d]}var Hy=Array.prototype,S3=Hy.slice,w3=Hy.map,Dm=Math.sqrt(50),Fm=Math.sqrt(10),Nm=Math.sqrt(2);function Wy(e,i,r){var n,o=-1,u,d,g;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(u=e,e=i,i=u),(g=$v(e,i,r))===0||!isFinite(g))return[];if(g>0)for(e=Math.ceil(e/g),i=Math.floor(i/g),d=new Array(u=Math.ceil(i-e+1));++o<u;)d[o]=(e+o)*g;else for(e=Math.floor(e*g),i=Math.ceil(i*g),d=new Array(u=Math.ceil(e-i+1));++o<u;)d[o]=(e-o)/g;return n&&d.reverse(),d}function $v(e,i,r){var n=(i-e)/Math.max(0,r),o=Math.floor(Math.log(n)/Math.LN10),u=n/Math.pow(10,o);return o>=0?(u>=Dm?10:u>=Fm?5:u>=Nm?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=Dm?10:u>=Fm?5:u>=Nm?2:1)}function Bm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),u=n/o;return u>=Dm?o*=10:u>=Fm?o*=5:u>=Nm&&(o*=2),i<e?-o:o}function C3(){var e=identity,i=extent,r=sturges;function n(o){var u,d=o.length,g,_=new Array(d);for(u=0;u<d;++u)_[u]=e(o[u],u,o);var E=i(_),M=E[0],P=E[1],D=r(_,M,P);Array.isArray(D)||(D=tickStep(M,P,D),D=range(Math.ceil(M/D)*D,P,D));for(var Z=D.length;D[0]<=M;)D.shift(),--Z;for(;D[Z-1]>P;)D.pop(),--Z;var Q=new Array(Z+1),ue;for(u=0;u<=Z;++u)ue=Q[u]=[],ue.x0=u>0?D[u-1]:M,ue.x1=u<Z?D[u]:P;for(u=0;u<d;++u)g=_[u],M<=g&&g<=P&&Q[bisect(D,g,0,Z)].push(o[u]);return Q}return n.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),n):e},n.domain=function(o){return arguments.length?(i=typeof o=="function"?o:constant([o[0],o[1]]),n):i},n.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),n):r},n}function A3(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function yC(e){return e===null?NaN:+e}function _C(e,i,r){if(r==null&&(r=yC),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*i,u=Math.floor(o),d=+r(e[u],u,e),g=+r(e[u+1],u+1,e);return d+(g-d)*(o-u)}}var yc="$";function Jv(){}Jv.prototype=Xy.prototype={constructor:Jv,has:function(e){return yc+e in this},get:function(e){return this[yc+e]},set:function(e,i){return this[yc+e]=i,this},remove:function(e){var i=yc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===yc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===yc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===yc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===yc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===yc&&++e;return e},empty:function(){for(var e in this)if(e[0]===yc)return!1;return!0},each:function(e){for(var i in this)i[0]===yc&&e(this[i],i.slice(1),this)}};function Xy(e,i){var r=new Jv;if(e instanceof Jv)e.each(function(g,_){r.set(_,g)});else if(Array.isArray(e)){var n=-1,o=e.length,u;if(i==null)for(;++n<o;)r.set(n,e[n]);else for(;++n<o;)r.set(i(u=e[n],n,e),u)}else if(e)for(var d in e)r.set(d,e[d]);return r}var zm=Xy;function T3(){var e=[],i=[],r,n,o;function u(g,_,E,M){if(_>=e.length)return r!=null&&g.sort(r),n!=null?n(g):g;for(var P=-1,D=g.length,Z=e[_++],Q,ue,ve=map(),Ne,it=E();++P<D;)(Ne=ve.get(Q=Z(ue=g[P])+""))?Ne.push(ue):ve.set(Q,[ue]);return ve.each(function(mt,bt){M(it,bt,u(mt,_,E,M))}),it}function d(g,_){if(++_>e.length)return g;var E,M=i[_-1];return n!=null&&_>=e.length?E=g.entries():(E=[],g.each(function(P,D){E.push({key:D,values:d(P,_)})})),M!=null?E.sort(function(P,D){return M(P.key,D.key)}):E}return o={object:function(g){return u(g,0,xC,bC)},map:function(g){return u(g,0,Yy,qy)},entries:function(g){return d(u(g,0,Yy,qy),0)},key:function(g){return e.push(g),o},sortKeys:function(g){return i[e.length-1]=g,o},sortValues:function(g){return r=g,o},rollup:function(g){return n=g,o}}}function xC(){return{}}function bC(e,i,r){e[i]=r}function Yy(){return map()}function qy(e,i,r){e.set(i,r)}function Qv(){}var Dp=zm.prototype;Qv.prototype=EC.prototype={constructor:Qv,has:Dp.has,add:function(e){return e+="",this[yc+e]=e,this},remove:Dp.remove,clear:Dp.clear,values:Dp.keys,size:Dp.size,empty:Dp.empty,each:Dp.each};function EC(e,i){var r=new Qv;if(e instanceof Qv)e.each(function(u){r.add(u)});else if(e){var n=-1,o=e.length;if(i==null)for(;++n<o;)r.add(e[n]);else for(;++n<o;)r.add(i(e[n],n,e))}return r}var M3=null,Ky=Array.prototype,em=Ky.map,Fp=Ky.slice;function Xh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function P3(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var $y={name:"implicit"};function tm(){var e=zm(),i=[],r=[],n=$y;function o(u){var d=u+"",g=e.get(d);if(!g){if(n!==$y)return n;e.set(d,g=i.push(u))}return r[(g-1)%r.length]}return o.domain=function(u){if(!arguments.length)return i.slice();i=[],e=zm();for(var d=-1,g=u.length,_,E;++d<g;)e.has(E=(_=u[d])+"")||e.set(E,i.push(_));return o},o.range=function(u){return arguments.length?(r=Fp.call(u),o):r.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.copy=function(){return tm(i,r).unknown(n)},Xh.apply(o,arguments),o}function Jy(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],o,u,d=!1,g=0,_=0,E=.5;delete e.unknown;function M(){var P=i().length,D=n[1]<n[0],Z=n[D-0],Q=n[1-D];o=(Q-Z)/Math.max(1,P-g+_*2),d&&(o=Math.floor(o)),Z+=(Q-Z-o*(P-g))*E,u=o*(1-g),d&&(Z=Math.round(Z),u=Math.round(u));var ue=sequence(P).map(function(ve){return Z+o*ve});return r(D?ue.reverse():ue)}return e.domain=function(P){return arguments.length?(i(P),M()):i()},e.range=function(P){return arguments.length?(n=[+P[0],+P[1]],M()):n.slice()},e.rangeRound=function(P){return n=[+P[0],+P[1]],d=!0,M()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(P){return arguments.length?(d=!!P,M()):d},e.padding=function(P){return arguments.length?(g=Math.min(1,_=+P),M()):g},e.paddingInner=function(P){return arguments.length?(g=Math.min(1,P),M()):g},e.paddingOuter=function(P){return arguments.length?(_=+P,M()):_},e.align=function(P){return arguments.length?(E=Math.max(0,Math.min(1,P)),M()):E},e.copy=function(){return Jy(i(),n).round(d).paddingInner(g).paddingOuter(_).align(E)},initRange.apply(M(),arguments)}function Qy(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Qy(i())},e}function I3(){return Qy(Jy.apply(null,arguments).paddingInner(1))}var SC=R(26257),wC=R(73626);function CC(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function AC(e){return function(){return e}}function Um(e){return+e}var e_=[0,1];function _c(e){return e}function Zm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:AC(isNaN(i)?NaN:.5)}function t_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(o){return Math.max(i,Math.min(r,o))}}function TC(e,i,r){var n=e[0],o=e[1],u=i[0],d=i[1];return o<n?(n=Zm(o,n),u=r(d,u)):(n=Zm(n,o),u=r(u,d)),function(g){return u(n(g))}}function MC(e,i,r){var n=Math.min(e.length,i.length)-1,o=new Array(n),u=new Array(n),d=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++d<n;)o[d]=Zm(e[d],e[d+1]),u[d]=r(i[d],i[d+1]);return function(g){var _=Kv(e,g,1,n)-1;return u[_](o[_](g))}}function rm(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function jm(){var e=e_,i=e_,r=SC.Z,n,o,u,d=_c,g,_,E;function M(){return g=Math.min(e.length,i.length)>2?MC:TC,_=E=null,P}function P(D){return isNaN(D=+D)?u:(_||(_=g(e.map(n),i,r)))(n(d(D)))}return P.invert=function(D){return d(o((E||(E=g(i,e.map(n),wC.Z)))(D)))},P.domain=function(D){return arguments.length?(e=em.call(D,Um),d===_c||(d=t_(e)),M()):e.slice()},P.range=function(D){return arguments.length?(i=Fp.call(D),M()):i.slice()},P.rangeRound=function(D){return i=Fp.call(D),r=CC,M()},P.clamp=function(D){return arguments.length?(d=D?t_(e):_c,P):d!==_c},P.interpolate=function(D){return arguments.length?(r=D,M()):r},P.unknown=function(D){return arguments.length?(u=D,P):u},function(D,Z){return n=D,o=Z,M()}}function r_(e,i){return jm()(e,i)}var PC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nm(e){if(!(i=PC.exec(e)))throw new Error("invalid format: "+e);var i;return new Vm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}nm.prototype=Vm.prototype;function Vm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Vm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function IC(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function im(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function xd(e){return e=im(Math.abs(e)),e?e[1]:NaN}function OC(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(xd(i)/3)))*3-xd(Math.abs(e)))}function RC(e,i){return function(r,n){for(var o=r.length,u=[],d=0,g=e[0],_=0;o>0&&g>0&&(_+g+1>n&&(g=Math.max(1,n-_)),u.push(r.substring(o-=g,o+g)),!((_+=g+1)>n));)g=e[d=(d+1)%e.length];return u.reverse().join(i)}}function LC(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function kC(e){e:for(var i=e.length,r=1,n=-1,o;r<i;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var n_;function DC(e,i){var r=im(e,i);if(!r)return e+"";var n=r[0],o=r[1],u=o-(n_=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=n.length;return u===d?n:u>d?n+new Array(u-d+1).join("0"):u>0?n.slice(0,u)+"."+n.slice(u):"0."+new Array(1-u).join("0")+im(e,Math.max(0,i+u-1))[0]}function i_(e,i){var r=im(e,i);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var a_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:IC,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return i_(e*100,i)},r:i_,s:DC,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function o_(e){return e}var s_=Array.prototype.map,u_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function FC(e){var i=e.grouping===void 0||e.thousands===void 0?o_:RC(s_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?o_:LC(s_.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",g=e.minus===void 0?"-":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function E(P){P=nm(P);var D=P.fill,Z=P.align,Q=P.sign,ue=P.symbol,ve=P.zero,Ne=P.width,it=P.comma,mt=P.precision,bt=P.trim,Vt=P.type;Vt==="n"?(it=!0,Vt="g"):a_[Vt]||(mt===void 0&&(mt=12),bt=!0,Vt="g"),(ve||D==="0"&&Z==="=")&&(ve=!0,D="0",Z="=");var Kt=ue==="$"?r:ue==="#"&&/[boxX]/.test(Vt)?"0"+Vt.toLowerCase():"",or=ue==="$"?n:/[%p]/.test(Vt)?d:"",br=a_[Vt],rn=/[defgprs%]/.test(Vt);mt=mt===void 0?6:/[gprs]/.test(Vt)?Math.max(1,Math.min(21,mt)):Math.max(0,Math.min(20,mt));function dn(Or){var In=Kt,Un=or,di,Fo,Ss;if(Vt==="c")Un=br(Or)+Un,Or="";else{Or=+Or;var ol=Or<0||1/Or<0;if(Or=isNaN(Or)?_:br(Math.abs(Or),mt),bt&&(Or=kC(Or)),ol&&+Or==0&&Q!=="+"&&(ol=!1),In=(ol?Q==="("?Q:g:Q==="-"||Q==="("?"":Q)+In,Un=(Vt==="s"?u_[8+n_/3]:"")+Un+(ol&&Q==="("?")":""),rn){for(di=-1,Fo=Or.length;++di<Fo;)if(Ss=Or.charCodeAt(di),48>Ss||Ss>57){Un=(Ss===46?o+Or.slice(di+1):Or.slice(di))+Un,Or=Or.slice(0,di);break}}}it&&!ve&&(Or=i(Or,Infinity));var xc=In.length+Or.length+Un.length,bl=xc<Ne?new Array(Ne-xc+1).join(D):"";switch(it&&ve&&(Or=i(bl+Or,bl.length?Ne-Un.length:Infinity),bl=""),Z){case"<":Or=In+Or+Un+bl;break;case"=":Or=In+bl+Or+Un;break;case"^":Or=bl.slice(0,xc=bl.length>>1)+In+Or+Un+bl.slice(xc);break;default:Or=bl+In+Or+Un;break}return u(Or)}return dn.toString=function(){return P+""},dn}function M(P,D){var Z=E((P=nm(P),P.type="f",P)),Q=Math.max(-8,Math.min(8,Math.floor(xd(D)/3)))*3,ue=Math.pow(10,-Q),ve=u_[8+Q/3];return function(Ne){return Z(ue*Ne)+ve}}return{format:E,formatPrefix:M}}var am,Gm,l_;NC({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function NC(e){return am=FC(e),Gm=am.format,l_=am.formatPrefix,am}function BC(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,xd(i)-xd(e))+1}function zC(e){return Math.max(0,-xd(Math.abs(e)))}function UC(e,i,r,n){var o=Bm(e,i,r),u;switch(n=nm(n==null?",f":n),n.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(u=OC(o,d))&&(n.precision=u),l_(n,d)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(u=BC(o,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=u-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(u=zC(o))&&(n.precision=u-(n.type==="%")*2);break}}return Gm(n)}function om(e){var i=e.domain;return e.ticks=function(r){var n=i();return Wy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var o=i();return UC(o[0],o[o.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),o=0,u=n.length-1,d=n[o],g=n[u],_;return g<d&&(_=d,d=g,g=_,_=o,o=u,u=_),_=$v(d,g,r),_>0?(d=Math.floor(d/_)*_,g=Math.ceil(g/_)*_,_=$v(d,g,r)):_<0&&(d=Math.ceil(d*_)/_,g=Math.floor(g*_)/_,_=$v(d,g,r)),_>0?(n[o]=Math.floor(d/_)*_,n[u]=Math.ceil(g/_)*_,i(n)):_<0&&(n[o]=Math.ceil(d*_)/_,n[u]=Math.floor(g*_)/_,i(n)),e},e}function c_(){var e=r_(_c,_c);return e.copy=function(){return rm(e,c_())},Xh.apply(e,arguments),om(e)}function f_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=em.call(n,Um),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return f_(e).unknown(i)},e=arguments.length?em.call(e,Um):[0,1],om(r)}function h_(e,i){e=e.slice();var r=0,n=e.length-1,o=e[r],u=e[n],d;return u<o&&(d=r,r=n,n=d,d=o,o=u,u=d),e[r]=i.floor(o),e[n]=i.ceil(u),e}function p_(e){return Math.log(e)}function d_(e){return Math.exp(e)}function ZC(e){return-Math.log(-e)}function jC(e){return-Math.exp(-e)}function VC(e){return isFinite(e)?+("1e"+e):e<0?0:e}function GC(e){return e===10?VC:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function HC(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function v_(e){return function(i){return-e(-i)}}function WC(e){var i=e(p_,d_),r=i.domain,n=10,o,u;function d(){return o=HC(n),u=GC(n),r()[0]<0?(o=v_(o),u=v_(u),e(ZC,jC)):e(p_,d_),i}return i.base=function(g){return arguments.length?(n=+g,d()):n},i.domain=function(g){return arguments.length?(r(g),d()):r()},i.ticks=function(g){var _=r(),E=_[0],M=_[_.length-1],P;(P=M<E)&&(D=E,E=M,M=D);var D=o(E),Z=o(M),Q,ue,ve,Ne=g==null?10:+g,it=[];if(!(n%1)&&Z-D<Ne){if(D=Math.round(D)-1,Z=Math.round(Z)+1,E>0){for(;D<Z;++D)for(ue=1,Q=u(D);ue<n;++ue)if(ve=Q*ue,!(ve<E)){if(ve>M)break;it.push(ve)}}else for(;D<Z;++D)for(ue=n-1,Q=u(D);ue>=1;--ue)if(ve=Q*ue,!(ve<E)){if(ve>M)break;it.push(ve)}}else it=Wy(D,Z,Math.min(Z-D,Ne)).map(u);return P?it.reverse():it},i.tickFormat=function(g,_){if(_==null&&(_=n===10?".0e":","),typeof _!="function"&&(_=Gm(_)),g===Infinity)return _;g==null&&(g=10);var E=Math.max(1,n*g/i.ticks().length);return function(M){var P=M/u(Math.round(o(M)));return P*n<n-.5&&(P*=n),P<=E?_(M):""}},i.nice=function(){return r(h_(r(),{floor:function(g){return u(Math.floor(o(g)))},ceil:function(g){return u(Math.ceil(o(g)))}}))},i}function m_(){var e=WC(jm()).domain([1,10]);return e.copy=function(){return rm(e,m_()).base(e.base())},Xh.apply(e,arguments),e}function g_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function y_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function XC(e){var i=1,r=e(g_(i),y_(i));return r.constant=function(n){return arguments.length?e(g_(i=+n),y_(i)):i},linearish(r)}function YC(){var e=XC(transformer());return e.copy=function(){return copy(e,YC()).constant(e.constant())},initRange.apply(e,arguments)}function __(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function qC(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function KC(e){return e<0?-e*e:e*e}function $C(e){var i=e(_c,_c),r=1;function n(){return r===1?e(_c,_c):r===.5?e(qC,KC):e(__(r),__(1/r))}return i.exponent=function(o){return arguments.length?(r=+o,n()):r},om(i)}function Hm(){var e=$C(jm());return e.copy=function(){return rm(e,Hm()).exponent(e.exponent())},Xh.apply(e,arguments),e}function O3(){return Hm.apply(null,arguments).exponent(.5)}function x_(){var e=[],i=[],r=[],n;function o(){var d=0,g=Math.max(1,i.length);for(r=new Array(g-1);++d<g;)r[d-1]=_C(e,d/g);return u}function u(d){return isNaN(d=+d)?n:i[Kv(r,d)]}return u.invertExtent=function(d){var g=i.indexOf(d);return g<0?[NaN,NaN]:[g>0?r[g-1]:e[0],g<r.length?r[g]:e[e.length-1]]},u.domain=function(d){if(!arguments.length)return e.slice();e=[];for(var g=0,_=d.length,E;g<_;++g)E=d[g],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(km),o()},u.range=function(d){return arguments.length?(i=Fp.call(d),o()):i.slice()},u.unknown=function(d){return arguments.length?(n=d,u):n},u.quantiles=function(){return r.slice()},u.copy=function(){return x_().domain(e).range(i).unknown(n)},Xh.apply(u,arguments)}function b_(){var e=0,i=1,r=1,n=[.5],o=[0,1],u;function d(_){return _<=_?o[Kv(n,_,0,r)]:u}function g(){var _=-1;for(n=new Array(r);++_<r;)n[_]=((_+1)*i-(_-r)*e)/(r+1);return d}return d.domain=function(_){return arguments.length?(e=+_[0],i=+_[1],g()):[e,i]},d.range=function(_){return arguments.length?(r=(o=Fp.call(_)).length-1,g()):o.slice()},d.invertExtent=function(_){var E=o.indexOf(_);return E<0?[NaN,NaN]:E<1?[e,n[0]]:E>=r?[n[r-1],i]:[n[E-1],n[E]]},d.unknown=function(_){return arguments.length&&(u=_),d},d.thresholds=function(){return n.slice()},d.copy=function(){return b_().domain([e,i]).range(o).unknown(u)},Xh.apply(om(d),arguments)}function E_(){var e=[.5],i=[0,1],r,n=1;function o(u){return u<=u?i[Kv(e,u,0,n)]:r}return o.domain=function(u){return arguments.length?(e=Fp.call(u),n=Math.min(e.length,i.length-1),o):e.slice()},o.range=function(u){return arguments.length?(i=Fp.call(u),n=Math.min(e.length,i.length-1),o):i.slice()},o.invertExtent=function(u){var d=i.indexOf(u);return[e[d-1],e[d]]},o.unknown=function(u){return arguments.length?(r=u,o):r},o.copy=function(){return E_().domain(e).range(i).unknown(r)},Xh.apply(o,arguments)}var Wm=new Date,Xm=new Date;function al(e,i,r,n){function o(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return o.floor=function(u){return e(u=new Date(+u)),u},o.ceil=function(u){return e(u=new Date(u-1)),i(u,1),e(u),u},o.round=function(u){var d=o(u),g=o.ceil(u);return u-d<g-u?d:g},o.offset=function(u,d){return i(u=new Date(+u),d==null?1:Math.floor(d)),u},o.range=function(u,d,g){var _=[],E;if(u=o.ceil(u),g=g==null?1:Math.floor(g),!(u<d)||!(g>0))return _;do _.push(E=new Date(+u)),i(u,g),e(u);while(E<u&&u<d);return _},o.filter=function(u){return al(function(d){if(d>=d)for(;e(d),!u(d);)d.setTime(d-1)},function(d,g){if(d>=d)if(g<0)for(;++g<=0;)for(;i(d,-1),!u(d););else for(;--g>=0;)for(;i(d,1),!u(d););})},r&&(o.count=function(u,d){return Wm.setTime(+u),Xm.setTime(+d),e(Wm),e(Xm),Math.floor(r(Wm,Xm))},o.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?o.filter(n?function(d){return n(d)%u==0}:function(d){return o.count(0,d)%u==0}):o}),o}var Ym=al(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ym.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:al(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var bd=Ym,R3=Ym.range,S_=al(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),JC=S_,L3=S_.range,sm=1e3,tv=6e4,w_=36e5,C_=864e5,A_=6048e5;function Np(e){return al(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*tv)/A_})}var qm=Np(0),um=Np(1),QC=Np(2),eA=Np(3),Ed=Np(4),tA=Np(5),rA=Np(6),k3=qm.range,D3=um.range,F3=QC.range,N3=eA.range,B3=Ed.range,z3=tA.range,U3=rA.range,T_=al(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*tv)/C_},function(e){return e.getDate()-1}),Km=T_,Z3=T_.range,M_=al(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sm-e.getMinutes()*tv)},function(e,i){e.setTime(+e+i*w_)},function(e,i){return(i-e)/w_},function(e){return e.getHours()}),nA=M_,j3=M_.range,P_=al(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sm)},function(e,i){e.setTime(+e+i*tv)},function(e,i){return(i-e)/tv},function(e){return e.getMinutes()}),iA=P_,V3=P_.range,I_=al(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*sm)},function(e,i){return(i-e)/sm},function(e){return e.getUTCSeconds()}),aA=I_,G3=I_.range,lm=al(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});lm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?al(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):lm};var oA=lm,H3=lm.range;function Bp(e){return al(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/A_})}var O_=Bp(0),cm=Bp(1),sA=Bp(2),uA=Bp(3),Sd=Bp(4),lA=Bp(5),cA=Bp(6),W3=O_.range,X3=cm.range,Y3=sA.range,q3=uA.range,K3=Sd.range,$3=lA.range,J3=cA.range,R_=al(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/C_},function(e){return e.getUTCDate()-1}),L_=R_,Q3=R_.range,$m=al(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});$m.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:al(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var rv=$m,eI=$m.range;function Jm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Qm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function nv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function fA(e){var i=e.dateTime,r=e.date,n=e.time,o=e.periods,u=e.days,d=e.shortDays,g=e.months,_=e.shortMonths,E=iv(o),M=av(o),P=iv(u),D=av(u),Z=iv(d),Q=av(d),ue=iv(g),ve=av(g),Ne=iv(_),it=av(_),mt={a:ol,A:xc,b:bl,B:UP,c:null,d:z_,e:z_,f:kA,g:GA,G:WA,H:OA,I:RA,j:LA,L:U_,m:DA,M:FA,p:ZP,q:jP,Q:W_,s:X_,S:NA,u:BA,U:zA,V:UA,w:ZA,W:jA,x:null,X:null,y:VA,Y:HA,Z:XA,"%":H_},bt={a:VP,A:GP,b:HP,B:WP,c:null,d:j_,e:j_,f:$A,g:sT,G:lT,H:YA,I:qA,j:KA,L:V_,m:JA,M:QA,p:XP,q:YP,Q:W_,s:X_,S:eT,u:tT,U:rT,V:nT,w:iT,W:aT,x:null,X:null,y:oT,Y:uT,Z:cT,"%":H_},Vt={a:dn,A:Or,b:In,B:Un,c:di,d:N_,e:N_,f:TA,g:F_,G:D_,H:B_,I:B_,j:SA,L:AA,m:EA,M:wA,p:rn,q:bA,Q:PA,s:IA,S:CA,u:mA,U:gA,V:yA,w:vA,W:_A,x:Fo,X:Ss,y:F_,Y:D_,Z:xA,"%":MA};mt.x=Kt(r,mt),mt.X=Kt(n,mt),mt.c=Kt(i,mt),bt.x=Kt(r,bt),bt.X=Kt(n,bt),bt.c=Kt(i,bt);function Kt(oi,Fa){return function(Qa){var yn=[],El=-1,Vo=0,Hl=oi.length,Wl,Zp,kx;for(Qa instanceof Date||(Qa=new Date(+Qa));++El<Hl;)oi.charCodeAt(El)===37&&(yn.push(oi.slice(Vo,El)),(Zp=k_[Wl=oi.charAt(++El)])!=null?Wl=oi.charAt(++El):Zp=Wl==="e"?" ":"0",(kx=Fa[Wl])&&(Wl=kx(Qa,Zp)),yn.push(Wl),Vo=El+1);return yn.push(oi.slice(Vo,El)),yn.join("")}}function or(oi,Fa){return function(Qa){var yn=nv(1900,void 0,1),El=br(yn,oi,Qa+="",0),Vo,Hl;if(El!=Qa.length)return null;if("Q"in yn)return new Date(yn.Q);if("s"in yn)return new Date(yn.s*1e3+("L"in yn?yn.L:0));if(Fa&&!("Z"in yn)&&(yn.Z=0),"p"in yn&&(yn.H=yn.H%12+yn.p*12),yn.m===void 0&&(yn.m="q"in yn?yn.q:0),"V"in yn){if(yn.V<1||yn.V>53)return null;"w"in yn||(yn.w=1),"Z"in yn?(Vo=Qm(nv(yn.y,0,1)),Hl=Vo.getUTCDay(),Vo=Hl>4||Hl===0?cm.ceil(Vo):cm(Vo),Vo=L_.offset(Vo,(yn.V-1)*7),yn.y=Vo.getUTCFullYear(),yn.m=Vo.getUTCMonth(),yn.d=Vo.getUTCDate()+(yn.w+6)%7):(Vo=Jm(nv(yn.y,0,1)),Hl=Vo.getDay(),Vo=Hl>4||Hl===0?um.ceil(Vo):um(Vo),Vo=Km.offset(Vo,(yn.V-1)*7),yn.y=Vo.getFullYear(),yn.m=Vo.getMonth(),yn.d=Vo.getDate()+(yn.w+6)%7)}else("W"in yn||"U"in yn)&&("w"in yn||(yn.w="u"in yn?yn.u%7:"W"in yn?1:0),Hl="Z"in yn?Qm(nv(yn.y,0,1)).getUTCDay():Jm(nv(yn.y,0,1)).getDay(),yn.m=0,yn.d="W"in yn?(yn.w+6)%7+yn.W*7-(Hl+5)%7:yn.w+yn.U*7-(Hl+6)%7);return"Z"in yn?(yn.H+=yn.Z/100|0,yn.M+=yn.Z%100,Qm(yn)):Jm(yn)}}function br(oi,Fa,Qa,yn){for(var El=0,Vo=Fa.length,Hl=Qa.length,Wl,Zp;El<Vo;){if(yn>=Hl)return-1;if(Wl=Fa.charCodeAt(El++),Wl===37){if(Wl=Fa.charAt(El++),Zp=Vt[Wl in k_?Fa.charAt(El++):Wl],!Zp||(yn=Zp(oi,Qa,yn))<0)return-1}else if(Wl!=Qa.charCodeAt(yn++))return-1}return yn}function rn(oi,Fa,Qa){var yn=E.exec(Fa.slice(Qa));return yn?(oi.p=M[yn[0].toLowerCase()],Qa+yn[0].length):-1}function dn(oi,Fa,Qa){var yn=Z.exec(Fa.slice(Qa));return yn?(oi.w=Q[yn[0].toLowerCase()],Qa+yn[0].length):-1}function Or(oi,Fa,Qa){var yn=P.exec(Fa.slice(Qa));return yn?(oi.w=D[yn[0].toLowerCase()],Qa+yn[0].length):-1}function In(oi,Fa,Qa){var yn=Ne.exec(Fa.slice(Qa));return yn?(oi.m=it[yn[0].toLowerCase()],Qa+yn[0].length):-1}function Un(oi,Fa,Qa){var yn=ue.exec(Fa.slice(Qa));return yn?(oi.m=ve[yn[0].toLowerCase()],Qa+yn[0].length):-1}function di(oi,Fa,Qa){return br(oi,i,Fa,Qa)}function Fo(oi,Fa,Qa){return br(oi,r,Fa,Qa)}function Ss(oi,Fa,Qa){return br(oi,n,Fa,Qa)}function ol(oi){return d[oi.getDay()]}function xc(oi){return u[oi.getDay()]}function bl(oi){return _[oi.getMonth()]}function UP(oi){return g[oi.getMonth()]}function ZP(oi){return o[+(oi.getHours()>=12)]}function jP(oi){return 1+~~(oi.getMonth()/3)}function VP(oi){return d[oi.getUTCDay()]}function GP(oi){return u[oi.getUTCDay()]}function HP(oi){return _[oi.getUTCMonth()]}function WP(oi){return g[oi.getUTCMonth()]}function XP(oi){return o[+(oi.getUTCHours()>=12)]}function YP(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var Fa=Kt(oi+="",mt);return Fa.toString=function(){return oi},Fa},parse:function(oi){var Fa=or(oi+="",!1);return Fa.toString=function(){return oi},Fa},utcFormat:function(oi){var Fa=Kt(oi+="",bt);return Fa.toString=function(){return oi},Fa},utcParse:function(oi){var Fa=or(oi+="",!0);return Fa.toString=function(){return oi},Fa}}}var k_={"-":"",_:" ","0":"0"},lu=/^\s*\d+/,hA=/^%/,pA=/[\\^$*+?|[\]().{}]/g;function Ja(e,i,r){var n=e<0?"-":"",o=(n?-e:e)+"",u=o.length;return n+(u<r?new Array(r-u+1).join(i)+o:o)}function dA(e){return e.replace(pA,"\\$&")}function iv(e){return new RegExp("^(?:"+e.map(dA).join("|")+")","i")}function av(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function vA(e,i,r){var n=lu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function mA(e,i,r){var n=lu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function gA(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function yA(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function _A(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function D_(e,i,r){var n=lu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function F_(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function xA(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function bA(e,i,r){var n=lu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function EA(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function N_(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function SA(e,i,r){var n=lu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function B_(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function wA(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function CA(e,i,r){var n=lu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function AA(e,i,r){var n=lu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function TA(e,i,r){var n=lu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function MA(e,i,r){var n=hA.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function PA(e,i,r){var n=lu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function IA(e,i,r){var n=lu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function z_(e,i){return Ja(e.getDate(),i,2)}function OA(e,i){return Ja(e.getHours(),i,2)}function RA(e,i){return Ja(e.getHours()%12||12,i,2)}function LA(e,i){return Ja(1+Km.count(bd(e),e),i,3)}function U_(e,i){return Ja(e.getMilliseconds(),i,3)}function kA(e,i){return U_(e,i)+"000"}function DA(e,i){return Ja(e.getMonth()+1,i,2)}function FA(e,i){return Ja(e.getMinutes(),i,2)}function NA(e,i){return Ja(e.getSeconds(),i,2)}function BA(e){var i=e.getDay();return i===0?7:i}function zA(e,i){return Ja(qm.count(bd(e)-1,e),i,2)}function Z_(e){var i=e.getDay();return i>=4||i===0?Ed(e):Ed.ceil(e)}function UA(e,i){return e=Z_(e),Ja(Ed.count(bd(e),e)+(bd(e).getDay()===4),i,2)}function ZA(e){return e.getDay()}function jA(e,i){return Ja(um.count(bd(e)-1,e),i,2)}function VA(e,i){return Ja(e.getFullYear()%100,i,2)}function GA(e,i){return e=Z_(e),Ja(e.getFullYear()%100,i,2)}function HA(e,i){return Ja(e.getFullYear()%1e4,i,4)}function WA(e,i){var r=e.getDay();return e=r>=4||r===0?Ed(e):Ed.ceil(e),Ja(e.getFullYear()%1e4,i,4)}function XA(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Ja(i/60|0,"0",2)+Ja(i%60,"0",2)}function j_(e,i){return Ja(e.getUTCDate(),i,2)}function YA(e,i){return Ja(e.getUTCHours(),i,2)}function qA(e,i){return Ja(e.getUTCHours()%12||12,i,2)}function KA(e,i){return Ja(1+L_.count(rv(e),e),i,3)}function V_(e,i){return Ja(e.getUTCMilliseconds(),i,3)}function $A(e,i){return V_(e,i)+"000"}function JA(e,i){return Ja(e.getUTCMonth()+1,i,2)}function QA(e,i){return Ja(e.getUTCMinutes(),i,2)}function eT(e,i){return Ja(e.getUTCSeconds(),i,2)}function tT(e){var i=e.getUTCDay();return i===0?7:i}function rT(e,i){return Ja(O_.count(rv(e)-1,e),i,2)}function G_(e){var i=e.getUTCDay();return i>=4||i===0?Sd(e):Sd.ceil(e)}function nT(e,i){return e=G_(e),Ja(Sd.count(rv(e),e)+(rv(e).getUTCDay()===4),i,2)}function iT(e){return e.getUTCDay()}function aT(e,i){return Ja(cm.count(rv(e)-1,e),i,2)}function oT(e,i){return Ja(e.getUTCFullYear()%100,i,2)}function sT(e,i){return e=G_(e),Ja(e.getUTCFullYear()%100,i,2)}function uT(e,i){return Ja(e.getUTCFullYear()%1e4,i,4)}function lT(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Sd(e):Sd.ceil(e),Ja(e.getUTCFullYear()%1e4,i,4)}function cT(){return"+0000"}function H_(){return"%"}function W_(e){return+e}function X_(e){return Math.floor(+e/1e3)}var wd,Y_,fT,hT,pT;dT({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function dT(e){return wd=fA(e),Y_=wd.format,fT=wd.parse,hT=wd.utcFormat,pT=wd.utcParse,wd}var ov=1e3,sv=ov*60,uv=sv*60,lv=uv*24,vT=lv*7,q_=lv*30,e0=lv*365;function mT(e){return new Date(e)}function gT(e){return e instanceof Date?+e:+new Date(+e)}function K_(e,i,r,n,o,u,d,g,_){var E=r_(_c,_c),M=E.invert,P=E.domain,D=_(".%L"),Z=_(":%S"),Q=_("%I:%M"),ue=_("%I %p"),ve=_("%a %d"),Ne=_("%b %d"),it=_("%B"),mt=_("%Y"),bt=[[d,1,ov],[d,5,5*ov],[d,15,15*ov],[d,30,30*ov],[u,1,sv],[u,5,5*sv],[u,15,15*sv],[u,30,30*sv],[o,1,uv],[o,3,3*uv],[o,6,6*uv],[o,12,12*uv],[n,1,lv],[n,2,2*lv],[r,1,vT],[i,1,q_],[i,3,3*q_],[e,1,e0]];function Vt(or){return(d(or)<or?D:u(or)<or?Z:o(or)<or?Q:n(or)<or?ue:i(or)<or?r(or)<or?ve:Ne:e(or)<or?it:mt)(or)}function Kt(or,br,rn,dn){if(or==null&&(or=10),typeof or=="number"){var Or=Math.abs(rn-br)/or,In=Vy(function(Un){return Un[2]}).right(bt,Or);In===bt.length?(dn=Bm(br/e0,rn/e0,or),or=e):In?(In=bt[Or/bt[In-1][2]<bt[In][2]/Or?In-1:In],dn=In[1],or=In[0]):(dn=Math.max(Bm(br,rn,or),1),or=g)}return dn==null?or:or.every(dn)}return E.invert=function(or){return new Date(M(or))},E.domain=function(or){return arguments.length?P(em.call(or,gT)):P().map(mT)},E.ticks=function(or,br){var rn=P(),dn=rn[0],Or=rn[rn.length-1],In=Or<dn,Un;return In&&(Un=dn,dn=Or,Or=Un),Un=Kt(or,dn,Or,br),Un=Un?Un.range(dn,Or+1):[],In?Un.reverse():Un},E.tickFormat=function(or,br){return br==null?Vt:_(br)},E.nice=function(or,br){var rn=P();return(or=Kt(or,rn[0],rn[rn.length-1],br))?P(h_(rn,or)):E},E.copy=function(){return rm(E,K_(e,i,r,n,o,u,d,g,_))},E}function yT(){return Xh.apply(K_(bd,JC,qm,Km,nA,iA,aA,oA,Y_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function tI(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function fm(){var e=0,i=1,r,n,o,u,d=identity,g=!1,_;function E(M){return isNaN(M=+M)?_:d(o===0?.5:(M=(u(M)-r)*o,g?Math.max(0,Math.min(1,M)):M))}return E.domain=function(M){return arguments.length?(r=u(e=+M[0]),n=u(i=+M[1]),o=r===n?0:1/(n-r),E):[e,i]},E.clamp=function(M){return arguments.length?(g=!!M,E):g},E.interpolator=function(M){return arguments.length?(d=M,E):d},E.unknown=function(M){return arguments.length?(_=M,E):_},function(M){return u=M,r=M(e),n=M(i),o=r===n?0:1/(n-r),E}}function hm(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function _T(){var e=linearish(fm()(identity));return e.copy=function(){return hm(e,_T())},initInterpolator.apply(e,arguments)}function xT(){var e=loggish(fm()).domain([1,10]);return e.copy=function(){return hm(e,xT()).base(e.base())},initInterpolator.apply(e,arguments)}function bT(){var e=symlogish(fm());return e.copy=function(){return hm(e,bT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function $_(){var e=powish(fm());return e.copy=function(){return hm(e,$_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function rI(){return $_.apply(null,arguments).exponent(.5)}function ET(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var o=0,u=n.length,d;o<u;++o)d=n[o],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return ET(i).domain(e)},initInterpolator.apply(r,arguments)}function pm(){var e=0,i=.5,r=1,n,o,u,d,g,_=identity,E,M=!1,P;function D(Z){return isNaN(Z=+Z)?P:(Z=.5+((Z=+E(Z))-o)*(Z<o?d:g),_(M?Math.max(0,Math.min(1,Z)):Z))}return D.domain=function(Z){return arguments.length?(n=E(e=+Z[0]),o=E(i=+Z[1]),u=E(r=+Z[2]),d=n===o?0:.5/(o-n),g=o===u?0:.5/(u-o),D):[e,i,r]},D.clamp=function(Z){return arguments.length?(M=!!Z,D):M},D.interpolator=function(Z){return arguments.length?(_=Z,D):_},D.unknown=function(Z){return arguments.length?(P=Z,D):P},function(Z){return E=Z,n=Z(e),o=Z(i),u=Z(r),d=n===o?0:.5/(o-n),g=o===u?0:.5/(u-o),D}}function ST(){var e=linearish(pm()(identity));return e.copy=function(){return copy(e,ST())},initInterpolator.apply(e,arguments)}function wT(){var e=loggish(pm()).domain([.1,1,10]);return e.copy=function(){return copy(e,wT()).base(e.base())},initInterpolator.apply(e,arguments)}function CT(){var e=symlogish(pm());return e.copy=function(){return copy(e,CT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function J_(){var e=powish(pm());return e.copy=function(){return copy(e,J_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function nI(){return J_.apply(null,arguments).exponent(.5)}var jc,Q_,e1,t1,t0,r1,AT=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,TT=(jc={},(0,I.Z)(jc,eu.LINEAR,c_),(0,I.Z)(jc,eu.POWER,Hm),(0,I.Z)(jc,eu.LOG,m_),(0,I.Z)(jc,eu.IDENTITY,f_),(0,I.Z)(jc,eu.TIME,yT),(0,I.Z)(jc,eu.QUANTILE,x_),(0,I.Z)(jc,eu.QUANTIZE,b_),(0,I.Z)(jc,eu.THRESHOLD,E_),(0,I.Z)(jc,eu.CAT,tm),jc),MT=(Q_=(0,Gr.b2)(),e1=(0,Gr.f3)(Ht.IGlobalConfigService),Q_(t1=(t0=function(){function e(){(0,pt.Z)(this,e),$t(this,"configService",r1,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,jt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),g=r.getSource().data.dataArray;g.length!==0&&o.caculateScalesForAttributes(d||[],g)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),g=r.getSource().data.dataArray;return o.caculateScalesForAttributes(d||[],g),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes();if(d){var g=r.getSource().data.dataArray;if(g.length===0)return;var _=d.filter(function(E){return E.needRescale});_.length&&o.caculateScalesForAttributes(_,g)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var o=this;this.scaleCache={},r.forEach(function(u){if(u.scale){var d=u.scale,g=u.name;d.names=o.parseFields(u.scale.field||[]);var _=[];d.names.forEach(function(E){_.push(o.getOrCreateScale(E,u,n))}),_.some(function(E){return E.type===Vh.VARIABLE})?(d.type=Vh.VARIABLE,_.forEach(function(E){if(!d.callback){var M;if(d.values&&d.values!=="text"){var P;if(((P=E.option)===null||P===void 0?void 0:P.type)==="linear"&&d.values.length>2){var D=E.scale.ticks(d.values.length);g==="color"&&E.scale.domain(D)}E.scale.range(d.values)}else((M=E.option)===null||M===void 0?void 0:M.type)==="cat"&&E.scale.range(E.option.domain)}})):(d.type=Vh.CONSTANT,d.defaultValues=_.map(function(E,M){return E.scale(d.names[M])})),d.scalers=_.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),u.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,o){var u,d=[r,n.name].join("_"),g=(u=n.scale)===null||u===void 0?void 0:u.values,_=this.createScale(r,n.name,g,o);return _}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Cn()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,o,u){var d,g,_=this.scaleOptions[n]&&((d=this.scaleOptions[n])===null||d===void 0?void 0:d.field)===r?this.scaleOptions[n]:this.scaleOptions[r],E={field:r,scale:void 0,type:Vh.VARIABLE,option:_};if(!u||!u.length)return _&&_.type?E.scale=this.createDefaultScale(_):(E.scale=tm([r]),E.type=Vh.CONSTANT),E;var M=(g=u.find(function(Z){return!Lu()(Z[r])}))===null||g===void 0?void 0:g[r];if(this.isNumber(r)||Lu()(M)&&!_)E.scale=tm([r]),E.type=Vh.CONSTANT;else{var P=_&&_.type||this.getDefaultType(M);o==="text"&&(P=eu.CAT);var D=this.createDefaultScaleConfig(P,r,u);Object.assign(D,_),E.scale=this.createDefaultScale(D),E.option=D}return E}},{key:"getDefaultType",value:function(r){var n=eu.LINEAR;return typeof r=="string"&&(n=AT.test(r)?eu.TIME:eu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,o){var u={type:r},d=(o==null?void 0:o.map(function(g){return g[n]}))||[];return r!==eu.CAT&&r!==eu.QUANTILE?u.domain=gC(d):r===eu.CAT?u.domain=Bd()(d):r===eu.QUANTILE&&(u.domain=d),u}},{key:"createDefaultScale",value:function(r){var n=r.type,o=r.domain,u=TT[n]();return o&&u.domain(o),u}}]),e}(),r1=hr(t0.prototype,"configService",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t0))||t1),n1,i1,a1,o1,dm,s1,u1;function l1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function PT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?l1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var IT=(n1=(0,Gr.b2)(),i1=(0,Gr.f3)(Ht.ICameraService),a1=(0,Gr.f3)(Ht.IRendererService),n1(o1=(dm=function(){function e(){(0,pt.Z)(this,e),$t(this,"cameraService",s1,this),$t(this,"rendererService",u1,this)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(PT({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),s1=hr(dm.prototype,"cameraService",[i1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=hr(dm.prototype,"rendererService",[a1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm))||o1),c1,f1,OT=(c1=(0,Gr.b2)(),c1(f1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||f1),h1,p1,RT=(h1=(0,Gr.b2)(),h1(p1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),o=n.autoFit,u=n.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(u)},100)})}}]),e}())||p1),d1,v1,LT=["type"];function m1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function cv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?m1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var g1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},kT={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},DT={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},FT={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},iI=null;function NT(e){var i={u_DirectionalLights:new Array(3).fill(cv({},DT)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(cv({},FT)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[kT]),e.forEach(function(r,n){var o=r.type,u=o===void 0?"directional":o,d=(0,Ul.Z)(r,LT),g=g1[u].lights,_=g1[u].num,E=i[_];i[g][E]=cv(cv({},i[g][E]),d),i[_]++}),i}var BT=(d1=(0,Gr.b2)(),d1(v1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),o=n.enableLighting;o&&r.models.forEach(function(u){return u.addUniforms(cv({},NT()))})})}}]),e}())||v1),y1,_1,vm={NONE:0,ENCODE:1,HIGHLIGHT:2},zT=(y1=(0,Gr.b2)(),y1(_1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r,n){var o=n.rendererService,u=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),g=d.enablePicking;u.registerStyleAttribute({name:"pickingColor",type:Ei.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:ae.FLOAT},size:3,update:function(E,M){var P=E.id;return g?fe(P):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),g=d.enablePicking;g&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:vm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),g=d.enablePicking;g&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:vm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(d){var g=r.getLayerConfig(),_=g.highlightColor,E=g.activeMix,M=E===void 0?0:E,P=typeof _=="string"?U(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:W(new Uint8Array(d))}),r.models.forEach(function(D){return D.addUniforms({u_PickingStage:vm.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:P.map(function(Z){return Z*255}),u_activeMix:M})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(d){var g=r.getLayerConfig(),_=g.selectColor,E=g.selectMix,M=E===void 0?0:E,P=typeof _=="string"?U(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:W(new Uint8Array(d))}),r.models.forEach(function(D){return D.addUniforms({u_PickingStage:vm.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:P.map(function(Z){return Z*255}),u_activeMix:M})})})}}]),e}())||_1),x1,b1,UT=(x1=(0,Gr.b2)(),x1(b1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(u)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Ei.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:ae.FLOAT},size:3,update:function(o,u,d){return d.length===2?[d[0],d[1],0]:[d[0],d[1],d[2]]}}}),r.registerStyleAttribute({name:"filter",type:Ei.Attribute,descriptor:{name:"filter",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,u){var d=o.filter;return d?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Ei.Attribute,descriptor:{name:"a_Color",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(o,u){var d=o.color;return!d||!d.length?[1,1,1,1]:d}}}),r.registerStyleAttribute({name:"vertexId",type:Ei.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,u,d,g){return[u]}}})}}]),e}())||b1),E1,S1,w1,C1,A1,T1,Cd,M1,P1,I1,O1,ZT=(E1=(0,Gr.b2)(),S1=(0,Gr.f3)(Ht.ICameraService),w1=(0,Gr.f3)(Ht.ICoordinateSystemService),C1=(0,Gr.f3)(Ht.IRendererService),A1=(0,Gr.f3)(Ht.IMapService),E1(T1=(Cd=function(){function e(){(0,pt.Z)(this,e),$t(this,"cameraService",M1,this),$t(this,"coordinateSystemService",P1,this),$t(this,"rendererService",I1,this),$t(this,"mapService",O1,this)}return(0,jt.Z)(e,[{key:"apply",value:function(r){var n=this,o=this.mapService.version,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),o==="GAODE2.x"&&(u=n.mapService.map.customCoords.getMVPMatrix(),d=n.mapService.getCustomCoordCenter());var g=n.rendererService.getViewportSize(),_=g.width,E=g.height;r.models.forEach(function(M){var P;M.addUniforms((P={},(0,I.Z)(P,Tp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(P,Tp.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(P,Tp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(P,Tp.Zoom,n.cameraService.getZoom()),(0,I.Z)(P,Tp.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(P,Tp.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(P,Tp.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(P,Me.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(P,Me.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(P,Me.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(P,Me.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(P,Me.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(P,Me.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(P,Me.Mvp,u),(0,I.Z)(P,"u_SceneCenterMKT",d),(0,I.Z)(P,"u_ViewportSize",[_,E]),(0,I.Z)(P,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(P,"u_DevicePixelRatio",ga.devicePixelRatio),(0,I.Z)(P,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(P,"u_shaderPick",Number(r.getShaderPickStat())),P))})})}}]),e}(),M1=hr(Cd.prototype,"cameraService",[S1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P1=hr(Cd.prototype,"coordinateSystemService",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I1=hr(Cd.prototype,"rendererService",[C1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O1=hr(Cd.prototype,"mapService",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||T1),R1,L1,jT=(R1=(0,Gr.b2)(),R1(L1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||L1),k1,D1,VT=(k1=(0,Gr.b2)(),k1(D1=function(){function e(){(0,pt.Z)(this,e)}return(0,jt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:u})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:u})})}},{key:"updateStyleAtrribute",value:function(r,n){var o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),g=o.getLayerStyleAttribute("shape");if(d&&d.needRegenerateVertices||g&&g.needRegenerateVertices){r.layerModelNeedUpdate=!0,u.forEach(function(_){return _.needRegenerateVertices=!1});return}u.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){o.updateAttributeByFeatureRange(_.name,r.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[];u.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){o.updateAttributeByFeatureRange(d.name,r.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}}]),e}())||D1);Gl.bind(Ht.ILayerPlugin).to(dC).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(UT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(MT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(pC).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(RT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(VT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(jT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(VE).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(ZT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(IT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(BT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(zT).inRequestScope(),Gl.bind(Ht.ILayerPlugin).to(OT).inRequestScope();var aI="2.6.23";function F1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function oI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?F1(Object(r),!0).forEach(function(n){GT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function GT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function sI(e,i){return YT(e)||XT(e,i)||WT(e,i)||HT()}function HT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WT(e,i){if(!!e){if(typeof e=="string")return N1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N1(e,i)}}function N1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function XT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function YT(e){if(Array.isArray(e))return e}var uI=null,lI=null,B1,r0,z1;function U1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Z1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?U1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qT=(B1=qd(Ht.IGlobalConfigService),r0=function(){function e(i){(0,pt.Z)(this,e),$t(this,"configService",z1,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,jt.Z)(e,[{key:"setContainer",value:function(r,n,o,u){r.bind(Ht.MapConfig).toConstantValue(Z1(Z1({},this.config),{},{id:n,canvas:o,hasBaseMap:u})),r.bind(Ht.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),z1=hr(r0.prototype,"configService",[B1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r0),KT=R(6158),fv=R.n(KT);function hv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mm(e,i){var r=nd([],i,e);return bu(r,r,1/r[3]),r}function cI(e,i){var r=e%i;return r<0?i+r:r}function fI(e,i,r){return r*i+(1-r)*e}function zp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Vc=Math.PI,j1=Vc/4,eh=Vc/180,V1=180/Vc,n0=512,i0=4003e4,$T=1.5;function G1(e){return Math.pow(2,e)}function JT(e){return Math.log2(e)}function gm(e,i){var r=(0,ie.Z)(e,2),n=r[0],o=r[1];zp(Number.isFinite(n)&&Number.isFinite(i)),zp(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),i*=n0;var u=n*eh,d=o*eh,g=i*(u+Vc)/(2*Vc),_=i*(Vc-Math.log(Math.tan(j1+d*.5)))/(2*Vc);return[g,_]}function a0(e,i){var r=(0,ie.Z)(e,2),n=r[0],o=r[1];i*=n0;var u=n/i*(2*Vc)-Vc,d=2*(Math.atan(Math.exp(Vc-o/i*(2*Vc)))-j1);return[u*V1,d*V1]}function hI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*eh);return JT(i0*r)-9}function H1(e){var i=e.latitude,r=e.longitude,n=e.zoom,o=e.scale,u=e.highPrecision,d=u===void 0?!1:u;o=o!==void 0?o:G1(n),zp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o));var g={},_=n0*o,E=Math.cos(i*eh),M=_/360,P=M/E,D=_/i0/E;if(g.pixelsPerMeter=[D,-D,D],g.metersPerPixel=[1/D,-1/D,1/D],g.pixelsPerDegree=[M,-P,D],g.degreesPerPixel=[1/M,-1/P,1/D],d){var Z=eh*Math.tan(i*eh)/E,Q=M*Z/2,ue=_/i0*Z,ve=ue/P*D;g.pixelsPerDegree2=[0,-Q,ue],g.pixelsPerMeter2=[ve,0,ve]}return g}function pI(e,i){var r=_slicedToArray(e,3),n=r[0],o=r[1],u=r[2],d=_slicedToArray(i,3),g=d[0],_=d[1],E=d[2],M=1,P=H1({longitude:n,latitude:o,scale:M,highPrecision:!0}),D=P.pixelsPerMeter,Z=P.pixelsPerMeter2,Q=gm(e,M);Q[0]+=g*(D[0]+Z[0]*_),Q[1]+=_*(D[1]+Z[1]*_);var ue=a0(Q,M),ve=(u||0)+(E||0);return Number.isFinite(u)||Number.isFinite(E)?[ue[0],ue[1],ve]:ue}function QT(e){var i=e.height,r=e.pitch,n=e.bearing,o=e.altitude,u=e.center,d=u===void 0?null:u,g=e.flipY,_=g===void 0?!1:g,E=hv();return xr(E,E,[0,0,-o]),Ar(E,E,[1,1,1/i]),Ut(E,E,-r*eh),Ur(E,E,n*eh),_&&Ar(E,E,[1,-1,1]),d&&xr(E,E,Xa.negate([],d)),E}function eM(e){var i=e.width,r=e.height,n=e.altitude,o=n===void 0?$T:n,u=e.pitch,d=u===void 0?0:u,g=e.nearZMultiplier,_=g===void 0?1:g,E=e.farZMultiplier,M=E===void 0?1:E,P=d*eh,D=Math.atan(.5/o),Z=Math.sin(D)*o/Math.sin(Math.PI/2-P-D),Q=Math.cos(Math.PI/2-P)*Z+o;return{fov:2*Math.atan(r/2/o),aspect:i/r,focalDistance:o,near:_,far:Q*M}}function tM(e){var i=e.width,r=e.height,n=e.pitch,o=e.altitude,u=e.nearZMultiplier,d=e.farZMultiplier,g=eM({width:i,height:r,altitude:o,pitch:n,nearZMultiplier:u,farZMultiplier:d}),_=g.fov,E=g.aspect,M=g.near,P=g.far,D=ci([],_,E,M,P);return D}function rM(e,i){var r=(0,ie.Z)(e,3),n=r[0],o=r[1],u=r[2],d=u===void 0?0:u;return zp(Number.isFinite(n)&&Number.isFinite(o)&&Number.isFinite(d)),mm(i,[n,o,d,1])}function W1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,ie.Z)(e,3),o=n[0],u=n[1],d=n[2];if(zp(Number.isFinite(o)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(d)){var g=mm(i,[o,u,d,1]);return g}var _=mm(i,[o,u,0,1]),E=mm(i,[o,u,1,1]),M=_[2],P=E[2],D=M===P?0:((r||0)-M)/(P-M);return Bi.t7([],_,E,D)}var X1=hv(),nM=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,o=i.viewMatrix,u=o===void 0?X1:o,d=i.projectionMatrix,g=d===void 0?X1:d;(0,pt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=g;var _=hv();Dr(_,_,this.projectionMatrix),Dr(_,_,this.viewMatrix),this.viewProjectionMatrix=_;var E=hv();Ar(E,E,[this.width/2,-this.height/2,1]),xr(E,E,[1,-1,0]),Dr(E,E,this.viewProjectionMatrix);var M=Sr(hv(),E);if(!M)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=M,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,jt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ea(r.projectionMatrix,this.projectionMatrix)&&ea(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,u=o===void 0?!0:o,d=this.projectPosition(r),g=rM(d,this.pixelProjectionMatrix),_=(0,ie.Z)(g,2),E=_[0],M=_[1],P=u?M:this.height-M;return r.length===2?[E,P]:[E,P,g[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,u=o===void 0?!0:o,d=n.targetZ,g=(0,ie.Z)(r,3),_=g[0],E=g[1],M=g[2],P=u?E:this.height-E,D=d&&d*this.pixelsPerMeter,Z=W1([_,P,M],this.pixelUnprojectionMatrix,D),Q=this.unprojectPosition(Z),ue=(0,ie.Z)(Q,3),ve=ue[0],Ne=ue[1],it=ue[2];return Number.isFinite(M)?[ve,Ne,it]:Number.isFinite(d)?[ve,Ne,d]:[ve,Ne]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),o=(0,ie.Z)(n,2),u=o[0],d=o[1],g=(r[2]||0)*this.pixelsPerMeter;return[u,d,g]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),o=(0,ie.Z)(n,2),u=o[0],d=o[1],g=(r[2]||0)/this.pixelsPerMeter;return[u,d,g]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function iM(e){var i=e.width,r=e.height,n=e.bounds,o=e.minExtent,u=o===void 0?0:o,d=e.maxZoom,g=d===void 0?24:d,_=e.padding,E=_===void 0?0:_,M=e.offset,P=M===void 0?[0,0]:M,D=(0,ie.Z)(n,2),Z=(0,ie.Z)(D[0],2),Q=Z[0],ue=Z[1],ve=(0,ie.Z)(D[1],2),Ne=ve[0],it=ve[1];if(Number.isFinite(E)){var mt=E;E={top:mt,bottom:mt,left:mt,right:mt}}else zp(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var bt=new Y1({width:i,height:r,longitude:0,latitude:0,zoom:0}),Vt=bt.project([Q,it]),Kt=bt.project([Ne,ue]),or=[Math.max(Math.abs(Kt[0]-Vt[0]),u),Math.max(Math.abs(Kt[1]-Vt[1]),u)],br=[i-E.left-E.right-Math.abs(P[0])*2,r-E.top-E.bottom-Math.abs(P[1])*2];zp(br[0]>0&&br[1]>0);var rn=br[0]/or[0],dn=br[1]/or[1],Or=(E.right-E.left)/2/rn,In=(E.bottom-E.top)/2/dn,Un=[(Kt[0]+Vt[0])/2+Or,(Kt[1]+Vt[1])/2+In],di=bt.unproject(Un),Fo=bt.zoom+Math.log2(Math.abs(Math.min(rn,dn)));return{longitude:di[0],latitude:di[1],zoom:Math.min(Fo,g)}}var Y1=function(e){(0,En.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.width,u=n.height,d=n.latitude,g=d===void 0?0:d,_=n.longitude,E=_===void 0?0:_,M=n.zoom,P=M===void 0?0:M,D=n.pitch,Z=D===void 0?0:D,Q=n.bearing,ue=Q===void 0?0:Q,ve=n.altitude,Ne=ve===void 0?1.5:ve,it=n.nearZMultiplier,mt=n.farZMultiplier;(0,pt.Z)(this,i),o=o||1,u=u||1;var bt=G1(P);Ne=Math.max(.75,Ne);var Vt=gm([E,g],bt);Vt[2]=0;var Kt=tM({width:o,height:u,pitch:Z,bearing:ue,altitude:Ne,nearZMultiplier:it||1/u,farZMultiplier:mt||1.01}),or=QT({height:u,center:Vt,pitch:Z,bearing:ue,altitude:Ne,flipY:!0});return r=(0,vn.Z)(this,(0,Qt.Z)(i).call(this,{width:o,height:u,viewMatrix:or,projectionMatrix:Kt})),r.latitude=g,r.longitude=E,r.zoom=P,r.pitch=Z,r.bearing=ue,r.altitude=Ne,r.scale=bt,r.center=Vt,r.pixelsPerMeter=H1((0,be.Z)((0,be.Z)(r))).pixelsPerMeter[2],Object.freeze((0,be.Z)((0,be.Z)(r))),r}return(0,jt.Z)(i,[{key:"projectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return gm(n,o)}},{key:"unprojectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a0(n,o)}},{key:"getMapCenterByLngLatPosition",value:function(n){var o=n.lngLat,u=n.pos,d=W1(u,this.pixelUnprojectionMatrix),g=gm(o,this.scale),_=Bi.IH([],g,Bi.tk([],d)),E=Bi.IH([],this.center,_);return a0(E,this.scale)}},{key:"getLocationAtPoint",value:function(n){var o=n.lngLat,u=n.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:u})}},{key:"fitBounds",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,d=this.height,g=iM(Object.assign({width:u,height:d,bounds:n},o)),_=g.longitude,E=g.latitude,M=g.zoom;return new i({width:u,height:d,longitude:_,latitude:E,zoom:M})}}]),i}(nM),aM=function(){function e(){(0,pt.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,jt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,o=r.zoom,u=r.pitch,d=r.bearing,g=r.viewportHeight,_=r.viewportWidth;this.viewport=new Y1({width:_,height:g,longitude:n&&n[0],latitude:n&&n[1],zoom:o,pitch:u,bearing:d})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),q1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},oM=["id","attributionControl","style","token","rotation","mapInstance"],K1,$1,J1,Q1,ex,tx,Ad,rx,nx,ix,ax;function ox(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function sM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ox(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ox(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var d=i.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(i.createTextNode(e)),o.appendChild(d),d}}uM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=fv();var sx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},lM=0,cM=12,ux="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",fM=(K1=(0,Gr.b2)(),$1=(0,Gr.f3)(Ht.MapConfig),J1=(0,Gr.f3)(Ht.IGlobalConfigService),Q1=(0,Gr.f3)(Ht.ICoordinateSystemService),ex=(0,Gr.f3)(Ht.IEventEmitter),K1(tx=(Ad=function(){function e(){var i=this;(0,pt.Z)(this,e),(0,I.Z)(this,"version",kp.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"dragging",!1),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),$t(this,"config",rx,this),$t(this,"configService",nx,this),$t(this,"coordinateSystemService",ix,this),$t(this,"eventEmitter",ax,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,o=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var u=i.config.offsetZoom,d=u===void 0?cM:u;i.viewport.getZoom()>d?i.coordinateSystemService.setCoordinateSystem(oe.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(oe.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,jt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=pa("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){eE.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(sx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(sx[r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),u=o.x,d=o.y;return[u-n.x,d-n.y]}},{key:"lngLatToMercator",value:function(r,n){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),u=o.x,d=u===void 0?0:u,g=o.y,_=g===void 0?0:g,E=o.z,M=E===void 0?0:E;return{x:d,y:_,z:M}}},{key:"getModelMatrix",value:function(r,n,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},g=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),_=g.meterInMercatorCoordinateUnits(),E=Fe();return xr(E,E,Xa.fromValues(g.x-d.x,g.y-d.y,g.z||0-d.z)),Ar(E,E,Xa.fromValues(_*u[0],-_*u[1],_*u[2])),Ut(E,E,o[0]),wr(E,E,o[1]),Ur(E,E,o[2]),E}},{key:"init",value:function(){var i=(0,bi.Z)(ti().mark(function n(){var o=this,u,d,g,_,E,M,P,D,Z,Q,ue,ve,Ne;return ti().wrap(function(mt){for(;;)switch(mt.prev=mt.next){case 0:u=this.config,d=u.id,g=d===void 0?"map":d,_=u.attributionControl,E=_===void 0?!1:_,M=u.style,P=M===void 0?"light":M,D=u.token,Z=D===void 0?ux:D,Q=u.rotation,ue=Q===void 0?0:Q,ve=u.mapInstance,Ne=(0,Ul.Z)(u,oM),this.viewport=new aM,!ve&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),Z===ux&&P!=="blank"&&!window.mapboxgl.accessToken&&!ve&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ve&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=Z),ve?(this.map=ve,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(g),this.map=new window.mapboxgl.Map(sM({container:this.$mapContainer,style:this.getMapStyle(P),attributionControl:E,bearing:ue},Ne))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return mt.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(n=this.eventEmitter).emit.apply(n,[r].concat(u))}},{key:"once",value:function(r){for(var n,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(n=this.eventEmitter).once.apply(n,[r].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var o=new(fv()).LngLat(r[0],r[1]),u=new(fv()).LngLat(n[0],n[1]),d=o.distanceTo(u),g=fv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),_=fv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),E=g.x,M=g.y,P=_.x,D=_.y,Z=Math.sqrt(Math.pow(E-P,2)+Math.pow(M-D,2))*4194304*2;return Z/d}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),o=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+lM++,n.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:q1[r]?q1[r]:r}}]),e}(),rx=hr(Ad.prototype,"config",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=hr(Ad.prototype,"configService",[J1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=hr(Ad.prototype,"coordinateSystemService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=hr(Ad.prototype,"eventEmitter",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad))||tx);function hM(e){var i=pM();return function(){var n=(0,Qt.Z)(e),o;if(i){var u=(0,Qt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,vn.Z)(this,o)}}function pM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var d=i.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(i.createTextNode(e)),o.appendChild(d),d}}dM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var vM=function(e){(0,En.Z)(r,e);var i=hM(r);function r(){return(0,pt.Z)(this,r),i.apply(this,arguments)}return(0,jt.Z)(r,[{key:"getServiceConstructor",value:function(){return fM}}]),r}(qT);function lx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function cx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lx(Object(r),!0).forEach(function(n){mM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function gM(e,i){return bM(e)||xM(e,i)||_M(e,i)||yM()}function yM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _M(e,i){if(!!e){if(typeof e=="string")return fx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fx(e,i)}}function fx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function xM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function bM(e){if(Array.isArray(e))return e}var EM=we.memo(function(e){var i=e.style,r=e.className,n=e.map,o=e.option,u=e.onSceneLoaded,d=(0,we.createRef)(),g=(0,we.useState)(),_=gM(g,2),E=_[0],M=_[1];return(0,we.useEffect)(function(){var P=new UE(cx(cx({id:d.current},o),{},{map:new vM(n)}));return P.on("loaded",function(){M(P),u&&u(P)}),function(){P.destroy()}},[]),(0,we.useEffect)(function(){E&&n.style&&E.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,we.useEffect)(function(){E&&n.zoom&&E.setZoom(n.zoom)},[n.zoom]),(0,we.useEffect)(function(){E&&n.center&&E.setCenter(n.center)},[JSON.stringify(n.center)]),(0,we.useEffect)(function(){E&&n.pitch!==void 0&&E.setPitch(n.pitch||0)},[n.pitch]),(0,we.useEffect)(function(){E&&n.rotation&&E.setRotation(n.rotation)},[n.rotation]),we.createElement(Cr.Provider,{value:E},(0,we.createElement)("div",{ref:d,style:i,className:r},E&&e.children))}),SM=EM;function hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function dI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hx(Object(r),!0).forEach(function(n){wM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function vI(e,i){return MM(e)||TM(e,i)||AM(e,i)||CM()}function CM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AM(e,i){if(!!e){if(typeof e=="string")return px(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return px(e,i)}}function px(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function TM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function MM(e){if(Array.isArray(e))return e}var mI=null,gI=null;function dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function yI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dx(Object(r),!0).forEach(function(n){PM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function _I(e,i){return LM(e)||RM(e,i)||OM(e,i)||IM()}function IM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OM(e,i){if(!!e){if(typeof e=="string")return vx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vx(e,i)}}function vx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function RM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function LM(e){if(Array.isArray(e))return e}var xI=null,bI=null;function EI(e,i){return NM(e)||FM(e,i)||DM(e,i)||kM()}function kM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DM(e,i){if(!!e){if(typeof e=="string")return mx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mx(e,i)}}function mx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function FM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function NM(e){if(Array.isArray(e))return e}var SI=null,wI=null;function gx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function CI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gx(Object(r),!0).forEach(function(n){BM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function AI(e,i){if(e==null)return{};var r=zM(e,i),n,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function zM(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,u;for(u=0;u<n.length;u++)o=n[u],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var TI=null,yx=R(73935);function _x(e,i){return VM(e)||jM(e,i)||ZM(e,i)||UM()}function UM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZM(e,i){if(!!e){if(typeof e=="string")return xx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xx(e,i)}}function xx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function jM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function VM(e){if(Array.isArray(e))return e}var bx=we.useEffect,Ex=we.useState,GM=/\B([A-Z])/g,HM=function(i){return i.replace(GM,"-$1").toLowerCase()};function MI(e){var i=e.className,r=e.style,n=e.children,o=e.position,u=Ex(),d=_x(u,2),g=d[0],_=d[1],E=useSceneValue(),M=Ex(function(){return document.createElement("div")}),P=_x(M,1),D=P[0];return bx(function(){var Z=new Control({position:o});return Z.onAdd=function(){if(i&&(D.className=i),r){var Q=Object.keys(r).map(function(ue){return"".concat(HM(ue),":").concat(r[ue])}).join(";");D.style.cssText=Q}return D},Z.onRemove=function(){},_(Z),E.addControl(Z),function(){E.removeControl(Z)}},[]),bx(function(){g&&g.setPosition(o||"bottomleft")},[o]),createPortal(n,D)}var Sx=(0,we.createContext)({});function PI(){return useContext(Sx)}var Tf=R(96486),II=we.useEffect,WM=we.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Tf.isEqual),OI=we.useEffect,XM=we.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Tf.isEqual),RI=we.useEffect,YM=we.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Tf.isEqual),qM=we.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Tf.isEqual),KM=we.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Tf.isEqual),LI=we.useEffect,$M=we.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Tf.isEqual),JM=we.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Tf.isEqual),QM=we.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Tf.isEqual),eP=["data"];function tP(e,i){if(e==null)return{};var r=rP(e,i),n,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function rP(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,u;for(u=0;u<n.length;u++)o=n[u],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var nP=we.memo(function(i){var r=i.layer,n=i.source,o=n.data,u=tP(n,eP);return r.inited?r.setData(o,u):r.source(o,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},Tf.isEqual),kI=we.useEffect,iP=we.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Tf.isEqual);function aP(e,i){return lP(e)||uP(e,i)||sP(e,i)||oP()}function oP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sP(e,i){if(!!e){if(typeof e=="string")return Cx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cx(e,i)}}function Cx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function uP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,d,g;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(n.push(d.value),!(i&&n.length===i));o=!0);}catch(_){u=!0,g=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw g}}return n}}function lP(e){if(Array.isArray(e))return e}var pv=we.useEffect,cP=we.useState;function Ax(e,i){var r=i.source,n=i.color,o=i.shape,u=i.style,d=i.size,g=i.scale,_=i.active,E=i.select,M=i.filter,P=i.animate,D=i.options,Z=i.onLayerLoaded,Q=Hn(),ue=cP(function(){var it;switch(e){case"polygonLayer":it=new Iy(D);break;case"lineLayer":it=new HS(D);break;case"pointLayer":it=new Bw(D);break;case"heatmapLayer":it=new rS(D);break;case"rasterLayer":it=new fC(D);break;case"imageLayer":it=new hS(D);break;case"citybuildingLayer":it=new T2(D);break;default:it=new Iy(D)}return it.on("inited",function(){Z&&Z(it,Q)}),it}),ve=aP(ue,1),Ne=ve[0];return pv(function(){return Q.addLayer(Ne),function(){Q.removeLayer(Ne)}},[]),pv(function(){Ne.inited&&D&&Ne.updateLayerConfig(D)},[D==null?void 0:D.minZoom,D==null?void 0:D.maxZoom,D==null?void 0:D.visible]),pv(function(){Ne.inited&&(D==null?void 0:D.zIndex)&&Ne.setIndex(D.zIndex)},[D==null?void 0:D.zIndex]),pv(function(){Ne.inited&&(D==null?void 0:D.blend)&&Ne.setBlend(D.blend)},[D==null?void 0:D.blend]),pv(function(){Q.render()}),we.createElement(Sx.Provider,{value:Ne},we.createElement(nP,{layer:Ne,source:r}),g&&we.createElement(KM,{layer:Ne,scale:g}),n&&we.createElement(YM,{layer:Ne,color:n}),d&&we.createElement(QM,{layer:Ne,size:d}),o&&we.createElement(JM,{layer:Ne,shape:o}),u&&we.createElement(iP,{layer:Ne,style:u}),_&&we.createElement(WM,{layer:Ne,active:_}),E&&we.createElement($M,{layer:Ne,select:E}),M&&we.createElement(qM,{layer:Ne,filter:M}),P&&we.createElement(XM,{layer:Ne,animate:P}),i.children)}var DI=null,FI=null,Tx=we.memo(function(i){return Ax("pointLayer",i)}),fP=we.memo(function(i){return Ax("heatmapLayer",i)}),NI=null,BI=null,zI=null,UI=we.useEffect,ZI=null,jI=null;function ym(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ym=function(r){return typeof r}:ym=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ym(e)}function Mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function _m(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mx(Object(r),!0).forEach(function(n){hP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function pP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Px(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dP(e,i,r){return i&&Px(e.prototype,i),r&&Px(e,r),e}function vP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&o0(e,i)}function o0(e,i){return o0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},o0(e,i)}function mP(e){var i=_P();return function(){var n=xm(e),o;if(i){var u=xm(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return gP(this,o)}}function gP(e,i){if(i&&(ym(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yP(e)}function yP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xm(e){return xm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},xm(e)}var VI=function(e){vP(r,e);var i=mP(r);function r(n){var o;return pP(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return dP(r,[{key:"componentDidMount",value:function(){var o,u=this.props,d=u.lnglat,g=u.children,_=u.option,E=u.lngLat,M=new gg(_m(_m({},_),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));d&&M.setLnglat(d),E&&M.setLnglat(E),g&&M.setDOMContent(this.el),this.popup=M,this.scene.addPopup(M)}},{key:"componentDidUpdate",value:function(o){var u,d,g,_,E,M,P=Array.isArray(o.lnglat)?o.lnglat:[o==null||(u=o.lnglat)===null||u===void 0?void 0:u.lng,o==null||(d=o.lnglat)===null||d===void 0?void 0:d.lat],D=Array.isArray(this.props.lnglat)?this.props.lnglat:[(g=this.props)===null||g===void 0||(_=g.lnglat)===null||_===void 0?void 0:_.lng,(E=this.props)===null||E===void 0||(M=E.lnglat)===null||M===void 0?void 0:M.lat],Z=P.toString()!==D.toString();if(Z){var Q;this.popup.remove(),this.popup=new gg(_m(_m({},this.props.option),{},{stopPropagation:(Q=this.props.option)===null||Q===void 0?void 0:Q.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return we.createElement(Cr.Consumer,{},function(u){return u&&(o.scene=u),(0,yx.createPortal)(o.props.children,o.el)})}}]),r}(we.PureComponent);function bm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bm=function(r){return typeof r}:bm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},bm(e)}function xP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ix(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bP(e,i,r){return i&&Ix(e.prototype,i),r&&Ix(e,r),e}function EP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&s0(e,i)}function s0(e,i){return s0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},s0(e,i)}function SP(e){var i=AP();return function(){var n=Em(e),o;if(i){var u=Em(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return wP(this,o)}}function wP(e,i){if(i&&(bm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CP(e)}function CP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function AP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Em(e){return Em=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Em(e)}var GI=function(e){EP(r,e);var i=SP(r);function r(n){var o;return xP(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return bP(r,[{key:"componentDidMount",value:function(){var o=this.props,u=o.lnglat,d=o.children,g=o.option,_=o.onMarkerLoaded,E=new hg(g);u&&E.setLnglat(u),d&&E.setElement(this.el),this.marker=E,_&&_(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(o){var u,d=(o==null?void 0:o.lnglat.toString())!==((u=this.props)===null||u===void 0?void 0:u.lnglat.toString());d&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return we.createElement(Cr.Consumer,{},function(u){return u&&(o.scene=u),(0,yx.createPortal)(o.props.children,o.el)})}}]),r}(we.PureComponent),HI=we.useEffect,WI=null,XI=null,YI=we.useEffect,qI=null,TP=R(83832),fi=R(85893),MP=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],PP=function(e){(0,At.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ye.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),n.state={data:null,grid:null,loading:!1},n}return(0,ke.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,Te.Z)(qt().mark(function u(){var d,g,_,E;return qt().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(D){return D.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(D){return D.json()})]);case 2:d=P.sent,g=(0,Hr.Z)(d,2),_=g[0],E=g[1],this.setState({data:_,grid:E,loading:!0});case 7:case"end":return P.stop()}},u,this)}));function o(){return n.apply(this,arguments)}return o}()},{key:"render",value:function(){var o=this.state,u=o.data,d=o.grid,g=o.loading;return g===!1?(0,fi.jsx)(TP.Z,{}):(0,fi.jsxs)(SM,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[d&&(0,fi.jsx)(fP,{source:{data:d,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),u&&[(0,fi.jsx)(Tx,{options:{autoFit:!0},source:{data:u},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:MP},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,fi.jsx)(Tx,{source:{data:u},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(E){return E>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(we.Component),Ox=R(86582),IP=R(93343),OP=R(70499),Up=R.n(OP);function RP(e){return e*1<10?"0".concat(e):e}function Rx(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(RP(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var LP=function(e){(0,At.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ye.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return n=i.call.apply(i,[this].concat(u)),n.state={activeData:Rx()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:Rx()},function(){n.loopData()})},1e3)})},n}return(0,ke.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var o=this.state.activeData,u=o===void 0?[]:o;return(0,fi.jsxs)("div",{className:Up().activeChart,children:[(0,fi.jsx)(ne.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,fi.jsx)("div",{style:{marginTop:32},children:(0,fi.jsx)(IP.Z,{autoFit:!0,data:u.map(function(d){return d.y}),height:84})}),u&&(0,fi.jsxs)("div",{children:[(0,fi.jsxs)("div",{className:Up().activeChartGrid,children:[(0,fi.jsxs)("p",{children:[(0,Ox.Z)(u).sort()[u.length-1].y+200," \u4EBF\u5143"]}),(0,fi.jsxs)("p",{children:[(0,Ox.Z)(u).sort()[Math.floor(u.length/2)].y," \u4EBF\u5143"]})]}),(0,fi.jsx)("div",{className:Up().dashedLine,children:(0,fi.jsx)("div",{className:Up().line})}),(0,fi.jsx)("div",{className:Up().dashedLine,children:(0,fi.jsx)("div",{className:Up().line})})]}),u&&(0,fi.jsxs)("div",{className:Up().activeChartLegend,children:[(0,fi.jsx)("span",{children:"00:00"}),(0,fi.jsx)("span",{children:u[Math.floor(u.length/2)].x}),(0,fi.jsx)("span",{children:u[u.length-1].x})]})]})}}]),r}(we.Component);function kP(){return u0.apply(this,arguments)}function u0(){return u0=(0,Te.Z)(qt().mark(function e(){return qt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,je.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),u0.apply(this,arguments)}var DP=R(19134),Lx=R.n(DP),FP=ne.Z.Countdown,NP=Date.now()+1e3*60*60*24*2+1e3*30,BP=function(){var i=(0,je.QT)(kP),r=i.loading,n=i.data,o=(n==null?void 0:n.list)||[];return(0,fi.jsx)(Rt.Z,{children:(0,fi.jsxs)(fi.Fragment,{children:[(0,fi.jsxs)(F.Z,{gutter:24,children:[(0,fi.jsx)(re.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,fi.jsxs)(v.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,fi.jsxs)(F.Z,{children:[(0,fi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,fi.jsx)(ne.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Rr()(124543233).format("0,0")})}),(0,fi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,fi.jsx)(ne.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,fi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,fi.jsx)(FP,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:NP,format:"HH:mm:ss:SSS"})}),(0,fi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,fi.jsx)(ne.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Rr()(234).format("0,0")})})]}),(0,fi.jsx)("div",{className:Lx().mapChart,children:(0,fi.jsx)(PP,{})})]})}),(0,fi.jsxs)(re.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,fi.jsx)(v.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,fi.jsx)(LP,{})}),(0,fi.jsx)(v.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,fi.jsx)(ut,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(d){return Number(d)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,fi.jsxs)(F.Z,{gutter:24,children:[(0,fi.jsx)(re.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,fi.jsx)(v.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Lx().pieCard,children:(0,fi.jsxs)(F.Z,{style:{padding:"16px 0"},children:[(0,fi.jsx)(re.Z,{span:8,children:(0,fi.jsx)($e.Z,{autoFit:!0,height:128,percent:.28})}),(0,fi.jsx)(re.Z,{span:8,children:(0,fi.jsx)($e.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,fi.jsx)(re.Z,{span:8,children:(0,fi.jsx)($e.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,fi.jsx)(re.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,fi.jsx)(v.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,fi.jsx)(Yt,{data:o,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,fi.jsx)(re.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,fi.jsx)(v.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,fi.jsx)(ht,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},zP=BP},9187:function(Ue){"use strict";Ue.exports=H,Ue.exports.default=H;function H(Te,Ye,ke){ke=ke||2;var At=Ye&&Ye.length,gt=At?Ye[0]*ke:Te.length,Ft=R(Te,0,gt,ke,!0),qt=[];if(!Ft||Ft.next===Ft.prev)return qt;var Cr,Hn,hn,Ki,Bn,Gn,hi;if(At&&(Ft=re(Te,Ye,Ft,ke)),Te.length>80*ke){Cr=hn=Te[0],Hn=Ki=Te[1];for(var Wn=ke;Wn<gt;Wn+=ke)Bn=Te[Wn],Gn=Te[Wn+1],Bn<Cr&&(Cr=Bn),Gn<Hn&&(Hn=Gn),Bn>hn&&(hn=Bn),Gn>Ki&&(Ki=Gn);hi=Math.max(hn-Cr,Ki-Hn),hi=hi!==0?1/hi:0}return $(Ft,qt,ke,Cr,Hn,hi),qt}function R(Te,Ye,ke,At,gt){var Ft,qt;if(gt===Hr(Te,Ye,ke,At)>0)for(Ft=Ye;Ft<ke;Ft+=At)qt=Rt(Ft,Te[Ft],Te[Ft+1],qt);else for(Ft=ke-At;Ft>=Ye;Ft-=At)qt=Rt(Ft,Te[Ft],Te[Ft+1],qt);return qt&&ut(qt,qt.next)&&(yr(qt),qt=qt.next),qt}function Y(Te,Ye){if(!Te)return Te;Ye||(Ye=Te);var ke=Te,At;do if(At=!1,!ke.steiner&&(ut(ke,ke.next)||ot(ke.prev,ke,ke.next)===0)){if(yr(ke),ke=Ye=ke.prev,ke===ke.next)break;At=!0}else ke=ke.next;while(At||ke!==Ye);return Ye}function $(Te,Ye,ke,At,gt,Ft,qt){if(!!Te){!qt&&Ft&&et(Te,At,gt,Ft);for(var Cr=Te,Hn,hn;Te.prev!==Te.next;){if(Hn=Te.prev,hn=Te.next,Ft?ee(Te,At,gt,Ft):v(Te)){Ye.push(Hn.i/ke),Ye.push(Te.i/ke),Ye.push(hn.i/ke),yr(Te),Te=hn.next,Cr=hn.next;continue}if(Te=hn,Te===Cr){qt?qt===1?(Te=F(Y(Te),Ye,ke),$(Te,Ye,ke,At,gt,Ft,2)):qt===2&&J(Te,Ye,ke,At,gt,Ft):$(Y(Te),Ye,ke,At,gt,Ft,1);break}}}}function v(Te){var Ye=Te.prev,ke=Te,At=Te.next;if(ot(Ye,ke,At)>=0)return!1;for(var gt=Te.next.next;gt!==Te.prev;){if(Xt(Ye.x,Ye.y,ke.x,ke.y,At.x,At.y,gt.x,gt.y)&&ot(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function ee(Te,Ye,ke,At){var gt=Te.prev,Ft=Te,qt=Te.next;if(ot(gt,Ft,qt)>=0)return!1;for(var Cr=gt.x<Ft.x?gt.x<qt.x?gt.x:qt.x:Ft.x<qt.x?Ft.x:qt.x,Hn=gt.y<Ft.y?gt.y<qt.y?gt.y:qt.y:Ft.y<qt.y?Ft.y:qt.y,hn=gt.x>Ft.x?gt.x>qt.x?gt.x:qt.x:Ft.x>qt.x?Ft.x:qt.x,Ki=gt.y>Ft.y?gt.y>qt.y?gt.y:qt.y:Ft.y>qt.y?Ft.y:qt.y,Bn=nr(Cr,Hn,Ye,ke,At),Gn=nr(hn,Ki,Ye,ke,At),hi=Te.prevZ,Wn=Te.nextZ;hi&&hi.z>=Bn&&Wn&&Wn.z<=Gn;){if(hi!==Te.prev&&hi!==Te.next&&Xt(gt.x,gt.y,Ft.x,Ft.y,qt.x,qt.y,hi.x,hi.y)&&ot(hi.prev,hi,hi.next)>=0||(hi=hi.prevZ,Wn!==Te.prev&&Wn!==Te.next&&Xt(gt.x,gt.y,Ft.x,Ft.y,qt.x,qt.y,Wn.x,Wn.y)&&ot(Wn.prev,Wn,Wn.next)>=0))return!1;Wn=Wn.nextZ}for(;hi&&hi.z>=Bn;){if(hi!==Te.prev&&hi!==Te.next&&Xt(gt.x,gt.y,Ft.x,Ft.y,qt.x,qt.y,hi.x,hi.y)&&ot(hi.prev,hi,hi.next)>=0)return!1;hi=hi.prevZ}for(;Wn&&Wn.z<=Gn;){if(Wn!==Te.prev&&Wn!==Te.next&&Xt(gt.x,gt.y,Ft.x,Ft.y,qt.x,qt.y,Wn.x,Wn.y)&&ot(Wn.prev,Wn,Wn.next)>=0)return!1;Wn=Wn.nextZ}return!0}function F(Te,Ye,ke){var At=Te;do{var gt=At.prev,Ft=At.next.next;!ut(gt,Ft)&&Jt(gt,At,At.next,Ft)&&qe(gt,Ft)&&qe(Ft,gt)&&(Ye.push(gt.i/ke),Ye.push(At.i/ke),Ye.push(Ft.i/ke),yr(At),yr(At.next),At=Te=Ft),At=At.next}while(At!==Te);return Y(At)}function J(Te,Ye,ke,At,gt,Ft){var qt=Te;do{for(var Cr=qt.next.next;Cr!==qt.prev;){if(qt.i!==Cr.i&&Ct(qt,Cr)){var Hn=$e(qt,Cr);qt=Y(qt,qt.next),Hn=Y(Hn,Hn.next),$(qt,Ye,ke,At,gt,Ft),$(Hn,Ye,ke,At,gt,Ft);return}Cr=Cr.next}qt=qt.next}while(qt!==Te)}function re(Te,Ye,ke,At){var gt=[],Ft,qt,Cr,Hn,hn;for(Ft=0,qt=Ye.length;Ft<qt;Ft++)Cr=Ye[Ft]*At,Hn=Ft<qt-1?Ye[Ft+1]*At:Te.length,hn=R(Te,Cr,Hn,At,!1),hn===hn.next&&(hn.steiner=!0),gt.push(_t(hn));for(gt.sort(Ee),Ft=0;Ft<gt.length;Ft++)ke=ne(gt[Ft],ke),ke=Y(ke,ke.next);return ke}function Ee(Te,Ye){return Te.x-Ye.x}function ne(Te,Ye){var ke=je(Te,Ye);if(!ke)return Ye;var At=$e(ke,Te),gt=Y(ke,ke.next);return Y(At,At.next),Ye===ke?gt:Ye}function je(Te,Ye){var ke=Ye,At=Te.x,gt=Te.y,Ft=-Infinity,qt;do{if(gt<=ke.y&&gt>=ke.next.y&&ke.next.y!==ke.y){var Cr=ke.x+(gt-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Cr<=At&&Cr>Ft){if(Ft=Cr,Cr===At){if(gt===ke.y)return ke;if(gt===ke.next.y)return ke.next}qt=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Ye);if(!qt)return null;if(At===Ft)return qt;var Hn=qt,hn=qt.x,Ki=qt.y,Bn=Infinity,Gn;ke=qt;do At>=ke.x&&ke.x>=hn&&At!==ke.x&&Xt(gt<Ki?At:Ft,gt,hn,Ki,gt<Ki?Ft:At,gt,ke.x,ke.y)&&(Gn=Math.abs(gt-ke.y)/(At-ke.x),qe(ke,Te)&&(Gn<Bn||Gn===Bn&&(ke.x>qt.x||ke.x===qt.x&&we(qt,ke)))&&(qt=ke,Bn=Gn)),ke=ke.next;while(ke!==Hn);return qt}function we(Te,Ye){return ot(Te.prev,Te,Ye.prev)<0&&ot(Ye.next,Te,Te.next)<0}function et(Te,Ye,ke,At){var gt=Te;do gt.z===null&&(gt.z=nr(gt.x,gt.y,Ye,ke,At)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==Te);gt.prevZ.nextZ=null,gt.prevZ=null,Mt(gt)}function Mt(Te){var Ye,ke,At,gt,Ft,qt,Cr,Hn,hn=1;do{for(ke=Te,Te=null,Ft=null,qt=0;ke;){for(qt++,At=ke,Cr=0,Ye=0;Ye<hn&&(Cr++,At=At.nextZ,!!At);Ye++);for(Hn=hn;Cr>0||Hn>0&&At;)Cr!==0&&(Hn===0||!At||ke.z<=At.z)?(gt=ke,ke=ke.nextZ,Cr--):(gt=At,At=At.nextZ,Hn--),Ft?Ft.nextZ=gt:Te=gt,gt.prevZ=Ft,Ft=gt;ke=At}Ft.nextZ=null,hn*=2}while(qt>1);return Te}function nr(Te,Ye,ke,At,gt){return Te=32767*(Te-ke)*gt,Ye=32767*(Ye-At)*gt,Te=(Te|Te<<8)&16711935,Te=(Te|Te<<4)&252645135,Te=(Te|Te<<2)&858993459,Te=(Te|Te<<1)&1431655765,Ye=(Ye|Ye<<8)&16711935,Ye=(Ye|Ye<<4)&252645135,Ye=(Ye|Ye<<2)&858993459,Ye=(Ye|Ye<<1)&1431655765,Te|Ye<<1}function _t(Te){var Ye=Te,ke=Te;do(Ye.x<ke.x||Ye.x===ke.x&&Ye.y<ke.y)&&(ke=Ye),Ye=Ye.next;while(Ye!==Te);return ke}function Xt(Te,Ye,ke,At,gt,Ft,qt,Cr){return(gt-qt)*(Ye-Cr)-(Te-qt)*(Ft-Cr)>=0&&(Te-qt)*(At-Cr)-(ke-qt)*(Ye-Cr)>=0&&(ke-qt)*(Ft-Cr)-(gt-qt)*(At-Cr)>=0}function Ct(Te,Ye){return Te.next.i!==Ye.i&&Te.prev.i!==Ye.i&&!dt(Te,Ye)&&(qe(Te,Ye)&&qe(Ye,Te)&&ht(Te,Ye)&&(ot(Te.prev,Te,Ye.prev)||ot(Te,Ye.prev,Ye))||ut(Te,Ye)&&ot(Te.prev,Te,Te.next)>0&&ot(Ye.prev,Ye,Ye.next)>0)}function ot(Te,Ye,ke){return(Ye.y-Te.y)*(ke.x-Ye.x)-(Ye.x-Te.x)*(ke.y-Ye.y)}function ut(Te,Ye){return Te.x===Ye.x&&Te.y===Ye.y}function Jt(Te,Ye,ke,At){var gt=Yt(ot(Te,Ye,ke)),Ft=Yt(ot(Te,Ye,At)),qt=Yt(ot(ke,At,Te)),Cr=Yt(ot(ke,At,Ye));return!!(gt!==Ft&&qt!==Cr||gt===0&&X(Te,ke,Ye)||Ft===0&&X(Te,At,Ye)||qt===0&&X(ke,Te,At)||Cr===0&&X(ke,Ye,At))}function X(Te,Ye,ke){return Ye.x<=Math.max(Te.x,ke.x)&&Ye.x>=Math.min(Te.x,ke.x)&&Ye.y<=Math.max(Te.y,ke.y)&&Ye.y>=Math.min(Te.y,ke.y)}function Yt(Te){return Te>0?1:Te<0?-1:0}function dt(Te,Ye){var ke=Te;do{if(ke.i!==Te.i&&ke.next.i!==Te.i&&ke.i!==Ye.i&&ke.next.i!==Ye.i&&Jt(ke,ke.next,Te,Ye))return!0;ke=ke.next}while(ke!==Te);return!1}function qe(Te,Ye){return ot(Te.prev,Te,Te.next)<0?ot(Te,Ye,Te.next)>=0&&ot(Te,Te.prev,Ye)>=0:ot(Te,Ye,Te.prev)<0||ot(Te,Te.next,Ye)<0}function ht(Te,Ye){var ke=Te,At=!1,gt=(Te.x+Ye.x)/2,Ft=(Te.y+Ye.y)/2;do ke.y>Ft!=ke.next.y>Ft&&ke.next.y!==ke.y&&gt<(ke.next.x-ke.x)*(Ft-ke.y)/(ke.next.y-ke.y)+ke.x&&(At=!At),ke=ke.next;while(ke!==Te);return At}function $e(Te,Ye){var ke=new Rr(Te.i,Te.x,Te.y),At=new Rr(Ye.i,Ye.x,Ye.y),gt=Te.next,Ft=Ye.prev;return Te.next=Ye,Ye.prev=Te,ke.next=gt,gt.prev=ke,At.next=ke,ke.prev=At,Ft.next=At,At.prev=Ft,At}function Rt(Te,Ye,ke,At){var gt=new Rr(Te,Ye,ke);return At?(gt.next=At.next,gt.prev=At,At.next.prev=gt,At.next=gt):(gt.prev=gt,gt.next=gt),gt}function yr(Te){Te.next.prev=Te.prev,Te.prev.next=Te.next,Te.prevZ&&(Te.prevZ.nextZ=Te.nextZ),Te.nextZ&&(Te.nextZ.prevZ=Te.prevZ)}function Rr(Te,Ye,ke){this.i=Te,this.x=Ye,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}H.deviation=function(Te,Ye,ke,At){var gt=Ye&&Ye.length,Ft=gt?Ye[0]*ke:Te.length,qt=Math.abs(Hr(Te,0,Ft,ke));if(gt)for(var Cr=0,Hn=Ye.length;Cr<Hn;Cr++){var hn=Ye[Cr]*ke,Ki=Cr<Hn-1?Ye[Cr+1]*ke:Te.length;qt-=Math.abs(Hr(Te,hn,Ki,ke))}var Bn=0;for(Cr=0;Cr<At.length;Cr+=3){var Gn=At[Cr]*ke,hi=At[Cr+1]*ke,Wn=At[Cr+2]*ke;Bn+=Math.abs((Te[Gn]-Te[Wn])*(Te[hi+1]-Te[Gn+1])-(Te[Gn]-Te[hi])*(Te[Wn+1]-Te[Gn+1]))}return qt===0&&Bn===0?0:Math.abs((Bn-qt)/qt)};function Hr(Te,Ye,ke,At){for(var gt=0,Ft=Ye,qt=ke-At;Ft<ke;Ft+=At)gt+=(Te[qt]-Te[Ft])*(Te[Ft+1]+Te[qt+1]),qt=Ft;return gt}H.flatten=function(Te){for(var Ye=Te[0][0].length,ke={vertices:[],holes:[],dimensions:Ye},At=0,gt=0;gt<Te.length;gt++){for(var Ft=0;Ft<Te[gt].length;Ft++)for(var qt=0;qt<Ye;qt++)ke.vertices.push(Te[gt][Ft][qt]);gt>0&&(At+=Te[gt-1].length,ke.holes.push(At))}return ke}},67709:function(Ue){function H(Y){var $=Y.target||Y.srcElement;$.__resizeRAF__&&cancelAnimationFrame($.__resizeRAF__),$.__resizeRAF__=requestAnimationFrame(function(){var v=$.__resizeTrigger__,ee=v&&v.__resizeListeners__;ee&&ee.forEach(function(F){F.call(v,Y)})})}var R=function($,v){var ee=this,F=ee.document,J,re=F.attachEvent;typeof navigator!="undefined"&&(J=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ee(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",H)}if(!$.__resizeListeners__)if($.__resizeListeners__=[],re)$.__resizeTrigger__=$,$.attachEvent("onresize",H);else{getComputedStyle($).position==="static"&&($.style.position="relative");var ne=$.__resizeTrigger__=F.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=$,ne.onload=Ee,ne.type="text/html",J&&$.appendChild(ne),ne.data="about:blank",J||$.appendChild(ne)}$.__resizeListeners__.push(v)};Ue.exports=typeof window=="undefined"?R:R.bind(window),Ue.exports.unbind=function(Y,$){var v=document.attachEvent,ee=Y.__resizeListeners__||[];if($){var F=ee.indexOf($);F!==-1&&ee.splice(F,1)}else ee=Y.__resizeListeners__=[];if(!ee.length){if(v)Y.detachEvent("onresize",H);else if(Y.__resizeTrigger__){var J=Y.__resizeTrigger__.contentDocument,re=J&&J.defaultView;re&&(re.removeEventListener("resize",H),delete re.__resizeTrigger__),Y.__resizeTrigger__=!Y.removeChild(Y.__resizeTrigger__)}delete Y.__resizeListeners__}}},26729:function(Ue){"use strict";var H=Object.prototype.hasOwnProperty,R="~";function Y(){}Object.create&&(Y.prototype=Object.create(null),new Y().__proto__||(R=!1));function $(J,re,Ee){this.fn=J,this.context=re,this.once=Ee||!1}function v(J,re,Ee,ne,je){if(typeof Ee!="function")throw new TypeError("The listener must be a function");var we=new $(Ee,ne||J,je),et=R?R+re:re;return J._events[et]?J._events[et].fn?J._events[et]=[J._events[et],we]:J._events[et].push(we):(J._events[et]=we,J._eventsCount++),J}function ee(J,re){--J._eventsCount==0?J._events=new Y:delete J._events[re]}function F(){this._events=new Y,this._eventsCount=0}F.prototype.eventNames=function(){var re=[],Ee,ne;if(this._eventsCount===0)return re;for(ne in Ee=this._events)H.call(Ee,ne)&&re.push(R?ne.slice(1):ne);return Object.getOwnPropertySymbols?re.concat(Object.getOwnPropertySymbols(Ee)):re},F.prototype.listeners=function(re){var Ee=R?R+re:re,ne=this._events[Ee];if(!ne)return[];if(ne.fn)return[ne.fn];for(var je=0,we=ne.length,et=new Array(we);je<we;je++)et[je]=ne[je].fn;return et},F.prototype.listenerCount=function(re){var Ee=R?R+re:re,ne=this._events[Ee];return ne?ne.fn?1:ne.length:0},F.prototype.emit=function(re,Ee,ne,je,we,et){var Mt=R?R+re:re;if(!this._events[Mt])return!1;var nr=this._events[Mt],_t=arguments.length,Xt,Ct;if(nr.fn){switch(nr.once&&this.removeListener(re,nr.fn,void 0,!0),_t){case 1:return nr.fn.call(nr.context),!0;case 2:return nr.fn.call(nr.context,Ee),!0;case 3:return nr.fn.call(nr.context,Ee,ne),!0;case 4:return nr.fn.call(nr.context,Ee,ne,je),!0;case 5:return nr.fn.call(nr.context,Ee,ne,je,we),!0;case 6:return nr.fn.call(nr.context,Ee,ne,je,we,et),!0}for(Ct=1,Xt=new Array(_t-1);Ct<_t;Ct++)Xt[Ct-1]=arguments[Ct];nr.fn.apply(nr.context,Xt)}else{var ot=nr.length,ut;for(Ct=0;Ct<ot;Ct++)switch(nr[Ct].once&&this.removeListener(re,nr[Ct].fn,void 0,!0),_t){case 1:nr[Ct].fn.call(nr[Ct].context);break;case 2:nr[Ct].fn.call(nr[Ct].context,Ee);break;case 3:nr[Ct].fn.call(nr[Ct].context,Ee,ne);break;case 4:nr[Ct].fn.call(nr[Ct].context,Ee,ne,je);break;default:if(!Xt)for(ut=1,Xt=new Array(_t-1);ut<_t;ut++)Xt[ut-1]=arguments[ut];nr[Ct].fn.apply(nr[Ct].context,Xt)}}return!0},F.prototype.on=function(re,Ee,ne){return v(this,re,Ee,ne,!1)},F.prototype.once=function(re,Ee,ne){return v(this,re,Ee,ne,!0)},F.prototype.removeListener=function(re,Ee,ne,je){var we=R?R+re:re;if(!this._events[we])return this;if(!Ee)return ee(this,we),this;var et=this._events[we];if(et.fn)et.fn===Ee&&(!je||et.once)&&(!ne||et.context===ne)&&ee(this,we);else{for(var Mt=0,nr=[],_t=et.length;Mt<_t;Mt++)(et[Mt].fn!==Ee||je&&!et[Mt].once||ne&&et[Mt].context!==ne)&&nr.push(et[Mt]);nr.length?this._events[we]=nr.length===1?nr[0]:nr:ee(this,we)}return this},F.prototype.removeAllListeners=function(re){var Ee;return re?(Ee=R?R+re:re,this._events[Ee]&&ee(this,Ee)):(this._events=new Y,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=R,F.EventEmitter=F,Ue.exports=F},7375:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0});var R=Symbol.for("INJECTION");function Y(J,re,Ee,ne){function je(){return ne&&!Reflect.hasMetadata(R,this,re)&&Reflect.defineMetadata(R,Ee(),this,re),Reflect.hasMetadata(R,this,re)?Reflect.getMetadata(R,this,re):Ee()}function we(et){Reflect.defineMetadata(R,et,this,re)}Object.defineProperty(J,re,{configurable:!0,enumerable:!0,get:je,set:we})}function $(J,re){return function(Ee){return function(ne,je){var we=function(){return J.get(Ee)};Y(ne,je,we,re)}}}H.makePropertyInjectDecorator=$;function v(J,re){return function(Ee,ne){return function(je,we){var et=function(){return J.getNamed(Ee,ne)};Y(je,we,et,re)}}}H.makePropertyInjectNamedDecorator=v;function ee(J,re){return function(Ee,ne,je){return function(we,et){var Mt=function(){return J.getTagged(Ee,ne,je)};Y(we,et,Mt,re)}}}H.makePropertyInjectTaggedDecorator=ee;function F(J,re){return function(Ee){return function(ne,je){var we=function(){return J.getAll(Ee)};Y(ne,je,we,re)}}}H.makePropertyMultiInjectDecorator=F},84879:function(Ue,H,R){"use strict";var Y;Y={value:!0};var $=R(7375);function v(ee,F){F===void 0&&(F=!0);var J=$.makePropertyInjectDecorator(ee,F),re=$.makePropertyInjectNamedDecorator(ee,F),Ee=$.makePropertyInjectTaggedDecorator(ee,F),ne=$.makePropertyMultiInjectDecorator(ee,F);return{lazyInject:J,lazyInjectNamed:re,lazyInjectTagged:Ee,lazyMultiInject:ne}}H.Z=v},99934:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.tagProperty=H.tagParameter=H.decorate=void 0;var Y=R(16674),$=R(6867);function v(ne,je,we,et){var Mt=$.TAGGED;F(Mt,ne,je,et,we)}H.tagParameter=v;function ee(ne,je,we){var et=$.TAGGED_PROP;F(et,ne.constructor,je,we)}H.tagProperty=ee;function F(ne,je,we,et,Mt){var nr={},_t=typeof Mt=="number",Xt=Mt!==void 0&&_t?Mt.toString():we;if(_t&&we!==void 0)throw new Error(Y.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,je)&&(nr=Reflect.getMetadata(ne,je));var Ct=nr[Xt];if(!Array.isArray(Ct))Ct=[];else for(var ot=0,ut=Ct;ot<ut.length;ot++){var Jt=ut[ot];if(Jt.key===et.key)throw new Error(Y.DUPLICATED_METADATA+" "+Jt.key.toString())}Ct.push(et),nr[Xt]=Ct,Reflect.defineMetadata(ne,nr,je)}function J(ne,je){Reflect.decorate(ne,je)}function re(ne,je){return function(we,et){je(we,et,ne)}}function Ee(ne,je,we){typeof we=="number"?J([re(we,ne)],je):typeof we=="string"?Reflect.decorate([ne],je,we):J([ne],je)}H.decorate=Ee},5744:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.inject=H.LazyServiceIdentifer=void 0;var Y=R(16674),$=R(6867),v=R(47738),ee=R(99934),F=function(){function re(Ee){this._cb=Ee}return re.prototype.unwrap=function(){return this._cb()},re}();H.LazyServiceIdentifer=F;function J(re){return function(Ee,ne,je){if(re===void 0)throw new Error(Y.UNDEFINED_INJECT_ANNOTATION(Ee.name));var we=new v.Metadata($.INJECT_TAG,re);typeof je=="number"?ee.tagParameter(Ee,ne,je,we):ee.tagProperty(Ee,ne,we)}}H.inject=J},64315:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.injectable=void 0;var Y=R(16674),$=R(6867);function v(){return function(ee){if(Reflect.hasOwnMetadata($.PARAM_TYPES,ee))throw new Error(Y.DUPLICATED_INJECTABLE_DECORATOR);var F=Reflect.getMetadata($.DESIGN_PARAM_TYPES,ee)||[];return Reflect.defineMetadata($.PARAM_TYPES,F,ee),ee}}H.injectable=v},71693:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.multiInject=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(F){return function(J,re,Ee){var ne=new $.Metadata(Y.MULTI_INJECT_TAG,F);typeof Ee=="number"?v.tagParameter(J,re,Ee,ne):v.tagProperty(J,re,ne)}}H.multiInject=ee},38085:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.named=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(F){return function(J,re,Ee){var ne=new $.Metadata(Y.NAMED_TAG,F);typeof Ee=="number"?v.tagParameter(J,re,Ee,ne):v.tagProperty(J,re,ne)}}H.named=ee},6515:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.optional=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(){return function(F,J,re){var Ee=new $.Metadata(Y.OPTIONAL_TAG,!0);typeof re=="number"?v.tagParameter(F,J,re,Ee):v.tagProperty(F,J,Ee)}}H.optional=ee},7014:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.postConstruct=void 0;var Y=R(16674),$=R(6867),v=R(47738);function ee(){return function(F,J,re){var Ee=new v.Metadata($.POST_CONSTRUCT,J);if(Reflect.hasOwnMetadata($.POST_CONSTRUCT,F.constructor))throw new Error(Y.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata($.POST_CONSTRUCT,Ee,F.constructor)}}H.postConstruct=ee},32052:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.tagged=void 0;var Y=R(47738),$=R(99934);function v(ee,F){return function(J,re,Ee){var ne=new Y.Metadata(ee,F);typeof Ee=="number"?$.tagParameter(J,re,Ee,ne):$.tagProperty(J,re,ne)}}H.tagged=v},55638:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.targetName=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(F){return function(J,re,Ee){var ne=new $.Metadata(Y.NAME_TAG,F);v.tagParameter(J,re,Ee,ne)}}H.targetName=ee},86757:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.unmanaged=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(){return function(F,J,re){var Ee=new $.Metadata(Y.UNMANAGED_TAG,!0);v.tagParameter(F,J,re,Ee)}}H.unmanaged=ee},44290:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Binding=void 0;var Y=R(28421),$=R(37791),v=function(){function ee(F,J){this.id=$.id(),this.activated=!1,this.serviceIdentifier=F,this.scope=J,this.type=Y.BindingTypeEnum.Invalid,this.constraint=function(re){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ee.prototype.clone=function(){var F=new ee(this.serviceIdentifier,this.scope);return F.activated=F.scope===Y.BindingScopeEnum.Singleton?this.activated:!1,F.implementationType=this.implementationType,F.dynamicValue=this.dynamicValue,F.scope=this.scope,F.type=this.type,F.factory=this.factory,F.provider=this.provider,F.constraint=this.constraint,F.onActivation=this.onActivation,F.cache=this.cache,F},ee}();H.Binding=v},23184:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingCount=void 0;var R={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};H.BindingCount=R},16674:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.STACK_OVERFLOW=H.CIRCULAR_DEPENDENCY_IN_FACTORY=H.POST_CONSTRUCT_ERROR=H.MULTIPLE_POST_CONSTRUCT_METHODS=H.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=H.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=H.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=H.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=H.ARGUMENTS_LENGTH_MISMATCH=H.INVALID_DECORATOR_OPERATION=H.INVALID_TO_SELF_VALUE=H.INVALID_FUNCTION_BINDING=H.INVALID_MIDDLEWARE_RETURN=H.NO_MORE_SNAPSHOTS_AVAILABLE=H.INVALID_BINDING_TYPE=H.NOT_IMPLEMENTED=H.CIRCULAR_DEPENDENCY=H.UNDEFINED_INJECT_ANNOTATION=H.MISSING_INJECT_ANNOTATION=H.MISSING_INJECTABLE_ANNOTATION=H.NOT_REGISTERED=H.CANNOT_UNBIND=H.AMBIGUOUS_MATCH=H.KEY_NOT_FOUND=H.NULL_ARGUMENT=H.DUPLICATED_METADATA=H.DUPLICATED_INJECTABLE_DECORATOR=void 0,H.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",H.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",H.NULL_ARGUMENT="NULL argument",H.KEY_NOT_FOUND="Key Not Found",H.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",H.CANNOT_UNBIND="Could not unbind serviceIdentifier:",H.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",H.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",H.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var R=function(ee){return"@inject called with undefined this could mean that the class "+ee+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};H.UNDEFINED_INJECT_ANNOTATION=R,H.CIRCULAR_DEPENDENCY="Circular dependency found:",H.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",H.INVALID_BINDING_TYPE="Invalid binding type:",H.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",H.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",H.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",H.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",H.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Y=function(){for(var ee=[],F=0;F<arguments.length;F++)ee[F]=arguments[F];return"The number of constructor arguments in the derived class "+(ee[0]+" must be >= than the number of constructor arguments of its base class.")};H.ARGUMENTS_LENGTH_MISMATCH=Y,H.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",H.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",H.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",H.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",H.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var $=function(){for(var ee=[],F=0;F<arguments.length;F++)ee[F]=arguments[F];return"@postConstruct error in class "+ee[0]+": "+ee[1]};H.POST_CONSTRUCT_ERROR=$;var v=function(){for(var ee=[],F=0;F<arguments.length;F++)ee[F]=arguments[F];return"It looks like there is a circular dependency "+("in one of the '"+ee[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ee[1]+"'.")};H.CIRCULAR_DEPENDENCY_IN_FACTORY=v,H.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.TargetTypeEnum=H.BindingTypeEnum=H.BindingScopeEnum=void 0;var R={Request:"Request",Singleton:"Singleton",Transient:"Transient"};H.BindingScopeEnum=R;var Y={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};H.BindingTypeEnum=Y;var $={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};H.TargetTypeEnum=$},6867:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.NON_CUSTOM_TAG_KEYS=H.POST_CONSTRUCT=H.DESIGN_PARAM_TYPES=H.PARAM_TYPES=H.TAGGED_PROP=H.TAGGED=H.MULTI_INJECT_TAG=H.INJECT_TAG=H.OPTIONAL_TAG=H.UNMANAGED_TAG=H.NAME_TAG=H.NAMED_TAG=void 0,H.NAMED_TAG="named",H.NAME_TAG="name",H.UNMANAGED_TAG="unmanaged",H.OPTIONAL_TAG="optional",H.INJECT_TAG="inject",H.MULTI_INJECT_TAG="multi_inject",H.TAGGED="inversify:tagged",H.TAGGED_PROP="inversify:tagged_props",H.PARAM_TYPES="inversify:paramtypes",H.DESIGN_PARAM_TYPES="design:paramtypes",H.POST_CONSTRUCT="post_construct";function R(){return[H.INJECT_TAG,H.MULTI_INJECT_TAG,H.NAME_TAG,H.UNMANAGED_TAG,H.NAMED_TAG,H.OPTIONAL_TAG]}H.NON_CUSTOM_TAG_KEYS=R()},51389:function(Ue,H,R){"use strict";var Y=this&&this.__awaiter||function(Ct,ot,ut,Jt){function X(Yt){return Yt instanceof ut?Yt:new ut(function(dt){dt(Yt)})}return new(ut||(ut=Promise))(function(Yt,dt){function qe(Rt){try{$e(Jt.next(Rt))}catch(yr){dt(yr)}}function ht(Rt){try{$e(Jt.throw(Rt))}catch(yr){dt(yr)}}function $e(Rt){Rt.done?Yt(Rt.value):X(Rt.value).then(qe,ht)}$e((Jt=Jt.apply(Ct,ot||[])).next())})},$=this&&this.__generator||function(Ct,ot){var ut={label:0,sent:function(){if(Yt[0]&1)throw Yt[1];return Yt[1]},trys:[],ops:[]},Jt,X,Yt,dt;return dt={next:qe(0),throw:qe(1),return:qe(2)},typeof Symbol=="function"&&(dt[Symbol.iterator]=function(){return this}),dt;function qe($e){return function(Rt){return ht([$e,Rt])}}function ht($e){if(Jt)throw new TypeError("Generator is already executing.");for(;ut;)try{if(Jt=1,X&&(Yt=$e[0]&2?X.return:$e[0]?X.throw||((Yt=X.return)&&Yt.call(X),0):X.next)&&!(Yt=Yt.call(X,$e[1])).done)return Yt;switch(X=0,Yt&&($e=[$e[0]&2,Yt.value]),$e[0]){case 0:case 1:Yt=$e;break;case 4:return ut.label++,{value:$e[1],done:!1};case 5:ut.label++,X=$e[1],$e=[0];continue;case 7:$e=ut.ops.pop(),ut.trys.pop();continue;default:if(Yt=ut.trys,!(Yt=Yt.length>0&&Yt[Yt.length-1])&&($e[0]===6||$e[0]===2)){ut=0;continue}if($e[0]===3&&(!Yt||$e[1]>Yt[0]&&$e[1]<Yt[3])){ut.label=$e[1];break}if($e[0]===6&&ut.label<Yt[1]){ut.label=Yt[1],Yt=$e;break}if(Yt&&ut.label<Yt[2]){ut.label=Yt[2],ut.ops.push($e);break}Yt[2]&&ut.ops.pop(),ut.trys.pop();continue}$e=ot.call(Ct,ut)}catch(Rt){$e=[6,Rt],X=0}finally{Jt=Yt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(Ct,ot){for(var ut=0,Jt=ot.length,X=Ct.length;ut<Jt;ut++,X++)Ct[X]=ot[ut];return Ct};Object.defineProperty(H,"__esModule",{value:!0}),H.Container=void 0;var ee=R(44290),F=R(16674),J=R(28421),re=R(6867),Ee=R(51377),ne=R(86311),je=R(31927),we=R(15451),et=R(37791),Mt=R(55800),nr=R(85700),_t=R(80175),Xt=function(){function Ct(ot){this._appliedMiddleware=[];var ut=ot||{};if(typeof ut!="object")throw new Error(""+F.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(ut.defaultScope===void 0)ut.defaultScope=J.BindingScopeEnum.Transient;else if(ut.defaultScope!==J.BindingScopeEnum.Singleton&&ut.defaultScope!==J.BindingScopeEnum.Transient&&ut.defaultScope!==J.BindingScopeEnum.Request)throw new Error(""+F.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(ut.autoBindInjectable===void 0)ut.autoBindInjectable=!1;else if(typeof ut.autoBindInjectable!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(ut.skipBaseClassChecks===void 0)ut.skipBaseClassChecks=!1;else if(typeof ut.skipBaseClassChecks!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:ut.autoBindInjectable,defaultScope:ut.defaultScope,skipBaseClassChecks:ut.skipBaseClassChecks},this.id=et.id(),this._bindingDictionary=new _t.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ee.MetadataReader}return Ct.merge=function(ot,ut){for(var Jt=[],X=2;X<arguments.length;X++)Jt[X-2]=arguments[X];var Yt=new Ct,dt=v([ot,ut],Jt).map(function($e){return ne.getBindingDictionary($e)}),qe=ne.getBindingDictionary(Yt);function ht($e,Rt){$e.traverse(function(yr,Rr){Rr.forEach(function(Hr){Rt.add(Hr.serviceIdentifier,Hr.clone())})})}return dt.forEach(function($e){ht($e,qe)}),Yt},Ct.prototype.load=function(){for(var ot=[],ut=0;ut<arguments.length;ut++)ot[ut]=arguments[ut];for(var Jt=this._getContainerModuleHelpersFactory(),X=0,Yt=ot;X<Yt.length;X++){var dt=Yt[X],qe=Jt(dt.id);dt.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)}},Ct.prototype.loadAsync=function(){for(var ot=[],ut=0;ut<arguments.length;ut++)ot[ut]=arguments[ut];return Y(this,void 0,void 0,function(){var Jt,X,Yt,dt,qe;return $(this,function(ht){switch(ht.label){case 0:Jt=this._getContainerModuleHelpersFactory(),X=0,Yt=ot,ht.label=1;case 1:return X<Yt.length?(dt=Yt[X],qe=Jt(dt.id),[4,dt.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)]):[3,4];case 2:ht.sent(),ht.label=3;case 3:return X++,[3,1];case 4:return[2]}})})},Ct.prototype.unload=function(){for(var ot=this,ut=[],Jt=0;Jt<arguments.length;Jt++)ut[Jt]=arguments[Jt];var X=function(Yt){return function(dt){return dt.moduleId===Yt}};ut.forEach(function(Yt){var dt=X(Yt.id);ot._bindingDictionary.removeByCondition(dt)})},Ct.prototype.bind=function(ot){var ut=this.options.defaultScope||J.BindingScopeEnum.Transient,Jt=new ee.Binding(ot,ut);return this._bindingDictionary.add(ot,Jt),new we.BindingToSyntax(Jt)},Ct.prototype.rebind=function(ot){return this.unbind(ot),this.bind(ot)},Ct.prototype.unbind=function(ot){try{this._bindingDictionary.remove(ot)}catch(ut){throw new Error(F.CANNOT_UNBIND+" "+Mt.getServiceIdentifierAsString(ot))}},Ct.prototype.unbindAll=function(){this._bindingDictionary=new _t.Lookup},Ct.prototype.isBound=function(ot){var ut=this._bindingDictionary.hasKey(ot);return!ut&&this.parent&&(ut=this.parent.isBound(ot)),ut},Ct.prototype.isBoundNamed=function(ot,ut){return this.isBoundTagged(ot,re.NAMED_TAG,ut)},Ct.prototype.isBoundTagged=function(ot,ut,Jt){var X=!1;if(this._bindingDictionary.hasKey(ot)){var Yt=this._bindingDictionary.get(ot),dt=ne.createMockRequest(this,ot,ut,Jt);X=Yt.some(function(qe){return qe.constraint(dt)})}return!X&&this.parent&&(X=this.parent.isBoundTagged(ot,ut,Jt)),X},Ct.prototype.snapshot=function(){this._snapshots.push(nr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ct.prototype.restore=function(){var ot=this._snapshots.pop();if(ot===void 0)throw new Error(F.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ot.bindings,this._middleware=ot.middleware},Ct.prototype.createChild=function(ot){var ut=new Ct(ot||this.options);return ut.parent=this,ut},Ct.prototype.applyMiddleware=function(){for(var ot=[],ut=0;ut<arguments.length;ut++)ot[ut]=arguments[ut];this._appliedMiddleware=this._appliedMiddleware.concat(ot);var Jt=this._middleware?this._middleware:this._planAndResolve();this._middleware=ot.reduce(function(X,Yt){return Yt(X)},Jt)},Ct.prototype.applyCustomMetadataReader=function(ot){this._metadataReader=ot},Ct.prototype.get=function(ot){return this._get(!1,!1,J.TargetTypeEnum.Variable,ot)},Ct.prototype.getTagged=function(ot,ut,Jt){return this._get(!1,!1,J.TargetTypeEnum.Variable,ot,ut,Jt)},Ct.prototype.getNamed=function(ot,ut){return this.getTagged(ot,re.NAMED_TAG,ut)},Ct.prototype.getAll=function(ot){return this._get(!0,!0,J.TargetTypeEnum.Variable,ot)},Ct.prototype.getAllTagged=function(ot,ut,Jt){return this._get(!1,!0,J.TargetTypeEnum.Variable,ot,ut,Jt)},Ct.prototype.getAllNamed=function(ot,ut){return this.getAllTagged(ot,re.NAMED_TAG,ut)},Ct.prototype.resolve=function(ot){var ut=this.createChild();return ut.bind(ot).toSelf(),this._appliedMiddleware.forEach(function(Jt){ut.applyMiddleware(Jt)}),ut.get(ot)},Ct.prototype._getContainerModuleHelpersFactory=function(){var ot=this,ut=function(qe,ht){qe._binding.moduleId=ht},Jt=function(qe){return function(ht){var $e=ot.bind.bind(ot),Rt=$e(ht);return ut(Rt,qe),Rt}},X=function(qe){return function(ht){var $e=ot.unbind.bind(ot);$e(ht)}},Yt=function(qe){return function(ht){var $e=ot.isBound.bind(ot);return $e(ht)}},dt=function(qe){return function(ht){var $e=ot.rebind.bind(ot),Rt=$e(ht);return ut(Rt,qe),Rt}};return function(qe){return{bindFunction:Jt(qe),isboundFunction:Yt(qe),rebindFunction:dt(qe),unbindFunction:X(qe)}}},Ct.prototype._get=function(ot,ut,Jt,X,Yt,dt){var qe=null,ht={avoidConstraints:ot,contextInterceptor:function($e){return $e},isMultiInject:ut,key:Yt,serviceIdentifier:X,targetType:Jt,value:dt};if(this._middleware){if(qe=this._middleware(ht),qe==null)throw new Error(F.INVALID_MIDDLEWARE_RETURN)}else qe=this._planAndResolve()(ht);return qe},Ct.prototype._planAndResolve=function(){var ot=this;return function(ut){var Jt=ne.plan(ot._metadataReader,ot,ut.isMultiInject,ut.targetType,ut.serviceIdentifier,ut.key,ut.value,ut.avoidConstraints);Jt=ut.contextInterceptor(Jt);var X=je.resolve(Jt);return X}},Ct}();H.Container=Xt},33244:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.AsyncContainerModule=H.ContainerModule=void 0;var Y=R(37791),$=function(){function ee(F){this.id=Y.id(),this.registry=F}return ee}();H.ContainerModule=$;var v=function(){function ee(F){this.id=Y.id(),this.registry=F}return ee}();H.AsyncContainerModule=v},85700:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.ContainerSnapshot=void 0;var R=function(){function Y(){}return Y.of=function($,v){var ee=new Y;return ee.bindings=$,ee.middleware=v,ee},Y}();H.ContainerSnapshot=R},80175:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Lookup=void 0;var Y=R(16674),$=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(ee,F){if(ee==null)throw new Error(Y.NULL_ARGUMENT);if(F==null)throw new Error(Y.NULL_ARGUMENT);var J=this._map.get(ee);J!==void 0?(J.push(F),this._map.set(ee,J)):this._map.set(ee,[F])},v.prototype.get=function(ee){if(ee==null)throw new Error(Y.NULL_ARGUMENT);var F=this._map.get(ee);if(F!==void 0)return F;throw new Error(Y.KEY_NOT_FOUND)},v.prototype.remove=function(ee){if(ee==null)throw new Error(Y.NULL_ARGUMENT);if(!this._map.delete(ee))throw new Error(Y.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(ee){var F=this;this._map.forEach(function(J,re){var Ee=J.filter(function(ne){return!ee(ne)});Ee.length>0?F._map.set(re,Ee):F._map.delete(re)})},v.prototype.hasKey=function(ee){if(ee==null)throw new Error(Y.NULL_ARGUMENT);return this._map.has(ee)},v.prototype.clone=function(){var ee=new v;return this._map.forEach(function(F,J){F.forEach(function(re){return ee.add(J,re.clone())})}),ee},v.prototype.traverse=function(ee){this._map.forEach(function(F,J){ee(J,F)})},v}();H.Lookup=$},86700:function(Ue,H,R){"use strict";var Y;Y={value:!0},Y=Y=Y=Y=Y=Y=H.GW=Y=Y=H.zY=Y=Y=Y=Y=Y=H.f3=Y=Y=H.b2=Y=Y=Y=Y=Y=H.W2=Y=void 0;var $=R(6867);Y=$;var v=R(51389);Object.defineProperty(H,"W2",{enumerable:!0,get:function(){return v.Container}});var ee=R(28421);Y={enumerable:!0,get:function(){return ee.BindingScopeEnum}},Y={enumerable:!0,get:function(){return ee.BindingTypeEnum}},Y={enumerable:!0,get:function(){return ee.TargetTypeEnum}};var F=R(33244);Y={enumerable:!0,get:function(){return F.AsyncContainerModule}},Y={enumerable:!0,get:function(){return F.ContainerModule}};var J=R(64315);Object.defineProperty(H,"b2",{enumerable:!0,get:function(){return J.injectable}});var re=R(32052);Y={enumerable:!0,get:function(){return re.tagged}};var Ee=R(38085);Y={enumerable:!0,get:function(){return Ee.named}};var ne=R(5744);Object.defineProperty(H,"f3",{enumerable:!0,get:function(){return ne.inject}}),Y={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var je=R(6515);Y={enumerable:!0,get:function(){return je.optional}};var we=R(86757);Y={enumerable:!0,get:function(){return we.unmanaged}};var et=R(71693);Y={enumerable:!0,get:function(){return et.multiInject}};var Mt=R(55638);Y={enumerable:!0,get:function(){return Mt.targetName}};var nr=R(7014);Object.defineProperty(H,"zY",{enumerable:!0,get:function(){return nr.postConstruct}});var _t=R(51377);Y={enumerable:!0,get:function(){return _t.MetadataReader}};var Xt=R(37791);Y={enumerable:!0,get:function(){return Xt.id}};var Ct=R(99934);Object.defineProperty(H,"GW",{enumerable:!0,get:function(){return Ct.decorate}});var ot=R(80758);Y={enumerable:!0,get:function(){return ot.traverseAncerstors}},Y={enumerable:!0,get:function(){return ot.taggedConstraint}},Y={enumerable:!0,get:function(){return ot.namedConstraint}},Y={enumerable:!0,get:function(){return ot.typeConstraint}};var ut=R(55800);Y={enumerable:!0,get:function(){return ut.getServiceIdentifierAsString}};var Jt=R(70600);Y={enumerable:!0,get:function(){return Jt.multiBindToService}}},95228:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Context=void 0;var Y=R(37791),$=function(){function v(ee){this.id=Y.id(),this.container=ee}return v.prototype.addPlan=function(ee){this.plan=ee},v.prototype.setCurrentRequest=function(ee){this.currentRequest=ee},v}();H.Context=$},47738:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Metadata=void 0;var Y=R(6867),$=function(){function v(ee,F){this.key=ee,this.value=F}return v.prototype.toString=function(){return this.key===Y.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();H.Metadata=$},51377:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.MetadataReader=void 0;var Y=R(6867),$=function(){function v(){}return v.prototype.getConstructorMetadata=function(ee){var F=Reflect.getMetadata(Y.PARAM_TYPES,ee),J=Reflect.getMetadata(Y.TAGGED,ee);return{compilerGeneratedMetadata:F,userGeneratedMetadata:J||{}}},v.prototype.getPropertiesMetadata=function(ee){var F=Reflect.getMetadata(Y.TAGGED_PROP,ee)||[];return F},v}();H.MetadataReader=$},55314:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Plan=void 0;var R=function(){function Y($,v){this.parentContext=$,this.rootRequest=v}return Y}();H.Plan=R},86311:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.getBindingDictionary=H.createMockRequest=H.plan=void 0;var Y=R(23184),$=R(16674),v=R(28421),ee=R(6867),F=R(85265),J=R(55800),re=R(95228),Ee=R(47738),ne=R(55314),je=R(6e3),we=R(6748),et=R(18924);function Mt(X){return X._bindingDictionary}H.getBindingDictionary=Mt;function nr(X,Yt,dt,qe,ht,$e){var Rt=X?ee.MULTI_INJECT_TAG:ee.INJECT_TAG,yr=new Ee.Metadata(Rt,dt),Rr=new et.Target(Yt,qe,dt,yr);if(ht!==void 0){var Hr=new Ee.Metadata(ht,$e);Rr.metadata.push(Hr)}return Rr}function _t(X,Yt,dt,qe,ht){var $e=ot(dt.container,ht.serviceIdentifier),Rt=[];return $e.length===Y.BindingCount.NoBindingsAvailable&&dt.container.options.autoBindInjectable&&typeof ht.serviceIdentifier=="function"&&X.getConstructorMetadata(ht.serviceIdentifier).compilerGeneratedMetadata&&(dt.container.bind(ht.serviceIdentifier).toSelf(),$e=ot(dt.container,ht.serviceIdentifier)),Yt?Rt=$e:Rt=$e.filter(function(yr){var Rr=new we.Request(yr.serviceIdentifier,dt,qe,yr,ht);return yr.constraint(Rr)}),Xt(ht.serviceIdentifier,Rt,ht,dt.container),Rt}function Xt(X,Yt,dt,qe){switch(Yt.length){case Y.BindingCount.NoBindingsAvailable:if(dt.isOptional())return Yt;var ht=J.getServiceIdentifierAsString(X),$e=$.NOT_REGISTERED;throw $e+=J.listMetadataForTarget(ht,dt),$e+=J.listRegisteredBindingsForServiceIdentifier(qe,ht,ot),new Error($e);case Y.BindingCount.OnlyOneBindingAvailable:if(!dt.isArray())return Yt;case Y.BindingCount.MultipleBindingsAvailable:default:if(dt.isArray())return Yt;var ht=J.getServiceIdentifierAsString(X),$e=$.AMBIGUOUS_MATCH+" "+ht;throw $e+=J.listRegisteredBindingsForServiceIdentifier(qe,ht,ot),new Error($e)}}function Ct(X,Yt,dt,qe,ht,$e){var Rt,yr;if(ht===null){Rt=_t(X,Yt,qe,null,$e),yr=new we.Request(dt,qe,null,Rt,$e);var Rr=new ne.Plan(qe,yr);qe.addPlan(Rr)}else Rt=_t(X,Yt,qe,ht,$e),yr=ht.addChildRequest($e.serviceIdentifier,Rt,$e);Rt.forEach(function(Hr){var Te=null;if($e.isArray())Te=yr.addChildRequest(Hr.serviceIdentifier,Hr,$e);else{if(Hr.cache)return;Te=yr}if(Hr.type===v.BindingTypeEnum.Instance&&Hr.implementationType!==null){var Ye=je.getDependencies(X,Hr.implementationType);if(!qe.container.options.skipBaseClassChecks){var ke=je.getBaseClassDependencyCount(X,Hr.implementationType);if(Ye.length<ke){var At=$.ARGUMENTS_LENGTH_MISMATCH(je.getFunctionName(Hr.implementationType));throw new Error(At)}}Ye.forEach(function(gt){Ct(X,!1,gt.serviceIdentifier,qe,Te,gt)})}})}function ot(X,Yt){var dt=[],qe=Mt(X);return qe.hasKey(Yt)?dt=qe.get(Yt):X.parent!==null&&(dt=ot(X.parent,Yt)),dt}function ut(X,Yt,dt,qe,ht,$e,Rt,yr){yr===void 0&&(yr=!1);var Rr=new re.Context(Yt),Hr=nr(dt,qe,ht,"",$e,Rt);try{return Ct(X,yr,ht,Rr,null,Hr),Rr}catch(Te){throw F.isStackOverflowExeption(Te)&&Rr.plan&&J.circularDependencyToException(Rr.plan.rootRequest),Te}}H.plan=ut;function Jt(X,Yt,dt,qe){var ht=new et.Target(v.TargetTypeEnum.Variable,"",Yt,new Ee.Metadata(dt,qe)),$e=new re.Context(X),Rt=new we.Request(Yt,$e,null,[],ht);return Rt}H.createMockRequest=Jt},88460:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.QueryableString=void 0;var R=function(){function Y($){this.str=$}return Y.prototype.startsWith=function($){return this.str.indexOf($)===0},Y.prototype.endsWith=function($){var v="",ee=$.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},ee)},Y.prototype.contains=function($){return this.str.indexOf($)!==-1},Y.prototype.equals=function($){return this.str===$},Y.prototype.value=function(){return this.str},Y}();H.QueryableString=R},6e3:function(Ue,H,R){"use strict";var Y=this&&this.__spreadArray||function(_t,Xt){for(var Ct=0,ot=Xt.length,ut=_t.length;Ct<ot;Ct++,ut++)_t[ut]=Xt[Ct];return _t};Object.defineProperty(H,"__esModule",{value:!0}),H.getFunctionName=H.getBaseClassDependencyCount=H.getDependencies=void 0;var $=R(5744),v=R(16674),ee=R(28421),F=R(6867),J=R(55800);Object.defineProperty(H,"getFunctionName",{enumerable:!0,get:function(){return J.getFunctionName}});var re=R(18924);function Ee(_t,Xt){var Ct=J.getFunctionName(Xt),ot=ne(_t,Ct,Xt,!1);return ot}H.getDependencies=Ee;function ne(_t,Xt,Ct,ot){var ut=_t.getConstructorMetadata(Ct),Jt=ut.compilerGeneratedMetadata;if(Jt===void 0){var X=v.MISSING_INJECTABLE_ANNOTATION+" "+Xt+".";throw new Error(X)}var Yt=ut.userGeneratedMetadata,dt=Object.keys(Yt),qe=Ct.length===0&&dt.length>0,ht=dt.length>Ct.length,$e=qe||ht?dt.length:Ct.length,Rt=we(ot,Xt,Jt,Yt,$e),yr=et(_t,Ct),Rr=Y(Y([],Rt),yr);return Rr}function je(_t,Xt,Ct,ot,ut){var Jt=ut[_t.toString()]||[],X=nr(Jt),Yt=X.unmanaged!==!0,dt=ot[_t],qe=X.inject||X.multiInject;if(dt=qe||dt,dt instanceof $.LazyServiceIdentifer&&(dt=dt.unwrap()),Yt){var ht=dt===Object,$e=dt===Function,Rt=dt===void 0,yr=ht||$e||Rt;if(!Xt&&yr){var Rr=v.MISSING_INJECT_ANNOTATION+" argument "+_t+" in class "+Ct+".";throw new Error(Rr)}var Hr=new re.Target(ee.TargetTypeEnum.ConstructorArgument,X.targetName,dt);return Hr.metadata=Jt,Hr}return null}function we(_t,Xt,Ct,ot,ut){for(var Jt=[],X=0;X<ut;X++){var Yt=X,dt=je(Yt,_t,Xt,Ct,ot);dt!==null&&Jt.push(dt)}return Jt}function et(_t,Xt){for(var Ct=_t.getPropertiesMetadata(Xt),ot=[],ut=Object.keys(Ct),Jt=0,X=ut;Jt<X.length;Jt++){var Yt=X[Jt],dt=Ct[Yt],qe=nr(Ct[Yt]),ht=qe.targetName||Yt,$e=qe.inject||qe.multiInject,Rt=new re.Target(ee.TargetTypeEnum.ClassProperty,ht,$e);Rt.metadata=dt,ot.push(Rt)}var yr=Object.getPrototypeOf(Xt.prototype).constructor;if(yr!==Object){var Rr=et(_t,yr);ot=Y(Y([],ot),Rr)}return ot}function Mt(_t,Xt){var Ct=Object.getPrototypeOf(Xt.prototype).constructor;if(Ct!==Object){var ot=J.getFunctionName(Ct),ut=ne(_t,ot,Ct,!0),Jt=ut.map(function(dt){return dt.metadata.filter(function(qe){return qe.key===F.UNMANAGED_TAG})}),X=[].concat.apply([],Jt).length,Yt=ut.length-X;return Yt>0?Yt:Mt(_t,Ct)}else return 0}H.getBaseClassDependencyCount=Mt;function nr(_t){var Xt={};return _t.forEach(function(Ct){Xt[Ct.key.toString()]=Ct.value}),{inject:Xt[F.INJECT_TAG],multiInject:Xt[F.MULTI_INJECT_TAG],targetName:Xt[F.NAME_TAG],unmanaged:Xt[F.UNMANAGED_TAG]}}},6748:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Request=void 0;var Y=R(37791),$=function(){function v(ee,F,J,re,Ee){this.id=Y.id(),this.serviceIdentifier=ee,this.parentContext=F,this.parentRequest=J,this.target=Ee,this.childRequests=[],this.bindings=Array.isArray(re)?re:[re],this.requestScope=J===null?new Map:null}return v.prototype.addChildRequest=function(ee,F,J){var re=new v(ee,this.parentContext,this,F,J);return this.childRequests.push(re),re},v}();H.Request=$},18924:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Target=void 0;var Y=R(6867),$=R(37791),v=R(47738),ee=R(88460),F=function(){function J(re,Ee,ne,je){this.id=$.id(),this.type=re,this.serviceIdentifier=ne,this.name=new ee.QueryableString(Ee||""),this.metadata=new Array;var we=null;typeof je=="string"?we=new v.Metadata(Y.NAMED_TAG,je):je instanceof v.Metadata&&(we=je),we!==null&&this.metadata.push(we)}return J.prototype.hasTag=function(re){for(var Ee=0,ne=this.metadata;Ee<ne.length;Ee++){var je=ne[Ee];if(je.key===re)return!0}return!1},J.prototype.isArray=function(){return this.hasTag(Y.MULTI_INJECT_TAG)},J.prototype.matchesArray=function(re){return this.matchesTag(Y.MULTI_INJECT_TAG)(re)},J.prototype.isNamed=function(){return this.hasTag(Y.NAMED_TAG)},J.prototype.isTagged=function(){return this.metadata.some(function(re){return Y.NON_CUSTOM_TAG_KEYS.every(function(Ee){return re.key!==Ee})})},J.prototype.isOptional=function(){return this.matchesTag(Y.OPTIONAL_TAG)(!0)},J.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(re){return re.key===Y.NAMED_TAG})[0]:null},J.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(re){return Y.NON_CUSTOM_TAG_KEYS.every(function(Ee){return re.key!==Ee})}):null},J.prototype.matchesNamedTag=function(re){return this.matchesTag(Y.NAMED_TAG)(re)},J.prototype.matchesTag=function(re){var Ee=this;return function(ne){for(var je=0,we=Ee.metadata;je<we.length;je++){var et=we[je];if(et.key===re&&et.value===ne)return!0}return!1}},J}();H.Target=F},52279:function(Ue,H,R){"use strict";var Y=this&&this.__spreadArray||function(ne,je){for(var we=0,et=je.length,Mt=ne.length;we<et;we++,Mt++)ne[Mt]=je[we];return ne};Object.defineProperty(H,"__esModule",{value:!0}),H.resolveInstance=void 0;var $=R(16674),v=R(28421),ee=R(6867);function F(ne,je,we){var et=je.filter(function(nr){return nr.target!==null&&nr.target.type===v.TargetTypeEnum.ClassProperty}),Mt=et.map(we);return et.forEach(function(nr,_t){var Xt="";Xt=nr.target.name.value();var Ct=Mt[_t];ne[Xt]=Ct}),ne}function J(ne,je){return new(ne.bind.apply(ne,Y([void 0],je)))}function re(ne,je){if(Reflect.hasMetadata(ee.POST_CONSTRUCT,ne)){var we=Reflect.getMetadata(ee.POST_CONSTRUCT,ne);try{je[we.value]()}catch(et){throw new Error($.POST_CONSTRUCT_ERROR(ne.name,et.message))}}}function Ee(ne,je,we){var et=null;if(je.length>0){var Mt=je.filter(function(_t){return _t.target!==null&&_t.target.type===v.TargetTypeEnum.ConstructorArgument}),nr=Mt.map(we);et=J(ne,nr),et=F(et,je,we)}else et=new ne;return re(ne,et),et}H.resolveInstance=Ee},31927:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.resolve=void 0;var Y=R(16674),$=R(28421),v=R(85265),ee=R(55800),F=R(52279),J=function(ne,je,we){try{return we()}catch(et){throw v.isStackOverflowExeption(et)?new Error(Y.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,je.toString())):et}},re=function(ne){return function(je){je.parentContext.setCurrentRequest(je);var we=je.bindings,et=je.childRequests,Mt=je.target&&je.target.isArray(),nr=!je.parentRequest||!je.parentRequest.target||!je.target||!je.parentRequest.target.matchesArray(je.target.serviceIdentifier);if(Mt&&nr)return et.map(function(Jt){var X=re(ne);return X(Jt)});var _t=null;if(je.target.isOptional()&&we.length===0)return;var Xt=we[0],Ct=Xt.scope===$.BindingScopeEnum.Singleton,ot=Xt.scope===$.BindingScopeEnum.Request;if(Ct&&Xt.activated)return Xt.cache;if(ot&&ne!==null&&ne.has(Xt.id))return ne.get(Xt.id);if(Xt.type===$.BindingTypeEnum.ConstantValue)_t=Xt.cache,Xt.activated=!0;else if(Xt.type===$.BindingTypeEnum.Function)_t=Xt.cache,Xt.activated=!0;else if(Xt.type===$.BindingTypeEnum.Constructor)_t=Xt.implementationType;else if(Xt.type===$.BindingTypeEnum.DynamicValue&&Xt.dynamicValue!==null)_t=J("toDynamicValue",Xt.serviceIdentifier,function(){return Xt.dynamicValue(je.parentContext)});else if(Xt.type===$.BindingTypeEnum.Factory&&Xt.factory!==null)_t=J("toFactory",Xt.serviceIdentifier,function(){return Xt.factory(je.parentContext)});else if(Xt.type===$.BindingTypeEnum.Provider&&Xt.provider!==null)_t=J("toProvider",Xt.serviceIdentifier,function(){return Xt.provider(je.parentContext)});else if(Xt.type===$.BindingTypeEnum.Instance&&Xt.implementationType!==null)_t=F.resolveInstance(Xt.implementationType,et,re(ne));else{var ut=ee.getServiceIdentifierAsString(je.serviceIdentifier);throw new Error(Y.INVALID_BINDING_TYPE+" "+ut)}return typeof Xt.onActivation=="function"&&(_t=Xt.onActivation(je.parentContext,_t)),Ct&&(Xt.cache=_t,Xt.activated=!0),ot&&ne!==null&&!ne.has(Xt.id)&&ne.set(Xt.id,_t),_t}};function Ee(ne){var je=re(ne.plan.rootRequest.requestScope);return je(ne.plan.rootRequest)}H.resolve=Ee},83366:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingInSyntax=void 0;var Y=R(28421),$=R(71325),v=function(){function ee(F){this._binding=F}return ee.prototype.inRequestScope=function(){return this._binding.scope=Y.BindingScopeEnum.Request,new $.BindingWhenOnSyntax(this._binding)},ee.prototype.inSingletonScope=function(){return this._binding.scope=Y.BindingScopeEnum.Singleton,new $.BindingWhenOnSyntax(this._binding)},ee.prototype.inTransientScope=function(){return this._binding.scope=Y.BindingScopeEnum.Transient,new $.BindingWhenOnSyntax(this._binding)},ee}();H.BindingInSyntax=v},74889:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingInWhenOnSyntax=void 0;var Y=R(83366),$=R(51811),v=R(98370),ee=function(){function F(J){this._binding=J,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new $.BindingOnSyntax(this._binding),this._bindingInSyntax=new Y.BindingInSyntax(J)}return F.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},F.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},F.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},F.prototype.when=function(J){return this._bindingWhenSyntax.when(J)},F.prototype.whenTargetNamed=function(J){return this._bindingWhenSyntax.whenTargetNamed(J)},F.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},F.prototype.whenTargetTagged=function(J,re){return this._bindingWhenSyntax.whenTargetTagged(J,re)},F.prototype.whenInjectedInto=function(J){return this._bindingWhenSyntax.whenInjectedInto(J)},F.prototype.whenParentNamed=function(J){return this._bindingWhenSyntax.whenParentNamed(J)},F.prototype.whenParentTagged=function(J,re){return this._bindingWhenSyntax.whenParentTagged(J,re)},F.prototype.whenAnyAncestorIs=function(J){return this._bindingWhenSyntax.whenAnyAncestorIs(J)},F.prototype.whenNoAncestorIs=function(J){return this._bindingWhenSyntax.whenNoAncestorIs(J)},F.prototype.whenAnyAncestorNamed=function(J){return this._bindingWhenSyntax.whenAnyAncestorNamed(J)},F.prototype.whenAnyAncestorTagged=function(J,re){return this._bindingWhenSyntax.whenAnyAncestorTagged(J,re)},F.prototype.whenNoAncestorNamed=function(J){return this._bindingWhenSyntax.whenNoAncestorNamed(J)},F.prototype.whenNoAncestorTagged=function(J,re){return this._bindingWhenSyntax.whenNoAncestorTagged(J,re)},F.prototype.whenAnyAncestorMatches=function(J){return this._bindingWhenSyntax.whenAnyAncestorMatches(J)},F.prototype.whenNoAncestorMatches=function(J){return this._bindingWhenSyntax.whenNoAncestorMatches(J)},F.prototype.onActivation=function(J){return this._bindingOnSyntax.onActivation(J)},F}();H.BindingInWhenOnSyntax=ee},51811:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingOnSyntax=void 0;var Y=R(98370),$=function(){function v(ee){this._binding=ee}return v.prototype.onActivation=function(ee){return this._binding.onActivation=ee,new Y.BindingWhenSyntax(this._binding)},v}();H.BindingOnSyntax=$},15451:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingToSyntax=void 0;var Y=R(16674),$=R(28421),v=R(74889),ee=R(71325),F=function(){function J(re){this._binding=re}return J.prototype.to=function(re){return this._binding.type=$.BindingTypeEnum.Instance,this._binding.implementationType=re,new v.BindingInWhenOnSyntax(this._binding)},J.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Y.INVALID_TO_SELF_VALUE);var re=this._binding.serviceIdentifier;return this.to(re)},J.prototype.toConstantValue=function(re){return this._binding.type=$.BindingTypeEnum.ConstantValue,this._binding.cache=re,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},J.prototype.toDynamicValue=function(re){return this._binding.type=$.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=re,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},J.prototype.toConstructor=function(re){return this._binding.type=$.BindingTypeEnum.Constructor,this._binding.implementationType=re,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},J.prototype.toFactory=function(re){return this._binding.type=$.BindingTypeEnum.Factory,this._binding.factory=re,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},J.prototype.toFunction=function(re){if(typeof re!="function")throw new Error(Y.INVALID_FUNCTION_BINDING);var Ee=this.toConstantValue(re);return this._binding.type=$.BindingTypeEnum.Function,this._binding.scope=$.BindingScopeEnum.Singleton,Ee},J.prototype.toAutoFactory=function(re){return this._binding.type=$.BindingTypeEnum.Factory,this._binding.factory=function(Ee){var ne=function(){return Ee.container.get(re)};return ne},this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},J.prototype.toProvider=function(re){return this._binding.type=$.BindingTypeEnum.Provider,this._binding.provider=re,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},J.prototype.toService=function(re){this.toDynamicValue(function(Ee){return Ee.container.get(re)})},J}();H.BindingToSyntax=F},71325:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingWhenOnSyntax=void 0;var Y=R(51811),$=R(98370),v=function(){function ee(F){this._binding=F,this._bindingWhenSyntax=new $.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Y.BindingOnSyntax(this._binding)}return ee.prototype.when=function(F){return this._bindingWhenSyntax.when(F)},ee.prototype.whenTargetNamed=function(F){return this._bindingWhenSyntax.whenTargetNamed(F)},ee.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ee.prototype.whenTargetTagged=function(F,J){return this._bindingWhenSyntax.whenTargetTagged(F,J)},ee.prototype.whenInjectedInto=function(F){return this._bindingWhenSyntax.whenInjectedInto(F)},ee.prototype.whenParentNamed=function(F){return this._bindingWhenSyntax.whenParentNamed(F)},ee.prototype.whenParentTagged=function(F,J){return this._bindingWhenSyntax.whenParentTagged(F,J)},ee.prototype.whenAnyAncestorIs=function(F){return this._bindingWhenSyntax.whenAnyAncestorIs(F)},ee.prototype.whenNoAncestorIs=function(F){return this._bindingWhenSyntax.whenNoAncestorIs(F)},ee.prototype.whenAnyAncestorNamed=function(F){return this._bindingWhenSyntax.whenAnyAncestorNamed(F)},ee.prototype.whenAnyAncestorTagged=function(F,J){return this._bindingWhenSyntax.whenAnyAncestorTagged(F,J)},ee.prototype.whenNoAncestorNamed=function(F){return this._bindingWhenSyntax.whenNoAncestorNamed(F)},ee.prototype.whenNoAncestorTagged=function(F,J){return this._bindingWhenSyntax.whenNoAncestorTagged(F,J)},ee.prototype.whenAnyAncestorMatches=function(F){return this._bindingWhenSyntax.whenAnyAncestorMatches(F)},ee.prototype.whenNoAncestorMatches=function(F){return this._bindingWhenSyntax.whenNoAncestorMatches(F)},ee.prototype.onActivation=function(F){return this._bindingOnSyntax.onActivation(F)},ee}();H.BindingWhenOnSyntax=v},98370:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingWhenSyntax=void 0;var Y=R(51811),$=R(80758),v=function(){function ee(F){this._binding=F}return ee.prototype.when=function(F){return this._binding.constraint=F,new Y.BindingOnSyntax(this._binding)},ee.prototype.whenTargetNamed=function(F){return this._binding.constraint=$.namedConstraint(F),new Y.BindingOnSyntax(this._binding)},ee.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(F){var J=F.target!==null&&!F.target.isNamed()&&!F.target.isTagged();return J},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenTargetTagged=function(F,J){return this._binding.constraint=$.taggedConstraint(F)(J),new Y.BindingOnSyntax(this._binding)},ee.prototype.whenInjectedInto=function(F){return this._binding.constraint=function(J){return $.typeConstraint(F)(J.parentRequest)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenParentNamed=function(F){return this._binding.constraint=function(J){return $.namedConstraint(F)(J.parentRequest)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenParentTagged=function(F,J){return this._binding.constraint=function(re){return $.taggedConstraint(F)(J)(re.parentRequest)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorIs=function(F){return this._binding.constraint=function(J){return $.traverseAncerstors(J,$.typeConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorIs=function(F){return this._binding.constraint=function(J){return!$.traverseAncerstors(J,$.typeConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorNamed=function(F){return this._binding.constraint=function(J){return $.traverseAncerstors(J,$.namedConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorNamed=function(F){return this._binding.constraint=function(J){return!$.traverseAncerstors(J,$.namedConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorTagged=function(F,J){return this._binding.constraint=function(re){return $.traverseAncerstors(re,$.taggedConstraint(F)(J))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorTagged=function(F,J){return this._binding.constraint=function(re){return!$.traverseAncerstors(re,$.taggedConstraint(F)(J))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorMatches=function(F){return this._binding.constraint=function(J){return $.traverseAncerstors(J,F)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorMatches=function(F){return this._binding.constraint=function(J){return!$.traverseAncerstors(J,F)},new Y.BindingOnSyntax(this._binding)},ee}();H.BindingWhenSyntax=v},80758:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.typeConstraint=H.namedConstraint=H.taggedConstraint=H.traverseAncerstors=void 0;var Y=R(6867),$=R(47738),v=function(re,Ee){var ne=re.parentRequest;return ne!==null?Ee(ne)?!0:v(ne,Ee):!1};H.traverseAncerstors=v;var ee=function(re){return function(Ee){var ne=function(je){return je!==null&&je.target!==null&&je.target.matchesTag(re)(Ee)};return ne.metaData=new $.Metadata(re,Ee),ne}};H.taggedConstraint=ee;var F=ee(Y.NAMED_TAG);H.namedConstraint=F;var J=function(re){return function(Ee){var ne=null;if(Ee!==null)if(ne=Ee.bindings[0],typeof re=="string"){var je=ne.serviceIdentifier;return je===re}else{var we=Ee.bindings[0].implementationType;return re===we}return!1}};H.typeConstraint=J},70600:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.multiBindToService=void 0;var R=function(Y){return function($){return function(){for(var v=[],ee=0;ee<arguments.length;ee++)v[ee]=arguments[ee];return v.forEach(function(F){return Y.bind(F).toService($)})}}};H.multiBindToService=R},85265:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.isStackOverflowExeption=void 0;var Y=R(16674);function $(v){return v instanceof RangeError||v.message===Y.STACK_OVERFLOW}H.isStackOverflowExeption=$},37791:function(Ue,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.id=void 0;var R=0;function Y(){return R++}H.id=Y},55800:function(Ue,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.circularDependencyToException=H.listMetadataForTarget=H.listRegisteredBindingsForServiceIdentifier=H.getServiceIdentifierAsString=H.getFunctionName=void 0;var Y=R(16674);function $(ne){if(typeof ne=="function"){var je=ne;return je.name}else{if(typeof ne=="symbol")return ne.toString();var je=ne;return je}}H.getServiceIdentifierAsString=$;function v(ne,je,we){var et="",Mt=we(ne,je);return Mt.length!==0&&(et=`
Registered bindings:`,Mt.forEach(function(nr){var _t="Object";nr.implementationType!==null&&(_t=Ee(nr.implementationType)),et=et+`
 `+_t,nr.constraint.metaData&&(et=et+" - "+nr.constraint.metaData)})),et}H.listRegisteredBindingsForServiceIdentifier=v;function ee(ne,je){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===je?!0:ee(ne.parentRequest,je)}function F(ne){function je(et,Mt){Mt===void 0&&(Mt=[]);var nr=$(et.serviceIdentifier);return Mt.push(nr),et.parentRequest!==null?je(et.parentRequest,Mt):Mt}var we=je(ne);return we.reverse().join(" --> ")}function J(ne){ne.childRequests.forEach(function(je){if(ee(je,je.serviceIdentifier)){var we=F(je);throw new Error(Y.CIRCULAR_DEPENDENCY+" "+we)}else J(je)})}H.circularDependencyToException=J;function re(ne,je){if(je.isTagged()||je.isNamed()){var we="",et=je.getNamedTag(),Mt=je.getCustomTags();return et!==null&&(we+=et.toString()+`
`),Mt!==null&&Mt.forEach(function(nr){we+=nr.toString()+`
`})," "+ne+`
 `+ne+" - "+we}else return" "+ne}H.listMetadataForTarget=re;function Ee(ne){if(ne.name)return ne.name;var je=ne.toString(),we=je.match(/^function\s*([^\s(]+)/);return we?we[1]:"Anonymous function: "+je}H.getFunctionName=Ee},31745:function(Ue){"use strict";Ue.exports=R,Ue.exports.default=R;var H=1e20;function R(F,J,re,Ee,ne,je){this.fontSize=F||24,this.buffer=J===void 0?3:J,this.cutoff=Ee||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=je||"normal",this.radius=re||8;var we=this.size=this.fontSize+this.buffer*2,et=we+this.buffer*2,Mt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Mt?this.canvas=my.createOffscreenCanvas(we,we,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=we),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(et*et),this.gridInner=new Float64Array(et*et),this.f=new Float64Array(et),this.z=new Float64Array(et+1),this.v=new Uint16Array(et),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Mt?this.middle=Math.round(we/2*1):this.middle=Math.round(we/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Y(F,J,re,Ee,ne,je,we){je.fill(H,0,J*re),we.fill(0,0,J*re);for(var et=(J-Ee)/2,Mt=0;Mt<ne;Mt++)for(var nr=0;nr<Ee;nr++){var _t=(Mt+et)*J+nr+et,Xt=F.data[4*(Mt*Ee+nr)+3]/255;if(Xt===1)je[_t]=0,we[_t]=H;else if(Xt===0)je[_t]=H,we[_t]=0;else{var Ct=Math.max(0,.5-Xt),ot=Math.max(0,Xt-.5);je[_t]=Ct*Ct,we[_t]=ot*ot}}}function $(F,J,re,Ee,ne,je,we){for(var et=0;et<J*re;et++){var Mt=Math.sqrt(Ee[et])-Math.sqrt(ne[et]);F[et]=Math.round(255-255*(Mt/je+we))}}R.prototype._draw=function(F,J){var re=this.ctx.measureText(F),Ee=re.width,ne=2*this.buffer,je,we,et,Mt,nr,_t,Xt,Ct;J&&this.useMetrics?(nr=Math.floor(re.actualBoundingBoxAscent),Ct=this.buffer+Math.ceil(re.actualBoundingBoxAscent),_t=this.buffer,Xt=this.buffer,we=Math.min(this.size,Math.ceil(re.actualBoundingBoxRight-re.actualBoundingBoxLeft)),Mt=Math.min(this.size-_t,Math.ceil(re.actualBoundingBoxAscent+re.actualBoundingBoxDescent)),je=we+ne,et=Mt+ne,this.ctx.textBaseline="alphabetic"):(je=we=this.size,et=Mt=this.size,nr=19*this.fontSize/24,_t=Xt=0,Ct=this.middle,this.ctx.textBaseline="middle");var ot;we&&Mt&&(this.ctx.clearRect(Xt,_t,we,Mt),this.ctx.fillText(F,this.buffer,Ct),ot=this.ctx.getImageData(Xt,_t,we,Mt));var ut=new Uint8ClampedArray(je*et);return Y(ot,je,et,we,Mt,this.gridOuter,this.gridInner),v(this.gridOuter,je,et,this.f,this.v,this.z),v(this.gridInner,je,et,this.f,this.v,this.z),$(ut,je,et,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:ut,metrics:{width:we,height:Mt,sdfWidth:je,sdfHeight:et,top:nr,left:0,advance:Ee}}},R.prototype.draw=function(F){return this._draw(F,!1).data},R.prototype.drawWithMetrics=function(F){return this._draw(F,!0)};function v(F,J,re,Ee,ne,je){for(var we=0;we<J;we++)ee(F,we,J,re,Ee,ne,je);for(var et=0;et<re;et++)ee(F,et*J,1,J,Ee,ne,je)}function ee(F,J,re,Ee,ne,je,we){var et,Mt,nr,_t;for(je[0]=0,we[0]=-H,we[1]=H,et=0;et<Ee;et++)ne[et]=F[J+et*re];for(et=1,Mt=0,nr=0;et<Ee;et++){do _t=je[Mt],nr=(ne[et]-ne[_t]+et*et-_t*_t)/(et-_t)/2;while(nr<=we[Mt]&&--Mt>-1);Mt++,je[Mt]=et,we[Mt]=nr,we[Mt+1]=H}for(et=0,Mt=0;et<Ee;et++){for(;we[Mt+1]<et;)Mt++;_t=je[Mt],F[J+et*re]=ne[_t]+(et-_t)*(et-_t)}}},18857:function(Ue,H,R){"use strict";R.r(H),R.d(H,{Function:function(){return iu},Interpreter:function(){return po},default:function(){return ju},evaluate:function(){return Zu},vm:function(){return Y}});var Y={};R.r(Y),R.d(Y,{Script:function(){return Sl},compileFunction:function(){return Ec},createContext:function(){return Xl},runInContext:function(){return Uu},runInNewContext:function(){return Sc}});var $={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ee={5:v,"5module":v+" export import",6:v+" const class extends export import super"},F=/^in(stanceof)?$/,J="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",re="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ee=new RegExp("["+J+"]"),ne=new RegExp("["+J+re+"]");J=re=null;var je=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],we=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function et(y,C){for(var N=65536,O=0;O<C.length;O+=2){if(N+=C[O],N>y)return!1;if(N+=C[O+1],N>=y)return!0}}function Mt(y,C){return y<65?y===36:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&Ee.test(String.fromCharCode(y)):C===!1?!1:et(y,je)}function nr(y,C){return y<48?y===36:y<58?!0:y<65?!1:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&ne.test(String.fromCharCode(y)):C===!1?!1:et(y,je)||et(y,we)}var _t=function(C,N){N===void 0&&(N={}),this.label=C,this.keyword=N.keyword,this.beforeExpr=!!N.beforeExpr,this.startsExpr=!!N.startsExpr,this.isLoop=!!N.isLoop,this.isAssign=!!N.isAssign,this.prefix=!!N.prefix,this.postfix=!!N.postfix,this.binop=N.binop||null,this.updateContext=null};function Xt(y,C){return new _t(y,{beforeExpr:!0,binop:C})}var Ct={beforeExpr:!0},ot={startsExpr:!0},ut={};function Jt(y,C){return C===void 0&&(C={}),C.keyword=y,ut[y]=new _t(y,C)}var X={num:new _t("num",ot),regexp:new _t("regexp",ot),string:new _t("string",ot),name:new _t("name",ot),eof:new _t("eof"),bracketL:new _t("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new _t("]"),braceL:new _t("{",{beforeExpr:!0,startsExpr:!0}),braceR:new _t("}"),parenL:new _t("(",{beforeExpr:!0,startsExpr:!0}),parenR:new _t(")"),comma:new _t(",",Ct),semi:new _t(";",Ct),colon:new _t(":",Ct),dot:new _t("."),question:new _t("?",Ct),questionDot:new _t("?."),arrow:new _t("=>",Ct),template:new _t("template"),invalidTemplate:new _t("invalidTemplate"),ellipsis:new _t("...",Ct),backQuote:new _t("`",ot),dollarBraceL:new _t("${",{beforeExpr:!0,startsExpr:!0}),eq:new _t("=",{beforeExpr:!0,isAssign:!0}),assign:new _t("_=",{beforeExpr:!0,isAssign:!0}),incDec:new _t("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new _t("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Xt("||",1),logicalAND:Xt("&&",2),bitwiseOR:Xt("|",3),bitwiseXOR:Xt("^",4),bitwiseAND:Xt("&",5),equality:Xt("==/!=/===/!==",6),relational:Xt("</>/<=/>=",7),bitShift:Xt("<</>>/>>>",8),plusMin:new _t("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Xt("%",10),star:Xt("*",10),slash:Xt("/",10),starstar:new _t("**",{beforeExpr:!0}),coalesce:Xt("??",1),_break:Jt("break"),_case:Jt("case",Ct),_catch:Jt("catch"),_continue:Jt("continue"),_debugger:Jt("debugger"),_default:Jt("default",Ct),_do:Jt("do",{isLoop:!0,beforeExpr:!0}),_else:Jt("else",Ct),_finally:Jt("finally"),_for:Jt("for",{isLoop:!0}),_function:Jt("function",ot),_if:Jt("if"),_return:Jt("return",Ct),_switch:Jt("switch"),_throw:Jt("throw",Ct),_try:Jt("try"),_var:Jt("var"),_const:Jt("const"),_while:Jt("while",{isLoop:!0}),_with:Jt("with"),_new:Jt("new",{beforeExpr:!0,startsExpr:!0}),_this:Jt("this",ot),_super:Jt("super",ot),_class:Jt("class",ot),_extends:Jt("extends",Ct),_export:Jt("export"),_import:Jt("import",ot),_null:Jt("null",ot),_true:Jt("true",ot),_false:Jt("false",ot),_in:Jt("in",{beforeExpr:!0,binop:7}),_instanceof:Jt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Jt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Jt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Jt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Yt=/\r\n?|\n|\u2028|\u2029/,dt=new RegExp(Yt.source,"g");function qe(y,C){return y===10||y===13||!C&&(y===8232||y===8233)}var ht=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Rt=Object.prototype,yr=Rt.hasOwnProperty,Rr=Rt.toString;function Hr(y,C){return yr.call(y,C)}var Te=Array.isArray||function(y){return Rr.call(y)==="[object Array]"};function Ye(y){return new RegExp("^(?:"+y.replace(/ /g,"|")+")$")}var ke=function(C,N){this.line=C,this.column=N};ke.prototype.offset=function(C){return new ke(this.line,this.column+C)};var At=function(C,N,O){this.start=N,this.end=O,C.sourceFile!==null&&(this.source=C.sourceFile)};function gt(y,C){for(var N=1,O=0;;){dt.lastIndex=O;var q=dt.exec(y);if(q&&q.index<C)++N,O=q.index+q[0].length;else return new ke(N,C-O)}}var Ft={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function qt(y){var C={};for(var N in Ft)C[N]=y&&Hr(y,N)?y[N]:Ft[N];if(C.ecmaVersion>=2015&&(C.ecmaVersion-=2009),C.allowReserved==null&&(C.allowReserved=C.ecmaVersion<5),Te(C.onToken)){var O=C.onToken;C.onToken=function(q){return O.push(q)}}return Te(C.onComment)&&(C.onComment=Cr(C,C.onComment)),C}function Cr(y,C){return function(N,O,q,_e,We,lt){var vt={type:N?"Block":"Line",value:O,start:q,end:_e};y.locations&&(vt.loc=new At(this,We,lt)),y.ranges&&(vt.range=[q,_e]),C.push(vt)}}var Hn=1,hn=2,Ki=Hn|hn,Bn=4,Gn=8,hi=16,Wn=32,si=64,aa=128;function Ri(y,C){return hn|(y?Bn:0)|(C?Gn:0)}var Si=0,Vi=1,ua=2,wi=3,xa=4,An=5,yi=function(C,N,O){this.options=C=qt(C),this.sourceFile=C.sourceFile,this.keywords=Ye(ee[C.ecmaVersion>=6?6:C.sourceType==="module"?"5module":5]);var q="";if(C.allowReserved!==!0){for(var _e=C.ecmaVersion;!(q=$[_e]);_e--);C.sourceType==="module"&&(q+=" await")}this.reservedWords=Ye(q);var We=(q?q+" ":"")+$.strict;this.reservedWordsStrict=Ye(We),this.reservedWordsStrictBind=Ye(We+" "+$.strictBind),this.input=String(N),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Yt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=X.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=C.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&C.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Hn),this.regexpState=null},zi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};yi.prototype.parse=function(){var C=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(C)},zi.inFunction.get=function(){return(this.currentVarScope().flags&hn)>0},zi.inGenerator.get=function(){return(this.currentVarScope().flags&Gn)>0},zi.inAsync.get=function(){return(this.currentVarScope().flags&Bn)>0},zi.allowSuper.get=function(){return(this.currentThisScope().flags&si)>0},zi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&aa)>0},zi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},yi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&hn)>0},yi.extend=function(){for(var C=[],N=arguments.length;N--;)C[N]=arguments[N];for(var O=this,q=0;q<C.length;q++)O=C[q](O);return O},yi.parse=function(C,N){return new this(N,C).parse()},yi.parseExpressionAt=function(C,N,O){var q=new this(O,C,N);return q.nextToken(),q.parseExpression()},yi.tokenizer=function(C,N){return new this(N,C)},Object.defineProperties(yi.prototype,zi);var $i=yi.prototype,ja=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;$i.strictDirective=function(y){for(;;){$e.lastIndex=y,y+=$e.exec(this.input)[0].length;var C=ja.exec(this.input.slice(y));if(!C)return!1;if((C[1]||C[2])==="use strict"){$e.lastIndex=y+C[0].length;var N=$e.exec(this.input),O=N.index+N[0].length,q=this.input.charAt(O);return q===";"||q==="}"||Yt.test(N[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(q)||q==="!"&&this.input.charAt(O+1)==="=")}y+=C[0].length,$e.lastIndex=y,y+=$e.exec(this.input)[0].length,this.input[y]===";"&&y++}},$i.eat=function(y){return this.type===y?(this.next(),!0):!1},$i.isContextual=function(y){return this.type===X.name&&this.value===y&&!this.containsEsc},$i.eatContextual=function(y){return this.isContextual(y)?(this.next(),!0):!1},$i.expectContextual=function(y){this.eatContextual(y)||this.unexpected()},$i.canInsertSemicolon=function(){return this.type===X.eof||this.type===X.braceR||Yt.test(this.input.slice(this.lastTokEnd,this.start))},$i.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},$i.semicolon=function(){!this.eat(X.semi)&&!this.insertSemicolon()&&this.unexpected()},$i.afterTrailingComma=function(y,C){if(this.type===y)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),C||this.next(),!0},$i.expect=function(y){this.eat(y)||this.unexpected()},$i.unexpected=function(y){this.raise(y!=null?y:this.start,"Unexpected token")};function me(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}$i.checkPatternErrors=function(y,C){if(!!y){y.trailingComma>-1&&this.raiseRecoverable(y.trailingComma,"Comma is not permitted after the rest element");var N=C?y.parenthesizedAssign:y.parenthesizedBind;N>-1&&this.raiseRecoverable(N,"Parenthesized pattern")}},$i.checkExpressionErrors=function(y,C){if(!y)return!1;var N=y.shorthandAssign,O=y.doubleProto;if(!C)return N>=0||O>=0;N>=0&&this.raise(N,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},$i.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},$i.isSimpleAssignTarget=function(y){return y.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(y.expression):y.type==="Identifier"||y.type==="MemberExpression"};var Ln=yi.prototype;Ln.parseTopLevel=function(y){var C={};for(y.body||(y.body=[]);this.type!==X.eof;){var N=this.parseStatement(null,!0,C);y.body.push(N)}if(this.inModule)for(var O=0,q=Object.keys(this.undefinedExports);O<q.length;O+=1){var _e=q[O];this.raiseRecoverable(this.undefinedExports[_e].start,"Export '"+_e+"' is not defined")}return this.adaptDirectivePrologue(y.body),this.next(),y.sourceType=this.options.sourceType,this.finishNode(y,"Program")};var Va={kind:"loop"},fs={kind:"switch"};Ln.isLet=function(y){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var C=$e.exec(this.input),N=this.pos+C[0].length,O=this.input.charCodeAt(N);if(O===91)return!0;if(y)return!1;if(O===123)return!0;if(Mt(O,!0)){for(var q=N+1;nr(this.input.charCodeAt(q),!0);)++q;var _e=this.input.slice(N,q);if(!F.test(_e))return!0}return!1},Ln.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var y=$e.exec(this.input),C=this.pos+y[0].length;return!Yt.test(this.input.slice(this.pos,C))&&this.input.slice(C,C+8)==="function"&&(C+8===this.input.length||!nr(this.input.charAt(C+8)))},Ln.parseStatement=function(y,C,N){var O=this.type,q=this.startNode(),_e;switch(this.isLet(y)&&(O=X._var,_e="let"),O){case X._break:case X._continue:return this.parseBreakContinueStatement(q,O.keyword);case X._debugger:return this.parseDebuggerStatement(q);case X._do:return this.parseDoStatement(q);case X._for:return this.parseForStatement(q);case X._function:return y&&(this.strict||y!=="if"&&y!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(q,!1,!y);case X._class:return y&&this.unexpected(),this.parseClass(q,!0);case X._if:return this.parseIfStatement(q);case X._return:return this.parseReturnStatement(q);case X._switch:return this.parseSwitchStatement(q);case X._throw:return this.parseThrowStatement(q);case X._try:return this.parseTryStatement(q);case X._const:case X._var:return _e=_e||this.value,y&&_e!=="var"&&this.unexpected(),this.parseVarStatement(q,_e);case X._while:return this.parseWhileStatement(q);case X._with:return this.parseWithStatement(q);case X.braceL:return this.parseBlock(!0,q);case X.semi:return this.parseEmptyStatement(q);case X._export:case X._import:if(this.options.ecmaVersion>10&&O===X._import){$e.lastIndex=this.pos;var We=$e.exec(this.input),lt=this.pos+We[0].length,vt=this.input.charCodeAt(lt);if(vt===40||vt===46)return this.parseExpressionStatement(q,this.parseExpression())}return this.options.allowImportExportEverywhere||(C||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===X._import?this.parseImport(q):this.parseExport(q,N);default:if(this.isAsyncFunction())return y&&this.unexpected(),this.next(),this.parseFunctionStatement(q,!0,!y);var lr=this.value,Er=this.parseExpression();return O===X.name&&Er.type==="Identifier"&&this.eat(X.colon)?this.parseLabeledStatement(q,lr,Er,y):this.parseExpressionStatement(q,Er)}},Ln.parseBreakContinueStatement=function(y,C){var N=C==="break";this.next(),this.eat(X.semi)||this.insertSemicolon()?y.label=null:this.type!==X.name?this.unexpected():(y.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var q=this.labels[O];if((y.label==null||q.name===y.label.name)&&(q.kind!=null&&(N||q.kind==="loop")||y.label&&N))break}return O===this.labels.length&&this.raise(y.start,"Unsyntactic "+C),this.finishNode(y,N?"BreakStatement":"ContinueStatement")},Ln.parseDebuggerStatement=function(y){return this.next(),this.semicolon(),this.finishNode(y,"DebuggerStatement")},Ln.parseDoStatement=function(y){return this.next(),this.labels.push(Va),y.body=this.parseStatement("do"),this.labels.pop(),this.expect(X._while),y.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(X.semi):this.semicolon(),this.finishNode(y,"DoWhileStatement")},Ln.parseForStatement=function(y){this.next();var C=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Va),this.enterScope(0),this.expect(X.parenL),this.type===X.semi)return C>-1&&this.unexpected(C),this.parseFor(y,null);var N=this.isLet();if(this.type===X._var||this.type===X._const||N){var O=this.startNode(),q=N?"let":this.value;return this.next(),this.parseVar(O,!0,q),this.finishNode(O,"VariableDeclaration"),(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===X._in?C>-1&&this.unexpected(C):y.await=C>-1),this.parseForIn(y,O)):(C>-1&&this.unexpected(C),this.parseFor(y,O))}var _e=new me,We=this.parseExpression(!0,_e);return this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===X._in?C>-1&&this.unexpected(C):y.await=C>-1),this.toAssignable(We,!1,_e),this.checkLVal(We),this.parseForIn(y,We)):(this.checkExpressionErrors(_e,!0),C>-1&&this.unexpected(C),this.parseFor(y,We))},Ln.parseFunctionStatement=function(y,C,N){return this.next(),this.parseFunction(y,ir|(N?0:Ir),!1,C)},Ln.parseIfStatement=function(y){return this.next(),y.test=this.parseParenExpression(),y.consequent=this.parseStatement("if"),y.alternate=this.eat(X._else)?this.parseStatement("if"):null,this.finishNode(y,"IfStatement")},Ln.parseReturnStatement=function(y){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(X.semi)||this.insertSemicolon()?y.argument=null:(y.argument=this.parseExpression(),this.semicolon()),this.finishNode(y,"ReturnStatement")},Ln.parseSwitchStatement=function(y){this.next(),y.discriminant=this.parseParenExpression(),y.cases=[],this.expect(X.braceL),this.labels.push(fs),this.enterScope(0);for(var C,N=!1;this.type!==X.braceR;)if(this.type===X._case||this.type===X._default){var O=this.type===X._case;C&&this.finishNode(C,"SwitchCase"),y.cases.push(C=this.startNode()),C.consequent=[],this.next(),O?C.test=this.parseExpression():(N&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),N=!0,C.test=null),this.expect(X.colon)}else C||this.unexpected(),C.consequent.push(this.parseStatement(null));return this.exitScope(),C&&this.finishNode(C,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(y,"SwitchStatement")},Ln.parseThrowStatement=function(y){return this.next(),Yt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),y.argument=this.parseExpression(),this.semicolon(),this.finishNode(y,"ThrowStatement")};var zt=[];Ln.parseTryStatement=function(y){if(this.next(),y.block=this.parseBlock(),y.handler=null,this.type===X._catch){var C=this.startNode();if(this.next(),this.eat(X.parenL)){C.param=this.parseBindingAtom();var N=C.param.type==="Identifier";this.enterScope(N?Wn:0),this.checkLVal(C.param,N?xa:ua),this.expect(X.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),C.param=null,this.enterScope(0);C.body=this.parseBlock(!1),this.exitScope(),y.handler=this.finishNode(C,"CatchClause")}return y.finalizer=this.eat(X._finally)?this.parseBlock():null,!y.handler&&!y.finalizer&&this.raise(y.start,"Missing catch or finally clause"),this.finishNode(y,"TryStatement")},Ln.parseVarStatement=function(y,C){return this.next(),this.parseVar(y,!1,C),this.semicolon(),this.finishNode(y,"VariableDeclaration")},Ln.parseWhileStatement=function(y){return this.next(),y.test=this.parseParenExpression(),this.labels.push(Va),y.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(y,"WhileStatement")},Ln.parseWithStatement=function(y){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),y.object=this.parseParenExpression(),y.body=this.parseStatement("with"),this.finishNode(y,"WithStatement")},Ln.parseEmptyStatement=function(y){return this.next(),this.finishNode(y,"EmptyStatement")},Ln.parseLabeledStatement=function(y,C,N,O){for(var q=0,_e=this.labels;q<_e.length;q+=1){var We=_e[q];We.name===C&&this.raise(N.start,"Label '"+C+"' is already declared")}for(var lt=this.type.isLoop?"loop":this.type===X._switch?"switch":null,vt=this.labels.length-1;vt>=0;vt--){var lr=this.labels[vt];if(lr.statementStart===y.start)lr.statementStart=this.start,lr.kind=lt;else break}return this.labels.push({name:C,kind:lt,statementStart:this.start}),y.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),y.label=N,this.finishNode(y,"LabeledStatement")},Ln.parseExpressionStatement=function(y,C){return y.expression=C,this.semicolon(),this.finishNode(y,"ExpressionStatement")},Ln.parseBlock=function(y,C,N){for(y===void 0&&(y=!0),C===void 0&&(C=this.startNode()),C.body=[],this.expect(X.braceL),y&&this.enterScope(0);this.type!==X.braceR;){var O=this.parseStatement(null);C.body.push(O)}return N&&(this.strict=!1),this.next(),y&&this.exitScope(),this.finishNode(C,"BlockStatement")},Ln.parseFor=function(y,C){return y.init=C,this.expect(X.semi),y.test=this.type===X.semi?null:this.parseExpression(),this.expect(X.semi),y.update=this.type===X.parenR?null:this.parseExpression(),this.expect(X.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,"ForStatement")},Ln.parseForIn=function(y,C){var N=this.type===X._in;return this.next(),C.type==="VariableDeclaration"&&C.declarations[0].init!=null&&(!N||this.options.ecmaVersion<8||this.strict||C.kind!=="var"||C.declarations[0].id.type!=="Identifier")?this.raise(C.start,(N?"for-in":"for-of")+" loop variable declaration may not have an initializer"):C.type==="AssignmentPattern"&&this.raise(C.start,"Invalid left-hand side in for-loop"),y.left=C,y.right=N?this.parseExpression():this.parseMaybeAssign(),this.expect(X.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,N?"ForInStatement":"ForOfStatement")},Ln.parseVar=function(y,C,N){for(y.declarations=[],y.kind=N;;){var O=this.startNode();if(this.parseVarId(O,N),this.eat(X.eq)?O.init=this.parseMaybeAssign(C):N==="const"&&!(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(C&&(this.type===X._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,y.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(X.comma))break}return y},Ln.parseVarId=function(y,C){y.id=this.parseBindingAtom(),this.checkLVal(y.id,C==="var"?Vi:ua,!1)};var ir=1,Ir=2,I=4;Ln.parseFunction=function(y,C,N,O){this.initFunction(y),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===X.star&&C&Ir&&this.unexpected(),y.generator=this.eat(X.star)),this.options.ecmaVersion>=8&&(y.async=!!O),C&ir&&(y.id=C&I&&this.type!==X.name?null:this.parseIdent(),y.id&&!(C&Ir)&&this.checkLVal(y.id,this.strict||y.generator||y.async?this.treatFunctionsAsVar?Vi:ua:wi));var q=this.yieldPos,_e=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(y.async,y.generator)),C&ir||(y.id=this.type===X.name?this.parseIdent():null),this.parseFunctionParams(y),this.parseFunctionBody(y,N,!1),this.yieldPos=q,this.awaitPos=_e,this.awaitIdentPos=We,this.finishNode(y,C&ir?"FunctionDeclaration":"FunctionExpression")},Ln.parseFunctionParams=function(y){this.expect(X.parenL),y.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Ln.parseClass=function(y,C){this.next();var N=this.strict;this.strict=!0,this.parseClassId(y,C),this.parseClassSuper(y);var O=this.startNode(),q=!1;for(O.body=[],this.expect(X.braceL);this.type!==X.braceR;){var _e=this.parseClassElement(y.superClass!==null);_e&&(O.body.push(_e),_e.type==="MethodDefinition"&&_e.kind==="constructor"&&(q&&this.raise(_e.start,"Duplicate constructor in the same class"),q=!0))}return this.strict=N,this.next(),y.body=this.finishNode(O,"ClassBody"),this.finishNode(y,C?"ClassDeclaration":"ClassExpression")},Ln.parseClassElement=function(y){var C=this;if(this.eat(X.semi))return null;var N=this.startNode(),O=function(vt,lr){lr===void 0&&(lr=!1);var Er=C.start,Mn=C.startLoc;return C.eatContextual(vt)?C.type!==X.parenL&&(!lr||!C.canInsertSemicolon())?!0:(N.key&&C.unexpected(),N.computed=!1,N.key=C.startNodeAt(Er,Mn),N.key.name=vt,C.finishNode(N.key,"Identifier"),!1):!1};N.kind="method",N.static=O("static");var q=this.eat(X.star),_e=!1;q||(this.options.ecmaVersion>=8&&O("async",!0)?(_e=!0,q=this.options.ecmaVersion>=9&&this.eat(X.star)):O("get")?N.kind="get":O("set")&&(N.kind="set")),N.key||this.parsePropertyName(N);var We=N.key,lt=!1;return!N.computed&&!N.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(N.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),q&&this.raise(We.start,"Constructor can't be a generator"),_e&&this.raise(We.start,"Constructor can't be an async method"),N.kind="constructor",lt=y):N.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(N,q,_e,lt),N.kind==="get"&&N.value.params.length!==0&&this.raiseRecoverable(N.value.start,"getter should have no params"),N.kind==="set"&&N.value.params.length!==1&&this.raiseRecoverable(N.value.start,"setter should have exactly one param"),N.kind==="set"&&N.value.params[0].type==="RestElement"&&this.raiseRecoverable(N.value.params[0].start,"Setter cannot use rest params"),N},Ln.parseClassMethod=function(y,C,N,O){return y.value=this.parseMethod(C,N,O),this.finishNode(y,"MethodDefinition")},Ln.parseClassId=function(y,C){this.type===X.name?(y.id=this.parseIdent(),C&&this.checkLVal(y.id,ua,!1)):(C===!0&&this.unexpected(),y.id=null)},Ln.parseClassSuper=function(y){y.superClass=this.eat(X._extends)?this.parseExprSubscripts():null},Ln.parseExport=function(y,C){if(this.next(),this.eat(X.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(y.exported=this.parseIdent(!0),this.checkExport(C,y.exported.name,this.lastTokStart)):y.exported=null),this.expectContextual("from"),this.type!==X.string&&this.unexpected(),y.source=this.parseExprAtom(),this.semicolon(),this.finishNode(y,"ExportAllDeclaration");if(this.eat(X._default)){this.checkExport(C,"default",this.lastTokStart);var N;if(this.type===X._function||(N=this.isAsyncFunction())){var O=this.startNode();this.next(),N&&this.next(),y.declaration=this.parseFunction(O,ir|I,!1,N)}else if(this.type===X._class){var q=this.startNode();y.declaration=this.parseClass(q,"nullableID")}else y.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(y,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())y.declaration=this.parseStatement(null),y.declaration.type==="VariableDeclaration"?this.checkVariableExport(C,y.declaration.declarations):this.checkExport(C,y.declaration.id.name,y.declaration.id.start),y.specifiers=[],y.source=null;else{if(y.declaration=null,y.specifiers=this.parseExportSpecifiers(C),this.eatContextual("from"))this.type!==X.string&&this.unexpected(),y.source=this.parseExprAtom();else{for(var _e=0,We=y.specifiers;_e<We.length;_e+=1){var lt=We[_e];this.checkUnreserved(lt.local),this.checkLocalExport(lt.local)}y.source=null}this.semicolon()}return this.finishNode(y,"ExportNamedDeclaration")},Ln.checkExport=function(y,C,N){!y||(Hr(y,C)&&this.raiseRecoverable(N,"Duplicate export '"+C+"'"),y[C]=!0)},Ln.checkPatternExport=function(y,C){var N=C.type;if(N==="Identifier")this.checkExport(y,C.name,C.start);else if(N==="ObjectPattern")for(var O=0,q=C.properties;O<q.length;O+=1){var _e=q[O];this.checkPatternExport(y,_e)}else if(N==="ArrayPattern")for(var We=0,lt=C.elements;We<lt.length;We+=1){var vt=lt[We];vt&&this.checkPatternExport(y,vt)}else N==="Property"?this.checkPatternExport(y,C.value):N==="AssignmentPattern"?this.checkPatternExport(y,C.left):N==="RestElement"?this.checkPatternExport(y,C.argument):N==="ParenthesizedExpression"&&this.checkPatternExport(y,C.expression)},Ln.checkVariableExport=function(y,C){if(!!y)for(var N=0,O=C;N<O.length;N+=1){var q=O[N];this.checkPatternExport(y,q.id)}},Ln.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Ln.parseExportSpecifiers=function(y){var C=[],N=!0;for(this.expect(X.braceL);!this.eat(X.braceR);){if(N)N=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(y,O.exported.name,O.exported.start),C.push(this.finishNode(O,"ExportSpecifier"))}return C},Ln.parseImport=function(y){return this.next(),this.type===X.string?(y.specifiers=zt,y.source=this.parseExprAtom()):(y.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),y.source=this.type===X.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(y,"ImportDeclaration")},Ln.parseImportSpecifiers=function(){var y=[],C=!0;if(this.type===X.name){var N=this.startNode();if(N.local=this.parseIdent(),this.checkLVal(N.local,ua),y.push(this.finishNode(N,"ImportDefaultSpecifier")),!this.eat(X.comma))return y}if(this.type===X.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ua),y.push(this.finishNode(O,"ImportNamespaceSpecifier")),y}for(this.expect(X.braceL);!this.eat(X.braceR);){if(C)C=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var q=this.startNode();q.imported=this.parseIdent(!0),this.eatContextual("as")?q.local=this.parseIdent():(this.checkUnreserved(q.imported),q.local=q.imported),this.checkLVal(q.local,ua),y.push(this.finishNode(q,"ImportSpecifier"))}return y},Ln.adaptDirectivePrologue=function(y){for(var C=0;C<y.length&&this.isDirectiveCandidate(y[C]);++C)y[C].directive=y[C].expression.raw.slice(1,-1)},Ln.isDirectiveCandidate=function(y){return y.type==="ExpressionStatement"&&y.expression.type==="Literal"&&typeof y.expression.value=="string"&&(this.input[y.start]==='"'||this.input[y.start]==="'")};var sr=yi.prototype;sr.toAssignable=function(y,C,N){if(this.options.ecmaVersion>=6&&y)switch(y.type){case"Identifier":this.inAsync&&y.name==="await"&&this.raise(y.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":y.type="ObjectPattern",N&&this.checkPatternErrors(N,!0);for(var O=0,q=y.properties;O<q.length;O+=1){var _e=q[O];this.toAssignable(_e,C),_e.type==="RestElement"&&(_e.argument.type==="ArrayPattern"||_e.argument.type==="ObjectPattern")&&this.raise(_e.argument.start,"Unexpected token")}break;case"Property":y.kind!=="init"&&this.raise(y.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(y.value,C);break;case"ArrayExpression":y.type="ArrayPattern",N&&this.checkPatternErrors(N,!0),this.toAssignableList(y.elements,C);break;case"SpreadElement":y.type="RestElement",this.toAssignable(y.argument,C),y.argument.type==="AssignmentPattern"&&this.raise(y.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":y.operator!=="="&&this.raise(y.left.end,"Only '=' operator can be used for specifying default value."),y.type="AssignmentPattern",delete y.operator,this.toAssignable(y.left,C);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(y.expression,C,N);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!C)break;default:this.raise(y.start,"Assigning to rvalue")}else N&&this.checkPatternErrors(N,!0);return y},sr.toAssignableList=function(y,C){for(var N=y.length,O=0;O<N;O++){var q=y[O];q&&this.toAssignable(q,C)}if(N){var _e=y[N-1];this.options.ecmaVersion===6&&C&&_e&&_e.type==="RestElement"&&_e.argument.type!=="Identifier"&&this.unexpected(_e.argument.start)}return y},sr.parseSpread=function(y){var C=this.startNode();return this.next(),C.argument=this.parseMaybeAssign(!1,y),this.finishNode(C,"SpreadElement")},sr.parseRestBinding=function(){var y=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==X.name&&this.unexpected(),y.argument=this.parseBindingAtom(),this.finishNode(y,"RestElement")},sr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case X.bracketL:var y=this.startNode();return this.next(),y.elements=this.parseBindingList(X.bracketR,!0,!0),this.finishNode(y,"ArrayPattern");case X.braceL:return this.parseObj(!0)}return this.parseIdent()},sr.parseBindingList=function(y,C,N){for(var O=[],q=!0;!this.eat(y);)if(q?q=!1:this.expect(X.comma),C&&this.type===X.comma)O.push(null);else{if(N&&this.afterTrailingComma(y))break;if(this.type===X.ellipsis){var _e=this.parseRestBinding();this.parseBindingListItem(_e),O.push(_e),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(y);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),O.push(We)}}return O},sr.parseBindingListItem=function(y){return y},sr.parseMaybeDefault=function(y,C,N){if(N=N||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(X.eq))return N;var O=this.startNodeAt(y,C);return O.left=N,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},sr.checkLVal=function(y,C,N){switch(C===void 0&&(C=Si),y.type){case"Identifier":C===ua&&y.name==="let"&&this.raiseRecoverable(y.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(y.name)&&this.raiseRecoverable(y.start,(C?"Binding ":"Assigning to ")+y.name+" in strict mode"),N&&(Hr(N,y.name)&&this.raiseRecoverable(y.start,"Argument name clash"),N[y.name]=!0),C!==Si&&C!==An&&this.declareName(y.name,C,y.start);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":C&&this.raiseRecoverable(y.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,q=y.properties;O<q.length;O+=1){var _e=q[O];this.checkLVal(_e,C,N)}break;case"Property":this.checkLVal(y.value,C,N);break;case"ArrayPattern":for(var We=0,lt=y.elements;We<lt.length;We+=1){var vt=lt[We];vt&&this.checkLVal(vt,C,N)}break;case"AssignmentPattern":this.checkLVal(y.left,C,N);break;case"RestElement":this.checkLVal(y.argument,C,N);break;case"ParenthesizedExpression":this.checkLVal(y.expression,C,N);break;default:this.raise(y.start,(C?"Binding":"Assigning to")+" rvalue")}};var On=yi.prototype;On.checkPropClash=function(y,C,N){if(!(this.options.ecmaVersion>=9&&y.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(y.computed||y.method||y.shorthand))){var O=y.key,q;switch(O.type){case"Identifier":q=O.name;break;case"Literal":q=String(O.value);break;default:return}var _e=y.kind;if(this.options.ecmaVersion>=6){q==="__proto__"&&_e==="init"&&(C.proto&&(N?N.doubleProto<0&&(N.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),C.proto=!0);return}q="$"+q;var We=C[q];if(We){var lt;_e==="init"?lt=this.strict&&We.init||We.get||We.set:lt=We.init||We[_e],lt&&this.raiseRecoverable(O.start,"Redefinition of property")}else We=C[q]={init:!1,get:!1,set:!1};We[_e]=!0}},On.parseExpression=function(y,C){var N=this.start,O=this.startLoc,q=this.parseMaybeAssign(y,C);if(this.type===X.comma){var _e=this.startNodeAt(N,O);for(_e.expressions=[q];this.eat(X.comma);)_e.expressions.push(this.parseMaybeAssign(y,C));return this.finishNode(_e,"SequenceExpression")}return q},On.parseMaybeAssign=function(y,C,N){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(y);this.exprAllowed=!1}var O=!1,q=-1,_e=-1;C?(q=C.parenthesizedAssign,_e=C.trailingComma,C.parenthesizedAssign=C.trailingComma=-1):(C=new me,O=!0);var We=this.start,lt=this.startLoc;(this.type===X.parenL||this.type===X.name)&&(this.potentialArrowAt=this.start);var vt=this.parseMaybeConditional(y,C);if(N&&(vt=N.call(this,vt,We,lt)),this.type.isAssign){var lr=this.startNodeAt(We,lt);return lr.operator=this.value,lr.left=this.type===X.eq?this.toAssignable(vt,!1,C):vt,O||(C.parenthesizedAssign=C.trailingComma=C.doubleProto=-1),C.shorthandAssign>=lr.left.start&&(C.shorthandAssign=-1),this.checkLVal(vt),this.next(),lr.right=this.parseMaybeAssign(y),this.finishNode(lr,"AssignmentExpression")}else O&&this.checkExpressionErrors(C,!0);return q>-1&&(C.parenthesizedAssign=q),_e>-1&&(C.trailingComma=_e),vt},On.parseMaybeConditional=function(y,C){var N=this.start,O=this.startLoc,q=this.parseExprOps(y,C);if(this.checkExpressionErrors(C))return q;if(this.eat(X.question)){var _e=this.startNodeAt(N,O);return _e.test=q,_e.consequent=this.parseMaybeAssign(),this.expect(X.colon),_e.alternate=this.parseMaybeAssign(y),this.finishNode(_e,"ConditionalExpression")}return q},On.parseExprOps=function(y,C){var N=this.start,O=this.startLoc,q=this.parseMaybeUnary(C,!1);return this.checkExpressionErrors(C)||q.start===N&&q.type==="ArrowFunctionExpression"?q:this.parseExprOp(q,N,O,-1,y)},On.parseExprOp=function(y,C,N,O,q){var _e=this.type.binop;if(_e!=null&&(!q||this.type!==X._in)&&_e>O){var We=this.type===X.logicalOR||this.type===X.logicalAND,lt=this.type===X.coalesce;lt&&(_e=X.logicalAND.binop);var vt=this.value;this.next();var lr=this.start,Er=this.startLoc,Mn=this.parseExprOp(this.parseMaybeUnary(null,!1),lr,Er,_e,q),li=this.buildBinary(C,N,y,Mn,vt,We||lt);return(We&&this.type===X.coalesce||lt&&(this.type===X.logicalOR||this.type===X.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(li,C,N,O,q)}return y},On.buildBinary=function(y,C,N,O,q,_e){var We=this.startNodeAt(y,C);return We.left=N,We.operator=q,We.right=O,this.finishNode(We,_e?"LogicalExpression":"BinaryExpression")},On.parseMaybeUnary=function(y,C){var N=this.start,O=this.startLoc,q;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))q=this.parseAwait(),C=!0;else if(this.type.prefix){var _e=this.startNode(),We=this.type===X.incDec;_e.operator=this.value,_e.prefix=!0,this.next(),_e.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(y,!0),We?this.checkLVal(_e.argument):this.strict&&_e.operator==="delete"&&_e.argument.type==="Identifier"?this.raiseRecoverable(_e.start,"Deleting local variable in strict mode"):C=!0,q=this.finishNode(_e,We?"UpdateExpression":"UnaryExpression")}else{if(q=this.parseExprSubscripts(y),this.checkExpressionErrors(y))return q;for(;this.type.postfix&&!this.canInsertSemicolon();){var lt=this.startNodeAt(N,O);lt.operator=this.value,lt.prefix=!1,lt.argument=q,this.checkLVal(q),this.next(),q=this.finishNode(lt,"UpdateExpression")}}return!C&&this.eat(X.starstar)?this.buildBinary(N,O,q,this.parseMaybeUnary(null,!1),"**",!1):q},On.parseExprSubscripts=function(y){var C=this.start,N=this.startLoc,O=this.parseExprAtom(y);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var q=this.parseSubscripts(O,C,N);return y&&q.type==="MemberExpression"&&(y.parenthesizedAssign>=q.start&&(y.parenthesizedAssign=-1),y.parenthesizedBind>=q.start&&(y.parenthesizedBind=-1)),q},On.parseSubscripts=function(y,C,N,O){for(var q=this.options.ecmaVersion>=8&&y.type==="Identifier"&&y.name==="async"&&this.lastTokEnd===y.end&&!this.canInsertSemicolon()&&y.end-y.start==5&&this.potentialArrowAt===y.start,_e=!1;;){var We=this.parseSubscript(y,C,N,O,q,_e);if(We.optional&&(_e=!0),We===y||We.type==="ArrowFunctionExpression"){if(_e){var lt=this.startNodeAt(C,N);lt.expression=We,We=this.finishNode(lt,"ChainExpression")}return We}y=We}},On.parseSubscript=function(y,C,N,O,q,_e){var We=this.options.ecmaVersion>=11,lt=We&&this.eat(X.questionDot);O&&lt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var vt=this.eat(X.bracketL);if(vt||lt&&this.type!==X.parenL&&this.type!==X.backQuote||this.eat(X.dot)){var lr=this.startNodeAt(C,N);lr.object=y,lr.property=vt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),lr.computed=!!vt,vt&&this.expect(X.bracketR),We&&(lr.optional=lt),y=this.finishNode(lr,"MemberExpression")}else if(!O&&this.eat(X.parenL)){var Er=new me,Mn=this.yieldPos,li=this.awaitPos,$n=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yi=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1,Er);if(q&&!lt&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(Er,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Mn,this.awaitPos=li,this.awaitIdentPos=$n,this.parseArrowExpression(this.startNodeAt(C,N),Yi,!0);this.checkExpressionErrors(Er,!0),this.yieldPos=Mn||this.yieldPos,this.awaitPos=li||this.awaitPos,this.awaitIdentPos=$n||this.awaitIdentPos;var fa=this.startNodeAt(C,N);fa.callee=y,fa.arguments=Yi,We&&(fa.optional=lt),y=this.finishNode(fa,"CallExpression")}else if(this.type===X.backQuote){(lt||_e)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Pa=this.startNodeAt(C,N);Pa.tag=y,Pa.quasi=this.parseTemplate({isTagged:!0}),y=this.finishNode(Pa,"TaggedTemplateExpression")}return y},On.parseExprAtom=function(y){this.type===X.slash&&this.readRegexp();var C,N=this.potentialArrowAt===this.start;switch(this.type){case X._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),C=this.startNode(),this.next(),this.type===X.parenL&&!this.allowDirectSuper&&this.raise(C.start,"super() call outside constructor of a subclass"),this.type!==X.dot&&this.type!==X.bracketL&&this.type!==X.parenL&&this.unexpected(),this.finishNode(C,"Super");case X._this:return C=this.startNode(),this.next(),this.finishNode(C,"ThisExpression");case X.name:var O=this.start,q=this.startLoc,_e=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!_e&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(X._function))return this.parseFunction(this.startNodeAt(O,q),0,!1,!0);if(N&&!this.canInsertSemicolon()){if(this.eat(X.arrow))return this.parseArrowExpression(this.startNodeAt(O,q),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===X.name&&!_e)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(X.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,q),[We],!0)}return We;case X.regexp:var lt=this.value;return C=this.parseLiteral(lt.value),C.regex={pattern:lt.pattern,flags:lt.flags},C;case X.num:case X.string:return this.parseLiteral(this.value);case X._null:case X._true:case X._false:return C=this.startNode(),C.value=this.type===X._null?null:this.type===X._true,C.raw=this.type.keyword,this.next(),this.finishNode(C,"Literal");case X.parenL:var vt=this.start,lr=this.parseParenAndDistinguishExpression(N);return y&&(y.parenthesizedAssign<0&&!this.isSimpleAssignTarget(lr)&&(y.parenthesizedAssign=vt),y.parenthesizedBind<0&&(y.parenthesizedBind=vt)),lr;case X.bracketL:return C=this.startNode(),this.next(),C.elements=this.parseExprList(X.bracketR,!0,!0,y),this.finishNode(C,"ArrayExpression");case X.braceL:return this.parseObj(!1,y);case X._function:return C=this.startNode(),this.next(),this.parseFunction(C,0);case X._class:return this.parseClass(this.startNode(),!1);case X._new:return this.parseNew();case X.backQuote:return this.parseTemplate();case X._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},On.parseExprImport=function(){var y=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var C=this.parseIdent(!0);switch(this.type){case X.parenL:return this.parseDynamicImport(y);case X.dot:return y.meta=C,this.parseImportMeta(y);default:this.unexpected()}},On.parseDynamicImport=function(y){if(this.next(),y.source=this.parseMaybeAssign(),!this.eat(X.parenR)){var C=this.start;this.eat(X.comma)&&this.eat(X.parenR)?this.raiseRecoverable(C,"Trailing comma is not allowed in import()"):this.unexpected(C)}return this.finishNode(y,"ImportExpression")},On.parseImportMeta=function(y){this.next();var C=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="meta"&&this.raiseRecoverable(y.property.start,"The only valid meta property for import is 'import.meta'"),C&&this.raiseRecoverable(y.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(y.start,"Cannot use 'import.meta' outside a module"),this.finishNode(y,"MetaProperty")},On.parseLiteral=function(y){var C=this.startNode();return C.value=y,C.raw=this.input.slice(this.start,this.end),C.raw.charCodeAt(C.raw.length-1)===110&&(C.bigint=C.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(C,"Literal")},On.parseParenExpression=function(){this.expect(X.parenL);var y=this.parseExpression();return this.expect(X.parenR),y},On.parseParenAndDistinguishExpression=function(y){var C=this.start,N=this.startLoc,O,q=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var _e=this.start,We=this.startLoc,lt=[],vt=!0,lr=!1,Er=new me,Mn=this.yieldPos,li=this.awaitPos,$n;for(this.yieldPos=0,this.awaitPos=0;this.type!==X.parenR;)if(vt?vt=!1:this.expect(X.comma),q&&this.afterTrailingComma(X.parenR,!0)){lr=!0;break}else if(this.type===X.ellipsis){$n=this.start,lt.push(this.parseParenItem(this.parseRestBinding())),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else lt.push(this.parseMaybeAssign(!1,Er,this.parseParenItem));var Yi=this.start,fa=this.startLoc;if(this.expect(X.parenR),y&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(Er,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Mn,this.awaitPos=li,this.parseParenArrowList(C,N,lt);(!lt.length||lr)&&this.unexpected(this.lastTokStart),$n&&this.unexpected($n),this.checkExpressionErrors(Er,!0),this.yieldPos=Mn||this.yieldPos,this.awaitPos=li||this.awaitPos,lt.length>1?(O=this.startNodeAt(_e,We),O.expressions=lt,this.finishNodeAt(O,"SequenceExpression",Yi,fa)):O=lt[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Pa=this.startNodeAt(C,N);return Pa.expression=O,this.finishNode(Pa,"ParenthesizedExpression")}else return O},On.parseParenItem=function(y){return y},On.parseParenArrowList=function(y,C,N){return this.parseArrowExpression(this.startNodeAt(y,C),N)};var ui=[];On.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var y=this.startNode(),C=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(X.dot)){y.meta=C;var N=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="target"&&this.raiseRecoverable(y.property.start,"The only valid meta property for new is 'new.target'"),N&&this.raiseRecoverable(y.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(y.start,"'new.target' can only be used in functions"),this.finishNode(y,"MetaProperty")}var O=this.start,q=this.startLoc,_e=this.type===X._import;return y.callee=this.parseSubscripts(this.parseExprAtom(),O,q,!0),_e&&y.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(X.parenL)?y.arguments=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1):y.arguments=ui,this.finishNode(y,"NewExpression")},On.parseTemplateElement=function(y){var C=y.isTagged,N=this.startNode();return this.type===X.invalidTemplate?(C||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),N.value={raw:this.value,cooked:null}):N.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),N.tail=this.type===X.backQuote,this.finishNode(N,"TemplateElement")},On.parseTemplate=function(y){y===void 0&&(y={});var C=y.isTagged;C===void 0&&(C=!1);var N=this.startNode();this.next(),N.expressions=[];var O=this.parseTemplateElement({isTagged:C});for(N.quasis=[O];!O.tail;)this.type===X.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(X.dollarBraceL),N.expressions.push(this.parseExpression()),this.expect(X.braceR),N.quasis.push(O=this.parseTemplateElement({isTagged:C}));return this.next(),this.finishNode(N,"TemplateLiteral")},On.isAsyncProp=function(y){return!y.computed&&y.key.type==="Identifier"&&y.key.name==="async"&&(this.type===X.name||this.type===X.num||this.type===X.string||this.type===X.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===X.star)&&!Yt.test(this.input.slice(this.lastTokEnd,this.start))},On.parseObj=function(y,C){var N=this.startNode(),O=!0,q={};for(N.properties=[],this.next();!this.eat(X.braceR);){if(O)O=!1;else if(this.expect(X.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(X.braceR))break;var _e=this.parseProperty(y,C);y||this.checkPropClash(_e,q,C),N.properties.push(_e)}return this.finishNode(N,y?"ObjectPattern":"ObjectExpression")},On.parseProperty=function(y,C){var N=this.startNode(),O,q,_e,We;if(this.options.ecmaVersion>=9&&this.eat(X.ellipsis))return y?(N.argument=this.parseIdent(!1),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(N,"RestElement")):(this.type===X.parenL&&C&&(C.parenthesizedAssign<0&&(C.parenthesizedAssign=this.start),C.parenthesizedBind<0&&(C.parenthesizedBind=this.start)),N.argument=this.parseMaybeAssign(!1,C),this.type===X.comma&&C&&C.trailingComma<0&&(C.trailingComma=this.start),this.finishNode(N,"SpreadElement"));this.options.ecmaVersion>=6&&(N.method=!1,N.shorthand=!1,(y||C)&&(_e=this.start,We=this.startLoc),y||(O=this.eat(X.star)));var lt=this.containsEsc;return this.parsePropertyName(N),!y&&!lt&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(N)?(q=!0,O=this.options.ecmaVersion>=9&&this.eat(X.star),this.parsePropertyName(N,C)):q=!1,this.parsePropertyValue(N,y,O,q,_e,We,C,lt),this.finishNode(N,"Property")},On.parsePropertyValue=function(y,C,N,O,q,_e,We,lt){if((N||O)&&this.type===X.colon&&this.unexpected(),this.eat(X.colon))y.value=C?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),y.kind="init";else if(this.options.ecmaVersion>=6&&this.type===X.parenL)C&&this.unexpected(),y.kind="init",y.method=!0,y.value=this.parseMethod(N,O);else if(!C&&!lt&&this.options.ecmaVersion>=5&&!y.computed&&y.key.type==="Identifier"&&(y.key.name==="get"||y.key.name==="set")&&this.type!==X.comma&&this.type!==X.braceR&&this.type!==X.eq){(N||O)&&this.unexpected(),y.kind=y.key.name,this.parsePropertyName(y),y.value=this.parseMethod(!1);var vt=y.kind==="get"?0:1;if(y.value.params.length!==vt){var lr=y.value.start;y.kind==="get"?this.raiseRecoverable(lr,"getter should have no params"):this.raiseRecoverable(lr,"setter should have exactly one param")}else y.kind==="set"&&y.value.params[0].type==="RestElement"&&this.raiseRecoverable(y.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!y.computed&&y.key.type==="Identifier"?((N||O)&&this.unexpected(),this.checkUnreserved(y.key),y.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=q),y.kind="init",C?y.value=this.parseMaybeDefault(q,_e,y.key):this.type===X.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),y.value=this.parseMaybeDefault(q,_e,y.key)):y.value=y.key,y.shorthand=!0):this.unexpected()},On.parsePropertyName=function(y){if(this.options.ecmaVersion>=6){if(this.eat(X.bracketL))return y.computed=!0,y.key=this.parseMaybeAssign(),this.expect(X.bracketR),y.key;y.computed=!1}return y.key=this.type===X.num||this.type===X.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},On.initFunction=function(y){y.id=null,this.options.ecmaVersion>=6&&(y.generator=y.expression=!1),this.options.ecmaVersion>=8&&(y.async=!1)},On.parseMethod=function(y,C,N){var O=this.startNode(),q=this.yieldPos,_e=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=y),this.options.ecmaVersion>=8&&(O.async=!!C),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(C,O.generator)|si|(N?aa:0)),this.expect(X.parenL),O.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=q,this.awaitPos=_e,this.awaitIdentPos=We,this.finishNode(O,"FunctionExpression")},On.parseArrowExpression=function(y,C,N){var O=this.yieldPos,q=this.awaitPos,_e=this.awaitIdentPos;return this.enterScope(Ri(N,!1)|hi),this.initFunction(y),this.options.ecmaVersion>=8&&(y.async=!!N),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,y.params=this.toAssignableList(C,!0),this.parseFunctionBody(y,!0,!1),this.yieldPos=O,this.awaitPos=q,this.awaitIdentPos=_e,this.finishNode(y,"ArrowFunctionExpression")},On.parseFunctionBody=function(y,C,N){var O=C&&this.type!==X.braceL,q=this.strict,_e=!1;if(O)y.body=this.parseMaybeAssign(),y.expression=!0,this.checkParams(y,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(y.params);(!q||We)&&(_e=this.strictDirective(this.end),_e&&We&&this.raiseRecoverable(y.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var lt=this.labels;this.labels=[],_e&&(this.strict=!0),this.checkParams(y,!q&&!_e&&!C&&!N&&this.isSimpleParamList(y.params)),this.strict&&y.id&&this.checkLVal(y.id,An),y.body=this.parseBlock(!1,void 0,_e&&!q),y.expression=!1,this.adaptDirectivePrologue(y.body.body),this.labels=lt}this.exitScope()},On.isSimpleParamList=function(y){for(var C=0,N=y;C<N.length;C+=1){var O=N[C];if(O.type!=="Identifier")return!1}return!0},On.checkParams=function(y,C){for(var N={},O=0,q=y.params;O<q.length;O+=1){var _e=q[O];this.checkLVal(_e,Vi,C?null:N)}},On.parseExprList=function(y,C,N,O){for(var q=[],_e=!0;!this.eat(y);){if(_e)_e=!1;else if(this.expect(X.comma),C&&this.afterTrailingComma(y))break;var We=void 0;N&&this.type===X.comma?We=null:this.type===X.ellipsis?(We=this.parseSpread(O),O&&this.type===X.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):We=this.parseMaybeAssign(!1,O),q.push(We)}return q},On.checkUnreserved=function(y){var C=y.start,N=y.end,O=y.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(C,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(C,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(C,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(C,N).indexOf("\\")!==-1)){var q=this.strict?this.reservedWordsStrict:this.reservedWords;q.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(C,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(C,"The keyword '"+O+"' is reserved"))}},On.parseIdent=function(y,C){var N=this.startNode();return this.type===X.name?N.name=this.value:this.type.keyword?(N.name=this.type.keyword,(N.name==="class"||N.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!y),this.finishNode(N,"Identifier"),y||(this.checkUnreserved(N),N.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=N.start)),N},On.parseYield=function(y){this.yieldPos||(this.yieldPos=this.start);var C=this.startNode();return this.next(),this.type===X.semi||this.canInsertSemicolon()||this.type!==X.star&&!this.type.startsExpr?(C.delegate=!1,C.argument=null):(C.delegate=this.eat(X.star),C.argument=this.parseMaybeAssign(y)),this.finishNode(C,"YieldExpression")},On.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var y=this.startNode();return this.next(),y.argument=this.parseMaybeUnary(null,!1),this.finishNode(y,"AwaitExpression")};var Zn=yi.prototype;Zn.raise=function(y,C){var N=gt(this.input,y);C+=" ("+N.line+":"+N.column+")";var O=new SyntaxError(C);throw O.pos=y,O.loc=N,O.raisedAt=this.pos,O},Zn.raiseRecoverable=Zn.raise,Zn.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var nn=yi.prototype,Ti=function(C){this.flags=C,this.var=[],this.lexical=[],this.functions=[]};nn.enterScope=function(y){this.scopeStack.push(new Ti(y))},nn.exitScope=function(){this.scopeStack.pop()},nn.treatFunctionsAsVarInScope=function(y){return y.flags&hn||!this.inModule&&y.flags&Hn},nn.declareName=function(y,C,N){var O=!1;if(C===ua){var q=this.currentScope();O=q.lexical.indexOf(y)>-1||q.functions.indexOf(y)>-1||q.var.indexOf(y)>-1,q.lexical.push(y),this.inModule&&q.flags&Hn&&delete this.undefinedExports[y]}else if(C===xa){var _e=this.currentScope();_e.lexical.push(y)}else if(C===wi){var We=this.currentScope();this.treatFunctionsAsVar?O=We.lexical.indexOf(y)>-1:O=We.lexical.indexOf(y)>-1||We.var.indexOf(y)>-1,We.functions.push(y)}else for(var lt=this.scopeStack.length-1;lt>=0;--lt){var vt=this.scopeStack[lt];if(vt.lexical.indexOf(y)>-1&&!(vt.flags&Wn&&vt.lexical[0]===y)||!this.treatFunctionsAsVarInScope(vt)&&vt.functions.indexOf(y)>-1){O=!0;break}if(vt.var.push(y),this.inModule&&vt.flags&Hn&&delete this.undefinedExports[y],vt.flags&Ki)break}O&&this.raiseRecoverable(N,"Identifier '"+y+"' has already been declared")},nn.checkLocalExport=function(y){this.scopeStack[0].lexical.indexOf(y.name)===-1&&this.scopeStack[0].var.indexOf(y.name)===-1&&(this.undefinedExports[y.name]=y)},nn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},nn.currentVarScope=function(){for(var y=this.scopeStack.length-1;;y--){var C=this.scopeStack[y];if(C.flags&Ki)return C}},nn.currentThisScope=function(){for(var y=this.scopeStack.length-1;;y--){var C=this.scopeStack[y];if(C.flags&Ki&&!(C.flags&hi))return C}};var Mi=function(C,N,O){this.type="",this.start=N,this.end=0,C.options.locations&&(this.loc=new At(C,O)),C.options.directSourceFile&&(this.sourceFile=C.options.directSourceFile),C.options.ranges&&(this.range=[N,0])},Ya=yi.prototype;Ya.startNode=function(){return new Mi(this,this.start,this.startLoc)},Ya.startNodeAt=function(y,C){return new Mi(this,y,C)};function hs(y,C,N,O){return y.type=C,y.end=N,this.options.locations&&(y.loc.end=O),this.options.ranges&&(y.range[1]=N),y}Ya.finishNode=function(y,C){return hs.call(this,y,C,this.lastTokEnd,this.lastTokEndLoc)},Ya.finishNodeAt=function(y,C,N,O){return hs.call(this,y,C,N,O)};var va=function(C,N,O,q,_e){this.token=C,this.isExpr=!!N,this.preserveSpace=!!O,this.override=q,this.generator=!!_e},Ra={b_stat:new va("{",!1),b_expr:new va("{",!0),b_tmpl:new va("${",!1),p_stat:new va("(",!1),p_expr:new va("(",!0),q_tmpl:new va("`",!0,!0,function(y){return y.tryReadTemplateToken()}),f_stat:new va("function",!1),f_expr:new va("function",!0),f_expr_gen:new va("function",!0,!1,null,!0),f_gen:new va("function",!1,!1,null,!0)},Sa=yi.prototype;Sa.initialContext=function(){return[Ra.b_stat]},Sa.braceIsBlock=function(y){var C=this.curContext();return C===Ra.f_expr||C===Ra.f_stat?!0:y===X.colon&&(C===Ra.b_stat||C===Ra.b_expr)?!C.isExpr:y===X._return||y===X.name&&this.exprAllowed?Yt.test(this.input.slice(this.lastTokEnd,this.start)):y===X._else||y===X.semi||y===X.eof||y===X.parenR||y===X.arrow?!0:y===X.braceL?C===Ra.b_stat:y===X._var||y===X._const||y===X.name?!1:!this.exprAllowed},Sa.inGeneratorContext=function(){for(var y=this.context.length-1;y>=1;y--){var C=this.context[y];if(C.token==="function")return C.generator}return!1},Sa.updateContext=function(y){var C,N=this.type;N.keyword&&y===X.dot?this.exprAllowed=!1:(C=N.updateContext)?C.call(this,y):this.exprAllowed=N.beforeExpr},X.parenR.updateContext=X.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var y=this.context.pop();y===Ra.b_stat&&this.curContext().token==="function"&&(y=this.context.pop()),this.exprAllowed=!y.isExpr},X.braceL.updateContext=function(y){this.context.push(this.braceIsBlock(y)?Ra.b_stat:Ra.b_expr),this.exprAllowed=!0},X.dollarBraceL.updateContext=function(){this.context.push(Ra.b_tmpl),this.exprAllowed=!0},X.parenL.updateContext=function(y){var C=y===X._if||y===X._for||y===X._with||y===X._while;this.context.push(C?Ra.p_stat:Ra.p_expr),this.exprAllowed=!0},X.incDec.updateContext=function(){},X._function.updateContext=X._class.updateContext=function(y){y.beforeExpr&&y!==X.semi&&y!==X._else&&!(y===X._return&&Yt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((y===X.colon||y===X.braceL)&&this.curContext()===Ra.b_stat)?this.context.push(Ra.f_expr):this.context.push(Ra.f_stat),this.exprAllowed=!1},X.backQuote.updateContext=function(){this.curContext()===Ra.q_tmpl?this.context.pop():this.context.push(Ra.q_tmpl),this.exprAllowed=!1},X.star.updateContext=function(y){if(y===X._function){var C=this.context.length-1;this.context[C]===Ra.f_expr?this.context[C]=Ra.f_expr_gen:this.context[C]=Ra.f_gen}this.exprAllowed=!0},X.name.updateContext=function(y){var C=!1;this.options.ecmaVersion>=6&&y!==X.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(C=!0),this.exprAllowed=C};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",K=V+" Extended_Pictographic",se=K,ge={9:V,10:K,11:se},Ie="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ve="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",rt=Ve+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",pe=rt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",De={9:Ve,10:rt,11:pe},yt={};function vr(y){var C=yt[y]={binary:Ye(ge[y]+" "+Ie),nonBinary:{General_Category:Ye(Ie),Script:Ye(De[y])}};C.nonBinary.Script_Extensions=C.nonBinary.Script,C.nonBinary.gc=C.nonBinary.General_Category,C.nonBinary.sc=C.nonBinary.Script,C.nonBinary.scx=C.nonBinary.Script_Extensions}vr(9),vr(10),vr(11);var Lt=yi.prototype,Dt=function(C){this.parser=C,this.validFlags="gim"+(C.options.ecmaVersion>=6?"uy":"")+(C.options.ecmaVersion>=9?"s":""),this.unicodeProperties=yt[C.options.ecmaVersion>=11?11:C.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Dt.prototype.reset=function(C,N,O){var q=O.indexOf("u")!==-1;this.start=C|0,this.source=N+"",this.flags=O,this.switchU=q&&this.parser.options.ecmaVersion>=6,this.switchN=q&&this.parser.options.ecmaVersion>=9},Dt.prototype.raise=function(C){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+C)},Dt.prototype.at=function(C,N){N===void 0&&(N=!1);var O=this.source,q=O.length;if(C>=q)return-1;var _e=O.charCodeAt(C);if(!(N||this.switchU)||_e<=55295||_e>=57344||C+1>=q)return _e;var We=O.charCodeAt(C+1);return We>=56320&&We<=57343?(_e<<10)+We-56613888:_e},Dt.prototype.nextIndex=function(C,N){N===void 0&&(N=!1);var O=this.source,q=O.length;if(C>=q)return q;var _e=O.charCodeAt(C),We;return!(N||this.switchU)||_e<=55295||_e>=57344||C+1>=q||(We=O.charCodeAt(C+1))<56320||We>57343?C+1:C+2},Dt.prototype.current=function(C){return C===void 0&&(C=!1),this.at(this.pos,C)},Dt.prototype.lookahead=function(C){return C===void 0&&(C=!1),this.at(this.nextIndex(this.pos,C),C)},Dt.prototype.advance=function(C){C===void 0&&(C=!1),this.pos=this.nextIndex(this.pos,C)},Dt.prototype.eat=function(C,N){return N===void 0&&(N=!1),this.current(N)===C?(this.advance(N),!0):!1};function gr(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}Lt.validateRegExpFlags=function(y){for(var C=y.validFlags,N=y.flags,O=0;O<N.length;O++){var q=N.charAt(O);C.indexOf(q)===-1&&this.raise(y.start,"Invalid regular expression flag"),N.indexOf(q,O+1)>-1&&this.raise(y.start,"Duplicate regular expression flag")}},Lt.validateRegExpPattern=function(y){this.regexp_pattern(y),!y.switchN&&this.options.ecmaVersion>=9&&y.groupNames.length>0&&(y.switchN=!0,this.regexp_pattern(y))},Lt.regexp_pattern=function(y){y.pos=0,y.lastIntValue=0,y.lastStringValue="",y.lastAssertionIsQuantifiable=!1,y.numCapturingParens=0,y.maxBackReference=0,y.groupNames.length=0,y.backReferenceNames.length=0,this.regexp_disjunction(y),y.pos!==y.source.length&&(y.eat(41)&&y.raise("Unmatched ')'"),(y.eat(93)||y.eat(125))&&y.raise("Lone quantifier brackets")),y.maxBackReference>y.numCapturingParens&&y.raise("Invalid escape");for(var C=0,N=y.backReferenceNames;C<N.length;C+=1){var O=N[C];y.groupNames.indexOf(O)===-1&&y.raise("Invalid named capture referenced")}},Lt.regexp_disjunction=function(y){for(this.regexp_alternative(y);y.eat(124);)this.regexp_alternative(y);this.regexp_eatQuantifier(y,!0)&&y.raise("Nothing to repeat"),y.eat(123)&&y.raise("Lone quantifier brackets")},Lt.regexp_alternative=function(y){for(;y.pos<y.source.length&&this.regexp_eatTerm(y););},Lt.regexp_eatTerm=function(y){return this.regexp_eatAssertion(y)?(y.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(y)&&y.switchU&&y.raise("Invalid quantifier"),!0):(y.switchU?this.regexp_eatAtom(y):this.regexp_eatExtendedAtom(y))?(this.regexp_eatQuantifier(y),!0):!1},Lt.regexp_eatAssertion=function(y){var C=y.pos;if(y.lastAssertionIsQuantifiable=!1,y.eat(94)||y.eat(36))return!0;if(y.eat(92)){if(y.eat(66)||y.eat(98))return!0;y.pos=C}if(y.eat(40)&&y.eat(63)){var N=!1;if(this.options.ecmaVersion>=9&&(N=y.eat(60)),y.eat(61)||y.eat(33))return this.regexp_disjunction(y),y.eat(41)||y.raise("Unterminated group"),y.lastAssertionIsQuantifiable=!N,!0}return y.pos=C,!1},Lt.regexp_eatQuantifier=function(y,C){return C===void 0&&(C=!1),this.regexp_eatQuantifierPrefix(y,C)?(y.eat(63),!0):!1},Lt.regexp_eatQuantifierPrefix=function(y,C){return y.eat(42)||y.eat(43)||y.eat(63)||this.regexp_eatBracedQuantifier(y,C)},Lt.regexp_eatBracedQuantifier=function(y,C){var N=y.pos;if(y.eat(123)){var O=0,q=-1;if(this.regexp_eatDecimalDigits(y)&&(O=y.lastIntValue,y.eat(44)&&this.regexp_eatDecimalDigits(y)&&(q=y.lastIntValue),y.eat(125)))return q!==-1&&q<O&&!C&&y.raise("numbers out of order in {} quantifier"),!0;y.switchU&&!C&&y.raise("Incomplete quantifier"),y.pos=N}return!1},Lt.regexp_eatAtom=function(y){return this.regexp_eatPatternCharacters(y)||y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)},Lt.regexp_eatReverseSolidusAtomEscape=function(y){var C=y.pos;if(y.eat(92)){if(this.regexp_eatAtomEscape(y))return!0;y.pos=C}return!1},Lt.regexp_eatUncapturingGroup=function(y){var C=y.pos;if(y.eat(40)){if(y.eat(63)&&y.eat(58)){if(this.regexp_disjunction(y),y.eat(41))return!0;y.raise("Unterminated group")}y.pos=C}return!1},Lt.regexp_eatCapturingGroup=function(y){if(y.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(y):y.current()===63&&y.raise("Invalid group"),this.regexp_disjunction(y),y.eat(41))return y.numCapturingParens+=1,!0;y.raise("Unterminated group")}return!1},Lt.regexp_eatExtendedAtom=function(y){return y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)||this.regexp_eatInvalidBracedQuantifier(y)||this.regexp_eatExtendedPatternCharacter(y)},Lt.regexp_eatInvalidBracedQuantifier=function(y){return this.regexp_eatBracedQuantifier(y,!0)&&y.raise("Nothing to repeat"),!1},Lt.regexp_eatSyntaxCharacter=function(y){var C=y.current();return bn(C)?(y.lastIntValue=C,y.advance(),!0):!1};function bn(y){return y===36||y>=40&&y<=43||y===46||y===63||y>=91&&y<=94||y>=123&&y<=125}Lt.regexp_eatPatternCharacters=function(y){for(var C=y.pos,N=0;(N=y.current())!==-1&&!bn(N);)y.advance();return y.pos!==C},Lt.regexp_eatExtendedPatternCharacter=function(y){var C=y.current();return C!==-1&&C!==36&&!(C>=40&&C<=43)&&C!==46&&C!==63&&C!==91&&C!==94&&C!==124?(y.advance(),!0):!1},Lt.regexp_groupSpecifier=function(y){if(y.eat(63)){if(this.regexp_eatGroupName(y)){y.groupNames.indexOf(y.lastStringValue)!==-1&&y.raise("Duplicate capture group name"),y.groupNames.push(y.lastStringValue);return}y.raise("Invalid group")}},Lt.regexp_eatGroupName=function(y){if(y.lastStringValue="",y.eat(60)){if(this.regexp_eatRegExpIdentifierName(y)&&y.eat(62))return!0;y.raise("Invalid capture group name")}return!1},Lt.regexp_eatRegExpIdentifierName=function(y){if(y.lastStringValue="",this.regexp_eatRegExpIdentifierStart(y)){for(y.lastStringValue+=gr(y.lastIntValue);this.regexp_eatRegExpIdentifierPart(y);)y.lastStringValue+=gr(y.lastIntValue);return!0}return!1},Lt.regexp_eatRegExpIdentifierStart=function(y){var C=y.pos,N=this.options.ecmaVersion>=11,O=y.current(N);return y.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,N)&&(O=y.lastIntValue),ln(O)?(y.lastIntValue=O,!0):(y.pos=C,!1)};function ln(y){return Mt(y,!0)||y===36||y===95}Lt.regexp_eatRegExpIdentifierPart=function(y){var C=y.pos,N=this.options.ecmaVersion>=11,O=y.current(N);return y.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,N)&&(O=y.lastIntValue),Tt(O)?(y.lastIntValue=O,!0):(y.pos=C,!1)};function Tt(y){return nr(y,!0)||y===36||y===95||y===8204||y===8205}Lt.regexp_eatAtomEscape=function(y){return this.regexp_eatBackReference(y)||this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)||y.switchN&&this.regexp_eatKGroupName(y)?!0:(y.switchU&&(y.current()===99&&y.raise("Invalid unicode escape"),y.raise("Invalid escape")),!1)},Lt.regexp_eatBackReference=function(y){var C=y.pos;if(this.regexp_eatDecimalEscape(y)){var N=y.lastIntValue;if(y.switchU)return N>y.maxBackReference&&(y.maxBackReference=N),!0;if(N<=y.numCapturingParens)return!0;y.pos=C}return!1},Lt.regexp_eatKGroupName=function(y){if(y.eat(107)){if(this.regexp_eatGroupName(y))return y.backReferenceNames.push(y.lastStringValue),!0;y.raise("Invalid named reference")}return!1},Lt.regexp_eatCharacterEscape=function(y){return this.regexp_eatControlEscape(y)||this.regexp_eatCControlLetter(y)||this.regexp_eatZero(y)||this.regexp_eatHexEscapeSequence(y)||this.regexp_eatRegExpUnicodeEscapeSequence(y,!1)||!y.switchU&&this.regexp_eatLegacyOctalEscapeSequence(y)||this.regexp_eatIdentityEscape(y)},Lt.regexp_eatCControlLetter=function(y){var C=y.pos;if(y.eat(99)){if(this.regexp_eatControlLetter(y))return!0;y.pos=C}return!1},Lt.regexp_eatZero=function(y){return y.current()===48&&!Ci(y.lookahead())?(y.lastIntValue=0,y.advance(),!0):!1},Lt.regexp_eatControlEscape=function(y){var C=y.current();return C===116?(y.lastIntValue=9,y.advance(),!0):C===110?(y.lastIntValue=10,y.advance(),!0):C===118?(y.lastIntValue=11,y.advance(),!0):C===102?(y.lastIntValue=12,y.advance(),!0):C===114?(y.lastIntValue=13,y.advance(),!0):!1},Lt.regexp_eatControlLetter=function(y){var C=y.current();return on(C)?(y.lastIntValue=C%32,y.advance(),!0):!1};function on(y){return y>=65&&y<=90||y>=97&&y<=122}Lt.regexp_eatRegExpUnicodeEscapeSequence=function(y,C){C===void 0&&(C=!1);var N=y.pos,O=C||y.switchU;if(y.eat(117)){if(this.regexp_eatFixedHexDigits(y,4)){var q=y.lastIntValue;if(O&&q>=55296&&q<=56319){var _e=y.pos;if(y.eat(92)&&y.eat(117)&&this.regexp_eatFixedHexDigits(y,4)){var We=y.lastIntValue;if(We>=56320&&We<=57343)return y.lastIntValue=(q-55296)*1024+(We-56320)+65536,!0}y.pos=_e,y.lastIntValue=q}return!0}if(O&&y.eat(123)&&this.regexp_eatHexDigits(y)&&y.eat(125)&&Vr(y.lastIntValue))return!0;O&&y.raise("Invalid unicode escape"),y.pos=N}return!1};function Vr(y){return y>=0&&y<=1114111}Lt.regexp_eatIdentityEscape=function(y){if(y.switchU)return this.regexp_eatSyntaxCharacter(y)?!0:y.eat(47)?(y.lastIntValue=47,!0):!1;var C=y.current();return C!==99&&(!y.switchN||C!==107)?(y.lastIntValue=C,y.advance(),!0):!1},Lt.regexp_eatDecimalEscape=function(y){y.lastIntValue=0;var C=y.current();if(C>=49&&C<=57){do y.lastIntValue=10*y.lastIntValue+(C-48),y.advance();while((C=y.current())>=48&&C<=57);return!0}return!1},Lt.regexp_eatCharacterClassEscape=function(y){var C=y.current();if(Wr(C))return y.lastIntValue=-1,y.advance(),!0;if(y.switchU&&this.options.ecmaVersion>=9&&(C===80||C===112)){if(y.lastIntValue=-1,y.advance(),y.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(y)&&y.eat(125))return!0;y.raise("Invalid property name")}return!1};function Wr(y){return y===100||y===68||y===115||y===83||y===119||y===87}Lt.regexp_eatUnicodePropertyValueExpression=function(y){var C=y.pos;if(this.regexp_eatUnicodePropertyName(y)&&y.eat(61)){var N=y.lastStringValue;if(this.regexp_eatUnicodePropertyValue(y)){var O=y.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(y,N,O),!0}}if(y.pos=C,this.regexp_eatLoneUnicodePropertyNameOrValue(y)){var q=y.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(y,q),!0}return!1},Lt.regexp_validateUnicodePropertyNameAndValue=function(y,C,N){Hr(y.unicodeProperties.nonBinary,C)||y.raise("Invalid property name"),y.unicodeProperties.nonBinary[C].test(N)||y.raise("Invalid property value")},Lt.regexp_validateUnicodePropertyNameOrValue=function(y,C){y.unicodeProperties.binary.test(C)||y.raise("Invalid property name")},Lt.regexp_eatUnicodePropertyName=function(y){var C=0;for(y.lastStringValue="";ii(C=y.current());)y.lastStringValue+=gr(C),y.advance();return y.lastStringValue!==""};function ii(y){return on(y)||y===95}Lt.regexp_eatUnicodePropertyValue=function(y){var C=0;for(y.lastStringValue="";en(C=y.current());)y.lastStringValue+=gr(C),y.advance();return y.lastStringValue!==""};function en(y){return ii(y)||Ci(y)}Lt.regexp_eatLoneUnicodePropertyNameOrValue=function(y){return this.regexp_eatUnicodePropertyValue(y)},Lt.regexp_eatCharacterClass=function(y){if(y.eat(91)){if(y.eat(94),this.regexp_classRanges(y),y.eat(93))return!0;y.raise("Unterminated character class")}return!1},Lt.regexp_classRanges=function(y){for(;this.regexp_eatClassAtom(y);){var C=y.lastIntValue;if(y.eat(45)&&this.regexp_eatClassAtom(y)){var N=y.lastIntValue;y.switchU&&(C===-1||N===-1)&&y.raise("Invalid character class"),C!==-1&&N!==-1&&C>N&&y.raise("Range out of order in character class")}}},Lt.regexp_eatClassAtom=function(y){var C=y.pos;if(y.eat(92)){if(this.regexp_eatClassEscape(y))return!0;if(y.switchU){var N=y.current();(N===99||Pi(N))&&y.raise("Invalid class escape"),y.raise("Invalid escape")}y.pos=C}var O=y.current();return O!==93?(y.lastIntValue=O,y.advance(),!0):!1},Lt.regexp_eatClassEscape=function(y){var C=y.pos;if(y.eat(98))return y.lastIntValue=8,!0;if(y.switchU&&y.eat(45))return y.lastIntValue=45,!0;if(!y.switchU&&y.eat(99)){if(this.regexp_eatClassControlLetter(y))return!0;y.pos=C}return this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)},Lt.regexp_eatClassControlLetter=function(y){var C=y.current();return Ci(C)||C===95?(y.lastIntValue=C%32,y.advance(),!0):!1},Lt.regexp_eatHexEscapeSequence=function(y){var C=y.pos;if(y.eat(120)){if(this.regexp_eatFixedHexDigits(y,2))return!0;y.switchU&&y.raise("Invalid escape"),y.pos=C}return!1},Lt.regexp_eatDecimalDigits=function(y){var C=y.pos,N=0;for(y.lastIntValue=0;Ci(N=y.current());)y.lastIntValue=10*y.lastIntValue+(N-48),y.advance();return y.pos!==C};function Ci(y){return y>=48&&y<=57}Lt.regexp_eatHexDigits=function(y){var C=y.pos,N=0;for(y.lastIntValue=0;ta(N=y.current());)y.lastIntValue=16*y.lastIntValue+gi(N),y.advance();return y.pos!==C};function ta(y){return y>=48&&y<=57||y>=65&&y<=70||y>=97&&y<=102}function gi(y){return y>=65&&y<=70?10+(y-65):y>=97&&y<=102?10+(y-97):y-48}Lt.regexp_eatLegacyOctalEscapeSequence=function(y){if(this.regexp_eatOctalDigit(y)){var C=y.lastIntValue;if(this.regexp_eatOctalDigit(y)){var N=y.lastIntValue;C<=3&&this.regexp_eatOctalDigit(y)?y.lastIntValue=C*64+N*8+y.lastIntValue:y.lastIntValue=C*8+N}else y.lastIntValue=C;return!0}return!1},Lt.regexp_eatOctalDigit=function(y){var C=y.current();return Pi(C)?(y.lastIntValue=C-48,y.advance(),!0):(y.lastIntValue=0,!1)};function Pi(y){return y>=48&&y<=55}Lt.regexp_eatFixedHexDigits=function(y,C){var N=y.pos;y.lastIntValue=0;for(var O=0;O<C;++O){var q=y.current();if(!ta(q))return y.pos=N,!1;y.lastIntValue=16*y.lastIntValue+gi(q),y.advance()}return!0};var _i=function(C){this.type=C.type,this.value=C.value,this.start=C.start,this.end=C.end,C.options.locations&&(this.loc=new At(C,C.startLoc,C.endLoc)),C.options.ranges&&(this.range=[C.start,C.end])},Jn=yi.prototype;Jn.next=function(y){!y&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Jn.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(Jn[Symbol.iterator]=function(){var y=this;return{next:function(){var C=y.getToken();return{done:C.type===X.eof,value:C}}}}),Jn.curContext=function(){return this.context[this.context.length-1]},Jn.nextToken=function(){var y=this.curContext();if((!y||!y.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(X.eof);if(y.override)return y.override(this);this.readToken(this.fullCharCodeAtPos())},Jn.readToken=function(y){return Mt(y,this.options.ecmaVersion>=6)||y===92?this.readWord():this.getTokenFromCode(y)},Jn.fullCharCodeAtPos=function(){var y=this.input.charCodeAt(this.pos);if(y<=55295||y>=57344)return y;var C=this.input.charCodeAt(this.pos+1);return(y<<10)+C-56613888},Jn.skipBlockComment=function(){var y=this.options.onComment&&this.curPosition(),C=this.pos,N=this.input.indexOf("*/",this.pos+=2);if(N===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=N+2,this.options.locations){dt.lastIndex=C;for(var O;(O=dt.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(C+2,N),C,this.pos,y,this.curPosition())},Jn.skipLineComment=function(y){for(var C=this.pos,N=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=y);this.pos<this.input.length&&!qe(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(C+y,this.pos),C,this.pos,N,this.curPosition())},Jn.skipSpace=function(){e:for(;this.pos<this.input.length;){var y=this.input.charCodeAt(this.pos);switch(y){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(y>8&&y<14||y>=5760&&ht.test(String.fromCharCode(y)))++this.pos;else break e}}},Jn.finishToken=function(y,C){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var N=this.type;this.type=y,this.value=C,this.updateContext(N)},Jn.readToken_dot=function(){var y=this.input.charCodeAt(this.pos+1);if(y>=48&&y<=57)return this.readNumber(!0);var C=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&y===46&&C===46?(this.pos+=3,this.finishToken(X.ellipsis)):(++this.pos,this.finishToken(X.dot))},Jn.readToken_slash=function(){var y=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):y===61?this.finishOp(X.assign,2):this.finishOp(X.slash,1)},Jn.readToken_mult_modulo_exp=function(y){var C=this.input.charCodeAt(this.pos+1),N=1,O=y===42?X.star:X.modulo;return this.options.ecmaVersion>=7&&y===42&&C===42&&(++N,O=X.starstar,C=this.input.charCodeAt(this.pos+2)),C===61?this.finishOp(X.assign,N+1):this.finishOp(O,N)},Jn.readToken_pipe_amp=function(y){var C=this.input.charCodeAt(this.pos+1);if(C===y){if(this.options.ecmaVersion>=12){var N=this.input.charCodeAt(this.pos+2);if(N===61)return this.finishOp(X.assign,3)}return this.finishOp(y===124?X.logicalOR:X.logicalAND,2)}return C===61?this.finishOp(X.assign,2):this.finishOp(y===124?X.bitwiseOR:X.bitwiseAND,1)},Jn.readToken_caret=function(){var y=this.input.charCodeAt(this.pos+1);return y===61?this.finishOp(X.assign,2):this.finishOp(X.bitwiseXOR,1)},Jn.readToken_plus_min=function(y){var C=this.input.charCodeAt(this.pos+1);return C===y?C===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Yt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(X.incDec,2):C===61?this.finishOp(X.assign,2):this.finishOp(X.plusMin,1)},Jn.readToken_lt_gt=function(y){var C=this.input.charCodeAt(this.pos+1),N=1;return C===y?(N=y===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+N)===61?this.finishOp(X.assign,N+1):this.finishOp(X.bitShift,N)):C===33&&y===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(C===61&&(N=2),this.finishOp(X.relational,N))},Jn.readToken_eq_excl=function(y){var C=this.input.charCodeAt(this.pos+1);return C===61?this.finishOp(X.equality,this.input.charCodeAt(this.pos+2)===61?3:2):y===61&&C===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(X.arrow)):this.finishOp(y===61?X.eq:X.prefix,1)},Jn.readToken_question=function(){var y=this.options.ecmaVersion;if(y>=11){var C=this.input.charCodeAt(this.pos+1);if(C===46){var N=this.input.charCodeAt(this.pos+2);if(N<48||N>57)return this.finishOp(X.questionDot,2)}if(C===63){if(y>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(X.assign,3)}return this.finishOp(X.coalesce,2)}}return this.finishOp(X.question,1)},Jn.getTokenFromCode=function(y){switch(y){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(X.parenL);case 41:return++this.pos,this.finishToken(X.parenR);case 59:return++this.pos,this.finishToken(X.semi);case 44:return++this.pos,this.finishToken(X.comma);case 91:return++this.pos,this.finishToken(X.bracketL);case 93:return++this.pos,this.finishToken(X.bracketR);case 123:return++this.pos,this.finishToken(X.braceL);case 125:return++this.pos,this.finishToken(X.braceR);case 58:return++this.pos,this.finishToken(X.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(X.backQuote);case 48:var C=this.input.charCodeAt(this.pos+1);if(C===120||C===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(C===111||C===79)return this.readRadixNumber(8);if(C===98||C===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(y);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(y);case 124:case 38:return this.readToken_pipe_amp(y);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(y);case 60:case 62:return this.readToken_lt_gt(y);case 61:case 33:return this.readToken_eq_excl(y);case 63:return this.readToken_question();case 126:return this.finishOp(X.prefix,1)}this.raise(this.pos,"Unexpected character '"+oa(y)+"'")},Jn.finishOp=function(y,C){var N=this.input.slice(this.pos,this.pos+C);return this.pos+=C,this.finishToken(y,N)},Jn.readRegexp=function(){for(var y,C,N=this.pos;;){this.pos>=this.input.length&&this.raise(N,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Yt.test(O)&&this.raise(N,"Unterminated regular expression"),y)y=!1;else{if(O==="[")C=!0;else if(O==="]"&&C)C=!1;else if(O==="/"&&!C)break;y=O==="\\"}++this.pos}var q=this.input.slice(N,this.pos);++this.pos;var _e=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(_e);var lt=this.regexpState||(this.regexpState=new Dt(this));lt.reset(N,q,We),this.validateRegExpFlags(lt),this.validateRegExpPattern(lt);var vt=null;try{vt=new RegExp(q,We)}catch(lr){}return this.finishToken(X.regexp,{pattern:q,flags:We,value:vt})},Jn.readInt=function(y,C,N){for(var O=this.options.ecmaVersion>=12&&C===void 0,q=N&&this.input.charCodeAt(this.pos)===48,_e=this.pos,We=0,lt=0,vt=0,lr=C==null?Infinity:C;vt<lr;++vt,++this.pos){var Er=this.input.charCodeAt(this.pos),Mn=void 0;if(O&&Er===95){q&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),lt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),vt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),lt=Er;continue}if(Er>=97?Mn=Er-97+10:Er>=65?Mn=Er-65+10:Er>=48&&Er<=57?Mn=Er-48:Mn=Infinity,Mn>=y)break;lt=Er,We=We*y+Mn}return O&&lt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===_e||C!=null&&this.pos-_e!==C?null:We};function Xi(y,C){return C?parseInt(y,8):parseFloat(y.replace(/_/g,""))}function La(y){return typeof BigInt!="function"?null:BigInt(y.replace(/_/g,""))}Jn.readRadixNumber=function(y){var C=this.pos;this.pos+=2;var N=this.readInt(y);return N==null&&this.raise(this.start+2,"Expected number in radix "+y),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(N=La(this.input.slice(C,this.pos)),++this.pos):Mt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,N)},Jn.readNumber=function(y){var C=this.pos;!y&&this.readInt(10,void 0,!0)===null&&this.raise(C,"Invalid number");var N=this.pos-C>=2&&this.input.charCodeAt(C)===48;N&&this.strict&&this.raise(C,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!N&&!y&&this.options.ecmaVersion>=11&&O===110){var q=La(this.input.slice(C,this.pos));return++this.pos,Mt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,q)}N&&/[89]/.test(this.input.slice(C,this.pos))&&(N=!1),O===46&&!N&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!N&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(C,"Invalid number")),Mt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var _e=Xi(this.input.slice(C,this.pos),N);return this.finishToken(X.num,_e)},Jn.readCodePoint=function(){var y=this.input.charCodeAt(this.pos),C;if(y===123){this.options.ecmaVersion<6&&this.unexpected();var N=++this.pos;C=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,C>1114111&&this.invalidStringToken(N,"Code point out of bounds")}else C=this.readHexChar(4);return C};function oa(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}Jn.readString=function(y){for(var C="",N=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===y)break;O===92?(C+=this.input.slice(N,this.pos),C+=this.readEscapedChar(!1),N=this.pos):(qe(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return C+=this.input.slice(N,this.pos++),this.finishToken(X.string,C)};var Ii={};Jn.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(y){if(y===Ii)this.readInvalidTemplateToken();else throw y}this.inTemplateElement=!1},Jn.invalidStringToken=function(y,C){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ii;this.raise(y,C)},Jn.readTmplToken=function(){for(var y="",C=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var N=this.input.charCodeAt(this.pos);if(N===96||N===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===X.template||this.type===X.invalidTemplate)?N===36?(this.pos+=2,this.finishToken(X.dollarBraceL)):(++this.pos,this.finishToken(X.backQuote)):(y+=this.input.slice(C,this.pos),this.finishToken(X.template,y));if(N===92)y+=this.input.slice(C,this.pos),y+=this.readEscapedChar(!0),C=this.pos;else if(qe(N)){switch(y+=this.input.slice(C,this.pos),++this.pos,N){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:y+=`
`;break;default:y+=String.fromCharCode(N);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),C=this.pos}else++this.pos}},Jn.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(X.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Jn.readEscapedChar=function(y){var C=this.input.charCodeAt(++this.pos);switch(++this.pos,C){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return oa(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(y){var N=this.pos-1;return this.invalidStringToken(N,"Invalid escape sequence in template string"),null}default:if(C>=48&&C<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],q=parseInt(O,8);return q>255&&(O=O.slice(0,-1),q=parseInt(O,8)),this.pos+=O.length-1,C=this.input.charCodeAt(this.pos),(O!=="0"||C===56||C===57)&&(this.strict||y)&&this.invalidStringToken(this.pos-1-O.length,y?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(q)}return qe(C)?"":String.fromCharCode(C)}},Jn.readHexChar=function(y){var C=this.pos,N=this.readInt(16,y);return N===null&&this.invalidStringToken(C,"Bad character escape sequence"),N},Jn.readWord1=function(){this.containsEsc=!1;for(var y="",C=!0,N=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var q=this.fullCharCodeAtPos();if(nr(q,O))this.pos+=q<=65535?1:2;else if(q===92){this.containsEsc=!0,y+=this.input.slice(N,this.pos);var _e=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(C?Mt:nr)(We,O)||this.invalidStringToken(_e,"Invalid Unicode escape"),y+=oa(We),N=this.pos}else break;C=!1}return y+this.input.slice(N,this.pos)},Jn.readWord=function(){var y=this.readWord1(),C=X.name;return this.keywords.test(y)&&(C=ut[y]),this.finishToken(C,y)};var Gi="7.4.1";yi.acorn={Parser:yi,version:Gi,defaultOptions:Ft,Position:ke,SourceLocation:At,getLineInfo:gt,Node:Mi,TokenType:_t,tokTypes:X,keywordTypes:ut,TokContext:va,tokContexts:Ra,isIdentifierChar:nr,isIdentifierStart:Mt,Token:_i,isNewLine:qe,lineBreak:Yt,lineBreakG:dt,nonASCIIwhitespace:ht};function Na(y,C){return yi.parse(y,C)}function tu(y,C,N){return yi.parseExpressionAt(y,C,N)}function wa(y,C){return yi.tokenizer(y,C)}function Ca(y,C){y.prototype=Object.create(C.prototype),y.prototype.constructor=y,y.__proto__=C}function ys(y){var C=typeof Map=="function"?new Map:void 0;return ys=function(O){if(O===null||!Bu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof C!="undefined"){if(C.has(O))return C.get(O);C.set(O,q)}function q(){return ra(O,arguments,Ba(this).constructor)}return q.prototype=Object.create(O.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),fo(q,O)},ys(y)}function ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function ra(y,C,N){return ps()?ra=Reflect.construct:ra=function(q,_e,We){var lt=[null];lt.push.apply(lt,_e);var vt=Function.bind.apply(q,lt),lr=new vt;return We&&fo(lr,We.prototype),lr},ra.apply(null,arguments)}function Bu(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function fo(y,C){return fo=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},fo(y,C)}function Ba(y){return Ba=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)},Ba(y)}var eo=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(ys(Error)),Ji=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(ys(SyntaxError)),Go=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(ys(ReferenceError)),Ho=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(ys(TypeError)),zu=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(eo),_o=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(Ji),Wo=function(y){Ca(C,y);function C(){return y.apply(this,arguments)||this}return C}(Go),ma={UnknownError:[3001,"%0",zu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",zu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Wo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Wo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Wo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Wo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Wo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Wo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Wo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Wo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Wo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Wo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Go],VariableUndefinedReferenceError:[2002,"%0 is not defined",Go],IsNotConstructor:[2003,"%0 is not a constructor",Ho]};function ho(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function Xo(y,C,N){return ho()?Xo=Reflect.construct:Xo=function(q,_e,We){var lt=[null];lt.push.apply(lt,_e);var vt=Function.bind.apply(q,lt),lr=new vt;return We&&to(lr,We.prototype),lr},Xo.apply(null,arguments)}function to(y,C){return to=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},to(y,C)}var ru="0.0.3";function bc(y,C){Object.defineProperty(y,"name",{value:C,writable:!1,enumerable:!1,configurable:!0})}var Os=Object.prototype.hasOwnProperty,ie=Symbol("Break"),xe=Symbol("Continue"),Qe=Symbol("DefaultCase"),Ot=Symbol("EmptyStatementReturn"),Fr=Symbol("WithScopeName"),pt=Symbol("SuperScopeName"),jt=Symbol("RootScopeName"),ro=Symbol("GlobalScopeName");function Qi(y){return typeof y=="function"}var Ga=function(){function y(N){this.interpreter=N}var C=y.prototype;return C.generator=function(){var O=this.interpreter;function q(){return this.getCurrentScope()}function _e(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:q.bind(O),getGlobalScope:_e.bind(O),getCurrentContext:We.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},y}();function Yo(y,C,N){if(N===void 0&&(N=!0),!(y instanceof Ga))throw new Error("Illegal call");if(typeof C!="string")return C;if(!!C){var O=y.generator(),q=O.getOptions(),_e={timeout:q.timeout,_initEnv:function(){N||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},We=N?O.getGlobalScope():O.getCurrentScope(),lt=new po(We,_e);return lt.evaluate(C)}}Object.defineProperty(Yo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function En(y){if(!(y instanceof Ga))throw new Error("Illegal call");for(var C=y.generator(),N=arguments.length,O=new Array(N>1?N-1:0),q=1;q<N;q++)O[q-1]=arguments[q];var _e=O.pop(),We=new po(C.getGlobalScope(),C.getOptions()),lt=`
		    (function anonymous(`+O.join(",")+`){
		        `+_e+`
		    });
		    `;return We.evaluate(lt)}Object.defineProperty(En,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var vn=function(C){this.value=C},Qt=function(C){this.value=C},No=function(C){this.value=C},be=function(C,N,O){N===void 0&&(N=null),this.name=O,this.parent=N,this.data=C,this.labelStack=[]};function Gs(){}function nu(y,C){return y===void 0&&(y=null),new be(Object.create(null),y,C)}function ds(y){return Object.create(y)}var sa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Yo,Function:En};typeof JSON!="undefined"&&(sa.JSON=JSON),typeof Promise!="undefined"&&(sa.Promise=Promise),typeof Set!="undefined"&&(sa.Set=Set),typeof Map!="undefined"&&(sa.Map=Map),typeof Symbol!="undefined"&&(sa.Symbol=Symbol),typeof Proxy!="undefined"&&(sa.Proxy=Proxy),typeof WeakMap!="undefined"&&(sa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(sa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(sa.Reflect=Reflect);var po=function(){function y(N,O){N===void 0&&(N=y.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||y.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?y.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=N||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var C=y.prototype;return C.initEnvironment=function(O){var q;if(O instanceof be)q=O;else{var _e=null,We=this.createSuperScope(O);this.options.rootContext&&(_e=new be(ds(this.options.rootContext),We,jt)),q=new be(O,_e||We,ro)}this.globalScope=q,this.currentScope=this.globalScope,this.globalContext=q.data,this.currentContext=q.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var lt=this.options._initEnv;lt&&lt.call(this)},C.getExecStartTime=function(){return this.execStartTime},C.getExecutionTime=function(){return this.execEndTime-this.execStartTime},C.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},C.getOptions=function(){return this.options},C.getGlobalScope=function(){return this.globalScope},C.getCurrentScope=function(){return this.currentScope},C.getCurrentContext=function(){return this.currentContext},C.isInterruptThrow=function(O){return O instanceof zu||O instanceof Wo||O instanceof _o},C.createSuperScope=function(O){var q=Object.assign({},sa),_e=Object.keys(q);return _e.forEach(function(We){We in O&&delete q[We]}),new be(q,null,pt)},C.setCurrentContext=function(O){this.currentContext=O},C.setCurrentScope=function(O){this.currentScope=O},C.evaluate=function(O){O===void 0&&(O="");var q;if(!!O)return q=Na(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||y.ecmaVersion}),this.evaluateNode(q,O)},C.appendCode=function(O){return this.evaluate(O)},C.evaluateNode=function(O,q){var _e=this;q===void 0&&(q=""),this.value=void 0,this.source=q,this.sourceList.push(q),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),lt=this.getCurrentContext(),vt=We.labelStack.concat([]),lr=this.callStack.concat([]),Er=function(){_e.setCurrentScope(We),_e.setCurrentContext(lt),We.labelStack=vt,_e.callStack=lr};try{var Mn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Mn()}catch(li){throw li}finally{Er(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},C.createErrorMessage=function(O,q,_e){var We=O[1].replace("%0",String(q));return _e!==null&&(We+=this.getNodePosition(_e||this.lastExecNode)),We},C.createError=function(O,q){return new q(O)},C.createThrowError=function(O,q){return this.createError(O,q)},C.createInternalThrowError=function(O,q,_e){return this.createError(this.createErrorMessage(O,q,_e),O[2])},C.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,q=Date.now();return q-this.execStartTime>O},C.getNodePosition=function(O){if(O){var q="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+q:""}return""},C.createClosure=function(O){var q=this,_e;switch(O.type){case"BinaryExpression":_e=this.binaryExpressionHandler(O);break;case"LogicalExpression":_e=this.logicalExpressionHandler(O);break;case"UnaryExpression":_e=this.unaryExpressionHandler(O);break;case"UpdateExpression":_e=this.updateExpressionHandler(O);break;case"ObjectExpression":_e=this.objectExpressionHandler(O);break;case"ArrayExpression":_e=this.arrayExpressionHandler(O);break;case"CallExpression":_e=this.callExpressionHandler(O);break;case"NewExpression":_e=this.newExpressionHandler(O);break;case"MemberExpression":_e=this.memberExpressionHandler(O);break;case"ThisExpression":_e=this.thisExpressionHandler(O);break;case"SequenceExpression":_e=this.sequenceExpressionHandler(O);break;case"Literal":_e=this.literalHandler(O);break;case"Identifier":_e=this.identifierHandler(O);break;case"AssignmentExpression":_e=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":_e=this.functionDeclarationHandler(O);break;case"VariableDeclaration":_e=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":_e=this.programHandler(O);break;case"ExpressionStatement":_e=this.expressionStatementHandler(O);break;case"EmptyStatement":_e=this.emptyStatementHandler(O);break;case"ReturnStatement":_e=this.returnStatementHandler(O);break;case"FunctionExpression":_e=this.functionExpressionHandler(O);break;case"IfStatement":_e=this.ifStatementHandler(O);break;case"ConditionalExpression":_e=this.conditionalExpressionHandler(O);break;case"ForStatement":_e=this.forStatementHandler(O);break;case"WhileStatement":_e=this.whileStatementHandler(O);break;case"DoWhileStatement":_e=this.doWhileStatementHandler(O);break;case"ForInStatement":_e=this.forInStatementHandler(O);break;case"WithStatement":_e=this.withStatementHandler(O);break;case"ThrowStatement":_e=this.throwStatementHandler(O);break;case"TryStatement":_e=this.tryStatementHandler(O);break;case"ContinueStatement":_e=this.continueStatementHandler(O);break;case"BreakStatement":_e=this.breakStatementHandler(O);break;case"SwitchStatement":_e=this.switchStatementHandler(O);break;case"LabeledStatement":_e=this.labeledStatementHandler(O);break;case"DebuggerStatement":_e=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ma.NodeTypeSyntaxError,O.type,O)}return function(){var We=q.options.timeout;if(We&&We>0&&q.checkTimeout())throw q.createInternalThrowError(ma.ExecutionTimeOutError,We,null);return q.lastExecNode=O,_e.apply(void 0,arguments)}},C.binaryExpressionHandler=function(O){var q=this,_e=this.createClosure(O.left),We=this.createClosure(O.right);return function(){var lt=_e(),vt=We();switch(O.operator){case"==":return lt==vt;case"!=":return lt!=vt;case"===":return lt===vt;case"!==":return lt!==vt;case"<":return lt<vt;case"<=":return lt<=vt;case">":return lt>vt;case">=":return lt>=vt;case"<<":return lt<<vt;case">>":return lt>>vt;case">>>":return lt>>>vt;case"+":return lt+vt;case"-":return lt-vt;case"*":return lt*vt;case"**":return Math.pow(lt,vt);case"/":return lt/vt;case"%":return lt%vt;case"|":return lt|vt;case"^":return lt^vt;case"&":return lt&vt;case"in":return lt in vt;case"instanceof":return lt instanceof vt;default:throw q.createInternalThrowError(ma.BinaryOperatorSyntaxError,O.operator,O)}}},C.logicalExpressionHandler=function(O){var q=this,_e=this.createClosure(O.left),We=this.createClosure(O.right);return function(){switch(O.operator){case"||":return _e()||We();case"&&":return _e()&&We();default:throw q.createInternalThrowError(ma.LogicalOperatorSyntaxError,O.operator,O)}}},C.unaryExpressionHandler=function(O){var q=this;switch(O.operator){case"delete":var _e=this.createObjectGetter(O.argument),We=this.createNameGetter(O.argument);return function(){var Er=_e(),Mn=We();return delete Er[Mn]};default:var lt;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var vt=this.createObjectGetter(O.argument),lr=this.createNameGetter(O.argument);lt=function(){return vt()[lr()]}}else lt=this.createClosure(O.argument);return function(){var Er=lt();switch(O.operator){case"-":return-Er;case"+":return+Er;case"!":return!Er;case"~":return~Er;case"void":return;case"typeof":return typeof Er;default:throw q.createInternalThrowError(ma.UnaryOperatorSyntaxError,O.operator,O)}}}},C.updateExpressionHandler=function(O){var q=this,_e=this.createObjectGetter(O.argument),We=this.createNameGetter(O.argument);return function(){var lt=_e(),vt=We();switch(q.assertVariable(lt,vt,O),O.operator){case"++":return O.prefix?++lt[vt]:lt[vt]++;case"--":return O.prefix?--lt[vt]:lt[vt]--;default:throw q.createInternalThrowError(ma.UpdateOperatorSyntaxError,O.operator,O)}}},C.objectExpressionHandler=function(O){var q=this,_e=[];function We(vt){return vt.type==="Identifier"?vt.name:vt.type==="Literal"?vt.value:this.throwError(ma.ObjectStructureSyntaxError,vt.type,vt)}var lt=Object.create(null);return O.properties.forEach(function(vt){var lr=vt.kind,Er=We(vt.key);(!lt[Er]||lr==="init")&&(lt[Er]={}),lt[Er][lr]=q.createClosure(vt.value),_e.push({key:Er,property:vt})}),function(){for(var vt={},lr=_e.length,Er=0;Er<lr;Er++){var Mn=_e[Er],li=Mn.key,$n=lt[li],Yi=$n.init?$n.init():void 0,fa=$n.get?$n.get():function(){},Pa=$n.set?$n.set():function(sl){};if("set"in $n||"get"in $n){var Hi={configurable:!0,enumerable:!0,get:fa,set:Pa};Object.defineProperty(vt,li,Hi)}else{var Mo=Mn.property,_s=Mo.kind;Mo.key.type==="Identifier"&&Mo.value.type==="FunctionExpression"&&_s==="init"&&!Mo.value.id&&bc(Yi,Mo.key.name),vt[li]=Yi}}return vt}},C.arrayExpressionHandler=function(O){var q=this,_e=O.elements.map(function(We){return We&&q.createClosure(We)});return function(){for(var We=_e.length,lt=Array(We),vt=0;vt<We;vt++){var lr=_e[vt];lr&&(lt[vt]=lr())}return lt}},C.safeObjectGet=function(O,q,_e){return O[q]},C.createCallFunctionGetter=function(O){var q=this;switch(O.type){case"MemberExpression":var _e=this.createClosure(O.object),We=this.createMemberKeyGetter(O),lt=this.source;return function(){var lr=_e(),Er=We(),Mn=q.safeObjectGet(lr,Er,O);if(!Mn||!Qi(Mn)){var li=lt.slice(O.start,O.end);throw q.createInternalThrowError(ma.FunctionUndefinedReferenceError,li,O)}return Mn.__IS_EVAL_FUNC?function($n){return Mn(new Ga(q),$n,!0)}:Mn.__IS_FUNCTION_FUNC?function(){for(var $n=arguments.length,Yi=new Array($n),fa=0;fa<$n;fa++)Yi[fa]=arguments[fa];return Mn.apply(void 0,[new Ga(q)].concat(Yi))}:Mn.bind(lr)};default:var vt=this.createClosure(O);return function(){var lr="";O.type==="Identifier"&&(lr=O.name);var Er=vt();if(!Er||!Qi(Er))throw q.createInternalThrowError(ma.FunctionUndefinedReferenceError,lr,O);if(O.type==="Identifier"&&Er.__IS_EVAL_FUNC&&lr==="eval")return function($n){var Yi=q.getScopeFromName(lr,q.getCurrentScope()),fa=Yi.name===pt||Yi.name===ro||Yi.name===jt;return Er(new Ga(q),$n,!fa)};if(Er.__IS_EVAL_FUNC)return function($n){return Er(new Ga(q),$n,!0)};if(Er.__IS_FUNCTION_FUNC)return function(){for(var $n=arguments.length,Yi=new Array($n),fa=0;fa<$n;fa++)Yi[fa]=arguments[fa];return Er.apply(void 0,[new Ga(q)].concat(Yi))};var Mn=q.options.globalContextInFunction;if(O.type==="Identifier"){var li=q.getIdentifierScope(O);li.name===Fr&&(Mn=li.data)}return Er.bind(Mn)}}},C.callExpressionHandler=function(O){var q=this,_e=this.createCallFunctionGetter(O.callee),We=O.arguments.map(function(lt){return q.createClosure(lt)});return function(){return _e().apply(void 0,We.map(function(lt){return lt()}))}},C.functionExpressionHandler=function(O){var q=this,_e=this,We=this.source,lt=this.collectDeclVars,vt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var lr=O.id?O.id.name:"",Er=O.params.length,Mn=O.params.map(function(fa){return q.createParamNameGetter(fa)}),li=this.createClosure(O.body),$n=this.collectDeclVars,Yi=this.collectDeclFuncs;return this.collectDeclVars=lt,this.collectDeclFuncs=vt,function(){var fa=_e.getCurrentScope(),Pa=function Hi(){for(var Mo=arguments.length,_s=new Array(Mo),sl=0;sl<Mo;sl++)_s[sl]=arguments[sl];_e.callStack.push(""+lr);var Gc=_e.getCurrentScope(),Vu=nu(fa,"FunctionScope("+lr+")");_e.setCurrentScope(Vu),_e.addDeclarationsToScope($n,Yi,Vu),lr&&(Vu.data[lr]=Hi),Vu.data.arguments=arguments,Mn.forEach(function(cu,xo){Vu.data[cu()]=_s[xo]});var wc=_e.getCurrentContext();_e.setCurrentContext(this);var wu=li();if(_e.setCurrentContext(wc),_e.setCurrentScope(Gc),_e.callStack.pop(),wu instanceof vn)return wu.value};return bc(Pa,lr),Object.defineProperty(Pa,"length",{value:Er,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Pa,"toString",{value:function(){return We.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Pa,"valueOf",{value:function(){return We.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Pa}},C.newExpressionHandler=function(O){var q=this,_e=this.source,We=this.createClosure(O.callee),lt=O.arguments.map(function(vt){return q.createClosure(vt)});return function(){var vt=We();if(!Qi(vt)||vt.__IS_EVAL_FUNC){var lr=O.callee,Er=_e.slice(lr.start,lr.end);throw q.createInternalThrowError(ma.IsNotConstructor,Er,O)}return vt.__IS_FUNCTION_FUNC?vt.apply(void 0,[new Ga(q)].concat(lt.map(function(Mn){return Mn()}))):Xo(vt,lt.map(function(Mn){return Mn()}))}},C.memberExpressionHandler=function(O){var q=this.createClosure(O.object),_e=this.createMemberKeyGetter(O);return function(){var We=q(),lt=_e();return We[lt]}},C.thisExpressionHandler=function(O){var q=this;return function(){return q.getCurrentContext()}},C.sequenceExpressionHandler=function(O){var q=this,_e=O.expressions.map(function(We){return q.createClosure(We)});return function(){for(var We,lt=_e.length,vt=0;vt<lt;vt++){var lr=_e[vt];We=lr()}return We}},C.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},C.identifierHandler=function(O){var q=this;return function(){var _e=q.getCurrentScope(),We=q.getScopeDataFromName(O.name,_e);return q.assertVariable(We,O.name,O),We[O.name]}},C.getIdentifierScope=function(O){var q=this.getCurrentScope(),_e=this.getScopeFromName(O.name,q);return _e},C.assignmentExpressionHandler=function(O){var q=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var _e=this.createObjectGetter(O.left),We=this.createNameGetter(O.left),lt=this.createClosure(O.right);return function(){var vt=_e(),lr=We(),Er=lt();switch(O.operator!=="="&&q.assertVariable(vt,lr,O),O.operator){case"=":return vt[lr]=Er;case"+=":return vt[lr]+=Er;case"-=":return vt[lr]-=Er;case"*=":return vt[lr]*=Er;case"**=":return vt[lr]=Math.pow(vt[lr],Er);case"/=":return vt[lr]/=Er;case"%=":return vt[lr]%=Er;case"<<=":return vt[lr]<<=Er;case">>=":return vt[lr]>>=Er;case">>>=":return vt[lr]>>>=Er;case"&=":return vt[lr]&=Er;case"^=":return vt[lr]^=Er;case"|=":return vt[lr]|=Er;default:throw q.createInternalThrowError(ma.AssignmentExpressionSyntaxError,O.type,O)}}},C.functionDeclarationHandler=function(O){if(O.id){var q=this.functionExpressionHandler(O);Object.defineProperty(q,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,q)}return function(){return Ot}},C.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ma.VariableTypeSyntaxError,O.type,O)},C.variableDeclarationHandler=function(O){for(var q=this,_e,We=[],lt=0;lt<O.declarations.length;lt++){var vt=O.declarations[lt];this.varDeclaration(this.getVariableName(vt.id)),vt.init&&We.push({type:"AssignmentExpression",operator:"=",left:vt.id,right:vt.init})}return We.length&&(_e=this.createClosure({type:"BlockStatement",body:We})),function(){if(_e){var lr=q.isVarDeclMode;q.isVarDeclMode=!0,_e(),q.isVarDeclMode=lr}return Ot}},C.assertVariable=function(O,q,_e){if(O===this.globalScope.data&&!(q in O))throw this.createInternalThrowError(ma.VariableUndefinedReferenceError,q,_e)},C.programHandler=function(O){var q=this,_e=O.body.map(function(We){return q.createClosure(We)});return function(){for(var We=Ot,lt=0;lt<_e.length;lt++){var vt=_e[lt],lr=q.setValue(vt());if(lr!==Ot&&(We=lr,We instanceof vn||We instanceof Qt||We instanceof No||We===ie||We===xe))break}return We}},C.expressionStatementHandler=function(O){return this.createClosure(O.expression)},C.emptyStatementHandler=function(O){return function(){return Ot}},C.returnStatementHandler=function(O){var q=O.argument?this.createClosure(O.argument):Gs;return function(){return new vn(q())}},C.ifStatementHandler=function(O){var q=this.createClosure(O.test),_e=this.createClosure(O.consequent),We=O.alternate?this.createClosure(O.alternate):function(){return Ot};return function(){return q()?_e():We()}},C.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},C.forStatementHandler=function(O){var q=this,_e=Gs,We=O.test?this.createClosure(O.test):function(){return!0},lt=Gs,vt=this.createClosure(O.body);return O.type==="ForStatement"&&(_e=O.init?this.createClosure(O.init):_e,lt=O.update?this.createClosure(O.update):Gs),function(lr){var Er,Mn=Ot,li=O.type==="DoWhileStatement";for(lr&&lr.type==="LabeledStatement"&&(Er=lr.label.name),_e();li||We();lt()){li=!1;var $n=q.setValue(vt());if(!($n===Ot||$n===xe)){if($n===ie)break;if(Mn=$n,Mn instanceof No&&Mn.value===Er){Mn=Ot;continue}if(Mn instanceof vn||Mn instanceof Qt||Mn instanceof No)break}}return Mn}},C.whileStatementHandler=function(O){return this.forStatementHandler(O)},C.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},C.forInStatementHandler=function(O){var q=this,_e=O.left,We=this.createClosure(O.right),lt=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),_e=O.left.declarations[0].id),function(vt){var lr,Er=Ot,Mn;vt&&vt.type==="LabeledStatement"&&(lr=vt.label.name);var li=We();for(Mn in li){q.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:_e,right:{type:"Literal",value:Mn}})();var $n=q.setValue(lt());if(!($n===Ot||$n===xe)){if($n===ie)break;if(Er=$n,Er instanceof No&&Er.value===lr){Er=Ot;continue}if(Er instanceof vn||Er instanceof Qt||Er instanceof No)break}}return Er}},C.withStatementHandler=function(O){var q=this,_e=this.createClosure(O.object),We=this.createClosure(O.body);return function(){var lt=_e(),vt=q.getCurrentScope(),lr=new be(lt,vt,Fr);q.setCurrentScope(lr);var Er=q.setValue(We());return q.setCurrentScope(vt),Er}},C.throwStatementHandler=function(O){var q=this,_e=this.createClosure(O.argument);return function(){throw q.setValue(void 0),_e()}},C.tryStatementHandler=function(O){var q=this,_e=this.createClosure(O.block),We=O.handler?this.catchClauseHandler(O.handler):null,lt=O.finalizer?this.createClosure(O.finalizer):null;return function(){var vt=q.getCurrentScope(),lr=q.getCurrentContext(),Er=vt.labelStack.concat([]),Mn=q.callStack.concat([]),li=Ot,$n,Yi,fa=function(){q.setCurrentScope(vt),q.setCurrentContext(lr),vt.labelStack=Er,q.callStack=Mn};try{li=q.setValue(_e()),li instanceof vn&&($n=li)}catch(Pa){if(fa(),q.isInterruptThrow(Pa))throw Pa;if(We)try{li=q.setValue(We(Pa)),li instanceof vn&&($n=li)}catch(Hi){if(fa(),q.isInterruptThrow(Hi))throw Hi;Yi=Hi}}if(lt)try{li=lt(),li instanceof vn&&($n=li)}catch(Pa){if(fa(),q.isInterruptThrow(Pa))throw Pa;Yi=Pa}if(Yi)throw Yi;return $n||li}},C.catchClauseHandler=function(O){var q=this,_e=this.createParamNameGetter(O.param),We=this.createClosure(O.body);return function(lt){var vt,lr=q.getCurrentScope(),Er=lr.data,Mn=_e(),li=Os.call(Er,Mn),$n=Er[Mn];return Er[Mn]=lt,vt=We(),li?Er[Mn]=$n:delete Er[Mn],vt}},C.continueStatementHandler=function(O){return function(){return O.label?new No(O.label.name):xe}},C.breakStatementHandler=function(O){return function(){return O.label?new Qt(O.label.name):ie}},C.switchStatementHandler=function(O){var q=this,_e=this.createClosure(O.discriminant),We=O.cases.map(function(lt){return q.switchCaseHandler(lt)});return function(){for(var lt=_e(),vt=!1,lr,Er,Mn,li=0;li<We.length;li++){var $n=We[li](),Yi=$n.testClosure();if(Yi===Qe){Mn=$n;continue}if(vt||Yi===lt){if(vt=!0,Er=q.setValue($n.bodyClosure()),Er===Ot)continue;if(Er===ie||(lr=Er,lr instanceof vn||lr instanceof Qt||lr instanceof No||lr===xe))break}}if(!vt&&Mn){Er=q.setValue(Mn.bodyClosure());var fa=Er===Ot||Er===ie||Er===xe;fa||(lr=Er)}return lr}},C.switchCaseHandler=function(O){var q=O.test?this.createClosure(O.test):function(){return Qe},_e=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:q,bodyClosure:_e}}},C.labeledStatementHandler=function(O){var q=this,_e=O.label.name,We=this.createClosure(O.body);return function(){var lt,vt=q.getCurrentScope();return vt.labelStack.push(_e),lt=We(O),lt instanceof Qt&&lt.value===_e&&(lt=Ot),vt.labelStack.pop(),lt}},C.debuggerStatementHandler=function(O){return function(){debugger;return Ot}},C.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ma.ParamTypeSyntaxError,O.type,O)},C.createObjectKeyGetter=function(O){var q;return O.type==="Identifier"?q=function(){return O.name}:q=this.createClosure(O),function(){return q()}},C.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},C.createObjectGetter=function(O){var q=this;switch(O.type){case"Identifier":return function(){return q.getScopeDataFromName(O.name,q.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ma.AssignmentTypeSyntaxError,O.type,O)}},C.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ma.AssignmentTypeSyntaxError,O.type,O)}},C.varDeclaration=function(O){var q=this.collectDeclVars;q[O]=void 0},C.funcDeclaration=function(O,q){var _e=this.collectDeclFuncs;_e[O]=q},C.addDeclarationsToScope=function(O,q,_e){var We=_e.data;for(var lt in q){var vt=q[lt];We[lt]=vt&&vt()}for(var lr in O)lr in We||(We[lr]=void 0)},C.getScopeValue=function(O,q){var _e=this.getScopeFromName(O,q);return _e.data[O]},C.getScopeDataFromName=function(O,q){return this.getScopeFromName(O,q).data},C.getScopeFromName=function(O,q){var _e=q;do if(O in _e.data)return _e;while(_e=_e.parent);return this.globalScope},C.setValue=function(O){var q=this.callStack.length;return this.isVarDeclMode||q||O===Ot||O===ie||O===xe||O instanceof Qt||O instanceof No||(this.value=O instanceof vn?O.value:O),O},C.getValue=function(){return this.value},y}();po.version=ru,po.eval=Yo,po.Function=En,po.ecmaVersion=5,po.globalContextInFunction=void 0,po.global=Object.create(null);function Xl(y){return y===void 0&&(y=Object.create(null)),y}function Ec(y,C,N){C===void 0&&(C=[]),N===void 0&&(N={});var O=N.parsingContext,q=N.timeout===void 0?0:N.timeout,_e=`
    (function anonymous(`+C.join(",")+`){
         `+y+`
    });
    `,We=new po(O,{ecmaVersion:N.ecmaVersion,timeout:q,rootContext:N.rootContext,globalContextInFunction:N.globalContextInFunction});return We.evaluate(_e)}function Uu(y,C,N){var O=new po(C,N);return O.evaluate(y)}var Sc=Uu,Sl=function(){function y(N){this._code=N}var C=y.prototype;return C.runInContext=function(O){return Uu(this._code,O)},C.runInNewContext=function(O){return Uu(this._code,O)},y}(),Zu=function(y,C,N){return Uu(y,C,N)};function iu(){for(var y=arguments.length,C=new Array(y),N=0;N<y;N++)C[N]=arguments[N];var O=C.pop();return Ec(O||"",C)}var ju=Zu},20396:function(Ue,H,R){var Y;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function($,v,ee,F){"use strict";var J=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",re=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ee=J||re,ne=["","webkit","Moz","MS","ms","o"],je=Ee?"":v.createElement("div"),we="function",et=Math.round,Mt=Math.abs,nr=Date.now;function _t(ie,xe,Qe){return setTimeout(dt(ie,Qe),xe)}function Xt(ie,xe,Qe){return Array.isArray(ie)?(Ct(ie,Qe[xe],Qe),!0):!1}function Ct(ie,xe,Qe){var Ot;if(!!ie)if(ie.forEach)ie.forEach(xe,Qe);else if(ie.length!==F)for(Ot=0;Ot<ie.length;)xe.call(Qe,ie[Ot],Ot,ie),Ot++;else for(Ot in ie)ie.hasOwnProperty(Ot)&&xe.call(Qe,ie[Ot],Ot,ie)}function ot(ie,xe,Qe){var Ot="DEPRECATED METHOD: "+xe+`
`+Qe+` AT 
`;return function(){var Fr=new Error("get-stack-trace"),pt=Fr&&Fr.stack?Fr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",jt=$.console&&($.console.warn||$.console.log);return jt&&jt.call($.console,Ot,pt),ie.apply(this,arguments)}}var ut;typeof Object.assign!="function"?ut=function(xe){if(xe===F||xe===null)throw new TypeError("Cannot convert undefined or null to object");for(var Qe=Object(xe),Ot=1;Ot<arguments.length;Ot++){var Fr=arguments[Ot];if(Fr!==F&&Fr!==null)for(var pt in Fr)Fr.hasOwnProperty(pt)&&(Qe[pt]=Fr[pt])}return Qe}:ut=Object.assign;var Jt=ot(function(xe,Qe,Ot){for(var Fr=Object.keys(Qe),pt=0;pt<Fr.length;)(!Ot||Ot&&xe[Fr[pt]]===F)&&(xe[Fr[pt]]=Qe[Fr[pt]]),pt++;return xe},"extend","Use `assign`."),X=ot(function(xe,Qe){return Jt(xe,Qe,!0)},"merge","Use `assign`.");function Yt(ie,xe,Qe){var Ot=xe.prototype,Fr;Fr=ie.prototype=Object.create(Ot),Fr.constructor=ie,Fr._super=Ot,Qe&&ut(Fr,Qe)}function dt(ie,xe){return function(){return ie.apply(xe,arguments)}}function qe(ie,xe){return typeof ie==we?ie.apply(xe&&xe[0]||F,xe):ie}function ht(ie,xe){return ie===F?xe:ie}function $e(ie,xe,Qe){Ct(Hr(xe),function(Ot){ie.addEventListener(Ot,Qe,!1)})}function Rt(ie,xe,Qe){Ct(Hr(xe),function(Ot){ie.removeEventListener(Ot,Qe,!1)})}function yr(ie,xe){for(;ie;){if(ie==xe)return!0;ie=ie.parentNode}return!1}function Rr(ie,xe){return ie.indexOf(xe)>-1}function Hr(ie){return ie.trim().split(/\s+/g)}function Te(ie,xe,Qe){if(ie.indexOf&&!Qe)return ie.indexOf(xe);for(var Ot=0;Ot<ie.length;){if(Qe&&ie[Ot][Qe]==xe||!Qe&&ie[Ot]===xe)return Ot;Ot++}return-1}function Ye(ie){return Array.prototype.slice.call(ie,0)}function ke(ie,xe,Qe){for(var Ot=[],Fr=[],pt=0;pt<ie.length;){var jt=xe?ie[pt][xe]:ie[pt];Te(Fr,jt)<0&&Ot.push(ie[pt]),Fr[pt]=jt,pt++}return Qe&&(xe?Ot=Ot.sort(function(Qi,Ga){return Qi[xe]>Ga[xe]}):Ot=Ot.sort()),Ot}function At(ie,xe){for(var Qe,Ot,Fr=xe[0].toUpperCase()+xe.slice(1),pt=0;pt<ne.length;){if(Qe=ne[pt],Ot=Qe?Qe+Fr:xe,Ot in ie)return Ot;pt++}return F}var gt=1;function Ft(){return gt++}function qt(ie){var xe=ie.ownerDocument||ie;return xe.defaultView||xe.parentWindow||$}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,Hn="ontouchstart"in $,hn=At($,"PointerEvent")!==F,Ki=Hn&&Cr.test(navigator.userAgent),Bn="touch",Gn="pen",hi="mouse",Wn="kinect",si=25,aa=1,Ri=2,Si=4,Vi=8,ua=1,wi=2,xa=4,An=8,yi=16,zi=wi|xa,$i=An|yi,ja=zi|$i,me=["x","y"],Ln=["clientX","clientY"];function Va(ie,xe){var Qe=this;this.manager=ie,this.callback=xe,this.element=ie.element,this.target=ie.options.inputTarget,this.domHandler=function(Ot){qe(ie.options.enable,[ie])&&Qe.handler(Ot)},this.init()}Va.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(qt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Rt(this.element,this.evEl,this.domHandler),this.evTarget&&Rt(this.target,this.evTarget,this.domHandler),this.evWin&&Rt(qt(this.element),this.evWin,this.domHandler)}};function fs(ie){var xe,Qe=ie.options.inputClass;return Qe?xe=Qe:hn?xe=Ie:Ki?xe=Dt:Hn?xe=Tt:xe=Sa,new xe(ie,zt)}function zt(ie,xe,Qe){var Ot=Qe.pointers.length,Fr=Qe.changedPointers.length,pt=xe&aa&&Ot-Fr==0,jt=xe&(Si|Vi)&&Ot-Fr==0;Qe.isFirst=!!pt,Qe.isFinal=!!jt,pt&&(ie.session={}),Qe.eventType=xe,ir(ie,Qe),ie.emit("hammer.input",Qe),ie.recognize(Qe),ie.session.prevInput=Qe}function ir(ie,xe){var Qe=ie.session,Ot=xe.pointers,Fr=Ot.length;Qe.firstInput||(Qe.firstInput=sr(xe)),Fr>1&&!Qe.firstMultiple?Qe.firstMultiple=sr(xe):Fr===1&&(Qe.firstMultiple=!1);var pt=Qe.firstInput,jt=Qe.firstMultiple,ro=jt?jt.center:pt.center,Qi=xe.center=On(Ot);xe.timeStamp=nr(),xe.deltaTime=xe.timeStamp-pt.timeStamp,xe.angle=Ti(ro,Qi),xe.distance=nn(ro,Qi),Ir(Qe,xe),xe.offsetDirection=Zn(xe.deltaX,xe.deltaY);var Ga=ui(xe.deltaTime,xe.deltaX,xe.deltaY);xe.overallVelocityX=Ga.x,xe.overallVelocityY=Ga.y,xe.overallVelocity=Mt(Ga.x)>Mt(Ga.y)?Ga.x:Ga.y,xe.scale=jt?Ya(jt.pointers,Ot):1,xe.rotation=jt?Mi(jt.pointers,Ot):0,xe.maxPointers=Qe.prevInput?xe.pointers.length>Qe.prevInput.maxPointers?xe.pointers.length:Qe.prevInput.maxPointers:xe.pointers.length,I(Qe,xe);var Yo=ie.element;yr(xe.srcEvent.target,Yo)&&(Yo=xe.srcEvent.target),xe.target=Yo}function Ir(ie,xe){var Qe=xe.center,Ot=ie.offsetDelta||{},Fr=ie.prevDelta||{},pt=ie.prevInput||{};(xe.eventType===aa||pt.eventType===Si)&&(Fr=ie.prevDelta={x:pt.deltaX||0,y:pt.deltaY||0},Ot=ie.offsetDelta={x:Qe.x,y:Qe.y}),xe.deltaX=Fr.x+(Qe.x-Ot.x),xe.deltaY=Fr.y+(Qe.y-Ot.y)}function I(ie,xe){var Qe=ie.lastInterval||xe,Ot=xe.timeStamp-Qe.timeStamp,Fr,pt,jt,ro;if(xe.eventType!=Vi&&(Ot>si||Qe.velocity===F)){var Qi=xe.deltaX-Qe.deltaX,Ga=xe.deltaY-Qe.deltaY,Yo=ui(Ot,Qi,Ga);pt=Yo.x,jt=Yo.y,Fr=Mt(Yo.x)>Mt(Yo.y)?Yo.x:Yo.y,ro=Zn(Qi,Ga),ie.lastInterval=xe}else Fr=Qe.velocity,pt=Qe.velocityX,jt=Qe.velocityY,ro=Qe.direction;xe.velocity=Fr,xe.velocityX=pt,xe.velocityY=jt,xe.direction=ro}function sr(ie){for(var xe=[],Qe=0;Qe<ie.pointers.length;)xe[Qe]={clientX:et(ie.pointers[Qe].clientX),clientY:et(ie.pointers[Qe].clientY)},Qe++;return{timeStamp:nr(),pointers:xe,center:On(xe),deltaX:ie.deltaX,deltaY:ie.deltaY}}function On(ie){var xe=ie.length;if(xe===1)return{x:et(ie[0].clientX),y:et(ie[0].clientY)};for(var Qe=0,Ot=0,Fr=0;Fr<xe;)Qe+=ie[Fr].clientX,Ot+=ie[Fr].clientY,Fr++;return{x:et(Qe/xe),y:et(Ot/xe)}}function ui(ie,xe,Qe){return{x:xe/ie||0,y:Qe/ie||0}}function Zn(ie,xe){return ie===xe?ua:Mt(ie)>=Mt(xe)?ie<0?wi:xa:xe<0?An:yi}function nn(ie,xe,Qe){Qe||(Qe=me);var Ot=xe[Qe[0]]-ie[Qe[0]],Fr=xe[Qe[1]]-ie[Qe[1]];return Math.sqrt(Ot*Ot+Fr*Fr)}function Ti(ie,xe,Qe){Qe||(Qe=me);var Ot=xe[Qe[0]]-ie[Qe[0]],Fr=xe[Qe[1]]-ie[Qe[1]];return Math.atan2(Fr,Ot)*180/Math.PI}function Mi(ie,xe){return Ti(xe[1],xe[0],Ln)+Ti(ie[1],ie[0],Ln)}function Ya(ie,xe){return nn(xe[0],xe[1],Ln)/nn(ie[0],ie[1],Ln)}var hs={mousedown:aa,mousemove:Ri,mouseup:Si},va="mousedown",Ra="mousemove mouseup";function Sa(){this.evEl=va,this.evWin=Ra,this.pressed=!1,Va.apply(this,arguments)}Yt(Sa,Va,{handler:function(xe){var Qe=hs[xe.type];Qe&aa&&xe.button===0&&(this.pressed=!0),Qe&Ri&&xe.which!==1&&(Qe=Si),!!this.pressed&&(Qe&Si&&(this.pressed=!1),this.callback(this.manager,Qe,{pointers:[xe],changedPointers:[xe],pointerType:hi,srcEvent:xe}))}});var V={pointerdown:aa,pointermove:Ri,pointerup:Si,pointercancel:Vi,pointerout:Vi},K={2:Bn,3:Gn,4:hi,5:Wn},se="pointerdown",ge="pointermove pointerup pointercancel";!Ee&&$.MSPointerEvent&&!$.PointerEvent&&(se="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Ie(){this.evEl=se,this.evWin=ge,Va.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Yt(Ie,Va,{handler:function(xe){var Qe=this.store,Ot=!1,Fr=xe.type.toLowerCase().replace("ms",""),pt=V[Fr],jt=K[xe.pointerType]||xe.pointerType,ro=jt==Bn,Qi=Te(Qe,xe.pointerId,"pointerId");pt&aa&&(xe.button===0||ro)?Qi<0&&(Qe.push(xe),Qi=Qe.length-1):pt&(Si|Vi)&&(Ot=!0),!(Qi<0)&&(Qe[Qi]=xe,this.callback(this.manager,pt,{pointers:Qe,changedPointers:[xe],pointerType:jt,srcEvent:xe}),Ot&&Qe.splice(Qi,1))}});var Ve={touchstart:aa,touchmove:Ri,touchend:Si,touchcancel:Vi},rt="touchstart",pe="touchstart touchmove touchend touchcancel";function De(){this.evTarget=rt,this.evWin=pe,this.started=!1,Va.apply(this,arguments)}Yt(De,Va,{handler:function(xe){var Qe=Ve[xe.type];if(Qe===aa&&(this.started=!0),!!this.started){var Ot=yt.call(this,xe,Qe);Qe&(Si|Vi)&&Ot[0].length-Ot[1].length==0&&(this.started=!1),this.callback(this.manager,Qe,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Bn,srcEvent:xe})}}});function yt(ie,xe){var Qe=Ye(ie.touches),Ot=Ye(ie.changedTouches);return xe&(Si|Vi)&&(Qe=ke(Qe.concat(Ot),"identifier",!0)),[Qe,Ot]}var vr={touchstart:aa,touchmove:Ri,touchend:Si,touchcancel:Vi},Lt="touchstart touchmove touchend touchcancel";function Dt(){this.evTarget=Lt,this.targetIds={},Va.apply(this,arguments)}Yt(Dt,Va,{handler:function(xe){var Qe=vr[xe.type],Ot=gr.call(this,xe,Qe);!Ot||this.callback(this.manager,Qe,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Bn,srcEvent:xe})}});function gr(ie,xe){var Qe=Ye(ie.touches),Ot=this.targetIds;if(xe&(aa|Ri)&&Qe.length===1)return Ot[Qe[0].identifier]=!0,[Qe,Qe];var Fr,pt,jt=Ye(ie.changedTouches),ro=[],Qi=this.target;if(pt=Qe.filter(function(Ga){return yr(Ga.target,Qi)}),xe===aa)for(Fr=0;Fr<pt.length;)Ot[pt[Fr].identifier]=!0,Fr++;for(Fr=0;Fr<jt.length;)Ot[jt[Fr].identifier]&&ro.push(jt[Fr]),xe&(Si|Vi)&&delete Ot[jt[Fr].identifier],Fr++;if(!!ro.length)return[ke(pt.concat(ro),"identifier",!0),ro]}var bn=2500,ln=25;function Tt(){Va.apply(this,arguments);var ie=dt(this.handler,this);this.touch=new Dt(this.manager,ie),this.mouse=new Sa(this.manager,ie),this.primaryTouch=null,this.lastTouches=[]}Yt(Tt,Va,{handler:function(xe,Qe,Ot){var Fr=Ot.pointerType==Bn,pt=Ot.pointerType==hi;if(!(pt&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(Fr)on.call(this,Qe,Ot);else if(pt&&Wr.call(this,Ot))return;this.callback(xe,Qe,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function on(ie,xe){ie&aa?(this.primaryTouch=xe.changedPointers[0].identifier,Vr.call(this,xe)):ie&(Si|Vi)&&Vr.call(this,xe)}function Vr(ie){var xe=ie.changedPointers[0];if(xe.identifier===this.primaryTouch){var Qe={x:xe.clientX,y:xe.clientY};this.lastTouches.push(Qe);var Ot=this.lastTouches,Fr=function(){var pt=Ot.indexOf(Qe);pt>-1&&Ot.splice(pt,1)};setTimeout(Fr,bn)}}function Wr(ie){for(var xe=ie.srcEvent.clientX,Qe=ie.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var Fr=this.lastTouches[Ot],pt=Math.abs(xe-Fr.x),jt=Math.abs(Qe-Fr.y);if(pt<=ln&&jt<=ln)return!0}return!1}var ii=Ee?F:At(je.style,"touchAction"),en=ii!==F,Ci="compute",ta="auto",gi="manipulation",Pi="none",_i="pan-x",Jn="pan-y",Xi=Ii();function La(ie,xe){this.manager=ie,this.set(xe)}La.prototype={set:function(ie){ie==Ci&&(ie=this.compute()),en&&this.manager.element.style&&Xi[ie]&&(this.manager.element.style[ii]=ie),this.actions=ie.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ie=[];return Ct(this.manager.recognizers,function(xe){qe(xe.options.enable,[xe])&&(ie=ie.concat(xe.getTouchAction()))}),oa(ie.join(" "))},preventDefaults:function(ie){var xe=ie.srcEvent,Qe=ie.offsetDirection;if(this.manager.session.prevented){xe.preventDefault();return}var Ot=this.actions,Fr=Rr(Ot,Pi)&&!Xi[Pi],pt=Rr(Ot,Jn)&&!Xi[Jn],jt=Rr(Ot,_i)&&!Xi[_i];if(Fr){var ro=ie.pointers.length===1,Qi=ie.distance<2,Ga=ie.deltaTime<250;if(ro&&Qi&&Ga)return}if(!(jt&&pt)&&(Fr||pt&&Qe&zi||jt&&Qe&$i))return this.preventSrc(xe)},preventSrc:function(ie){this.manager.session.prevented=!0,ie.preventDefault()}};function oa(ie){if(Rr(ie,Pi))return Pi;var xe=Rr(ie,_i),Qe=Rr(ie,Jn);return xe&&Qe?Pi:xe||Qe?xe?_i:Jn:Rr(ie,gi)?gi:ta}function Ii(){if(!en)return!1;var ie={};if(Ee)return ie;var xe=$.CSS&&$.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Qe){ie[Qe]=xe?$.CSS.supports("touch-action",Qe):!0}),ie}var Gi=1,Na=2,tu=4,wa=8,Ca=wa,ys=16,ps=32;function ra(ie){this.options=ut({},this.defaults,ie||{}),this.id=Ft(),this.manager=null,this.options.enable=ht(this.options.enable,!0),this.state=Gi,this.simultaneous={},this.requireFail=[]}ra.prototype={defaults:{},set:function(ie){return ut(this.options,ie),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ie){if(Xt(ie,"recognizeWith",this))return this;var xe=this.simultaneous;return ie=Ba(ie,this),xe[ie.id]||(xe[ie.id]=ie,ie.recognizeWith(this)),this},dropRecognizeWith:function(ie){return Xt(ie,"dropRecognizeWith",this)?this:(ie=Ba(ie,this),delete this.simultaneous[ie.id],this)},requireFailure:function(ie){if(Xt(ie,"requireFailure",this))return this;var xe=this.requireFail;return ie=Ba(ie,this),Te(xe,ie)===-1&&(xe.push(ie),ie.requireFailure(this)),this},dropRequireFailure:function(ie){if(Xt(ie,"dropRequireFailure",this))return this;ie=Ba(ie,this);var xe=Te(this.requireFail,ie);return xe>-1&&this.requireFail.splice(xe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ie){return!!this.simultaneous[ie.id]},emit:function(ie){var xe=this,Qe=this.state;function Ot(Fr){xe.manager.emit(Fr,ie)}Qe<wa&&Ot(xe.options.event+Bu(Qe)),Ot(xe.options.event),ie.additionalEvent&&Ot(ie.additionalEvent),Qe>=wa&&Ot(xe.options.event+Bu(Qe))},tryEmit:function(ie){if(this.canEmit())return this.emit(ie);this.state=ps},canEmit:function(){for(var ie=0;ie<this.requireFail.length;){if(!(this.requireFail[ie].state&(ps|Gi)))return!1;ie++}return!0},recognize:function(ie){var xe=ut({},ie);if(!qe(this.options.enable,[this,xe])){this.reset(),this.state=ps;return}this.state&(Ca|ys|ps)&&(this.state=Gi),this.state=this.process(xe),this.state&(Na|tu|wa|ys)&&this.tryEmit(xe)},process:function(ie){},getTouchAction:function(){},reset:function(){}};function Bu(ie){return ie&ys?"cancel":ie&wa?"end":ie&tu?"move":ie&Na?"start":""}function fo(ie){return ie==yi?"down":ie==An?"up":ie==wi?"left":ie==xa?"right":""}function Ba(ie,xe){var Qe=xe.manager;return Qe?Qe.get(ie):ie}function eo(){ra.apply(this,arguments)}Yt(eo,ra,{defaults:{pointers:1},attrTest:function(ie){var xe=this.options.pointers;return xe===0||ie.pointers.length===xe},process:function(ie){var xe=this.state,Qe=ie.eventType,Ot=xe&(Na|tu),Fr=this.attrTest(ie);return Ot&&(Qe&Vi||!Fr)?xe|ys:Ot||Fr?Qe&Si?xe|wa:xe&Na?xe|tu:Na:ps}});function Ji(){eo.apply(this,arguments),this.pX=null,this.pY=null}Yt(Ji,eo,{defaults:{event:"pan",threshold:10,pointers:1,direction:ja},getTouchAction:function(){var ie=this.options.direction,xe=[];return ie&zi&&xe.push(Jn),ie&$i&&xe.push(_i),xe},directionTest:function(ie){var xe=this.options,Qe=!0,Ot=ie.distance,Fr=ie.direction,pt=ie.deltaX,jt=ie.deltaY;return Fr&xe.direction||(xe.direction&zi?(Fr=pt===0?ua:pt<0?wi:xa,Qe=pt!=this.pX,Ot=Math.abs(ie.deltaX)):(Fr=jt===0?ua:jt<0?An:yi,Qe=jt!=this.pY,Ot=Math.abs(ie.deltaY))),ie.direction=Fr,Qe&&Ot>xe.threshold&&Fr&xe.direction},attrTest:function(ie){return eo.prototype.attrTest.call(this,ie)&&(this.state&Na||!(this.state&Na)&&this.directionTest(ie))},emit:function(ie){this.pX=ie.deltaX,this.pY=ie.deltaY;var xe=fo(ie.direction);xe&&(ie.additionalEvent=this.options.event+xe),this._super.emit.call(this,ie)}});function Go(){eo.apply(this,arguments)}Yt(Go,eo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.scale-1)>this.options.threshold||this.state&Na)},emit:function(ie){if(ie.scale!==1){var xe=ie.scale<1?"in":"out";ie.additionalEvent=this.options.event+xe}this._super.emit.call(this,ie)}});function Ho(){ra.apply(this,arguments),this._timer=null,this._input=null}Yt(Ho,ra,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ta]},process:function(ie){var xe=this.options,Qe=ie.pointers.length===xe.pointers,Ot=ie.distance<xe.threshold,Fr=ie.deltaTime>xe.time;if(this._input=ie,!Ot||!Qe||ie.eventType&(Si|Vi)&&!Fr)this.reset();else if(ie.eventType&aa)this.reset(),this._timer=_t(function(){this.state=Ca,this.tryEmit()},xe.time,this);else if(ie.eventType&Si)return Ca;return ps},reset:function(){clearTimeout(this._timer)},emit:function(ie){this.state===Ca&&(ie&&ie.eventType&Si?this.manager.emit(this.options.event+"up",ie):(this._input.timeStamp=nr(),this.manager.emit(this.options.event,this._input)))}});function zu(){eo.apply(this,arguments)}Yt(zu,eo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.rotation)>this.options.threshold||this.state&Na)}});function _o(){eo.apply(this,arguments)}Yt(_o,eo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:zi|$i,pointers:1},getTouchAction:function(){return Ji.prototype.getTouchAction.call(this)},attrTest:function(ie){var xe=this.options.direction,Qe;return xe&(zi|$i)?Qe=ie.overallVelocity:xe&zi?Qe=ie.overallVelocityX:xe&$i&&(Qe=ie.overallVelocityY),this._super.attrTest.call(this,ie)&&xe&ie.offsetDirection&&ie.distance>this.options.threshold&&ie.maxPointers==this.options.pointers&&Mt(Qe)>this.options.velocity&&ie.eventType&Si},emit:function(ie){var xe=fo(ie.offsetDirection);xe&&this.manager.emit(this.options.event+xe,ie),this.manager.emit(this.options.event,ie)}});function Wo(){ra.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Yt(Wo,ra,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[gi]},process:function(ie){var xe=this.options,Qe=ie.pointers.length===xe.pointers,Ot=ie.distance<xe.threshold,Fr=ie.deltaTime<xe.time;if(this.reset(),ie.eventType&aa&&this.count===0)return this.failTimeout();if(Ot&&Fr&&Qe){if(ie.eventType!=Si)return this.failTimeout();var pt=this.pTime?ie.timeStamp-this.pTime<xe.interval:!0,jt=!this.pCenter||nn(this.pCenter,ie.center)<xe.posThreshold;this.pTime=ie.timeStamp,this.pCenter=ie.center,!jt||!pt?this.count=1:this.count+=1,this._input=ie;var ro=this.count%xe.taps;if(ro===0)return this.hasRequireFailures()?(this._timer=_t(function(){this.state=Ca,this.tryEmit()},xe.interval,this),Na):Ca}return ps},failTimeout:function(){return this._timer=_t(function(){this.state=ps},this.options.interval,this),ps},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ca&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ma(ie,xe){return xe=xe||{},xe.recognizers=ht(xe.recognizers,ma.defaults.preset),new to(ie,xe)}ma.VERSION="2.0.7",ma.defaults={domEvents:!1,touchAction:Ci,enable:!0,inputTarget:null,inputClass:null,preset:[[zu,{enable:!1}],[Go,{enable:!1},["rotate"]],[_o,{direction:zi}],[Ji,{direction:zi},["swipe"]],[Wo],[Wo,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ho=1,Xo=2;function to(ie,xe){this.options=ut({},ma.defaults,xe||{}),this.options.inputTarget=this.options.inputTarget||ie,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ie,this.input=fs(this),this.touchAction=new La(this,this.options.touchAction),ru(this,!0),Ct(this.options.recognizers,function(Qe){var Ot=this.add(new Qe[0](Qe[1]));Qe[2]&&Ot.recognizeWith(Qe[2]),Qe[3]&&Ot.requireFailure(Qe[3])},this)}to.prototype={set:function(ie){return ut(this.options,ie),ie.touchAction&&this.touchAction.update(),ie.inputTarget&&(this.input.destroy(),this.input.target=ie.inputTarget,this.input.init()),this},stop:function(ie){this.session.stopped=ie?Xo:ho},recognize:function(ie){var xe=this.session;if(!xe.stopped){this.touchAction.preventDefaults(ie);var Qe,Ot=this.recognizers,Fr=xe.curRecognizer;(!Fr||Fr&&Fr.state&Ca)&&(Fr=xe.curRecognizer=null);for(var pt=0;pt<Ot.length;)Qe=Ot[pt],xe.stopped!==Xo&&(!Fr||Qe==Fr||Qe.canRecognizeWith(Fr))?Qe.recognize(ie):Qe.reset(),!Fr&&Qe.state&(Na|tu|wa)&&(Fr=xe.curRecognizer=Qe),pt++}},get:function(ie){if(ie instanceof ra)return ie;for(var xe=this.recognizers,Qe=0;Qe<xe.length;Qe++)if(xe[Qe].options.event==ie)return xe[Qe];return null},add:function(ie){if(Xt(ie,"add",this))return this;var xe=this.get(ie.options.event);return xe&&this.remove(xe),this.recognizers.push(ie),ie.manager=this,this.touchAction.update(),ie},remove:function(ie){if(Xt(ie,"remove",this))return this;if(ie=this.get(ie),ie){var xe=this.recognizers,Qe=Te(xe,ie);Qe!==-1&&(xe.splice(Qe,1),this.touchAction.update())}return this},on:function(ie,xe){if(ie!==F&&xe!==F){var Qe=this.handlers;return Ct(Hr(ie),function(Ot){Qe[Ot]=Qe[Ot]||[],Qe[Ot].push(xe)}),this}},off:function(ie,xe){if(ie!==F){var Qe=this.handlers;return Ct(Hr(ie),function(Ot){xe?Qe[Ot]&&Qe[Ot].splice(Te(Qe[Ot],xe),1):delete Qe[Ot]}),this}},emit:function(ie,xe){this.options.domEvents&&bc(ie,xe);var Qe=this.handlers[ie]&&this.handlers[ie].slice();if(!(!Qe||!Qe.length)){xe.type=ie,xe.preventDefault=function(){xe.srcEvent.preventDefault()};for(var Ot=0;Ot<Qe.length;)Qe[Ot](xe),Ot++}},destroy:function(){this.element&&ru(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ru(ie,xe){var Qe=ie.element;if(!!Qe.style){var Ot;Ct(ie.options.cssProps,function(Fr,pt){Ot=At(Qe.style,pt),xe?(ie.oldCssProps[Ot]=Qe.style[Ot],Qe.style[Ot]=Fr):Qe.style[Ot]=ie.oldCssProps[Ot]||""}),xe||(ie.oldCssProps={})}}function bc(ie,xe){if(!Ee){var Qe=v.createEvent("Event");Qe.initEvent(ie,!0,!0),Qe.gesture=xe,xe.target.dispatchEvent(Qe)}}if(!Ee){ut(ma,{INPUT_START:aa,INPUT_MOVE:Ri,INPUT_END:Si,INPUT_CANCEL:Vi,STATE_POSSIBLE:Gi,STATE_BEGAN:Na,STATE_CHANGED:tu,STATE_ENDED:wa,STATE_RECOGNIZED:Ca,STATE_CANCELLED:ys,STATE_FAILED:ps,DIRECTION_NONE:ua,DIRECTION_LEFT:wi,DIRECTION_RIGHT:xa,DIRECTION_UP:An,DIRECTION_DOWN:yi,DIRECTION_HORIZONTAL:zi,DIRECTION_VERTICAL:$i,DIRECTION_ALL:ja,Manager:to,Input:Va,TouchAction:La,TouchInput:Dt,MouseInput:Sa,PointerEventInput:Ie,TouchMouseInput:Tt,SingleTouchInput:De,Recognizer:ra,AttrRecognizer:eo,Tap:Wo,Pan:Ji,Swipe:_o,Pinch:Go,Rotate:zu,Press:Ho,on:$e,off:Rt,each:Ct,merge:X,extend:Jt,assign:ut,inherit:Yt,bindFn:dt,prefixed:At});var Os=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Os.Hammer=ma,Y=function(){return ma}.call(H,R,H,Ue),Y!==F&&(Ue.exports=Y)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ue,H,R){(function(Y,$){Ue.exports=$(R(18857))})(this,function(Y){"use strict";var $=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},v=function(B,le){for(var Fe=Object.keys(le),kt=0;kt<Fe.length;++kt)B[Fe[kt]]=le[Fe[kt]];return B},ee=`
`;function F(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function J(B){var le=new Error("(regl) "+B);throw console.error(le),le}function re(B,le){B||J(le)}function Ee(B){return B?": "+B:""}function ne(B,le,Fe){B in le||J("unknown parameter ("+B+")"+Ee(Fe)+". possible values: "+Object.keys(le).join())}function je(B,le){$(B)||J("invalid parameter type"+Ee(le)+". must be a typed array")}function we(B,le){switch(le){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function et(B,le,Fe){we(B,le)||J("invalid parameter type"+Ee(Fe)+". expected "+le+", got "+typeof B)}function Mt(B,le){B>=0&&(B|0)===B||J("invalid parameter type, ("+B+")"+Ee(le)+". must be a nonnegative integer")}function nr(B,le,Fe){le.indexOf(B)<0&&J("invalid value"+Ee(Fe)+". must be one of: "+le)}var _t=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Xt(B){Object.keys(B).forEach(function(le){_t.indexOf(le)<0&&J('invalid regl constructor argument "'+le+'". must be one of '+_t)})}function Ct(B,le){for(B=B+"";B.length<le;)B=" "+B;return B}function ot(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ut(B,le){this.number=B,this.line=le,this.errors=[]}function Jt(B,le,Fe){this.file=B,this.line=le,this.message=Fe}function X(){var B=new Error,le=(B.stack||B).toString(),Fe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(le);if(Fe)return Fe[1];var kt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(le);return kt?kt[1]:"unknown"}function Yt(){var B=new Error,le=(B.stack||B).toString(),Fe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(le);if(Fe)return Fe[1];var kt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(le);return kt?kt[1]:"unknown"}function dt(B,le){var Fe=B.split(`
`),kt=1,ur=0,It={unknown:new ot,0:new ot};It.unknown.name=It[0].name=le||X(),It.unknown.lines.push(new ut(0,""));for(var tr=0;tr<Fe.length;++tr){var dr=Fe[tr],_r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(dr);if(_r)switch(_r[1]){case"line":var Sr=/(\d+)(\s+\d+)?/.exec(_r[2]);Sr&&(kt=Sr[1]|0,Sr[2]&&(ur=Sr[2]|0,ur in It||(It[ur]=new ot)));break;case"define":var Lr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(_r[2]);Lr&&(It[ur].name=Lr[1]?F(Lr[2]):Lr[2]);break}It[ur].lines.push(new ut(kt++,dr))}return Object.keys(It).forEach(function(kr){var Dr=It[kr];Dr.lines.forEach(function(xr){Dr.index[xr.number]=xr})}),It}function qe(B){var le=[];return B.split(`
`).forEach(function(Fe){if(!(Fe.length<5)){var kt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Fe);kt?le.push(new Jt(kt[1]|0,kt[2]|0,kt[3].trim())):Fe.length>0&&le.push(new Jt("unknown",0,Fe))}}),le}function ht(B,le){le.forEach(function(Fe){var kt=B[Fe.file];if(kt){var ur=kt.index[Fe.line];if(ur){ur.errors.push(Fe),kt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Fe)})}function $e(B,le,Fe,kt,ur){if(!B.getShaderParameter(le,B.COMPILE_STATUS)){var It=B.getShaderInfoLog(le),tr=kt===B.FRAGMENT_SHADER?"fragment":"vertex";ke(Fe,"string",tr+" shader source must be a string",ur);var dr=dt(Fe,ur),_r=qe(It);ht(dr,_r),Object.keys(dr).forEach(function(Sr){var Lr=dr[Sr];if(!Lr.hasErrors)return;var kr=[""],Dr=[""];function xr(Ar,st){kr.push(Ar),Dr.push(st||"")}xr("file number "+Sr+": "+Lr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Lr.lines.forEach(function(Ar){if(Ar.errors.length>0){xr(Ct(Ar.number,4)+"|  ","background-color:yellow; font-weight:bold"),xr(Ar.line+ee,"color:red; background-color:yellow; font-weight:bold");var st=0;Ar.errors.forEach(function(Ut){var wr=Ut.message,Ur=/^\s*'(.*)'\s*:\s*(.*)$/.exec(wr);if(Ur){var fr=Ur[1];switch(wr=Ur[2],fr){case"assign":fr="=";break}st=Math.max(Ar.line.indexOf(fr,st),0)}else st=0;xr(Ct("| ",6)),xr(Ct("^^^",st+3)+ee,"font-weight:bold"),xr(Ct("| ",6)),xr(wr+ee,"font-weight:bold")}),xr(Ct("| ",6)+ee)}else xr(Ct(Ar.number,4)+"|  "),xr(Ar.line+ee,"color:red")}),typeof document!="undefined"&&!window.chrome?(Dr[0]=kr.join("%c"),console.log.apply(console,Dr)):console.log(kr.join(""))}),re.raise("Error compiling "+tr+" shader, "+dr[0].name)}}function Rt(B,le,Fe,kt,ur){if(!B.getProgramParameter(le,B.LINK_STATUS)){var It=B.getProgramInfoLog(le),tr=dt(Fe,ur),dr=dt(kt,ur),_r='Error linking program with vertex shader, "'+dr[0].name+'", and fragment shader "'+tr[0].name+'"';typeof document!="undefined"?console.log("%c"+_r+ee+"%c"+It,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(_r+ee+It),re.raise(_r)}}function yr(B){B._commandRef=X()}function Rr(B,le,Fe,kt){yr(B);function ur(_r){return _r?kt.id(_r):0}B._fragId=ur(B.static.frag),B._vertId=ur(B.static.vert);function It(_r,Sr){Object.keys(Sr).forEach(function(Lr){_r[kt.id(Lr)]=!0})}var tr=B._uniformSet={};It(tr,le.static),It(tr,le.dynamic);var dr=B._attributeSet={};It(dr,Fe.static),It(dr,Fe.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Hr(B,le){var Fe=Yt();J(B+" in command "+(le||X())+(Fe==="unknown"?"":" called from "+Fe))}function Te(B,le,Fe){B||Hr(le,Fe||X())}function Ye(B,le,Fe,kt){B in le||Hr("unknown parameter ("+B+")"+Ee(Fe)+". possible values: "+Object.keys(le).join(),kt||X())}function ke(B,le,Fe,kt){we(B,le)||Hr("invalid parameter type"+Ee(Fe)+". expected "+le+", got "+typeof B,kt||X())}function At(B){B()}function gt(B,le,Fe){B.texture?nr(B.texture._texture.internalformat,le,"unsupported texture format for attachment"):nr(B.renderbuffer._renderbuffer.format,Fe,"unsupported renderbuffer format for attachment")}var Ft=33071,qt=9728,Cr=9984,Hn=9985,hn=9986,Ki=9987,Bn=5120,Gn=5121,hi=5122,Wn=5123,si=5124,aa=5125,Ri=5126,Si=32819,Vi=32820,ua=33635,wi=34042,xa=36193,An={};An[Bn]=An[Gn]=1,An[hi]=An[Wn]=An[xa]=An[ua]=An[Si]=An[Vi]=2,An[si]=An[aa]=An[Ri]=An[wi]=4;function yi(B,le){return B===Vi||B===Si||B===ua?2:B===wi?4:An[B]*le}function zi(B){return!(B&B-1)&&!!B}function $i(B,le,Fe){var kt,ur=le.width,It=le.height,tr=le.channels;re(ur>0&&ur<=Fe.maxTextureSize&&It>0&&It<=Fe.maxTextureSize,"invalid texture shape"),(B.wrapS!==Ft||B.wrapT!==Ft)&&re(zi(ur)&&zi(It),"incompatible wrap mode for texture, both width and height must be power of 2"),le.mipmask===1?ur!==1&&It!==1&&re(B.minFilter!==Cr&&B.minFilter!==hn&&B.minFilter!==Hn&&B.minFilter!==Ki,"min filter requires mipmap"):(re(zi(ur)&&zi(It),"texture must be a square power of 2 to support mipmapping"),re(le.mipmask===(ur<<1)-1,"missing or incomplete mipmap data")),le.type===Ri&&(Fe.extensions.indexOf("oes_texture_float_linear")<0&&re(B.minFilter===qt&&B.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),re(!B.genMipmaps,"mipmap generation not supported with float textures"));var dr=le.images;for(kt=0;kt<16;++kt)if(dr[kt]){var _r=ur>>kt,Sr=It>>kt;re(le.mipmask&1<<kt,"missing mipmap data");var Lr=dr[kt];if(re(Lr.width===_r&&Lr.height===Sr,"invalid shape for mip images"),re(Lr.format===le.format&&Lr.internalformat===le.internalformat&&Lr.type===le.type,"incompatible type for mip image"),!Lr.compressed)if(Lr.data){var kr=Math.ceil(yi(Lr.type,tr)*_r/Lr.unpackAlignment)*Lr.unpackAlignment;re(Lr.data.byteLength===kr*Sr,"invalid data for image, buffer size is inconsistent with image format")}else Lr.element||Lr.copy}else B.genMipmaps||re((le.mipmask&1<<kt)==0,"extra mipmap data");le.compressed&&re(!B.genMipmaps,"mipmap generation for compressed images not supported")}function ja(B,le,Fe,kt){var ur=B.width,It=B.height,tr=B.channels;re(ur>0&&ur<=kt.maxTextureSize&&It>0&&It<=kt.maxTextureSize,"invalid texture shape"),re(ur===It,"cube map must be square"),re(le.wrapS===Ft&&le.wrapT===Ft,"wrap mode not supported by cube map");for(var dr=0;dr<Fe.length;++dr){var _r=Fe[dr];re(_r.width===ur&&_r.height===It,"inconsistent cube map face shape"),le.genMipmaps&&(re(!_r.compressed,"can not generate mipmap for compressed textures"),re(_r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Sr=_r.images,Lr=0;Lr<16;++Lr){var kr=Sr[Lr];if(kr){var Dr=ur>>Lr,xr=It>>Lr;re(_r.mipmask&1<<Lr,"missing mipmap data"),re(kr.width===Dr&&kr.height===xr,"invalid shape for mip images"),re(kr.format===B.format&&kr.internalformat===B.internalformat&&kr.type===B.type,"incompatible type for mip image"),kr.compressed||(kr.data?re(kr.data.byteLength===Dr*xr*Math.max(yi(kr.type,tr),kr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):kr.element||kr.copy)}}}}var me=v(re,{optional:At,raise:J,commandRaise:Hr,command:Te,parameter:ne,commandParameter:Ye,constructor:Xt,type:et,commandType:ke,isTypedArray:je,nni:Mt,oneOf:nr,shaderError:$e,linkError:Rt,callSite:Yt,saveCommandRef:yr,saveDrawInfo:Rr,framebufferFormat:gt,guessCommand:X,texture2D:$i,textureCube:ja}),Ln=0,Va=0,fs=5,zt=6;function ir(B,le){this.id=Ln++,this.type=B,this.data=le}function Ir(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(B){if(B.length===0)return[];var le=B.charAt(0),Fe=B.charAt(B.length-1);if(B.length>1&&le===Fe&&(le==='"'||le==="'"))return['"'+Ir(B.substr(1,B.length-2))+'"'];var kt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(kt)return I(B.substr(0,kt.index)).concat(I(kt[1])).concat(I(B.substr(kt.index+kt[0].length)));var ur=B.split(".");if(ur.length===1)return['"'+Ir(B)+'"'];for(var It=[],tr=0;tr<ur.length;++tr)It=It.concat(I(ur[tr]));return It}function sr(B){return"["+I(B).join("][")+"]"}function On(B,le){return new ir(B,sr(le+""))}function ui(B){return typeof B=="function"&&!B._reglType||B instanceof ir}function Zn(B,le){if(typeof B=="function")return new ir(Va,B);if(typeof B=="number"||typeof B=="boolean")return new ir(fs,B);if(Array.isArray(B))return new ir(zt,B.map(function(Fe,kt){return Zn(Fe,le+"["+kt+"]")}));if(B instanceof ir)return B;me(!1,"invalid option type in uniform "+le)}var nn={DynamicVariable:ir,define:On,isDynamic:ui,unbox:Zn,accessor:sr},Ti={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Mi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ya=Mi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hs(){var B={"":0},le=[""];return{id:function(Fe){var kt=B[Fe];return kt||(kt=B[Fe]=le.length,le.push(Fe),kt)},str:function(Fe){return le[Fe]}}}function va(B,le,Fe){var kt=document.createElement("canvas");v(kt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(kt),B===document.body&&(kt.style.position="absolute",v(B.style,{margin:0,padding:0}));function ur(){var dr=window.innerWidth,_r=window.innerHeight;if(B!==document.body){var Sr=kt.getBoundingClientRect();dr=Sr.right-Sr.left,_r=Sr.bottom-Sr.top}kt.width=Fe*dr,kt.height=Fe*_r}var It;B!==document.body&&typeof ResizeObserver=="function"?(It=new ResizeObserver(function(){setTimeout(ur)}),It.observe(B)):window.addEventListener("resize",ur,!1);function tr(){It?It.disconnect():window.removeEventListener("resize",ur),B.removeChild(kt)}return ur(),{canvas:kt,onDestroy:tr}}function Ra(B,le){function Fe(kt){try{return B.getContext(kt,le)}catch(ur){return null}}return Fe("webgl")||Fe("experimental-webgl")||Fe("webgl-experimental")}function Sa(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function V(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function K(B){return typeof B=="string"?B.split():(me(Array.isArray(B),"invalid extension array"),B)}function se(B){return typeof B=="string"?(me(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ge(B){var le=B||{},Fe,kt,ur,It,tr={},dr=[],_r=[],Sr=typeof window=="undefined"?1:window.devicePixelRatio,Lr=!1,kr=function(Ar){Ar&&me.raise(Ar)},Dr=function(){};if(typeof le=="string"?(me(typeof document!="undefined","selector queries only supported in DOM environments"),Fe=document.querySelector(le),me(Fe,"invalid query string for element")):typeof le=="object"?Sa(le)?Fe=le:V(le)?(It=le,ur=It.canvas):(me.constructor(le),"gl"in le?It=le.gl:"canvas"in le?ur=se(le.canvas):"container"in le&&(kt=se(le.container)),"attributes"in le&&(tr=le.attributes,me.type(tr,"object","invalid context attributes")),"extensions"in le&&(dr=K(le.extensions)),"optionalExtensions"in le&&(_r=K(le.optionalExtensions)),"onDone"in le&&(me.type(le.onDone,"function","invalid or missing onDone callback"),kr=le.onDone),"profile"in le&&(Lr=!!le.profile),"pixelRatio"in le&&(Sr=+le.pixelRatio,me(Sr>0,"invalid pixel ratio"))):me.raise("invalid arguments to regl"),Fe&&(Fe.nodeName.toLowerCase()==="canvas"?ur=Fe:kt=Fe),!It){if(!ur){me(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var xr=va(kt||document.body,kr,Sr);if(!xr)return null;ur=xr.canvas,Dr=xr.onDestroy}tr.premultipliedAlpha===void 0&&(tr.premultipliedAlpha=!0),It=Ra(ur,tr)}return It?{gl:It,canvas:ur,container:kt,extensions:dr,optionalExtensions:_r,pixelRatio:Sr,profile:Lr,onDone:kr,onDestroy:Dr}:(Dr(),kr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ie(B,le){var Fe={};function kt(dr){me.type(dr,"string","extension name must be string");var _r=dr.toLowerCase(),Sr;try{Sr=Fe[_r]=ur(dr)}catch(Lr){}return!!Sr}function ur(dr){return B.getExtension(dr)?B.getExtension(dr):B.getExtension(dr.toLowerCase())?B.getExtension(dr.toLowerCase()):null}for(var It=0;It<le.extensions.length;++It){var tr=le.extensions[It];if(!kt(tr))return le.onDestroy(),le.onDone('"'+tr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return le.optionalExtensions.forEach(kt),{extensions:Fe,restore:function(){Object.keys(Fe).forEach(function(dr){if(Fe[dr]&&!kt(dr))throw new Error("(regl): error restoring extension "+dr)})}}}function Ve(B,le){for(var Fe=Array(B),kt=0;kt<B;++kt)Fe[kt]=le(kt);return Fe}var rt=5120,pe=5121,De=5122,yt=5123,vr=5124,Lt=5125,Dt=5126;function gr(B){for(var le=16;le<=1<<28;le*=16)if(B<=le)return le;return 0}function bn(B){var le,Fe;return le=(B>65535)<<4,B>>>=le,Fe=(B>255)<<3,B>>>=Fe,le|=Fe,Fe=(B>15)<<2,B>>>=Fe,le|=Fe,Fe=(B>3)<<1,B>>>=Fe,le|=Fe,le|B>>1}function ln(){var B=Ve(8,function(){return[]});function le(It){var tr=gr(It),dr=B[bn(tr)>>2];return dr.length>0?dr.pop():new ArrayBuffer(tr)}function Fe(It){B[bn(It.byteLength)>>2].push(It)}function kt(It,tr){var dr=null;switch(It){case rt:dr=new Int8Array(le(tr),0,tr);break;case pe:dr=new Uint8Array(le(tr),0,tr);break;case De:dr=new Int16Array(le(2*tr),0,tr);break;case yt:dr=new Uint16Array(le(2*tr),0,tr);break;case vr:dr=new Int32Array(le(4*tr),0,tr);break;case Lt:dr=new Uint32Array(le(4*tr),0,tr);break;case Dt:dr=new Float32Array(le(4*tr),0,tr);break;default:return null}return dr.length!==tr?dr.subarray(0,tr):dr}function ur(It){Fe(It.buffer)}return{alloc:le,free:Fe,allocType:kt,freeType:ur}}var Tt=ln();Tt.zero=ln();var on=3408,Vr=3410,Wr=3411,ii=3412,en=3413,Ci=3414,ta=3415,gi=33901,Pi=33902,_i=3379,Jn=3386,Xi=34921,La=36347,oa=36348,Ii=35661,Gi=35660,Na=34930,tu=36349,wa=34076,Ca=34024,ys=7936,ps=7937,ra=7938,Bu=35724,fo=34047,Ba=36063,eo=34852,Ji=3553,Go=34067,Ho=34069,zu=33984,_o=6408,Wo=5126,ma=5121,ho=36160,Xo=36053,to=36064,ru=16384,bc=function(B,le){var Fe=1;le.ext_texture_filter_anisotropic&&(Fe=B.getParameter(fo));var kt=1,ur=1;le.webgl_draw_buffers&&(kt=B.getParameter(eo),ur=B.getParameter(Ba));var It=!!le.oes_texture_float;if(It){var tr=B.createTexture();B.bindTexture(Ji,tr),B.texImage2D(Ji,0,_o,1,1,0,_o,Wo,null);var dr=B.createFramebuffer();if(B.bindFramebuffer(ho,dr),B.framebufferTexture2D(ho,to,Ji,tr,0),B.bindTexture(Ji,null),B.checkFramebufferStatus(ho)!==Xo)It=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(ru);var _r=Tt.allocType(Wo,4);B.readPixels(0,0,1,1,_o,Wo,_r),B.getError()?It=!1:(B.deleteFramebuffer(dr),B.deleteTexture(tr),It=_r[0]===1),Tt.freeType(_r)}}var Sr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Lr=!0;if(!Sr){var kr=B.createTexture(),Dr=Tt.allocType(ma,36);B.activeTexture(zu),B.bindTexture(Go,kr),B.texImage2D(Ho,0,_o,3,3,0,_o,ma,Dr),Tt.freeType(Dr),B.bindTexture(Go,null),B.deleteTexture(kr),Lr=!B.getError()}return{colorBits:[B.getParameter(Vr),B.getParameter(Wr),B.getParameter(ii),B.getParameter(en)],depthBits:B.getParameter(Ci),stencilBits:B.getParameter(ta),subpixelBits:B.getParameter(on),extensions:Object.keys(le).filter(function(xr){return!!le[xr]}),maxAnisotropic:Fe,maxDrawbuffers:kt,maxColorAttachments:ur,pointSizeDims:B.getParameter(gi),lineWidthDims:B.getParameter(Pi),maxViewportDims:B.getParameter(Jn),maxCombinedTextureUnits:B.getParameter(Ii),maxCubeMapSize:B.getParameter(wa),maxRenderbufferSize:B.getParameter(Ca),maxTextureUnits:B.getParameter(Na),maxTextureSize:B.getParameter(_i),maxAttributes:B.getParameter(Xi),maxVertexUniforms:B.getParameter(La),maxVertexTextureUnits:B.getParameter(Gi),maxVaryingVectors:B.getParameter(oa),maxFragmentUniforms:B.getParameter(tu),glsl:B.getParameter(Bu),renderer:B.getParameter(ps),vendor:B.getParameter(ys),version:B.getParameter(ra),readFloat:It,npotTextureCube:Lr}};function Os(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||$(B.data))}var ie=function(B){return Object.keys(B).map(function(le){return B[le]})},xe={shape:ro,flatten:jt};function Qe(B,le,Fe){for(var kt=0;kt<le;++kt)Fe[kt]=B[kt]}function Ot(B,le,Fe,kt){for(var ur=0,It=0;It<le;++It)for(var tr=B[It],dr=0;dr<Fe;++dr)kt[ur++]=tr[dr]}function Fr(B,le,Fe,kt,ur,It){for(var tr=It,dr=0;dr<le;++dr)for(var _r=B[dr],Sr=0;Sr<Fe;++Sr)for(var Lr=_r[Sr],kr=0;kr<kt;++kr)ur[tr++]=Lr[kr]}function pt(B,le,Fe,kt,ur){for(var It=1,tr=Fe+1;tr<le.length;++tr)It*=le[tr];var dr=le[Fe];if(le.length-Fe==4){var _r=le[Fe+1],Sr=le[Fe+2],Lr=le[Fe+3];for(tr=0;tr<dr;++tr)Fr(B[tr],_r,Sr,Lr,kt,ur),ur+=It}else for(tr=0;tr<dr;++tr)pt(B[tr],le,Fe+1,kt,ur),ur+=It}function jt(B,le,Fe,kt){var ur=1;if(le.length)for(var It=0;It<le.length;++It)ur*=le[It];else ur=0;var tr=kt||Tt.allocType(Fe,ur);switch(le.length){case 0:break;case 1:Qe(B,le[0],tr);break;case 2:Ot(B,le[0],le[1],tr);break;case 3:Fr(B,le[0],le[1],le[2],tr,0);break;default:pt(B,le,0,tr,0)}return tr}function ro(B){for(var le=[],Fe=B;Fe.length;Fe=Fe[0])le.push(Fe.length);return le}var Qi={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ga=5120,Yo=5122,En=5124,vn=5121,Qt=5123,No=5125,be=5126,Gs=5126,nu={int8:Ga,int16:Yo,int32:En,uint8:vn,uint16:Qt,uint32:No,float:be,float32:Gs},ds=35048,sa=35040,po={dynamic:ds,stream:sa,static:35044},Xl=xe.flatten,Ec=xe.shape,Uu=35044,Sc=35040,Sl=5121,Zu=5126,iu=[];iu[5120]=1,iu[5122]=2,iu[5124]=4,iu[5121]=1,iu[5123]=2,iu[5125]=4,iu[5126]=4;function ju(B){return Qi[Object.prototype.toString.call(B)]|0}function y(B,le){for(var Fe=0;Fe<le.length;++Fe)B[Fe]=le[Fe]}function C(B,le,Fe,kt,ur,It,tr){for(var dr=0,_r=0;_r<Fe;++_r)for(var Sr=0;Sr<kt;++Sr)B[dr++]=le[ur*_r+It*Sr+tr]}function N(B,le,Fe,kt){var ur=0,It={};function tr(st){this.id=ur++,this.buffer=B.createBuffer(),this.type=st,this.usage=Uu,this.byteLength=0,this.dimension=1,this.dtype=Sl,this.persistentData=null,Fe.profile&&(this.stats={size:0})}tr.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},tr.prototype.destroy=function(){Dr(this)};var dr=[];function _r(st,Ut){var wr=dr.pop();return wr||(wr=new tr(st)),wr.bind(),kr(wr,Ut,Sc,0,1,!1),wr}function Sr(st){dr.push(st)}function Lr(st,Ut,wr){st.byteLength=Ut.byteLength,B.bufferData(st.type,Ut,wr)}function kr(st,Ut,wr,Ur,fr,Nr){var Jr;if(st.usage=wr,Array.isArray(Ut)){if(st.dtype=Ur||Zu,Ut.length>0){var Fn;if(Array.isArray(Ut[0])){Jr=Ec(Ut);for(var rr=1,ar=1;ar<Jr.length;++ar)rr*=Jr[ar];st.dimension=rr,Fn=Xl(Ut,Jr,st.dtype),Lr(st,Fn,wr),Nr?st.persistentData=Fn:Tt.freeType(Fn)}else if(typeof Ut[0]=="number"){st.dimension=fr;var _n=Tt.allocType(st.dtype,Ut.length);y(_n,Ut),Lr(st,_n,wr),Nr?st.persistentData=_n:Tt.freeType(_n)}else $(Ut[0])?(st.dimension=Ut[0].length,st.dtype=Ur||ju(Ut[0])||Zu,Fn=Xl(Ut,[Ut.length,Ut[0].length],st.dtype),Lr(st,Fn,wr),Nr?st.persistentData=Fn:Tt.freeType(Fn)):me.raise("invalid buffer data")}}else if($(Ut))st.dtype=Ur||ju(Ut),st.dimension=fr,Lr(st,Ut,wr),Nr&&(st.persistentData=new Uint8Array(new Uint8Array(Ut.buffer)));else if(Os(Ut)){Jr=Ut.shape;var Xr=Ut.stride,Tr=Ut.offset,Yr=0,Qr=0,vi=0,ni=0;Jr.length===1?(Yr=Jr[0],Qr=1,vi=Xr[0],ni=0):Jr.length===2?(Yr=Jr[0],Qr=Jr[1],vi=Xr[0],ni=Xr[1]):me.raise("invalid shape"),st.dtype=Ur||ju(Ut.data)||Zu,st.dimension=Qr;var qr=Tt.allocType(st.dtype,Yr*Qr);C(qr,Ut.data,Yr,Qr,vi,ni,Tr),Lr(st,qr,wr),Nr?st.persistentData=qr:Tt.freeType(qr)}else Ut instanceof ArrayBuffer?(st.dtype=Sl,st.dimension=fr,Lr(st,Ut,wr),Nr&&(st.persistentData=new Uint8Array(new Uint8Array(Ut)))):me.raise("invalid buffer data")}function Dr(st){le.bufferCount--,kt(st);var Ut=st.buffer;me(Ut,"buffer must not be deleted already"),B.deleteBuffer(Ut),st.buffer=null,delete It[st.id]}function xr(st,Ut,wr,Ur){le.bufferCount++;var fr=new tr(Ut);It[fr.id]=fr;function Nr(rr){var ar=Uu,_n=null,Xr=0,Tr=0,Yr=1;return Array.isArray(rr)||$(rr)||Os(rr)||rr instanceof ArrayBuffer?_n=rr:typeof rr=="number"?Xr=rr|0:rr&&(me.type(rr,"object","buffer arguments must be an object, a number or an array"),"data"in rr&&(me(_n===null||Array.isArray(_n)||$(_n)||Os(_n),"invalid data for buffer"),_n=rr.data),"usage"in rr&&(me.parameter(rr.usage,po,"invalid buffer usage"),ar=po[rr.usage]),"type"in rr&&(me.parameter(rr.type,nu,"invalid buffer type"),Tr=nu[rr.type]),"dimension"in rr&&(me.type(rr.dimension,"number","invalid dimension"),Yr=rr.dimension|0),"length"in rr&&(me.nni(Xr,"buffer length must be a nonnegative integer"),Xr=rr.length|0)),fr.bind(),_n?kr(fr,_n,ar,Tr,Yr,Ur):(Xr&&B.bufferData(fr.type,Xr,ar),fr.dtype=Tr||Sl,fr.usage=ar,fr.dimension=Yr,fr.byteLength=Xr),Fe.profile&&(fr.stats.size=fr.byteLength*iu[fr.dtype]),Nr}function Jr(rr,ar){me(ar+rr.byteLength<=fr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+rr.byteLength+" starting from offset "+ar+" to a buffer of size "+fr.byteLength),B.bufferSubData(fr.type,ar,rr)}function Fn(rr,ar){var _n=(ar||0)|0,Xr;if(fr.bind(),$(rr)||rr instanceof ArrayBuffer)Jr(rr,_n);else if(Array.isArray(rr)){if(rr.length>0)if(typeof rr[0]=="number"){var Tr=Tt.allocType(fr.dtype,rr.length);y(Tr,rr),Jr(Tr,_n),Tt.freeType(Tr)}else if(Array.isArray(rr[0])||$(rr[0])){Xr=Ec(rr);var Yr=Xl(rr,Xr,fr.dtype);Jr(Yr,_n),Tt.freeType(Yr)}else me.raise("invalid buffer data")}else if(Os(rr)){Xr=rr.shape;var Qr=rr.stride,vi=0,ni=0,qr=0,an=0;Xr.length===1?(vi=Xr[0],ni=1,qr=Qr[0],an=0):Xr.length===2?(vi=Xr[0],ni=Xr[1],qr=Qr[0],an=Qr[1]):me.raise("invalid shape");var Yn=Array.isArray(rr.data)?fr.dtype:ju(rr.data),ci=Tt.allocType(Yn,vi*ni);C(ci,rr.data,vi,ni,qr,an,rr.offset),Jr(ci,_n),Tt.freeType(ci)}else me.raise("invalid data for buffer subdata");return Nr}return wr||Nr(st),Nr._reglType="buffer",Nr._buffer=fr,Nr.subdata=Fn,Fe.profile&&(Nr.stats=fr.stats),Nr.destroy=function(){Dr(fr)},Nr}function Ar(){ie(It).forEach(function(st){st.buffer=B.createBuffer(),B.bindBuffer(st.type,st.buffer),B.bufferData(st.type,st.persistentData||st.byteLength,st.usage)})}return Fe.profile&&(le.getTotalBufferSize=function(){var st=0;return Object.keys(It).forEach(function(Ut){st+=It[Ut].stats.size}),st}),{create:xr,createStream:_r,destroyStream:Sr,clear:function(){ie(It).forEach(Dr),dr.forEach(Dr)},getBuffer:function(st){return st&&st._buffer instanceof tr?st._buffer:null},restore:Ar,_initBuffer:kr}}var O=0,q=0,_e=1,We=1,lt=4,vt=4,lr={points:O,point:q,lines:_e,line:We,triangles:lt,triangle:vt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Er=0,Mn=1,li=4,$n=5120,Yi=5121,fa=5122,Pa=5123,Hi=5124,Mo=5125,_s=34963,sl=35040,Gc=35044;function Vu(B,le,Fe,kt){var ur={},It=0,tr={uint8:Yi,uint16:Pa};le.oes_element_index_uint&&(tr.uint32=Mo);function dr(Ar){this.id=It++,ur[this.id]=this,this.buffer=Ar,this.primType=li,this.vertCount=0,this.type=0}dr.prototype.bind=function(){this.buffer.bind()};var _r=[];function Sr(Ar){var st=_r.pop();return st||(st=new dr(Fe.create(null,_s,!0,!1)._buffer)),kr(st,Ar,sl,-1,-1,0,0),st}function Lr(Ar){_r.push(Ar)}function kr(Ar,st,Ut,wr,Ur,fr,Nr){Ar.buffer.bind();var Jr;if(st){var Fn=Nr;!Nr&&(!$(st)||Os(st)&&!$(st.data))&&(Fn=le.oes_element_index_uint?Mo:Pa),Fe._initBuffer(Ar.buffer,st,Ut,Fn,3)}else B.bufferData(_s,fr,Ut),Ar.buffer.dtype=Jr||Yi,Ar.buffer.usage=Ut,Ar.buffer.dimension=3,Ar.buffer.byteLength=fr;if(Jr=Nr,!Nr){switch(Ar.buffer.dtype){case Yi:case $n:Jr=Yi;break;case Pa:case fa:Jr=Pa;break;case Mo:case Hi:Jr=Mo;break;default:me.raise("unsupported type for element array")}Ar.buffer.dtype=Jr}Ar.type=Jr,me(Jr!==Mo||!!le.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var rr=Ur;rr<0&&(rr=Ar.buffer.byteLength,Jr===Pa?rr>>=1:Jr===Mo&&(rr>>=2)),Ar.vertCount=rr;var ar=wr;if(wr<0){ar=li;var _n=Ar.buffer.dimension;_n===1&&(ar=Er),_n===2&&(ar=Mn),_n===3&&(ar=li)}Ar.primType=ar}function Dr(Ar){kt.elementsCount--,me(Ar.buffer!==null,"must not double destroy elements"),delete ur[Ar.id],Ar.buffer.destroy(),Ar.buffer=null}function xr(Ar,st){var Ut=Fe.create(null,_s,!0),wr=new dr(Ut._buffer);kt.elementsCount++;function Ur(fr){if(!fr)Ut(),wr.primType=li,wr.vertCount=0,wr.type=Yi;else if(typeof fr=="number")Ut(fr),wr.primType=li,wr.vertCount=fr|0,wr.type=Yi;else{var Nr=null,Jr=Gc,Fn=-1,rr=-1,ar=0,_n=0;Array.isArray(fr)||$(fr)||Os(fr)?Nr=fr:(me.type(fr,"object","invalid arguments for elements"),"data"in fr&&(Nr=fr.data,me(Array.isArray(Nr)||$(Nr)||Os(Nr),"invalid data for element buffer")),"usage"in fr&&(me.parameter(fr.usage,po,"invalid element buffer usage"),Jr=po[fr.usage]),"primitive"in fr&&(me.parameter(fr.primitive,lr,"invalid element buffer primitive"),Fn=lr[fr.primitive]),"count"in fr&&(me(typeof fr.count=="number"&&fr.count>=0,"invalid vertex count for elements"),rr=fr.count|0),"type"in fr&&(me.parameter(fr.type,tr,"invalid buffer type"),_n=tr[fr.type]),"length"in fr?ar=fr.length|0:(ar=rr,_n===Pa||_n===fa?ar*=2:(_n===Mo||_n===Hi)&&(ar*=4))),kr(wr,Nr,Jr,Fn,rr,ar,_n)}return Ur}return Ur(Ar),Ur._reglType="elements",Ur._elements=wr,Ur.subdata=function(fr,Nr){return Ut.subdata(fr,Nr),Ur},Ur.destroy=function(){Dr(wr)},Ur}return{create:xr,createStream:Sr,destroyStream:Lr,getElements:function(Ar){return typeof Ar=="function"&&Ar._elements instanceof dr?Ar._elements:null},clear:function(){ie(ur).forEach(Dr)}}}var wc=new Float32Array(1),wu=new Uint32Array(wc.buffer),cu=5123;function xo(B){for(var le=Tt.allocType(cu,B.length),Fe=0;Fe<B.length;++Fe)if(isNaN(B[Fe]))le[Fe]=65535;else if(B[Fe]===Infinity)le[Fe]=31744;else if(B[Fe]===-Infinity)le[Fe]=64512;else{wc[0]=B[Fe];var kt=wu[0],ur=kt>>>31<<15,It=(kt<<1>>>24)-127,tr=kt>>13&(1<<10)-1;if(It<-24)le[Fe]=ur;else if(It<-14){var dr=-14-It;le[Fe]=ur+(tr+(1<<10)>>dr)}else It>15?le[Fe]=ur+31744:le[Fe]=ur+(It+15<<10)+tr}return le}function ha(B){return Array.isArray(B)||$(B)}var th=function(B){return!(B&B-1)&&!!B},rh=34467,uo=3553,Mf=34067,fu=34069,Rs=6408,Cc=6406,ul=6407,ba=6409,wl=6410,Yl=32854,es=32855,Pf=36194,nh=32819,ih=32820,Hc=33635,ll=34042,Bo=6402,Cu=34041,Gu=35904,zo=35906,Cl=36193,Hu=33776,Hs=33777,Wc=33778,Xc=33779,Yc=35986,Wu=35987,ql=34798,Ac=35840,qc=35841,Tc=35842,ah=35843,Mc=36196,cl=5121,Kc=5123,$c=5125,Au=5126,Jc=10242,If=10243,oh=10497,Al=33071,Yh=33648,ts=10240,Ha=10241,Kl=9728,Tl=9729,au=9984,Di=9985,ka=9986,Ls=9987,Qc=33170,fl=4352,ef=4353,qh=4354,Kh=34046,Pc=3317,$l=37440,Xu=37441,Po=37443,Jl=37444,Ql=33984,qa=[au,ka,Di,Ls],mn=[0,ba,wl,ul,Rs],no={};no[ba]=no[Cc]=no[Bo]=1,no[Cu]=no[wl]=2,no[ul]=no[Gu]=3,no[Rs]=no[zo]=4;function Yu(B){return"[object "+B+"]"}var qu=Yu("HTMLCanvasElement"),hu=Yu("OffscreenCanvas"),ks=Yu("CanvasRenderingContext2D"),Of=Yu("ImageBitmap"),Kr=Yu("HTMLImageElement"),tf=Yu("HTMLVideoElement"),Rf=Object.keys(Qi).concat([qu,hu,ks,Of,Kr,tf]),Tu=[];Tu[cl]=1,Tu[Au]=4,Tu[Cl]=2,Tu[Kc]=2,Tu[$c]=4;var za=[];za[Yl]=2,za[es]=2,za[Pf]=2,za[Cu]=4,za[Hu]=.5,za[Hs]=.5,za[Wc]=1,za[Xc]=1,za[Yc]=.5,za[Wu]=1,za[ql]=1,za[Ac]=.5,za[qc]=.25,za[Tc]=.5,za[ah]=.25,za[Mc]=.5;function Ds(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function rf(B){if(!Array.isArray(B))return!1;var le=B.length;return!(le===0||!ha(B[0]))}function Mu(B){return Object.prototype.toString.call(B)}function ws(B){return Mu(B)===qu}function bo(B){return Mu(B)===hu}function sh(B){return Mu(B)===ks}function ga(B){return Mu(B)===Of}function Lf(B){return Mu(B)===Kr}function uh(B){return Mu(B)===tf}function Ws(B){var le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(le&&B&&B.getContext)}function Cs(B){var le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(le&&B&&"src"in B&&"crossOrigin"in B)}function Oi(B){if(!B)return!1;if(Ws(B)||Cs(B))return!0;var le=Mu(B);return Rf.indexOf(le)>=0?!0:Ds(B)||rf(B)||Os(B)}function pu(B){return Qi[Object.prototype.toString.call(B)]|0}function pa(B,le){var Fe=le.length;switch(B.type){case cl:case Kc:case $c:case Au:var kt=Tt.allocType(B.type,Fe);kt.set(le),B.data=kt;break;case Cl:B.data=xo(le);break;default:me.raise("unsupported texture type, must specify a typed array")}}function lo(B,le){return Tt.allocType(B.type===Cl?Au:B.type,le)}function Fs(B,le){B.type===Cl?(B.data=xo(le),Tt.freeType(le)):B.data=le}function ou(B,le,Fe,kt,ur,It){for(var tr=B.width,dr=B.height,_r=B.channels,Sr=tr*dr*_r,Lr=lo(B,Sr),kr=0,Dr=0;Dr<dr;++Dr)for(var xr=0;xr<tr;++xr)for(var Ar=0;Ar<_r;++Ar)Lr[kr++]=le[Fe*xr+kt*Dr+ur*Ar+It];Fs(B,Lr)}function Ns(B,le,Fe,kt,ur,It){var tr;if(typeof za[B]!="undefined"?tr=za[B]:tr=no[B]*Tu[le],It&&(tr*=6),ur){for(var dr=0,_r=Fe;_r>=1;)dr+=tr*_r*_r,_r/=2;return dr}else return tr*Fe*kt}function vs(B,le,Fe,kt,ur,It,tr){var dr={"don't care":fl,"dont care":fl,nice:qh,fast:ef},_r={repeat:oh,clamp:Al,mirror:Yh},Sr={nearest:Kl,linear:Tl},Lr=v({mipmap:Ls,"nearest mipmap nearest":au,"linear mipmap nearest":Di,"nearest mipmap linear":ka,"linear mipmap linear":Ls},Sr),kr={none:0,browser:Jl},Dr={uint8:cl,rgba4:nh,rgb565:Hc,"rgb5 a1":ih},xr={alpha:Cc,luminance:ba,"luminance alpha":wl,rgb:ul,rgba:Rs,rgba4:Yl,"rgb5 a1":es,rgb565:Pf},Ar={};le.ext_srgb&&(xr.srgb=Gu,xr.srgba=zo),le.oes_texture_float&&(Dr.float32=Dr.float=Au),le.oes_texture_half_float&&(Dr.float16=Dr["half float"]=Cl),le.webgl_depth_texture&&(v(xr,{depth:Bo,"depth stencil":Cu}),v(Dr,{uint16:Kc,uint32:$c,"depth stencil":ll})),le.webgl_compressed_texture_s3tc&&v(Ar,{"rgb s3tc dxt1":Hu,"rgba s3tc dxt1":Hs,"rgba s3tc dxt3":Wc,"rgba s3tc dxt5":Xc}),le.webgl_compressed_texture_atc&&v(Ar,{"rgb atc":Yc,"rgba atc explicit alpha":Wu,"rgba atc interpolated alpha":ql}),le.webgl_compressed_texture_pvrtc&&v(Ar,{"rgb pvrtc 4bppv1":Ac,"rgb pvrtc 2bppv1":qc,"rgba pvrtc 4bppv1":Tc,"rgba pvrtc 2bppv1":ah}),le.webgl_compressed_texture_etc1&&(Ar["rgb etc1"]=Mc);var st=Array.prototype.slice.call(B.getParameter(rh)||new Uint32Array(0));Object.keys(Ar).forEach(function(Pe){var Bt=Ar[Pe];st.indexOf(Bt)>=0&&(xr[Pe]=Bt)});var Ut=Object.keys(xr);Fe.textureFormats=Ut;var wr=[];Object.keys(xr).forEach(function(Pe){var Bt=xr[Pe];wr[Bt]=Pe});var Ur=[];Object.keys(Dr).forEach(function(Pe){var Bt=Dr[Pe];Ur[Bt]=Pe});var fr=[];Object.keys(Sr).forEach(function(Pe){var Bt=Sr[Pe];fr[Bt]=Pe});var Nr=[];Object.keys(Lr).forEach(function(Pe){var Bt=Lr[Pe];Nr[Bt]=Pe});var Jr=[];Object.keys(_r).forEach(function(Pe){var Bt=_r[Pe];Jr[Bt]=Pe});var Fn=Ut.reduce(function(Pe,Bt){var wt=xr[Bt];return wt===ba||wt===Cc||wt===ba||wt===wl||wt===Bo||wt===Cu||le.ext_srgb&&(wt===Gu||wt===zo)?Pe[wt]=wt:wt===es||Bt.indexOf("rgba")>=0?Pe[wt]=Rs:Pe[wt]=ul,Pe},{});function rr(){this.internalformat=Rs,this.format=Rs,this.type=cl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Jl,this.width=0,this.height=0,this.channels=0}function ar(Pe,Bt){Pe.internalformat=Bt.internalformat,Pe.format=Bt.format,Pe.type=Bt.type,Pe.compressed=Bt.compressed,Pe.premultiplyAlpha=Bt.premultiplyAlpha,Pe.flipY=Bt.flipY,Pe.unpackAlignment=Bt.unpackAlignment,Pe.colorSpace=Bt.colorSpace,Pe.width=Bt.width,Pe.height=Bt.height,Pe.channels=Bt.channels}function _n(Pe,Bt){if(!(typeof Bt!="object"||!Bt)){if("premultiplyAlpha"in Bt&&(me.type(Bt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Pe.premultiplyAlpha=Bt.premultiplyAlpha),"flipY"in Bt&&(me.type(Bt.flipY,"boolean","invalid texture flip"),Pe.flipY=Bt.flipY),"alignment"in Bt&&(me.oneOf(Bt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Pe.unpackAlignment=Bt.alignment),"colorSpace"in Bt&&(me.parameter(Bt.colorSpace,kr,"invalid colorSpace"),Pe.colorSpace=kr[Bt.colorSpace]),"type"in Bt){var wt=Bt.type;me(le.oes_texture_float||!(wt==="float"||wt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),me(le.oes_texture_half_float||!(wt==="half float"||wt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),me(le.webgl_depth_texture||!(wt==="uint16"||wt==="uint32"||wt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(wt,Dr,"invalid texture type"),Pe.type=Dr[wt]}var pn=Pe.width,Zi=Pe.height,Se=Pe.channels,ce=!1;"shape"in Bt?(me(Array.isArray(Bt.shape)&&Bt.shape.length>=2,"shape must be an array"),pn=Bt.shape[0],Zi=Bt.shape[1],Bt.shape.length===3&&(Se=Bt.shape[2],me(Se>0&&Se<=4,"invalid number of channels"),ce=!0),me(pn>=0&&pn<=Fe.maxTextureSize,"invalid width"),me(Zi>=0&&Zi<=Fe.maxTextureSize,"invalid height")):("radius"in Bt&&(pn=Zi=Bt.radius,me(pn>=0&&pn<=Fe.maxTextureSize,"invalid radius")),"width"in Bt&&(pn=Bt.width,me(pn>=0&&pn<=Fe.maxTextureSize,"invalid width")),"height"in Bt&&(Zi=Bt.height,me(Zi>=0&&Zi<=Fe.maxTextureSize,"invalid height")),"channels"in Bt&&(Se=Bt.channels,me(Se>0&&Se<=4,"invalid number of channels"),ce=!0)),Pe.width=pn|0,Pe.height=Zi|0,Pe.channels=Se|0;var Ge=!1;if("format"in Bt){var ct=Bt.format;me(le.webgl_depth_texture||!(ct==="depth"||ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(ct,xr,"invalid texture format");var Pt=Pe.internalformat=xr[ct];Pe.format=Fn[Pt],ct in Dr&&("type"in Bt||(Pe.type=Dr[ct])),ct in Ar&&(Pe.compressed=!0),Ge=!0}!ce&&Ge?Pe.channels=no[Pe.format]:ce&&!Ge?Pe.channels!==mn[Pe.format]&&(Pe.format=Pe.internalformat=mn[Pe.channels]):Ge&&ce&&me(Pe.channels===no[Pe.format],"number of channels inconsistent with specified format")}}function Xr(Pe){B.pixelStorei($l,Pe.flipY),B.pixelStorei(Xu,Pe.premultiplyAlpha),B.pixelStorei(Po,Pe.colorSpace),B.pixelStorei(Pc,Pe.unpackAlignment)}function Tr(){rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Yr(Pe,Bt){var wt=null;if(Oi(Bt)?wt=Bt:Bt&&(me.type(Bt,"object","invalid pixel data type"),_n(Pe,Bt),"x"in Bt&&(Pe.xOffset=Bt.x|0),"y"in Bt&&(Pe.yOffset=Bt.y|0),Oi(Bt.data)&&(wt=Bt.data)),me(!Pe.compressed||wt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Bt.copy){me(!wt,"can not specify copy and data field for the same texture");var pn=ur.viewportWidth,Zi=ur.viewportHeight;Pe.width=Pe.width||pn-Pe.xOffset,Pe.height=Pe.height||Zi-Pe.yOffset,Pe.needsCopy=!0,me(Pe.xOffset>=0&&Pe.xOffset<pn&&Pe.yOffset>=0&&Pe.yOffset<Zi&&Pe.width>0&&Pe.width<=pn&&Pe.height>0&&Pe.height<=Zi,"copy texture read out of bounds")}else if(!wt)Pe.width=Pe.width||1,Pe.height=Pe.height||1,Pe.channels=Pe.channels||4;else if($(wt))Pe.channels=Pe.channels||4,Pe.data=wt,!("type"in Bt)&&Pe.type===cl&&(Pe.type=pu(wt));else if(Ds(wt))Pe.channels=Pe.channels||4,pa(Pe,wt),Pe.alignment=1,Pe.needsFree=!0;else if(Os(wt)){var Se=wt.data;!Array.isArray(Se)&&Pe.type===cl&&(Pe.type=pu(Se));var ce=wt.shape,Ge=wt.stride,ct,Pt,Je,Be,nt,ye;ce.length===3?(Je=ce[2],ye=Ge[2]):(me(ce.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Je=1,ye=1),ct=ce[0],Pt=ce[1],Be=Ge[0],nt=Ge[1],Pe.alignment=1,Pe.width=ct,Pe.height=Pt,Pe.channels=Je,Pe.format=Pe.internalformat=mn[Je],Pe.needsFree=!0,ou(Pe,Se,Be,nt,ye,wt.offset)}else if(Ws(wt)||ws(wt)||bo(wt)||sh(wt))Ws(wt)||ws(wt)||bo(wt)?Pe.element=wt:Pe.element=wt.canvas,Pe.width=Pe.element.width,Pe.height=Pe.element.height,Pe.channels=4;else if(ga(wt))Pe.element=wt,Pe.width=wt.width,Pe.height=wt.height,Pe.channels=4;else if(Lf(wt))Pe.element=wt,Pe.width=wt.naturalWidth,Pe.height=wt.naturalHeight,Pe.channels=4;else if(Cs(wt))Pe.element=wt,Pe.width=wt.width,Pe.height=wt.height,Pe.channels=4;else if(uh(wt))Pe.element=wt,Pe.width=wt.videoWidth,Pe.height=wt.videoHeight,Pe.channels=4;else if(rf(wt)){var Ze=Pe.width||wt[0].length,Ce=Pe.height||wt.length,ft=Pe.channels;ha(wt[0][0])?ft=ft||wt[0][0].length:ft=ft||1;for(var Et=xe.shape(wt),pr=1,Zr=0;Zr<Et.length;++Zr)pr*=Et[Zr];var jr=lo(Pe,pr);xe.flatten(wt,Et,"",jr),Fs(Pe,jr),Pe.alignment=1,Pe.width=Ze,Pe.height=Ce,Pe.channels=ft,Pe.format=Pe.internalformat=mn[ft],Pe.needsFree=!0}Pe.type===Au?me(Fe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Pe.type===Cl&&me(Fe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Qr(Pe,Bt,wt){var pn=Pe.element,Zi=Pe.data,Se=Pe.internalformat,ce=Pe.format,Ge=Pe.type,ct=Pe.width,Pt=Pe.height;Xr(Pe),pn?B.texImage2D(Bt,wt,ce,ce,Ge,pn):Pe.compressed?B.compressedTexImage2D(Bt,wt,Se,ct,Pt,0,Zi):Pe.needsCopy?(kt(),B.copyTexImage2D(Bt,wt,ce,Pe.xOffset,Pe.yOffset,ct,Pt,0)):B.texImage2D(Bt,wt,ce,ct,Pt,0,ce,Ge,Zi||null)}function vi(Pe,Bt,wt,pn,Zi){var Se=Pe.element,ce=Pe.data,Ge=Pe.internalformat,ct=Pe.format,Pt=Pe.type,Je=Pe.width,Be=Pe.height;Xr(Pe),Se?B.texSubImage2D(Bt,Zi,wt,pn,ct,Pt,Se):Pe.compressed?B.compressedTexSubImage2D(Bt,Zi,wt,pn,Ge,Je,Be,ce):Pe.needsCopy?(kt(),B.copyTexSubImage2D(Bt,Zi,wt,pn,Pe.xOffset,Pe.yOffset,Je,Be)):B.texSubImage2D(Bt,Zi,wt,pn,Je,Be,ct,Pt,ce)}var ni=[];function qr(){return ni.pop()||new Tr}function an(Pe){Pe.needsFree&&Tt.freeType(Pe.data),Tr.call(Pe),ni.push(Pe)}function Yn(){rr.call(this),this.genMipmaps=!1,this.mipmapHint=fl,this.mipmask=0,this.images=Array(16)}function ci(Pe,Bt,wt){var pn=Pe.images[0]=qr();Pe.mipmask=1,pn.width=Pe.width=Bt,pn.height=Pe.height=wt,pn.channels=Pe.channels=4}function Ui(Pe,Bt){var wt=null;if(Oi(Bt))wt=Pe.images[0]=qr(),ar(wt,Pe),Yr(wt,Bt),Pe.mipmask=1;else if(_n(Pe,Bt),Array.isArray(Bt.mipmap))for(var pn=Bt.mipmap,Zi=0;Zi<pn.length;++Zi)wt=Pe.images[Zi]=qr(),ar(wt,Pe),wt.width>>=Zi,wt.height>>=Zi,Yr(wt,pn[Zi]),Pe.mipmask|=1<<Zi;else wt=Pe.images[0]=qr(),ar(wt,Pe),Yr(wt,Bt),Pe.mipmask=1;ar(Pe,Pe.images[0]),Pe.compressed&&(Pe.internalformat===Hu||Pe.internalformat===Hs||Pe.internalformat===Wc||Pe.internalformat===Xc)&&me(Pe.width%4==0&&Pe.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ao(Pe,Bt){for(var wt=Pe.images,pn=0;pn<wt.length;++pn){if(!wt[pn])return;Qr(wt[pn],Bt,pn)}}var oo=[];function Ni(){var Pe=oo.pop()||new Yn;rr.call(Pe),Pe.mipmask=0;for(var Bt=0;Bt<16;++Bt)Pe.images[Bt]=null;return Pe}function as(Pe){for(var Bt=Pe.images,wt=0;wt<Bt.length;++wt)Bt[wt]&&an(Bt[wt]),Bt[wt]=null;oo.push(Pe)}function Wa(){this.minFilter=Kl,this.magFilter=Kl,this.wrapS=Al,this.wrapT=Al,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=fl}function Ko(Pe,Bt){if("min"in Bt){var wt=Bt.min;me.parameter(wt,Lr),Pe.minFilter=Lr[wt],qa.indexOf(Pe.minFilter)>=0&&!("faces"in Bt)&&(Pe.genMipmaps=!0)}if("mag"in Bt){var pn=Bt.mag;me.parameter(pn,Sr),Pe.magFilter=Sr[pn]}var Zi=Pe.wrapS,Se=Pe.wrapT;if("wrap"in Bt){var ce=Bt.wrap;typeof ce=="string"?(me.parameter(ce,_r),Zi=Se=_r[ce]):Array.isArray(ce)&&(me.parameter(ce[0],_r),me.parameter(ce[1],_r),Zi=_r[ce[0]],Se=_r[ce[1]])}else{if("wrapS"in Bt){var Ge=Bt.wrapS;me.parameter(Ge,_r),Zi=_r[Ge]}if("wrapT"in Bt){var ct=Bt.wrapT;me.parameter(ct,_r),Se=_r[ct]}}if(Pe.wrapS=Zi,Pe.wrapT=Se,"anisotropic"in Bt){var Pt=Bt.anisotropic;me(typeof Pt=="number"&&Pt>=1&&Pt<=Fe.maxAnisotropic,"aniso samples must be between 1 and "),Pe.anisotropic=Bt.anisotropic}if("mipmap"in Bt){var Je=!1;switch(typeof Bt.mipmap){case"string":me.parameter(Bt.mipmap,dr,"invalid mipmap hint"),Pe.mipmapHint=dr[Bt.mipmap],Pe.genMipmaps=!0,Je=!0;break;case"boolean":Je=Pe.genMipmaps=Bt.mipmap;break;case"object":me(Array.isArray(Bt.mipmap),"invalid mipmap type"),Pe.genMipmaps=!1,Je=!0;break;default:me.raise("invalid mipmap type")}Je&&!("min"in Bt)&&(Pe.minFilter=au)}}function So(Pe,Bt){B.texParameteri(Bt,Ha,Pe.minFilter),B.texParameteri(Bt,ts,Pe.magFilter),B.texParameteri(Bt,Jc,Pe.wrapS),B.texParameteri(Bt,If,Pe.wrapT),le.ext_texture_filter_anisotropic&&B.texParameteri(Bt,Kh,Pe.anisotropic),Pe.genMipmaps&&(B.hint(Qc,Pe.mipmapHint),B.generateMipmap(Bt))}var $o=0,Zo={},os=Fe.maxTextureUnits,co=Array(os).map(function(){return null});function mi(Pe){rr.call(this),this.mipmask=0,this.internalformat=Rs,this.id=$o++,this.refCount=1,this.target=Pe,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Wa,tr.profile&&(this.stats={size:0})}function jo(Pe){B.activeTexture(Ql),B.bindTexture(Pe.target,Pe.texture)}function ea(){var Pe=co[0];Pe?B.bindTexture(Pe.target,Pe.texture):B.bindTexture(uo,null)}function ss(Pe){var Bt=Pe.texture;me(Bt,"must not double destroy texture");var wt=Pe.unit,pn=Pe.target;wt>=0&&(B.activeTexture(Ql+wt),B.bindTexture(pn,null),co[wt]=null),B.deleteTexture(Bt),Pe.texture=null,Pe.params=null,Pe.pixels=null,Pe.refCount=0,delete Zo[Pe.id],It.textureCount--}v(mi.prototype,{bind:function(){var Pe=this;Pe.bindCount+=1;var Bt=Pe.unit;if(Bt<0){for(var wt=0;wt<os;++wt){var pn=co[wt];if(pn){if(pn.bindCount>0)continue;pn.unit=-1}co[wt]=Pe,Bt=wt;break}Bt>=os&&me.raise("insufficient number of texture units"),tr.profile&&It.maxTextureUnits<Bt+1&&(It.maxTextureUnits=Bt+1),Pe.unit=Bt,B.activeTexture(Ql+Bt),B.bindTexture(Pe.target,Pe.texture)}return Bt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ss(this)}});function Qn(Pe,Bt){var wt=new mi(uo);Zo[wt.id]=wt,It.textureCount++;function pn(ce,Ge){var ct=wt.texInfo;Wa.call(ct);var Pt=Ni();return typeof ce=="number"?typeof Ge=="number"?ci(Pt,ce|0,Ge|0):ci(Pt,ce|0,ce|0):ce?(me.type(ce,"object","invalid arguments to regl.texture"),Ko(ct,ce),Ui(Pt,ce)):ci(Pt,1,1),ct.genMipmaps&&(Pt.mipmask=(Pt.width<<1)-1),wt.mipmask=Pt.mipmask,ar(wt,Pt),me.texture2D(ct,Pt,Fe),wt.internalformat=Pt.internalformat,pn.width=Pt.width,pn.height=Pt.height,jo(wt),ao(Pt,uo),So(ct,uo),ea(),as(Pt),tr.profile&&(wt.stats.size=Ns(wt.internalformat,wt.type,Pt.width,Pt.height,ct.genMipmaps,!1)),pn.format=wr[wt.internalformat],pn.type=Ur[wt.type],pn.mag=fr[ct.magFilter],pn.min=Nr[ct.minFilter],pn.wrapS=Jr[ct.wrapS],pn.wrapT=Jr[ct.wrapT],pn}function Zi(ce,Ge,ct,Pt){me(!!ce,"must specify image data");var Je=Ge|0,Be=ct|0,nt=Pt|0,ye=qr();return ar(ye,wt),ye.width=0,ye.height=0,Yr(ye,ce),ye.width=ye.width||(wt.width>>nt)-Je,ye.height=ye.height||(wt.height>>nt)-Be,me(wt.type===ye.type&&wt.format===ye.format&&wt.internalformat===ye.internalformat,"incompatible format for texture.subimage"),me(Je>=0&&Be>=0&&Je+ye.width<=wt.width&&Be+ye.height<=wt.height,"texture.subimage write out of bounds"),me(wt.mipmask&1<<nt,"missing mipmap data"),me(ye.data||ye.element||ye.needsCopy,"missing image data"),jo(wt),vi(ye,uo,Je,Be,nt),ea(),an(ye),pn}function Se(ce,Ge){var ct=ce|0,Pt=Ge|0||ct;if(ct===wt.width&&Pt===wt.height)return pn;pn.width=wt.width=ct,pn.height=wt.height=Pt,jo(wt);for(var Je=0;wt.mipmask>>Je;++Je){var Be=ct>>Je,nt=Pt>>Je;if(!Be||!nt)break;B.texImage2D(uo,Je,wt.format,Be,nt,0,wt.format,wt.type,null)}return ea(),tr.profile&&(wt.stats.size=Ns(wt.internalformat,wt.type,ct,Pt,!1,!1)),pn}return pn(Pe,Bt),pn.subimage=Zi,pn.resize=Se,pn._reglType="texture2d",pn._texture=wt,tr.profile&&(pn.stats=wt.stats),pn.destroy=function(){wt.decRef()},pn}function ki(Pe,Bt,wt,pn,Zi,Se){var ce=new mi(Mf);Zo[ce.id]=ce,It.cubeCount++;var Ge=new Array(6);function ct(Be,nt,ye,Ze,Ce,ft){var Et,pr=ce.texInfo;for(Wa.call(pr),Et=0;Et<6;++Et)Ge[Et]=Ni();if(typeof Be=="number"||!Be){var Zr=Be|0||1;for(Et=0;Et<6;++Et)ci(Ge[Et],Zr,Zr)}else if(typeof Be=="object")if(nt)Ui(Ge[0],Be),Ui(Ge[1],nt),Ui(Ge[2],ye),Ui(Ge[3],Ze),Ui(Ge[4],Ce),Ui(Ge[5],ft);else if(Ko(pr,Be),_n(ce,Be),"faces"in Be){var jr=Be.faces;for(me(Array.isArray(jr)&&jr.length===6,"cube faces must be a length 6 array"),Et=0;Et<6;++Et)me(typeof jr[Et]=="object"&&!!jr[Et],"invalid input for cube map face"),ar(Ge[Et],ce),Ui(Ge[Et],jr[Et])}else for(Et=0;Et<6;++Et)Ui(Ge[Et],Be);else me.raise("invalid arguments to cube map");for(ar(ce,Ge[0]),me.optional(function(){Fe.npotTextureCube||me(th(ce.width)&&th(ce.height),"your browser does not support non power or two texture dimensions")}),pr.genMipmaps?ce.mipmask=(Ge[0].width<<1)-1:ce.mipmask=Ge[0].mipmask,me.textureCube(ce,pr,Ge,Fe),ce.internalformat=Ge[0].internalformat,ct.width=Ge[0].width,ct.height=Ge[0].height,jo(ce),Et=0;Et<6;++Et)ao(Ge[Et],fu+Et);for(So(pr,Mf),ea(),tr.profile&&(ce.stats.size=Ns(ce.internalformat,ce.type,ct.width,ct.height,pr.genMipmaps,!0)),ct.format=wr[ce.internalformat],ct.type=Ur[ce.type],ct.mag=fr[pr.magFilter],ct.min=Nr[pr.minFilter],ct.wrapS=Jr[pr.wrapS],ct.wrapT=Jr[pr.wrapT],Et=0;Et<6;++Et)as(Ge[Et]);return ct}function Pt(Be,nt,ye,Ze,Ce){me(!!nt,"must specify image data"),me(typeof Be=="number"&&Be===(Be|0)&&Be>=0&&Be<6,"invalid face");var ft=ye|0,Et=Ze|0,pr=Ce|0,Zr=qr();return ar(Zr,ce),Zr.width=0,Zr.height=0,Yr(Zr,nt),Zr.width=Zr.width||(ce.width>>pr)-ft,Zr.height=Zr.height||(ce.height>>pr)-Et,me(ce.type===Zr.type&&ce.format===Zr.format&&ce.internalformat===Zr.internalformat,"incompatible format for texture.subimage"),me(ft>=0&&Et>=0&&ft+Zr.width<=ce.width&&Et+Zr.height<=ce.height,"texture.subimage write out of bounds"),me(ce.mipmask&1<<pr,"missing mipmap data"),me(Zr.data||Zr.element||Zr.needsCopy,"missing image data"),jo(ce),vi(Zr,fu+Be,ft,Et,pr),ea(),an(Zr),ct}function Je(Be){var nt=Be|0;if(nt!==ce.width){ct.width=ce.width=nt,ct.height=ce.height=nt,jo(ce);for(var ye=0;ye<6;++ye)for(var Ze=0;ce.mipmask>>Ze;++Ze)B.texImage2D(fu+ye,Ze,ce.format,nt>>Ze,nt>>Ze,0,ce.format,ce.type,null);return ea(),tr.profile&&(ce.stats.size=Ns(ce.internalformat,ce.type,ct.width,ct.height,!1,!0)),ct}}return ct(Pe,Bt,wt,pn,Zi,Se),ct.subimage=Pt,ct.resize=Je,ct._reglType="textureCube",ct._texture=ce,tr.profile&&(ct.stats=ce.stats),ct.destroy=function(){ce.decRef()},ct}function la(){for(var Pe=0;Pe<os;++Pe)B.activeTexture(Ql+Pe),B.bindTexture(uo,null),co[Pe]=null;ie(Zo).forEach(ss),It.cubeCount=0,It.textureCount=0}tr.profile&&(It.getTotalTextureSize=function(){var Pe=0;return Object.keys(Zo).forEach(function(Bt){Pe+=Zo[Bt].stats.size}),Pe});function wo(){for(var Pe=0;Pe<os;++Pe){var Bt=co[Pe];Bt&&(Bt.bindCount=0,Bt.unit=-1,co[Pe]=null)}ie(Zo).forEach(function(wt){wt.texture=B.createTexture(),B.bindTexture(wt.target,wt.texture);for(var pn=0;pn<32;++pn)if((wt.mipmask&1<<pn)!=0)if(wt.target===uo)B.texImage2D(uo,pn,wt.internalformat,wt.width>>pn,wt.height>>pn,0,wt.internalformat,wt.type,null);else for(var Zi=0;Zi<6;++Zi)B.texImage2D(fu+Zi,pn,wt.internalformat,wt.width>>pn,wt.height>>pn,0,wt.internalformat,wt.type,null);So(wt.texInfo,wt.target)})}function rl(){for(var Pe=0;Pe<os;++Pe){var Bt=co[Pe];Bt&&(Bt.bindCount=0,Bt.unit=-1,co[Pe]=null),B.activeTexture(Ql+Pe),B.bindTexture(uo,null),B.bindTexture(Mf,null)}}return{create2D:Qn,createCube:ki,clear:la,getTexture:function(Pe){return null},restore:wo,refresh:rl}}var Bs=36161,Pn=32854,wn=32855,ec=36194,ms=33189,du=36168,qo=34041,Ea=35907,Ic=34836,Oc=34842,da=34843,Aa=[];Aa[Pn]=2,Aa[wn]=2,Aa[ec]=2,Aa[ms]=2,Aa[du]=1,Aa[qo]=4,Aa[Ea]=4,Aa[Ic]=16,Aa[Oc]=8,Aa[da]=6;function Rc(B,le,Fe){return Aa[B]*le*Fe}var Ml=function(B,le,Fe,kt,ur){var It={rgba4:Pn,rgb565:ec,"rgb5 a1":wn,depth:ms,stencil:du,"depth stencil":qo};le.ext_srgb&&(It.srgba=Ea),le.ext_color_buffer_half_float&&(It.rgba16f=Oc,It.rgb16f=da),le.webgl_color_buffer_float&&(It.rgba32f=Ic);var tr=[];Object.keys(It).forEach(function(xr){var Ar=It[xr];tr[Ar]=xr});var dr=0,_r={};function Sr(xr){this.id=dr++,this.refCount=1,this.renderbuffer=xr,this.format=Pn,this.width=0,this.height=0,ur.profile&&(this.stats={size:0})}Sr.prototype.decRef=function(){--this.refCount<=0&&Lr(this)};function Lr(xr){var Ar=xr.renderbuffer;me(Ar,"must not double destroy renderbuffer"),B.bindRenderbuffer(Bs,null),B.deleteRenderbuffer(Ar),xr.renderbuffer=null,xr.refCount=0,delete _r[xr.id],kt.renderbufferCount--}function kr(xr,Ar){var st=new Sr(B.createRenderbuffer());_r[st.id]=st,kt.renderbufferCount++;function Ut(Ur,fr){var Nr=0,Jr=0,Fn=Pn;if(typeof Ur=="object"&&Ur){var rr=Ur;if("shape"in rr){var ar=rr.shape;me(Array.isArray(ar)&&ar.length>=2,"invalid renderbuffer shape"),Nr=ar[0]|0,Jr=ar[1]|0}else"radius"in rr&&(Nr=Jr=rr.radius|0),"width"in rr&&(Nr=rr.width|0),"height"in rr&&(Jr=rr.height|0);"format"in rr&&(me.parameter(rr.format,It,"invalid renderbuffer format"),Fn=It[rr.format])}else typeof Ur=="number"?(Nr=Ur|0,typeof fr=="number"?Jr=fr|0:Jr=Nr):Ur?me.raise("invalid arguments to renderbuffer constructor"):Nr=Jr=1;if(me(Nr>0&&Jr>0&&Nr<=Fe.maxRenderbufferSize&&Jr<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),!(Nr===st.width&&Jr===st.height&&Fn===st.format))return Ut.width=st.width=Nr,Ut.height=st.height=Jr,st.format=Fn,B.bindRenderbuffer(Bs,st.renderbuffer),B.renderbufferStorage(Bs,Fn,Nr,Jr),me(B.getError()===0,"invalid render buffer format"),ur.profile&&(st.stats.size=Rc(st.format,st.width,st.height)),Ut.format=tr[st.format],Ut}function wr(Ur,fr){var Nr=Ur|0,Jr=fr|0||Nr;return Nr===st.width&&Jr===st.height||(me(Nr>0&&Jr>0&&Nr<=Fe.maxRenderbufferSize&&Jr<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),Ut.width=st.width=Nr,Ut.height=st.height=Jr,B.bindRenderbuffer(Bs,st.renderbuffer),B.renderbufferStorage(Bs,st.format,Nr,Jr),me(B.getError()===0,"invalid render buffer format"),ur.profile&&(st.stats.size=Rc(st.format,st.width,st.height))),Ut}return Ut(xr,Ar),Ut.resize=wr,Ut._reglType="renderbuffer",Ut._renderbuffer=st,ur.profile&&(Ut.stats=st.stats),Ut.destroy=function(){st.decRef()},Ut}ur.profile&&(kt.getTotalRenderbufferSize=function(){var xr=0;return Object.keys(_r).forEach(function(Ar){xr+=_r[Ar].stats.size}),xr});function Dr(){ie(_r).forEach(function(xr){xr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(Bs,xr.renderbuffer),B.renderbufferStorage(Bs,xr.format,xr.width,xr.height)}),B.bindRenderbuffer(Bs,null)}return{create:kr,clear:function(){ie(_r).forEach(Lr)},restore:Dr}},vu=36160,Xs=36161,Io=3553,hl=34069,mu=36064,nf=36096,Pl=36128,Il=33306,Ol=36053,tc=36054,pl=36055,lh=36057,Ku=36061,Pu=36193,kf=5121,dl=5126,Ys=6407,af=6408,gu=6402,ch=[Ys,af],rc=[];rc[af]=4,rc[Ys]=3;var l=[];l[kf]=1,l[dl]=4,l[Pu]=2;var f=32854,c=32855,p=36194,b=33189,w=36168,A=34041,L=35907,U=34836,W=34842,fe=34843,he=[f,c,p,L,W,fe,U],de={};de[Ol]="complete",de[tc]="incomplete attachment",de[lh]="incomplete dimensions",de[pl]="incomplete, missing attachment",de[Ku]="unsupported";function Le(B,le,Fe,kt,ur,It){var tr={cur:null,next:null,dirty:!1,setFBO:null},dr=["rgba"],_r=["rgba4","rgb565","rgb5 a1"];le.ext_srgb&&_r.push("srgba"),le.ext_color_buffer_half_float&&_r.push("rgba16f","rgb16f"),le.webgl_color_buffer_float&&_r.push("rgba32f");var Sr=["uint8"];le.oes_texture_half_float&&Sr.push("half float","float16"),le.oes_texture_float&&Sr.push("float","float32");function Lr(Tr,Yr,Qr){this.target=Tr,this.texture=Yr,this.renderbuffer=Qr;var vi=0,ni=0;Yr?(vi=Yr.width,ni=Yr.height):Qr&&(vi=Qr.width,ni=Qr.height),this.width=vi,this.height=ni}function kr(Tr){Tr&&(Tr.texture&&Tr.texture._texture.decRef(),Tr.renderbuffer&&Tr.renderbuffer._renderbuffer.decRef())}function Dr(Tr,Yr,Qr){if(!!Tr)if(Tr.texture){var vi=Tr.texture._texture,ni=Math.max(1,vi.width),qr=Math.max(1,vi.height);me(ni===Yr&&qr===Qr,"inconsistent width/height for supplied texture"),vi.refCount+=1}else{var an=Tr.renderbuffer._renderbuffer;me(an.width===Yr&&an.height===Qr,"inconsistent width/height for renderbuffer"),an.refCount+=1}}function xr(Tr,Yr){Yr&&(Yr.texture?B.framebufferTexture2D(vu,Tr,Yr.target,Yr.texture._texture.texture,0):B.framebufferRenderbuffer(vu,Tr,Xs,Yr.renderbuffer._renderbuffer.renderbuffer))}function Ar(Tr){var Yr=Io,Qr=null,vi=null,ni=Tr;typeof Tr=="object"&&(ni=Tr.data,"target"in Tr&&(Yr=Tr.target|0)),me.type(ni,"function","invalid attachment data");var qr=ni._reglType;return qr==="texture2d"?(Qr=ni,me(Yr===Io)):qr==="textureCube"?(Qr=ni,me(Yr>=hl&&Yr<hl+6,"invalid cube map target")):qr==="renderbuffer"?(vi=ni,Yr=Xs):me.raise("invalid regl object for attachment"),new Lr(Yr,Qr,vi)}function st(Tr,Yr,Qr,vi,ni){if(Qr){var qr=kt.create2D({width:Tr,height:Yr,format:vi,type:ni});return qr._texture.refCount=0,new Lr(Io,qr,null)}else{var an=ur.create({width:Tr,height:Yr,format:vi});return an._renderbuffer.refCount=0,new Lr(Xs,null,an)}}function Ut(Tr){return Tr&&(Tr.texture||Tr.renderbuffer)}function wr(Tr,Yr,Qr){Tr&&(Tr.texture?Tr.texture.resize(Yr,Qr):Tr.renderbuffer&&Tr.renderbuffer.resize(Yr,Qr),Tr.width=Yr,Tr.height=Qr)}var Ur=0,fr={};function Nr(){this.id=Ur++,fr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Jr(Tr){Tr.colorAttachments.forEach(kr),kr(Tr.depthAttachment),kr(Tr.stencilAttachment),kr(Tr.depthStencilAttachment)}function Fn(Tr){var Yr=Tr.framebuffer;me(Yr,"must not double destroy framebuffer"),B.deleteFramebuffer(Yr),Tr.framebuffer=null,It.framebufferCount--,delete fr[Tr.id]}function rr(Tr){var Yr;B.bindFramebuffer(vu,Tr.framebuffer);var Qr=Tr.colorAttachments;for(Yr=0;Yr<Qr.length;++Yr)xr(mu+Yr,Qr[Yr]);for(Yr=Qr.length;Yr<Fe.maxColorAttachments;++Yr)B.framebufferTexture2D(vu,mu+Yr,Io,null,0);B.framebufferTexture2D(vu,Il,Io,null,0),B.framebufferTexture2D(vu,nf,Io,null,0),B.framebufferTexture2D(vu,Pl,Io,null,0),xr(nf,Tr.depthAttachment),xr(Pl,Tr.stencilAttachment),xr(Il,Tr.depthStencilAttachment);var vi=B.checkFramebufferStatus(vu);!B.isContextLost()&&vi!==Ol&&me.raise("framebuffer configuration not supported, status = "+de[vi]),B.bindFramebuffer(vu,tr.next?tr.next.framebuffer:null),tr.cur=tr.next,B.getError()}function ar(Tr,Yr){var Qr=new Nr;It.framebufferCount++;function vi(qr,an){var Yn;me(tr.next!==Qr,"can not update framebuffer which is currently in use");var ci=0,Ui=0,ao=!0,oo=!0,Ni=null,as=!0,Wa="rgba",Ko="uint8",So=1,$o=null,Zo=null,os=null,co=!1;if(typeof qr=="number")ci=qr|0,Ui=an|0||ci;else if(!qr)ci=Ui=1;else{me.type(qr,"object","invalid arguments for framebuffer");var mi=qr;if("shape"in mi){var jo=mi.shape;me(Array.isArray(jo)&&jo.length>=2,"invalid shape for framebuffer"),ci=jo[0],Ui=jo[1]}else"radius"in mi&&(ci=Ui=mi.radius),"width"in mi&&(ci=mi.width),"height"in mi&&(Ui=mi.height);("color"in mi||"colors"in mi)&&(Ni=mi.color||mi.colors,Array.isArray(Ni)&&me(Ni.length===1||le.webgl_draw_buffers,"multiple render targets not supported")),Ni||("colorCount"in mi&&(So=mi.colorCount|0,me(So>0,"invalid color buffer count")),"colorTexture"in mi&&(as=!!mi.colorTexture,Wa="rgba4"),"colorType"in mi&&(Ko=mi.colorType,as?(me(le.oes_texture_float||!(Ko==="float"||Ko==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),me(le.oes_texture_half_float||!(Ko==="half float"||Ko==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ko==="half float"||Ko==="float16"?(me(le.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Wa="rgba16f"):(Ko==="float"||Ko==="float32")&&(me(le.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Wa="rgba32f"),me.oneOf(Ko,Sr,"invalid color type")),"colorFormat"in mi&&(Wa=mi.colorFormat,dr.indexOf(Wa)>=0?as=!0:_r.indexOf(Wa)>=0?as=!1:me.optional(function(){as?me.oneOf(mi.colorFormat,dr,"invalid color format for texture"):me.oneOf(mi.colorFormat,_r,"invalid color format for renderbuffer")}))),("depthTexture"in mi||"depthStencilTexture"in mi)&&(co=!!(mi.depthTexture||mi.depthStencilTexture),me(!co||le.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in mi&&(typeof mi.depth=="boolean"?ao=mi.depth:($o=mi.depth,oo=!1)),"stencil"in mi&&(typeof mi.stencil=="boolean"?oo=mi.stencil:(Zo=mi.stencil,ao=!1)),"depthStencil"in mi&&(typeof mi.depthStencil=="boolean"?ao=oo=mi.depthStencil:(os=mi.depthStencil,ao=!1,oo=!1))}var ea=null,ss=null,Qn=null,ki=null;if(Array.isArray(Ni))ea=Ni.map(Ar);else if(Ni)ea=[Ar(Ni)];else for(ea=new Array(So),Yn=0;Yn<So;++Yn)ea[Yn]=st(ci,Ui,as,Wa,Ko);me(le.webgl_draw_buffers||ea.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),me(ea.length<=Fe.maxColorAttachments,"too many color attachments, not supported"),ci=ci||ea[0].width,Ui=Ui||ea[0].height,$o?ss=Ar($o):ao&&!oo&&(ss=st(ci,Ui,co,"depth","uint32")),Zo?Qn=Ar(Zo):oo&&!ao&&(Qn=st(ci,Ui,!1,"stencil","uint8")),os?ki=Ar(os):!$o&&!Zo&&oo&&ao&&(ki=st(ci,Ui,co,"depth stencil","depth stencil")),me(!!$o+!!Zo+!!os<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var la=null;for(Yn=0;Yn<ea.length;++Yn)if(Dr(ea[Yn],ci,Ui),me(!ea[Yn]||ea[Yn].texture&&ch.indexOf(ea[Yn].texture._texture.format)>=0||ea[Yn].renderbuffer&&he.indexOf(ea[Yn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Yn+" is invalid"),ea[Yn]&&ea[Yn].texture){var wo=rc[ea[Yn].texture._texture.format]*l[ea[Yn].texture._texture.type];la===null?la=wo:me(la===wo,"all color attachments much have the same number of bits per pixel.")}return Dr(ss,ci,Ui),me(!ss||ss.texture&&ss.texture._texture.format===gu||ss.renderbuffer&&ss.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),Dr(Qn,ci,Ui),me(!Qn||Qn.renderbuffer&&Qn.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Dr(ki,ci,Ui),me(!ki||ki.texture&&ki.texture._texture.format===A||ki.renderbuffer&&ki.renderbuffer._renderbuffer.format===A,"invalid depth-stencil attachment for framebuffer object"),Jr(Qr),Qr.width=ci,Qr.height=Ui,Qr.colorAttachments=ea,Qr.depthAttachment=ss,Qr.stencilAttachment=Qn,Qr.depthStencilAttachment=ki,vi.color=ea.map(Ut),vi.depth=Ut(ss),vi.stencil=Ut(Qn),vi.depthStencil=Ut(ki),vi.width=Qr.width,vi.height=Qr.height,rr(Qr),vi}function ni(qr,an){me(tr.next!==Qr,"can not resize a framebuffer which is currently in use");var Yn=Math.max(qr|0,1),ci=Math.max(an|0||Yn,1);if(Yn===Qr.width&&ci===Qr.height)return vi;for(var Ui=Qr.colorAttachments,ao=0;ao<Ui.length;++ao)wr(Ui[ao],Yn,ci);return wr(Qr.depthAttachment,Yn,ci),wr(Qr.stencilAttachment,Yn,ci),wr(Qr.depthStencilAttachment,Yn,ci),Qr.width=vi.width=Yn,Qr.height=vi.height=ci,rr(Qr),vi}return vi(Tr,Yr),v(vi,{resize:ni,_reglType:"framebuffer",_framebuffer:Qr,destroy:function(){Fn(Qr),Jr(Qr)},use:function(qr){tr.setFBO({framebuffer:vi},qr)}})}function _n(Tr){var Yr=Array(6);function Qr(ni){var qr;me(Yr.indexOf(tr.next)<0,"can not update framebuffer which is currently in use");var an={color:null},Yn=0,ci=null,Ui="rgba",ao="uint8",oo=1;if(typeof ni=="number")Yn=ni|0;else if(!ni)Yn=1;else{me.type(ni,"object","invalid arguments for framebuffer");var Ni=ni;if("shape"in Ni){var as=Ni.shape;me(Array.isArray(as)&&as.length>=2,"invalid shape for framebuffer"),me(as[0]===as[1],"cube framebuffer must be square"),Yn=as[0]}else"radius"in Ni&&(Yn=Ni.radius|0),"width"in Ni?(Yn=Ni.width|0,"height"in Ni&&me(Ni.height===Yn,"must be square")):"height"in Ni&&(Yn=Ni.height|0);("color"in Ni||"colors"in Ni)&&(ci=Ni.color||Ni.colors,Array.isArray(ci)&&me(ci.length===1||le.webgl_draw_buffers,"multiple render targets not supported")),ci||("colorCount"in Ni&&(oo=Ni.colorCount|0,me(oo>0,"invalid color buffer count")),"colorType"in Ni&&(me.oneOf(Ni.colorType,Sr,"invalid color type"),ao=Ni.colorType),"colorFormat"in Ni&&(Ui=Ni.colorFormat,me.oneOf(Ni.colorFormat,dr,"invalid color format for texture"))),"depth"in Ni&&(an.depth=Ni.depth),"stencil"in Ni&&(an.stencil=Ni.stencil),"depthStencil"in Ni&&(an.depthStencil=Ni.depthStencil)}var Wa;if(ci)if(Array.isArray(ci))for(Wa=[],qr=0;qr<ci.length;++qr)Wa[qr]=ci[qr];else Wa=[ci];else{Wa=Array(oo);var Ko={radius:Yn,format:Ui,type:ao};for(qr=0;qr<oo;++qr)Wa[qr]=kt.createCube(Ko)}for(an.color=Array(Wa.length),qr=0;qr<Wa.length;++qr){var So=Wa[qr];me(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),Yn=Yn||So.width,me(So.width===Yn&&So.height===Yn,"invalid cube map shape"),an.color[qr]={target:hl,data:Wa[qr]}}for(qr=0;qr<6;++qr){for(var $o=0;$o<Wa.length;++$o)an.color[$o].target=hl+qr;qr>0&&(an.depth=Yr[0].depth,an.stencil=Yr[0].stencil,an.depthStencil=Yr[0].depthStencil),Yr[qr]?Yr[qr](an):Yr[qr]=ar(an)}return v(Qr,{width:Yn,height:Yn,color:Wa})}function vi(ni){var qr,an=ni|0;if(me(an>0&&an<=Fe.maxCubeMapSize,"invalid radius for cube fbo"),an===Qr.width)return Qr;var Yn=Qr.color;for(qr=0;qr<Yn.length;++qr)Yn[qr].resize(an);for(qr=0;qr<6;++qr)Yr[qr].resize(an);return Qr.width=Qr.height=an,Qr}return Qr(Tr),v(Qr,{faces:Yr,resize:vi,_reglType:"framebufferCube",destroy:function(){Yr.forEach(function(ni){ni.destroy()})}})}function Xr(){tr.cur=null,tr.next=null,tr.dirty=!0,ie(fr).forEach(function(Tr){Tr.framebuffer=B.createFramebuffer(),rr(Tr)})}return v(tr,{getFramebuffer:function(Tr){if(typeof Tr=="function"&&Tr._reglType==="framebuffer"){var Yr=Tr._framebuffer;if(Yr instanceof Nr)return Yr}return null},create:ar,createCube:_n,clear:function(){ie(fr).forEach(Fn)},restore:Xr})}var Oe=5126,Xe=34962,Ae=34963,He=["attributes","elements","offset","count","primitive","instances"];function tt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Oe,this.offset=0,this.stride=0,this.divisor=0}function xt(B,le,Fe,kt,ur,It,tr){for(var dr=Fe.maxAttributes,_r=new Array(dr),Sr=0;Sr<dr;++Sr)_r[Sr]=new tt;var Lr=0,kr={},Dr={Record:tt,scope:{},state:_r,currentVAO:null,targetVAO:null,restore:Ar()?Jr:function(){},createVAO:Fn,getVAO:Ut,destroyBuffer:xr,setVAO:Ar()?wr:Ur,clear:Ar()?fr:function(){}};function xr(rr){for(var ar=0;ar<_r.length;++ar){var _n=_r[ar];_n.buffer===rr&&(B.disableVertexAttribArray(ar),_n.buffer=null)}}function Ar(){return le.oes_vertex_array_object}function st(){return le.angle_instanced_arrays}function Ut(rr){return typeof rr=="function"&&rr._vao?rr._vao:null}function wr(rr){if(rr!==Dr.currentVAO){var ar=Ar();rr?ar.bindVertexArrayOES(rr.vao):ar.bindVertexArrayOES(null),Dr.currentVAO=rr}}function Ur(rr){if(rr!==Dr.currentVAO){if(rr)rr.bindAttrs();else{for(var ar=st(),_n=0;_n<_r.length;++_n){var Xr=_r[_n];Xr.buffer?(B.enableVertexAttribArray(_n),Xr.buffer.bind(),B.vertexAttribPointer(_n,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offfset),ar&&Xr.divisor&&ar.vertexAttribDivisorANGLE(_n,Xr.divisor)):(B.disableVertexAttribArray(_n),B.vertexAttrib4f(_n,Xr.x,Xr.y,Xr.z,Xr.w))}tr.elements?B.bindBuffer(Ae,tr.elements.buffer.buffer):B.bindBuffer(Ae,null)}Dr.currentVAO=rr}}function fr(){ie(kr).forEach(function(rr){rr.destroy()})}function Nr(){this.id=++Lr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var rr=Ar();rr?this.vao=rr.createVertexArrayOES():this.vao=null,kr[this.id]=this,this.buffers=[]}Nr.prototype.bindAttrs=function(){for(var rr=st(),ar=this.attributes,_n=0;_n<ar.length;++_n){var Xr=ar[_n];Xr.buffer?(B.enableVertexAttribArray(_n),B.bindBuffer(Xe,Xr.buffer.buffer),B.vertexAttribPointer(_n,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offset),rr&&Xr.divisor&&rr.vertexAttribDivisorANGLE(_n,Xr.divisor)):(B.disableVertexAttribArray(_n),B.vertexAttrib4f(_n,Xr.x,Xr.y,Xr.z,Xr.w))}for(var Tr=ar.length;Tr<dr;++Tr)B.disableVertexAttribArray(Tr);var Yr=It.getElements(this.elements);Yr?B.bindBuffer(Ae,Yr.buffer.buffer):B.bindBuffer(Ae,null)},Nr.prototype.refresh=function(){var rr=Ar();rr&&(rr.bindVertexArrayOES(this.vao),this.bindAttrs(),Dr.currentVAO=null,rr.bindVertexArrayOES(null))},Nr.prototype.destroy=function(){if(this.vao){var rr=Ar();this===Dr.currentVAO&&(Dr.currentVAO=null,rr.bindVertexArrayOES(null)),rr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),kr[this.id]&&(delete kr[this.id],kt.vaoCount-=1)};function Jr(){var rr=Ar();rr&&ie(kr).forEach(function(ar){ar.refresh()})}function Fn(rr){var ar=new Nr;kt.vaoCount+=1;function _n(Xr){var Tr;if(Array.isArray(Xr))Tr=Xr,ar.elements&&ar.ownsElements&&ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1,ar.offset=0,ar.count=0,ar.instances=-1,ar.primitive=4;else{if(me(typeof Xr=="object","invalid arguments for create vao"),me("attributes"in Xr,"must specify attributes for vao"),Xr.elements){var Yr=Xr.elements;ar.ownsElements?typeof Yr=="function"&&Yr._reglType==="elements"?(ar.elements.destroy(),ar.ownsElements=!1):(ar.elements(Yr),ar.ownsElements=!1):It.getElements(Xr.elements)?(ar.elements=Xr.elements,ar.ownsElements=!1):(ar.elements=It.create(Xr.elements),ar.ownsElements=!0)}else ar.elements=null,ar.ownsElements=!1;Tr=Xr.attributes,ar.offset=0,ar.count=-1,ar.instances=-1,ar.primitive=4,ar.elements&&(ar.count=ar.elements._elements.vertCount,ar.primitive=ar.elements._elements.primType),"offset"in Xr&&(ar.offset=Xr.offset|0),"count"in Xr&&(ar.count=Xr.count|0),"instances"in Xr&&(ar.instances=Xr.instances|0),"primitive"in Xr&&(me(Xr.primitive in lr,"bad primitive type: "+Xr.primitive),ar.primitive=lr[Xr.primitive]),me.optional(()=>{for(var ao=Object.keys(Xr),oo=0;oo<ao.length;++oo)me(He.indexOf(ao[oo])>=0,'invalid option for vao: "'+ao[oo]+'" valid options are '+He)}),me(Array.isArray(Tr),"attributes must be an array")}me(Tr.length<dr,"too many attributes"),me(Tr.length>0,"must specify at least one attribute");var Qr={},vi=ar.attributes;vi.length=Tr.length;for(var ni=0;ni<Tr.length;++ni){var qr=Tr[ni],an=vi[ni]=new tt,Yn=qr.data||qr;if(Array.isArray(Yn)||$(Yn)||Os(Yn)){var ci;ar.buffers[ni]&&(ci=ar.buffers[ni],$(Yn)&&ci._buffer.byteLength>=Yn.byteLength?ci.subdata(Yn):(ci.destroy(),ar.buffers[ni]=null)),ar.buffers[ni]||(ci=ar.buffers[ni]=ur.create(qr,Xe,!1,!0)),an.buffer=ur.getBuffer(ci),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1,Qr[ni]=1}else ur.getBuffer(qr)?(an.buffer=ur.getBuffer(qr),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1):ur.getBuffer(qr.buffer)?(an.buffer=ur.getBuffer(qr.buffer),an.size=(+qr.size||an.buffer.dimension)|0,an.normalized=!!qr.normalized||!1,"type"in qr?(me.parameter(qr.type,nu,"invalid buffer type"),an.type=nu[qr.type]):an.type=an.buffer.dtype,an.offset=(qr.offset||0)|0,an.stride=(qr.stride||0)|0,an.divisor=(qr.divisor||0)|0,an.state=1,me(an.size>=1&&an.size<=4,"size must be between 1 and 4"),me(an.offset>=0,"invalid offset"),me(an.stride>=0&&an.stride<=255,"stride must be between 0 and 255"),me(an.divisor>=0,"divisor must be positive"),me(!an.divisor||!!le.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in qr?(me(ni>0,"first attribute must not be a constant"),an.x=+qr.x||0,an.y=+qr.y||0,an.z=+qr.z||0,an.w=+qr.w||0,an.state=2):me(!1,"invalid attribute spec for location "+ni)}for(var Ui=0;Ui<ar.buffers.length;++Ui)!Qr[Ui]&&ar.buffers[Ui]&&(ar.buffers[Ui].destroy(),ar.buffers[Ui]=null);return ar.refresh(),_n}return _n.destroy=function(){for(var Xr=0;Xr<ar.buffers.length;++Xr)ar.buffers[Xr]&&ar.buffers[Xr].destroy();ar.buffers.length=0,ar.ownsElements&&(ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1),ar.destroy()},_n._vao=ar,_n._reglType="vao",_n(rr)}return Dr}var Gt=35632,Nt=35633,er=35718,mr=35721;function zr(B,le,Fe,kt){var ur={},It={};function tr(st,Ut,wr,Ur){this.name=st,this.id=Ut,this.location=wr,this.info=Ur}function dr(st,Ut){for(var wr=0;wr<st.length;++wr)if(st[wr].id===Ut.id){st[wr].location=Ut.location;return}st.push(Ut)}function _r(st,Ut,wr){var Ur=st===Gt?ur:It,fr=Ur[Ut];if(!fr){var Nr=le.str(Ut);fr=B.createShader(st),B.shaderSource(fr,Nr),B.compileShader(fr),me.shaderError(B,fr,Nr,st,wr),Ur[Ut]=fr}return fr}var Sr={},Lr=[],kr=0;function Dr(st,Ut){this.id=kr++,this.fragId=st,this.vertId=Ut,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,kt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function xr(st,Ut,wr){var Ur,fr,Nr=_r(Gt,st.fragId),Jr=_r(Nt,st.vertId),Fn=st.program=B.createProgram();if(B.attachShader(Fn,Nr),B.attachShader(Fn,Jr),wr)for(Ur=0;Ur<wr.length;++Ur){var rr=wr[Ur];B.bindAttribLocation(Fn,rr[0],rr[1])}B.linkProgram(Fn),me.linkError(B,Fn,le.str(st.fragId),le.str(st.vertId),Ut);var ar=B.getProgramParameter(Fn,er);kt.profile&&(st.stats.uniformsCount=ar);var _n=st.uniforms;for(Ur=0;Ur<ar;++Ur)if(fr=B.getActiveUniform(Fn,Ur),fr)if(fr.size>1)for(var Xr=0;Xr<fr.size;++Xr){var Tr=fr.name.replace("[0]","["+Xr+"]");dr(_n,new tr(Tr,le.id(Tr),B.getUniformLocation(Fn,Tr),fr))}else dr(_n,new tr(fr.name,le.id(fr.name),B.getUniformLocation(Fn,fr.name),fr));var Yr=B.getProgramParameter(Fn,mr);kt.profile&&(st.stats.attributesCount=Yr);var Qr=st.attributes;for(Ur=0;Ur<Yr;++Ur)fr=B.getActiveAttrib(Fn,Ur),fr&&dr(Qr,new tr(fr.name,le.id(fr.name),B.getAttribLocation(Fn,fr.name),fr))}kt.profile&&(Fe.getMaxUniformsCount=function(){var st=0;return Lr.forEach(function(Ut){Ut.stats.uniformsCount>st&&(st=Ut.stats.uniformsCount)}),st},Fe.getMaxAttributesCount=function(){var st=0;return Lr.forEach(function(Ut){Ut.stats.attributesCount>st&&(st=Ut.stats.attributesCount)}),st});function Ar(){ur={},It={};for(var st=0;st<Lr.length;++st)xr(Lr[st],null,Lr[st].attributes.map(function(Ut){return[Ut.location,Ut.name]}))}return{clear:function(){var st=B.deleteShader.bind(B);ie(ur).forEach(st),ur={},ie(It).forEach(st),It={},Lr.forEach(function(Ut){B.deleteProgram(Ut.program)}),Lr.length=0,Sr={},Fe.shaderCount=0},program:function(st,Ut,wr,Ur){me.command(st>=0,"missing vertex shader",wr),me.command(Ut>=0,"missing fragment shader",wr);var fr=Sr[Ut];fr||(fr=Sr[Ut]={});var Nr=fr[st];if(Nr&&(Nr.refCount++,!Ur))return Nr;var Jr=new Dr(Ut,st);return Fe.shaderCount++,xr(Jr,wr,Ur),Nr||(fr[st]=Jr),Lr.push(Jr),v(Jr,{destroy:function(){if(Jr.refCount--,Jr.refCount<=0){B.deleteProgram(Jr.program);var Fn=Lr.indexOf(Jr);Lr.splice(Fn,1),Fe.shaderCount--}fr[Jr.vertId].refCount<=0&&(B.deleteShader(It[Jr.vertId]),delete It[Jr.vertId],delete Sr[Jr.fragId][Jr.vertId]),Object.keys(Sr[Jr.fragId]).length||(B.deleteShader(ur[Jr.fragId]),delete ur[Jr.fragId],delete Sr[Jr.fragId])}})},restore:Ar,shader:_r,frag:-1,vert:-1}}var Br=6408,sn=5121,kn=3333,Dn=5126;function Cn(B,le,Fe,kt,ur,It,tr){function dr(Lr){var kr;le.next===null?(me(ur.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),kr=sn):(me(le.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),kr=le.next.colorAttachments[0].texture._texture.type,me.optional(function(){It.oes_texture_float?(me(kr===sn||kr===Dn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),kr===Dn&&me(tr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):me(kr===sn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Dr=0,xr=0,Ar=kt.framebufferWidth,st=kt.framebufferHeight,Ut=null;$(Lr)?Ut=Lr:Lr&&(me.type(Lr,"object","invalid arguments to regl.read()"),Dr=Lr.x|0,xr=Lr.y|0,me(Dr>=0&&Dr<kt.framebufferWidth,"invalid x offset for regl.read"),me(xr>=0&&xr<kt.framebufferHeight,"invalid y offset for regl.read"),Ar=(Lr.width||kt.framebufferWidth-Dr)|0,st=(Lr.height||kt.framebufferHeight-xr)|0,Ut=Lr.data||null),Ut&&(kr===sn?me(Ut instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):kr===Dn&&me(Ut instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),me(Ar>0&&Ar+Dr<=kt.framebufferWidth,"invalid width for read pixels"),me(st>0&&st+xr<=kt.framebufferHeight,"invalid height for read pixels"),Fe();var wr=Ar*st*4;return Ut||(kr===sn?Ut=new Uint8Array(wr):kr===Dn&&(Ut=Ut||new Float32Array(wr))),me.isTypedArray(Ut,"data buffer for regl.read() must be a typedarray"),me(Ut.byteLength>=wr,"data buffer for regl.read() too small"),B.pixelStorei(kn,4),B.readPixels(Dr,xr,Ar,st,Br,kr,Ut),Ut}function _r(Lr){var kr;return le.setFBO({framebuffer:Lr.framebuffer},function(){kr=dr(Lr)}),kr}function Sr(Lr){return!Lr||!("framebuffer"in Lr)?dr(Lr):_r(Lr)}return Sr}function Fi(B){return Array.prototype.slice.call(B)}function $r(B){return Fi(B).join("")}function ai(){var B=0,le=[],Fe=[];function kt(kr){for(var Dr=0;Dr<Fe.length;++Dr)if(Fe[Dr]===kr)return le[Dr];var xr="g"+B++;return le.push(xr),Fe.push(kr),xr}function ur(){var kr=[];function Dr(){kr.push.apply(kr,Fi(arguments))}var xr=[];function Ar(){var st="v"+B++;return xr.push(st),arguments.length>0&&(kr.push(st,"="),kr.push.apply(kr,Fi(arguments)),kr.push(";")),st}return v(Dr,{def:Ar,toString:function(){return $r([xr.length>0?"var "+xr.join(",")+";":"",$r(kr)])}})}function It(){var kr=ur(),Dr=ur(),xr=kr.toString,Ar=Dr.toString;function st(Ut,wr){Dr(Ut,wr,"=",kr.def(Ut,wr),";")}return v(function(){kr.apply(kr,Fi(arguments))},{def:kr.def,entry:kr,exit:Dr,save:st,set:function(Ut,wr,Ur){st(Ut,wr),kr(Ut,wr,"=",Ur,";")},toString:function(){return xr()+Ar()}})}function tr(){var kr=$r(arguments),Dr=It(),xr=It(),Ar=Dr.toString,st=xr.toString;return v(Dr,{then:function(){return Dr.apply(Dr,Fi(arguments)),this},else:function(){return xr.apply(xr,Fi(arguments)),this},toString:function(){var Ut=st();return Ut&&(Ut="else{"+Ut+"}"),$r(["if(",kr,"){",Ar(),"}",Ut])}})}var dr=ur(),_r={};function Sr(kr,Dr){var xr=[];function Ar(){var fr="a"+xr.length;return xr.push(fr),fr}Dr=Dr||0;for(var st=0;st<Dr;++st)Ar();var Ut=It(),wr=Ut.toString,Ur=_r[kr]=v(Ut,{arg:Ar,toString:function(){return $r(["function(",xr.join(),"){",wr(),"}"])}});return Ur}function Lr(){var kr=['"use strict";',dr,"return {"];Object.keys(_r).forEach(function(st){kr.push('"',st,'":',_r[st].toString(),",")}),kr.push("}");var Dr=$r(kr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),xr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ar=xr?Y.Function.apply(null,le.concat(Dr)):Function.apply(null,le.concat(Dr));return Ar.apply(null,Fe)}return{global:dr,link:kt,block:ur,proc:Sr,scope:It,cond:tr,compile:Lr}}var ri="xyzw".split(""),qn=5121,jn=1,pi=2,Xn=0,Vn=1,qi=2,Li=3,vo=4,Oo=5,Ia=6,mo="dither",zs="blend.enable",xs="blend.color",$u="blend.equation",rs="blend.func",Eo="depth.enable",su="depth.func",Lc="depth.range",nc="depth.mask",As="colorMask",Ju="cull.enable",Qu="cull.face",qs="frontFace",vl="lineWidth",Us="polygonOffset.enable",io="polygonOffset.offset",yu="sample.alpha",Iu="sample.enable",_u="sample.coverage",na="stencil.enable",Zs="stencil.mask",ns="stencil.func",is="stencil.opFront",ic="stencil.opBack",kc="scissor.enable",of="scissor.box",Ks="viewport",ac="profile",uu="framebuffer",ml="vert",Rl="frag",Ro="elements",Uo="primitive",Dc="count",sf="offset",Df="instances",uf="vao",fh="Width",$h="Height",oc=uu+fh,lf=uu+$h,Ff=Ks+fh,jp=Ks+$h,Ll="drawingBuffer",cf=Ll+fh,Jh=Ll+$h,Vp=[rs,$u,ns,is,ic,_u,Ks,of,io],ff=34962,Qh=34963,Td=35632,Md=35633,Gp=3553,hh=34067,Pd=2884,Fc=3042,ep=3024,Lo=2960,ph=2929,Hp=3089,dh=32823,vh=32926,Nf=32928,kl=5126,Bf=35664,sc=35665,hf=35666,zf=5124,Uf=35667,Dl=35668,mh=35669,Zf=35670,jf=35671,Nc=35672,pf=35673,$s=35674,Vf=35675,Gf=35676,Hf=35678,gh=35680,Gr=4,gl=1028,Ht=1029,Wp=2304,yh=2305,tp=32775,Xp=32776,Yp=519,xu=7680,rp=0,uc=1,df=32774,el=513,np=36160,qp=36064,tl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Bc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],lc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},cc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ip={frag:Td,vert:Md},_h={cw:Wp,ccw:yh};function vf(B){return Array.isArray(B)||$(B)||Os(B)}function ap(B){return B.sort(function(le,Fe){return le===Ks?-1:Fe===Ks?1:le<Fe?-1:1})}function ya(B,le,Fe,kt){this.thisDep=B,this.contextDep=le,this.propDep=Fe,this.append=kt}function fc(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function ko(B){return new ya(!1,!1,!1,B)}function Js(B,le){var Fe=B.type;if(Fe===Xn){var kt=B.data.length;return new ya(!0,kt>=1,kt>=2,le)}else if(Fe===vo){var ur=B.data;return new ya(ur.thisDep,ur.contextDep,ur.propDep,le)}else{if(Fe===Oo)return new ya(!1,!1,!1,le);if(Fe===Ia){for(var It=!1,tr=!1,dr=!1,_r=0;_r<B.data.length;++_r){var Sr=B.data[_r];if(Sr.type===Vn)dr=!0;else if(Sr.type===qi)tr=!0;else if(Sr.type===Li)It=!0;else if(Sr.type===Xn){It=!0;var Lr=Sr.data;Lr>=1&&(tr=!0),Lr>=2&&(dr=!0)}else Sr.type===vo&&(It=It||Sr.data.thisDep,tr=tr||Sr.data.contextDep,dr=dr||Sr.data.propDep)}return new ya(It,tr,dr,le)}else return new ya(Fe===Li,Fe===qi,Fe===Vn,le)}}var Kp=new ya(!1,!1,!1,function(){});function $p(B,le,Fe,kt,ur,It,tr,dr,_r,Sr,Lr,kr,Dr,xr,Ar){var st=Sr.Record,Ut={add:32774,subtract:32778,"reverse subtract":32779};Fe.ext_blend_minmax&&(Ut.min=tp,Ut.max=Xp);var wr=Fe.angle_instanced_arrays,Ur=Fe.webgl_draw_buffers,fr=Fe.oes_vertex_array_object,Nr={dirty:!0,profile:Ar.profile},Jr={},Fn=[],rr={},ar={};function _n(Se){return Se.replace(".","_")}function Xr(Se,ce,Ge){var ct=_n(Se);Fn.push(Se),Jr[ct]=Nr[ct]=!!Ge,rr[ct]=ce}function Tr(Se,ce,Ge){var ct=_n(Se);Fn.push(Se),Array.isArray(Ge)?(Nr[ct]=Ge.slice(),Jr[ct]=Ge.slice()):Nr[ct]=Jr[ct]=Ge,ar[ct]=ce}Xr(mo,ep),Xr(zs,Fc),Tr(xs,"blendColor",[0,0,0,0]),Tr($u,"blendEquationSeparate",[df,df]),Tr(rs,"blendFuncSeparate",[uc,rp,uc,rp]),Xr(Eo,ph,!0),Tr(su,"depthFunc",el),Tr(Lc,"depthRange",[0,1]),Tr(nc,"depthMask",!0),Tr(As,As,[!0,!0,!0,!0]),Xr(Ju,Pd),Tr(Qu,"cullFace",Ht),Tr(qs,qs,yh),Tr(vl,vl,1),Xr(Us,dh),Tr(io,"polygonOffset",[0,0]),Xr(yu,vh),Xr(Iu,Nf),Tr(_u,"sampleCoverage",[1,!1]),Xr(na,Lo),Tr(Zs,"stencilMask",-1),Tr(ns,"stencilFunc",[Yp,0,-1]),Tr(is,"stencilOpSeparate",[gl,xu,xu,xu]),Tr(ic,"stencilOpSeparate",[Ht,xu,xu,xu]),Xr(kc,Hp),Tr(of,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Tr(Ks,Ks,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Yr={gl:B,context:Dr,strings:le,next:Jr,current:Nr,draw:kr,elements:It,buffer:ur,shader:Lr,attributes:Sr.state,vao:Sr,uniforms:_r,framebuffer:dr,extensions:Fe,timer:xr,isBufferArgs:vf},Qr={primTypes:lr,compareFuncs:lc,blendFuncs:tl,blendEquations:Ut,stencilOps:cc,glTypes:nu,orientationType:_h};me.optional(function(){Yr.isArrayLike=ha}),Ur&&(Qr.backBuffer=[Ht],Qr.drawBuffer=Ve(kt.maxDrawbuffers,function(Se){return Se===0?[0]:Ve(Se,function(ce){return qp+ce})}));var vi=0;function ni(){var Se=ai(),ce=Se.link,Ge=Se.global;Se.id=vi++,Se.batchId="0";var ct=ce(Yr),Pt=Se.shared={props:"a0"};Object.keys(Yr).forEach(function(Ze){Pt[Ze]=Ge.def(ct,".",Ze)}),me.optional(function(){Se.CHECK=ce(me),Se.commandStr=me.guessCommand(),Se.command=ce(Se.commandStr),Se.assert=function(Ze,Ce,ft){Ze("if(!(",Ce,"))",this.CHECK,".commandRaise(",ce(ft),",",this.command,");")},Qr.invalidBlendCombinations=Bc});var Je=Se.next={},Be=Se.current={};Object.keys(ar).forEach(function(Ze){Array.isArray(Nr[Ze])&&(Je[Ze]=Ge.def(Pt.next,".",Ze),Be[Ze]=Ge.def(Pt.current,".",Ze))});var nt=Se.constants={};Object.keys(Qr).forEach(function(Ze){nt[Ze]=Ge.def(JSON.stringify(Qr[Ze]))}),Se.invoke=function(Ze,Ce){switch(Ce.type){case Xn:var ft=["this",Pt.context,Pt.props,Se.batchId];return Ze.def(ce(Ce.data),".call(",ft.slice(0,Math.max(Ce.data.length+1,4)),")");case Vn:return Ze.def(Pt.props,Ce.data);case qi:return Ze.def(Pt.context,Ce.data);case Li:return Ze.def("this",Ce.data);case vo:return Ce.data.append(Se,Ze),Ce.data.ref;case Oo:return Ce.data.toString();case Ia:return Ce.data.map(function(Et){return Se.invoke(Ze,Et)})}},Se.attribCache={};var ye={};return Se.scopeAttrib=function(Ze){var Ce=le.id(Ze);if(Ce in ye)return ye[Ce];var ft=Sr.scope[Ce];ft||(ft=Sr.scope[Ce]=new st);var Et=ye[Ce]=ce(ft);return Et},Se}function qr(Se){var ce=Se.static,Ge=Se.dynamic,ct;if(ac in ce){var Pt=!!ce[ac];ct=ko(function(Be,nt){return Pt}),ct.enable=Pt}else if(ac in Ge){var Je=Ge[ac];ct=Js(Je,function(Be,nt){return Be.invoke(nt,Je)})}return ct}function an(Se,ce){var Ge=Se.static,ct=Se.dynamic;if(uu in Ge){var Pt=Ge[uu];return Pt?(Pt=dr.getFramebuffer(Pt),me.command(Pt,"invalid framebuffer object"),ko(function(Be,nt){var ye=Be.link(Pt),Ze=Be.shared;nt.set(Ze.framebuffer,".next",ye);var Ce=Ze.context;return nt.set(Ce,"."+oc,ye+".width"),nt.set(Ce,"."+lf,ye+".height"),ye})):ko(function(Be,nt){var ye=Be.shared;nt.set(ye.framebuffer,".next","null");var Ze=ye.context;return nt.set(Ze,"."+oc,Ze+"."+cf),nt.set(Ze,"."+lf,Ze+"."+Jh),"null"})}else if(uu in ct){var Je=ct[uu];return Js(Je,function(Be,nt){var ye=Be.invoke(nt,Je),Ze=Be.shared,Ce=Ze.framebuffer,ft=nt.def(Ce,".getFramebuffer(",ye,")");me.optional(function(){Be.assert(nt,"!"+ye+"||"+ft,"invalid framebuffer object")}),nt.set(Ce,".next",ft);var Et=Ze.context;return nt.set(Et,"."+oc,ft+"?"+ft+".width:"+Et+"."+cf),nt.set(Et,"."+lf,ft+"?"+ft+".height:"+Et+"."+Jh),ft})}else return null}function Yn(Se,ce,Ge){var ct=Se.static,Pt=Se.dynamic;function Je(ye){if(ye in ct){var Ze=ct[ye];me.commandType(Ze,"object","invalid "+ye,Ge.commandStr);var Ce=!0,ft=Ze.x|0,Et=Ze.y|0,pr,Zr;return"width"in Ze?(pr=Ze.width|0,me.command(pr>=0,"invalid "+ye,Ge.commandStr)):Ce=!1,"height"in Ze?(Zr=Ze.height|0,me.command(Zr>=0,"invalid "+ye,Ge.commandStr)):Ce=!1,new ya(!Ce&&ce&&ce.thisDep,!Ce&&ce&&ce.contextDep,!Ce&&ce&&ce.propDep,function($t,hr){var un=$t.shared.context,Sn=pr;"width"in Ze||(Sn=hr.def(un,".",oc,"-",ft));var xn=Zr;return"height"in Ze||(xn=hr.def(un,".",lf,"-",Et)),[ft,Et,Sn,xn]})}else if(ye in Pt){var jr=Pt[ye],tn=Js(jr,function($t,hr){var un=$t.invoke(hr,jr);me.optional(function(){$t.assert(hr,un+"&&typeof "+un+'==="object"',"invalid "+ye)});var Sn=$t.shared.context,xn=hr.def(un,".x|0"),gn=hr.def(un,".y|0"),Kn=hr.def('"width" in ',un,"?",un,".width|0:","(",Sn,".",oc,"-",xn,")"),Ta=hr.def('"height" in ',un,"?",un,".height|0:","(",Sn,".",lf,"-",gn,")");return me.optional(function(){$t.assert(hr,Kn+">=0&&"+Ta+">=0","invalid "+ye)}),[xn,gn,Kn,Ta]});return ce&&(tn.thisDep=tn.thisDep||ce.thisDep,tn.contextDep=tn.contextDep||ce.contextDep,tn.propDep=tn.propDep||ce.propDep),tn}else return ce?new ya(ce.thisDep,ce.contextDep,ce.propDep,function($t,hr){var un=$t.shared.context;return[0,0,hr.def(un,".",oc),hr.def(un,".",lf)]}):null}var Be=Je(Ks);if(Be){var nt=Be;Be=new ya(Be.thisDep,Be.contextDep,Be.propDep,function(ye,Ze){var Ce=nt.append(ye,Ze),ft=ye.shared.context;return Ze.set(ft,"."+Ff,Ce[2]),Ze.set(ft,"."+jp,Ce[3]),Ce})}return{viewport:Be,scissor_box:Je(of)}}function ci(Se,ce){var Ge=Se.static,ct=typeof Ge[Rl]=="string"&&typeof Ge[ml]=="string";if(ct){if(Object.keys(ce.dynamic).length>0)return null;var Pt=ce.static,Je=Object.keys(Pt);if(Je.length>0&&typeof Pt[Je[0]]=="number"){for(var Be=[],nt=0;nt<Je.length;++nt)me(typeof Pt[Je[nt]]=="number","must specify all vertex attribute locations when using vaos"),Be.push([Pt[Je[nt]]|0,Je[nt]]);return Be}}return null}function Ui(Se,ce,Ge){var ct=Se.static,Pt=Se.dynamic;function Je(Ce){if(Ce in ct){var ft=le.id(ct[Ce]);me.optional(function(){Lr.shader(ip[Ce],ft,me.guessCommand())});var Et=ko(function(){return ft});return Et.id=ft,Et}else if(Ce in Pt){var pr=Pt[Ce];return Js(pr,function(Zr,jr){var tn=Zr.invoke(jr,pr),$t=jr.def(Zr.shared.strings,".id(",tn,")");return me.optional(function(){jr(Zr.shared.shader,".shader(",ip[Ce],",",$t,",",Zr.command,");")}),$t})}return null}var Be=Je(Rl),nt=Je(ml),ye=null,Ze;return fc(Be)&&fc(nt)?(ye=Lr.program(nt.id,Be.id,null,Ge),Ze=ko(function(Ce,ft){return Ce.link(ye)})):Ze=new ya(Be&&Be.thisDep||nt&&nt.thisDep,Be&&Be.contextDep||nt&&nt.contextDep,Be&&Be.propDep||nt&&nt.propDep,function(Ce,ft){var Et=Ce.shared.shader,pr;Be?pr=Be.append(Ce,ft):pr=ft.def(Et,".",Rl);var Zr;nt?Zr=nt.append(Ce,ft):Zr=ft.def(Et,".",ml);var jr=Et+".program("+Zr+","+pr;return me.optional(function(){jr+=","+Ce.command}),ft.def(jr+")")}),{frag:Be,vert:nt,progVar:Ze,program:ye}}function ao(Se,ce){var Ge=Se.static,ct=Se.dynamic,Pt={},Je=!1;function Be(){if(uf in Ge){var hr=Ge[uf];return hr!==null&&Sr.getVAO(hr)===null&&(hr=Sr.createVAO(hr)),Je=!0,Pt.vao=hr,ko(function(Sn){var xn=Sr.getVAO(hr);return xn?Sn.link(xn):"null"})}else if(uf in ct){Je=!0;var un=ct[uf];return Js(un,function(Sn,xn){var gn=Sn.invoke(xn,un);return xn.def(Sn.shared.vao+".getVAO("+gn+")")})}return null}var nt=Be(),ye=!1;function Ze(){if(Ro in Ge){var hr=Ge[Ro];if(Pt.elements=hr,vf(hr)){var un=Pt.elements=It.create(hr,!0);hr=It.getElements(un),ye=!0}else hr&&(hr=It.getElements(hr),ye=!0,me.command(hr,"invalid elements",ce.commandStr));var Sn=ko(function(gn,Kn){if(hr){var Ta=gn.link(hr);return gn.ELEMENTS=Ta,Ta}return gn.ELEMENTS=null,null});return Sn.value=hr,Sn}else if(Ro in ct){ye=!0;var xn=ct[Ro];return Js(xn,function(gn,Kn){var Ta=gn.shared,gs=Ta.isBufferArgs,Ua=Ta.elements,_a=gn.invoke(Kn,xn),Nl=Kn.def("null"),js=Kn.def(gs,"(",_a,")"),yl=gn.cond(js).then(Nl,"=",Ua,".createStream(",_a,");").else(Nl,"=",Ua,".getElements(",_a,");");return me.optional(function(){gn.assert(yl.else,"!"+_a+"||"+Nl,"invalid elements")}),Kn.entry(yl),Kn.exit(gn.cond(js).then(Ua,".destroyStream(",Nl,");")),gn.ELEMENTS=Nl,Nl})}else if(Je)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(gn,Kn){return Kn.def(gn.shared.vao+".currentVAO?"+gn.shared.elements+".getElements("+gn.shared.vao+".currentVAO.elements):null")});return null}var Ce=Ze();function ft(){if(Uo in Ge){var hr=Ge[Uo];return Pt.primitive=hr,me.commandParameter(hr,lr,"invalid primitve",ce.commandStr),ko(function(Sn,xn){return lr[hr]})}else if(Uo in ct){var un=ct[Uo];return Js(un,function(Sn,xn){var gn=Sn.constants.primTypes,Kn=Sn.invoke(xn,un);return me.optional(function(){Sn.assert(xn,Kn+" in "+gn,"invalid primitive, must be one of "+Object.keys(lr))}),xn.def(gn,"[",Kn,"]")})}else{if(ye)return fc(Ce)?Ce.value?ko(function(Sn,xn){return xn.def(Sn.ELEMENTS,".primType")}):ko(function(){return Gr}):new ya(Ce.thisDep,Ce.contextDep,Ce.propDep,function(Sn,xn){var gn=Sn.ELEMENTS;return xn.def(gn,"?",gn,".primType:",Gr)});if(Je)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(Sn,xn){return xn.def(Sn.shared.vao+".currentVAO?"+Sn.shared.vao+".currentVAO.primitive:"+Gr)})}return null}function Et(hr,un){if(hr in Ge){var Sn=Ge[hr]|0;return un?Pt.offset=Sn:Pt.instances=Sn,me.command(!un||Sn>=0,"invalid "+hr,ce.commandStr),ko(function(gn,Kn){return un&&(gn.OFFSET=Sn),Sn})}else if(hr in ct){var xn=ct[hr];return Js(xn,function(gn,Kn){var Ta=gn.invoke(Kn,xn);return un&&(gn.OFFSET=Ta,me.optional(function(){gn.assert(Kn,Ta+">=0","invalid "+hr)})),Ta})}else if(un){if(ye)return ko(function(gn,Kn){return gn.OFFSET=0,0});if(Je)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(gn,Kn){return Kn.def(gn.shared.vao+".currentVAO?"+gn.shared.vao+".currentVAO.offset:0")})}else if(Je)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(gn,Kn){return Kn.def(gn.shared.vao+".currentVAO?"+gn.shared.vao+".currentVAO.instances:-1")});return null}var pr=Et(sf,!0);function Zr(){if(Dc in Ge){var hr=Ge[Dc]|0;return Pt.count=hr,me.command(typeof hr=="number"&&hr>=0,"invalid vertex count",ce.commandStr),ko(function(){return hr})}else if(Dc in ct){var un=ct[Dc];return Js(un,function(Kn,Ta){var gs=Kn.invoke(Ta,un);return me.optional(function(){Kn.assert(Ta,"typeof "+gs+'==="number"&&'+gs+">=0&&"+gs+"===("+gs+"|0)","invalid vertex count")}),gs})}else if(ye)if(fc(Ce)){if(Ce)return pr?new ya(pr.thisDep,pr.contextDep,pr.propDep,function(Kn,Ta){var gs=Ta.def(Kn.ELEMENTS,".vertCount-",Kn.OFFSET);return me.optional(function(){Kn.assert(Ta,gs+">=0","invalid vertex offset/element buffer too small")}),gs}):ko(function(Kn,Ta){return Ta.def(Kn.ELEMENTS,".vertCount")});var Sn=ko(function(){return-1});return me.optional(function(){Sn.MISSING=!0}),Sn}else{var xn=new ya(Ce.thisDep||pr.thisDep,Ce.contextDep||pr.contextDep,Ce.propDep||pr.propDep,function(Kn,Ta){var gs=Kn.ELEMENTS;return Kn.OFFSET?Ta.def(gs,"?",gs,".vertCount-",Kn.OFFSET,":-1"):Ta.def(gs,"?",gs,".vertCount:-1")});return me.optional(function(){xn.DYNAMIC=!0}),xn}else if(Je){var gn=new ya(nt.thisDep,nt.contextDep,nt.propDep,function(Kn,Ta){return Ta.def(Kn.shared.vao,".currentVAO?",Kn.shared.vao,".currentVAO.count:-1")});return gn}return null}var jr=ft(),tn=Zr(),$t=Et(Df,!1);return{elements:Ce,primitive:jr,count:tn,instances:$t,offset:pr,vao:nt,vaoActive:Je,elementsActive:ye,static:Pt}}function oo(Se,ce){var Ge=Se.static,ct=Se.dynamic,Pt={};return Fn.forEach(function(Je){var Be=_n(Je);function nt(ye,Ze){if(Je in Ge){var Ce=ye(Ge[Je]);Pt[Be]=ko(function(){return Ce})}else if(Je in ct){var ft=ct[Je];Pt[Be]=Js(ft,function(Et,pr){return Ze(Et,pr,Et.invoke(pr,ft))})}}switch(Je){case Ju:case zs:case mo:case na:case Eo:case kc:case Us:case yu:case Iu:case nc:return nt(function(ye){return me.commandType(ye,"boolean",Je,ce.commandStr),ye},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,"typeof "+Ce+'==="boolean"',"invalid flag "+Je,ye.commandStr)}),Ce});case su:return nt(function(ye){return me.commandParameter(ye,lc,"invalid "+Je,ce.commandStr),lc[ye]},function(ye,Ze,Ce){var ft=ye.constants.compareFuncs;return me.optional(function(){ye.assert(Ze,Ce+" in "+ft,"invalid "+Je+", must be one of "+Object.keys(lc))}),Ze.def(ft,"[",Ce,"]")});case Lc:return nt(function(ye){return me.command(ha(ye)&&ye.length===2&&typeof ye[0]=="number"&&typeof ye[1]=="number"&&ye[0]<=ye[1],"depth range is 2d array",ce.commandStr),ye},function(ye,Ze,Ce){me.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var ft=Ze.def("+",Ce,"[0]"),Et=Ze.def("+",Ce,"[1]");return[ft,Et]});case rs:return nt(function(ye){me.commandType(ye,"object","blend.func",ce.commandStr);var Ze="srcRGB"in ye?ye.srcRGB:ye.src,Ce="srcAlpha"in ye?ye.srcAlpha:ye.src,ft="dstRGB"in ye?ye.dstRGB:ye.dst,Et="dstAlpha"in ye?ye.dstAlpha:ye.dst;return me.commandParameter(Ze,tl,Be+".srcRGB",ce.commandStr),me.commandParameter(Ce,tl,Be+".srcAlpha",ce.commandStr),me.commandParameter(ft,tl,Be+".dstRGB",ce.commandStr),me.commandParameter(Et,tl,Be+".dstAlpha",ce.commandStr),me.command(Bc.indexOf(Ze+", "+ft)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+ft+")",ce.commandStr),[tl[Ze],tl[ft],tl[Ce],tl[Et]]},function(ye,Ze,Ce){var ft=ye.constants.blendFuncs;me.optional(function(){ye.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function Et(un,Sn){var xn=Ze.def('"',un,Sn,'" in ',Ce,"?",Ce,".",un,Sn,":",Ce,".",un);return me.optional(function(){ye.assert(Ze,xn+" in "+ft,"invalid "+Je+"."+un+Sn+", must be one of "+Object.keys(tl))}),xn}var pr=Et("src","RGB"),Zr=Et("dst","RGB");me.optional(function(){var un=ye.constants.invalidBlendCombinations;ye.assert(Ze,un+".indexOf("+pr+'+", "+'+Zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var jr=Ze.def(ft,"[",pr,"]"),tn=Ze.def(ft,"[",Et("src","Alpha"),"]"),$t=Ze.def(ft,"[",Zr,"]"),hr=Ze.def(ft,"[",Et("dst","Alpha"),"]");return[jr,$t,tn,hr]});case $u:return nt(function(ye){if(typeof ye=="string")return me.commandParameter(ye,Ut,"invalid "+Je,ce.commandStr),[Ut[ye],Ut[ye]];if(typeof ye=="object")return me.commandParameter(ye.rgb,Ut,Je+".rgb",ce.commandStr),me.commandParameter(ye.alpha,Ut,Je+".alpha",ce.commandStr),[Ut[ye.rgb],Ut[ye.alpha]];me.commandRaise("invalid blend.equation",ce.commandStr)},function(ye,Ze,Ce){var ft=ye.constants.blendEquations,Et=Ze.def(),pr=Ze.def(),Zr=ye.cond("typeof ",Ce,'==="string"');return me.optional(function(){function jr(tn,$t,hr){ye.assert(tn,hr+" in "+ft,"invalid "+$t+", must be one of "+Object.keys(Ut))}jr(Zr.then,Je,Ce),ye.assert(Zr.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+Je),jr(Zr.else,Je+".rgb",Ce+".rgb"),jr(Zr.else,Je+".alpha",Ce+".alpha")}),Zr.then(Et,"=",pr,"=",ft,"[",Ce,"];"),Zr.else(Et,"=",ft,"[",Ce,".rgb];",pr,"=",ft,"[",Ce,".alpha];"),Ze(Zr),[Et,pr]});case xs:return nt(function(ye){return me.command(ha(ye)&&ye.length===4,"blend.color must be a 4d array",ce.commandStr),Ve(4,function(Ze){return+ye[Ze]})},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),Ve(4,function(ft){return Ze.def("+",Ce,"[",ft,"]")})});case Zs:return nt(function(ye){return me.commandType(ye,"number",Be,ce.commandStr),ye|0},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),Ze.def(Ce,"|0")});case ns:return nt(function(ye){me.commandType(ye,"object",Be,ce.commandStr);var Ze=ye.cmp||"keep",Ce=ye.ref||0,ft="mask"in ye?ye.mask:-1;return me.commandParameter(Ze,lc,Je+".cmp",ce.commandStr),me.commandType(Ce,"number",Je+".ref",ce.commandStr),me.commandType(ft,"number",Je+".mask",ce.commandStr),[lc[Ze],Ce,ft]},function(ye,Ze,Ce){var ft=ye.constants.compareFuncs;me.optional(function(){function jr(){ye.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}jr(Ce+"&&typeof ",Ce,'==="object"'),jr('!("cmp" in ',Ce,")||(",Ce,".cmp in ",ft,")")});var Et=Ze.def('"cmp" in ',Ce,"?",ft,"[",Ce,".cmp]",":",xu),pr=Ze.def(Ce,".ref|0"),Zr=Ze.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[Et,pr,Zr]});case is:case ic:return nt(function(ye){me.commandType(ye,"object",Be,ce.commandStr);var Ze=ye.fail||"keep",Ce=ye.zfail||"keep",ft=ye.zpass||"keep";return me.commandParameter(Ze,cc,Je+".fail",ce.commandStr),me.commandParameter(Ce,cc,Je+".zfail",ce.commandStr),me.commandParameter(ft,cc,Je+".zpass",ce.commandStr),[Je===ic?Ht:gl,cc[Ze],cc[Ce],cc[ft]]},function(ye,Ze,Ce){var ft=ye.constants.stencilOps;me.optional(function(){ye.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid "+Je)});function Et(pr){return me.optional(function(){ye.assert(Ze,'!("'+pr+'" in '+Ce+")||("+Ce+"."+pr+" in "+ft+")","invalid "+Je+"."+pr+", must be one of "+Object.keys(cc))}),Ze.def('"',pr,'" in ',Ce,"?",ft,"[",Ce,".",pr,"]:",xu)}return[Je===ic?Ht:gl,Et("fail"),Et("zfail"),Et("zpass")]});case io:return nt(function(ye){me.commandType(ye,"object",Be,ce.commandStr);var Ze=ye.factor|0,Ce=ye.units|0;return me.commandType(Ze,"number",Be+".factor",ce.commandStr),me.commandType(Ce,"number",Be+".units",ce.commandStr),[Ze,Ce]},function(ye,Ze,Ce){me.optional(function(){ye.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid "+Je)});var ft=Ze.def(Ce,".factor|0"),Et=Ze.def(Ce,".units|0");return[ft,Et]});case Qu:return nt(function(ye){var Ze=0;return ye==="front"?Ze=gl:ye==="back"&&(Ze=Ht),me.command(!!Ze,Be,ce.commandStr),Ze},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),Ze.def(Ce,'==="front"?',gl,":",Ht)});case vl:return nt(function(ye){return me.command(typeof ye=="number"&&ye>=kt.lineWidthDims[0]&&ye<=kt.lineWidthDims[1],"invalid line width, must be a positive number between "+kt.lineWidthDims[0]+" and "+kt.lineWidthDims[1],ce.commandStr),ye},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,"typeof "+Ce+'==="number"&&'+Ce+">="+kt.lineWidthDims[0]+"&&"+Ce+"<="+kt.lineWidthDims[1],"invalid line width")}),Ce});case qs:return nt(function(ye){return me.commandParameter(ye,_h,Be,ce.commandStr),_h[ye]},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Ce+'==="cw"?'+Wp+":"+yh)});case As:return nt(function(ye){return me.command(ha(ye)&&ye.length===4,"color.mask must be length 4 array",ce.commandStr),ye.map(function(Ze){return!!Ze})},function(ye,Ze,Ce){return me.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),Ve(4,function(ft){return"!!"+Ce+"["+ft+"]"})});case _u:return nt(function(ye){me.command(typeof ye=="object"&&ye,Be,ce.commandStr);var Ze="value"in ye?ye.value:1,Ce=!!ye.invert;return me.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ce.commandStr),[Ze,Ce]},function(ye,Ze,Ce){me.optional(function(){ye.assert(Ze,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var ft=Ze.def('"value" in ',Ce,"?+",Ce,".value:1"),Et=Ze.def("!!",Ce,".invert");return[ft,Et]})}}),Pt}function Ni(Se,ce){var Ge=Se.static,ct=Se.dynamic,Pt={};return Object.keys(Ge).forEach(function(Je){var Be=Ge[Je],nt;if(typeof Be=="number"||typeof Be=="boolean")nt=ko(function(){return Be});else if(typeof Be=="function"){var ye=Be._reglType;ye==="texture2d"||ye==="textureCube"?nt=ko(function(Ze){return Ze.link(Be)}):ye==="framebuffer"||ye==="framebufferCube"?(me.command(Be.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Je+'"',ce.commandStr),nt=ko(function(Ze){return Ze.link(Be.color[0])})):me.commandRaise('invalid data for uniform "'+Je+'"',ce.commandStr)}else ha(Be)?nt=ko(function(Ze){var Ce=Ze.global.def("[",Ve(Be.length,function(ft){return me.command(typeof Be[ft]=="number"||typeof Be[ft]=="boolean","invalid uniform "+Je,Ze.commandStr),Be[ft]}),"]");return Ce}):me.commandRaise('invalid or missing data for uniform "'+Je+'"',ce.commandStr);nt.value=Be,Pt[Je]=nt}),Object.keys(ct).forEach(function(Je){var Be=ct[Je];Pt[Je]=Js(Be,function(nt,ye){return nt.invoke(ye,Be)})}),Pt}function as(Se,ce){var Ge=Se.static,ct=Se.dynamic,Pt={};return Object.keys(Ge).forEach(function(Je){var Be=Ge[Je],nt=le.id(Je),ye=new st;if(vf(Be))ye.state=jn,ye.buffer=ur.getBuffer(ur.create(Be,ff,!1,!0)),ye.type=0;else{var Ze=ur.getBuffer(Be);if(Ze)ye.state=jn,ye.buffer=Ze,ye.type=0;else if(me.command(typeof Be=="object"&&Be,"invalid data for attribute "+Je,ce.commandStr),"constant"in Be){var Ce=Be.constant;ye.buffer="null",ye.state=pi,typeof Ce=="number"?ye.x=Ce:(me.command(ha(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+Je,ce.commandStr),ri.forEach(function($t,hr){hr<Ce.length&&(ye[$t]=Ce[hr])}))}else{vf(Be.buffer)?Ze=ur.getBuffer(ur.create(Be.buffer,ff,!1,!0)):Ze=ur.getBuffer(Be.buffer),me.command(!!Ze,'missing buffer for attribute "'+Je+'"',ce.commandStr);var ft=Be.offset|0;me.command(ft>=0,'invalid offset for attribute "'+Je+'"',ce.commandStr);var Et=Be.stride|0;me.command(Et>=0&&Et<256,'invalid stride for attribute "'+Je+'", must be integer betweeen [0, 255]',ce.commandStr);var pr=Be.size|0;me.command(!("size"in Be)||pr>0&&pr<=4,'invalid size for attribute "'+Je+'", must be 1,2,3,4',ce.commandStr);var Zr=!!Be.normalized,jr=0;"type"in Be&&(me.commandParameter(Be.type,nu,"invalid type for attribute "+Je,ce.commandStr),jr=nu[Be.type]);var tn=Be.divisor|0;me.optional(function(){"divisor"in Be&&(me.command(tn===0||wr,'cannot specify divisor for attribute "'+Je+'", instancing not supported',ce.commandStr),me.command(tn>=0,'invalid divisor for attribute "'+Je+'"',ce.commandStr));var $t=ce.commandStr,hr=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Be).forEach(function(un){me.command(hr.indexOf(un)>=0,'unknown parameter "'+un+'" for attribute pointer "'+Je+'" (valid parameters are '+hr+")",$t)})}),ye.buffer=Ze,ye.state=jn,ye.size=pr,ye.normalized=Zr,ye.type=jr||Ze.dtype,ye.offset=ft,ye.stride=Et,ye.divisor=tn}}Pt[Je]=ko(function($t,hr){var un=$t.attribCache;if(nt in un)return un[nt];var Sn={isStream:!1};return Object.keys(ye).forEach(function(xn){Sn[xn]=ye[xn]}),ye.buffer&&(Sn.buffer=$t.link(ye.buffer),Sn.type=Sn.type||Sn.buffer+".dtype"),un[nt]=Sn,Sn})}),Object.keys(ct).forEach(function(Je){var Be=ct[Je];function nt(ye,Ze){var Ce=ye.invoke(Ze,Be),ft=ye.shared,Et=ye.constants,pr=ft.isBufferArgs,Zr=ft.buffer;me.optional(function(){ye.assert(Ze,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+pr+"("+Ce+")||"+Zr+".getBuffer("+Ce+")||"+Zr+".getBuffer("+Ce+".buffer)||"+pr+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+ft.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+Je+'"')});var jr={isStream:Ze.def(!1)},tn=new st;tn.state=jn,Object.keys(tn).forEach(function(Sn){jr[Sn]=Ze.def(""+tn[Sn])});var $t=jr.buffer,hr=jr.type;Ze("if(",pr,"(",Ce,")){",jr.isStream,"=true;",$t,"=",Zr,".createStream(",ff,",",Ce,");",hr,"=",$t,".dtype;","}else{",$t,"=",Zr,".getBuffer(",Ce,");","if(",$t,"){",hr,"=",$t,".dtype;",'}else if("constant" in ',Ce,"){",jr.state,"=",pi,";","if(typeof "+Ce+'.constant === "number"){',jr[ri[0]],"=",Ce,".constant;",ri.slice(1).map(function(Sn){return jr[Sn]}).join("="),"=0;","}else{",ri.map(function(Sn,xn){return jr[Sn]+"="+Ce+".constant.length>"+xn+"?"+Ce+".constant["+xn+"]:0;"}).join(""),"}}else{","if(",pr,"(",Ce,".buffer)){",$t,"=",Zr,".createStream(",ff,",",Ce,".buffer);","}else{",$t,"=",Zr,".getBuffer(",Ce,".buffer);","}",hr,'="type" in ',Ce,"?",Et.glTypes,"[",Ce,".type]:",$t,".dtype;",jr.normalized,"=!!",Ce,".normalized;");function un(Sn){Ze(jr[Sn],"=",Ce,".",Sn,"|0;")}return un("size"),un("offset"),un("stride"),un("divisor"),Ze("}}"),Ze.exit("if(",jr.isStream,"){",Zr,".destroyStream(",$t,");","}"),jr}Pt[Je]=Js(Be,nt)}),Pt}function Wa(Se){var ce=Se.static,Ge=Se.dynamic,ct={};return Object.keys(ce).forEach(function(Pt){var Je=ce[Pt];ct[Pt]=ko(function(Be,nt){return typeof Je=="number"||typeof Je=="boolean"?""+Je:Be.link(Je)})}),Object.keys(Ge).forEach(function(Pt){var Je=Ge[Pt];ct[Pt]=Js(Je,function(Be,nt){return Be.invoke(nt,Je)})}),ct}function Ko(Se,ce,Ge,ct,Pt){var Je=Se.static,Be=Se.dynamic;me.optional(function(){var un=[uu,ml,Rl,Ro,Uo,sf,Dc,Df,ac,uf].concat(Fn);function Sn(xn){Object.keys(xn).forEach(function(gn){me.command(un.indexOf(gn)>=0,'unknown parameter "'+gn+'"',Pt.commandStr)})}Sn(Je),Sn(Be)});var nt=ci(Se,ce),ye=an(Se,Pt),Ze=Yn(Se,ye,Pt),Ce=ao(Se,Pt),ft=oo(Se,Pt),Et=Ui(Se,Pt,nt);function pr(un){var Sn=Ze[un];Sn&&(ft[un]=Sn)}pr(Ks),pr(_n(of));var Zr=Object.keys(ft).length>0,jr={framebuffer:ye,draw:Ce,shader:Et,state:ft,dirty:Zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(jr.profile=qr(Se,Pt),jr.uniforms=Ni(Ge,Pt),jr.drawVAO=jr.scopeVAO=Ce.vao,!jr.drawVAO&&Et.program&&!nt&&Fe.angle_instanced_arrays&&Ce.static.elements){var tn=!0,$t=Et.program.attributes.map(function(un){var Sn=ce.static[un];return tn=tn&&!!Sn,Sn});if(tn&&$t.length>0){var hr=Sr.getVAO(Sr.createVAO({attributes:$t,elements:Ce.static.elements}));jr.drawVAO=new ya(null,null,null,function(un,Sn){return un.link(hr)}),jr.useVAO=!0}}return nt?jr.useVAO=!0:jr.attributes=as(ce,Pt),jr.context=Wa(ct,Pt),jr}function So(Se,ce,Ge){var ct=Se.shared,Pt=ct.context,Je=Se.scope();Object.keys(Ge).forEach(function(Be){ce.save(Pt,"."+Be);var nt=Ge[Be],ye=nt.append(Se,ce);Array.isArray(ye)?Je(Pt,".",Be,"=[",ye.join(),"];"):Je(Pt,".",Be,"=",ye,";")}),ce(Je)}function $o(Se,ce,Ge,ct){var Pt=Se.shared,Je=Pt.gl,Be=Pt.framebuffer,nt;Ur&&(nt=ce.def(Pt.extensions,".webgl_draw_buffers"));var ye=Se.constants,Ze=ye.drawBuffer,Ce=ye.backBuffer,ft;Ge?ft=Ge.append(Se,ce):ft=ce.def(Be,".next"),ct||ce("if(",ft,"!==",Be,".cur){"),ce("if(",ft,"){",Je,".bindFramebuffer(",np,",",ft,".framebuffer);"),Ur&&ce(nt,".drawBuffersWEBGL(",Ze,"[",ft,".colorAttachments.length]);"),ce("}else{",Je,".bindFramebuffer(",np,",null);"),Ur&&ce(nt,".drawBuffersWEBGL(",Ce,");"),ce("}",Be,".cur=",ft,";"),ct||ce("}")}function Zo(Se,ce,Ge){var ct=Se.shared,Pt=ct.gl,Je=Se.current,Be=Se.next,nt=ct.current,ye=ct.next,Ze=Se.cond(nt,".dirty");Fn.forEach(function(Ce){var ft=_n(Ce);if(!(ft in Ge.state)){var Et,pr;if(ft in Be){Et=Be[ft],pr=Je[ft];var Zr=Ve(Nr[ft].length,function(tn){return Ze.def(Et,"[",tn,"]")});Ze(Se.cond(Zr.map(function(tn,$t){return tn+"!=="+pr+"["+$t+"]"}).join("||")).then(Pt,".",ar[ft],"(",Zr,");",Zr.map(function(tn,$t){return pr+"["+$t+"]="+tn}).join(";"),";"))}else{Et=Ze.def(ye,".",ft);var jr=Se.cond(Et,"!==",nt,".",ft);Ze(jr),ft in rr?jr(Se.cond(Et).then(Pt,".enable(",rr[ft],");").else(Pt,".disable(",rr[ft],");"),nt,".",ft,"=",Et,";"):jr(Pt,".",ar[ft],"(",Et,");",nt,".",ft,"=",Et,";")}}}),Object.keys(Ge.state).length===0&&Ze(nt,".dirty=false;"),ce(Ze)}function os(Se,ce,Ge,ct){var Pt=Se.shared,Je=Se.current,Be=Pt.current,nt=Pt.gl;ap(Object.keys(Ge)).forEach(function(ye){var Ze=Ge[ye];if(!(ct&&!ct(Ze))){var Ce=Ze.append(Se,ce);if(rr[ye]){var ft=rr[ye];fc(Ze)?Ce?ce(nt,".enable(",ft,");"):ce(nt,".disable(",ft,");"):ce(Se.cond(Ce).then(nt,".enable(",ft,");").else(nt,".disable(",ft,");")),ce(Be,".",ye,"=",Ce,";")}else if(ha(Ce)){var Et=Je[ye];ce(nt,".",ar[ye],"(",Ce,");",Ce.map(function(pr,Zr){return Et+"["+Zr+"]="+pr}).join(";"),";")}else ce(nt,".",ar[ye],"(",Ce,");",Be,".",ye,"=",Ce,";")}})}function co(Se,ce){wr&&(Se.instancing=ce.def(Se.shared.extensions,".angle_instanced_arrays"))}function mi(Se,ce,Ge,ct,Pt){var Je=Se.shared,Be=Se.stats,nt=Je.current,ye=Je.timer,Ze=Ge.profile;function Ce(){var un=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return un||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ft,Et;function pr(un){ft=ce.def(),un(ft,"=",Ce(),";"),typeof Pt=="string"?un(Be,".count+=",Pt,";"):un(Be,".count++;"),xr&&(ct?(Et=ce.def(),un(Et,"=",ye,".getNumPendingQueries();")):un(ye,".beginQuery(",Be,");"))}function Zr(un){un(Be,".cpuTime+=",Ce(),"-",ft,";"),xr&&(ct?un(ye,".pushScopeStats(",Et,",",ye,".getNumPendingQueries(),",Be,");"):un(ye,".endQuery();"))}function jr(un){var Sn=ce.def(nt,".profile");ce(nt,".profile=",un,";"),ce.exit(nt,".profile=",Sn,";")}var tn;if(Ze){if(fc(Ze)){Ze.enable?(pr(ce),Zr(ce.exit),jr("true")):jr("false");return}tn=Ze.append(Se,ce),jr(tn)}else tn=ce.def(nt,".profile");var $t=Se.block();pr($t),ce("if(",tn,"){",$t,"}");var hr=Se.block();Zr(hr),ce.exit("if(",tn,"){",hr,"}")}function jo(Se,ce,Ge,ct,Pt){var Je=Se.shared;function Be(ye){switch(ye){case Bf:case Uf:case jf:return 2;case sc:case Dl:case Nc:return 3;case hf:case mh:case pf:return 4;default:return 1}}function nt(ye,Ze,Ce){var ft=Je.gl,Et=ce.def(ye,".location"),pr=ce.def(Je.attributes,"[",Et,"]"),Zr=Ce.state,jr=Ce.buffer,tn=[Ce.x,Ce.y,Ce.z,Ce.w],$t=["buffer","normalized","offset","stride"];function hr(){ce("if(!",pr,".buffer){",ft,".enableVertexAttribArray(",Et,");}");var Sn=Ce.type,xn;if(Ce.size?xn=ce.def(Ce.size,"||",Ze):xn=Ze,ce("if(",pr,".type!==",Sn,"||",pr,".size!==",xn,"||",$t.map(function(Kn){return pr+"."+Kn+"!=="+Ce[Kn]}).join("||"),"){",ft,".bindBuffer(",ff,",",jr,".buffer);",ft,".vertexAttribPointer(",[Et,xn,Sn,Ce.normalized,Ce.stride,Ce.offset],");",pr,".type=",Sn,";",pr,".size=",xn,";",$t.map(function(Kn){return pr+"."+Kn+"="+Ce[Kn]+";"}).join(""),"}"),wr){var gn=Ce.divisor;ce("if(",pr,".divisor!==",gn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[Et,gn],");",pr,".divisor=",gn,";}")}}function un(){ce("if(",pr,".buffer){",ft,".disableVertexAttribArray(",Et,");",pr,".buffer=null;","}if(",ri.map(function(Sn,xn){return pr+"."+Sn+"!=="+tn[xn]}).join("||"),"){",ft,".vertexAttrib4f(",Et,",",tn,");",ri.map(function(Sn,xn){return pr+"."+Sn+"="+tn[xn]+";"}).join(""),"}")}Zr===jn?hr():Zr===pi?un():(ce("if(",Zr,"===",jn,"){"),hr(),ce("}else{"),un(),ce("}"))}ct.forEach(function(ye){var Ze=ye.name,Ce=Ge.attributes[Ze],ft;if(Ce){if(!Pt(Ce))return;ft=Ce.append(Se,ce)}else{if(!Pt(Kp))return;var Et=Se.scopeAttrib(Ze);me.optional(function(){Se.assert(ce,Et+".state","missing attribute "+Ze)}),ft={},Object.keys(new st).forEach(function(pr){ft[pr]=ce.def(Et,".",pr)})}nt(Se.link(ye),Be(ye.info.type),ft)})}function ea(Se,ce,Ge,ct,Pt,Je){for(var Be=Se.shared,nt=Be.gl,ye,Ze=0;Ze<ct.length;++Ze){var Ce=ct[Ze],ft=Ce.name,Et=Ce.info.type,pr=Ge.uniforms[ft],Zr=Se.link(Ce),jr=Zr+".location",tn;if(pr){if(!Pt(pr))continue;if(fc(pr)){var $t=pr.value;if(me.command($t!==null&&typeof $t!="undefined",'missing uniform "'+ft+'"',Se.commandStr),Et===Hf||Et===gh){me.command(typeof $t=="function"&&(Et===Hf&&($t._reglType==="texture2d"||$t._reglType==="framebuffer")||Et===gh&&($t._reglType==="textureCube"||$t._reglType==="framebufferCube")),"invalid texture for uniform "+ft,Se.commandStr);var hr=Se.link($t._texture||$t.color[0]._texture);ce(nt,".uniform1i(",jr,",",hr+".bind());"),ce.exit(hr,".unbind();")}else if(Et===$s||Et===Vf||Et===Gf){me.optional(function(){me.command(ha($t),"invalid matrix for uniform "+ft,Se.commandStr),me.command(Et===$s&&$t.length===4||Et===Vf&&$t.length===9||Et===Gf&&$t.length===16,"invalid length for matrix uniform "+ft,Se.commandStr)});var un=Se.global.def("new Float32Array(["+Array.prototype.slice.call($t)+"])"),Sn=2;Et===Vf?Sn=3:Et===Gf&&(Sn=4),ce(nt,".uniformMatrix",Sn,"fv(",jr,",false,",un,");")}else{switch(Et){case kl:me.commandType($t,"number","uniform "+ft,Se.commandStr),ye="1f";break;case Bf:me.command(ha($t)&&$t.length===2,"uniform "+ft,Se.commandStr),ye="2f";break;case sc:me.command(ha($t)&&$t.length===3,"uniform "+ft,Se.commandStr),ye="3f";break;case hf:me.command(ha($t)&&$t.length===4,"uniform "+ft,Se.commandStr),ye="4f";break;case Zf:me.commandType($t,"boolean","uniform "+ft,Se.commandStr),ye="1i";break;case zf:me.commandType($t,"number","uniform "+ft,Se.commandStr),ye="1i";break;case jf:me.command(ha($t)&&$t.length===2,"uniform "+ft,Se.commandStr),ye="2i";break;case Uf:me.command(ha($t)&&$t.length===2,"uniform "+ft,Se.commandStr),ye="2i";break;case Nc:me.command(ha($t)&&$t.length===3,"uniform "+ft,Se.commandStr),ye="3i";break;case Dl:me.command(ha($t)&&$t.length===3,"uniform "+ft,Se.commandStr),ye="3i";break;case pf:me.command(ha($t)&&$t.length===4,"uniform "+ft,Se.commandStr),ye="4i";break;case mh:me.command(ha($t)&&$t.length===4,"uniform "+ft,Se.commandStr),ye="4i";break}ce(nt,".uniform",ye,"(",jr,",",ha($t)?Array.prototype.slice.call($t):$t,");")}continue}else tn=pr.append(Se,ce)}else{if(!Pt(Kp))continue;tn=ce.def(Be.uniforms,"[",le.id(ft),"]")}Et===Hf?(me(!Array.isArray(tn),"must specify a scalar prop for textures"),ce("if(",tn,"&&",tn,'._reglType==="framebuffer"){',tn,"=",tn,".color[0];","}")):Et===gh&&(me(!Array.isArray(tn),"must specify a scalar prop for cube maps"),ce("if(",tn,"&&",tn,'._reglType==="framebufferCube"){',tn,"=",tn,".color[0];","}")),me.optional(function(){function js(bu,zc){Se.assert(ce,bu,'bad data or missing for uniform "'+ft+'".  '+zc)}function yl(bu){me(!Array.isArray(tn),"must not specify an array type for uniform"),js("typeof "+tn+'==="'+bu+'"',"invalid type, expected "+bu)}function Ou(bu,zc){Array.isArray(tn)?me(tn.length===bu,"must have length "+bu):js(Be.isArrayLike+"("+tn+")&&"+tn+".length==="+bu,"invalid vector, should have length "+bu,Se.commandStr)}function td(bu){me(!Array.isArray(tn),"must not specify a value type"),js("typeof "+tn+'==="function"&&'+tn+'._reglType==="texture'+(bu===Gp?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(Et){case zf:yl("number");break;case Uf:Ou(2,"number");break;case Dl:Ou(3,"number");break;case mh:Ou(4,"number");break;case kl:yl("number");break;case Bf:Ou(2,"number");break;case sc:Ou(3,"number");break;case hf:Ou(4,"number");break;case Zf:yl("boolean");break;case jf:Ou(2,"boolean");break;case Nc:Ou(3,"boolean");break;case pf:Ou(4,"boolean");break;case $s:Ou(4,"number");break;case Vf:Ou(9,"number");break;case Gf:Ou(16,"number");break;case Hf:td(Gp);break;case gh:td(hh);break}});var xn=1;switch(Et){case Hf:case gh:var gn=ce.def(tn,"._texture");ce(nt,".uniform1i(",jr,",",gn,".bind());"),ce.exit(gn,".unbind();");continue;case zf:case Zf:ye="1i";break;case Uf:case jf:ye="2i",xn=2;break;case Dl:case Nc:ye="3i",xn=3;break;case mh:case pf:ye="4i",xn=4;break;case kl:ye="1f";break;case Bf:ye="2f",xn=2;break;case sc:ye="3f",xn=3;break;case hf:ye="4f",xn=4;break;case $s:ye="Matrix2fv";break;case Vf:ye="Matrix3fv";break;case Gf:ye="Matrix4fv";break}if(ye.charAt(0)==="M"){ce(nt,".uniform",ye,"(",jr,",");var Kn=Math.pow(Et-$s+2,2),Ta=Se.global.def("new Float32Array(",Kn,")");Array.isArray(tn)?ce("false,(",Ve(Kn,function(js){return Ta+"["+js+"]="+tn[js]}),",",Ta,")"):ce("false,(Array.isArray(",tn,")||",tn," instanceof Float32Array)?",tn,":(",Ve(Kn,function(js){return Ta+"["+js+"]="+tn+"["+js+"]"}),",",Ta,")"),ce(");")}else if(xn>1){for(var gs=[],Ua=[],_a=0;_a<xn;++_a)Array.isArray(tn)?Ua.push(tn[_a]):Ua.push(ce.def(tn+"["+_a+"]")),Je&&gs.push(ce.def());Je&&ce("if(!",Se.batchId,"||",gs.map(function(js,yl){return js+"!=="+Ua[yl]}).join("||"),"){",gs.map(function(js,yl){return js+"="+Ua[yl]+";"}).join("")),ce(nt,".uniform",ye,"(",jr,",",Ua.join(","),");"),Je&&ce("}")}else{if(me(!Array.isArray(tn),"uniform value must not be an array"),Je){var Nl=ce.def();ce("if(!",Se.batchId,"||",Nl,"!==",tn,"){",Nl,"=",tn,";")}ce(nt,".uniform",ye,"(",jr,",",tn,");"),Je&&ce("}")}}}function ss(Se,ce,Ge,ct){var Pt=Se.shared,Je=Pt.gl,Be=Pt.draw,nt=ct.draw;function ye(){var xn=nt.elements,gn,Kn=ce;return xn?((xn.contextDep&&ct.contextDynamic||xn.propDep)&&(Kn=Ge),gn=xn.append(Se,Kn),nt.elementsActive&&Kn("if("+gn+")"+Je+".bindBuffer("+Qh+","+gn+".buffer.buffer);")):(gn=Kn.def(),Kn(gn,"=",Be,".",Ro,";","if(",gn,"){",Je,".bindBuffer(",Qh,",",gn,".buffer.buffer);}","else if(",Pt.vao,".currentVAO){",gn,"=",Se.shared.elements+".getElements("+Pt.vao,".currentVAO.elements);",fr?"":"if("+gn+")"+Je+".bindBuffer("+Qh+","+gn+".buffer.buffer);","}")),gn}function Ze(){var xn=nt.count,gn,Kn=ce;return xn?((xn.contextDep&&ct.contextDynamic||xn.propDep)&&(Kn=Ge),gn=xn.append(Se,Kn),me.optional(function(){xn.MISSING&&Se.assert(ce,"false","missing vertex count"),xn.DYNAMIC&&Se.assert(Kn,gn+">=0","missing vertex count")})):(gn=Kn.def(Be,".",Dc),me.optional(function(){Se.assert(Kn,gn+">=0","missing vertex count")})),gn}var Ce=ye();function ft(xn){var gn=nt[xn];return gn?gn.contextDep&&ct.contextDynamic||gn.propDep?gn.append(Se,Ge):gn.append(Se,ce):ce.def(Be,".",xn)}var Et=ft(Uo),pr=ft(sf),Zr=Ze();if(typeof Zr=="number"){if(Zr===0)return}else Ge("if(",Zr,"){"),Ge.exit("}");var jr,tn;wr&&(jr=ft(Df),tn=Se.instancing);var $t=Ce+".type",hr=nt.elements&&fc(nt.elements)&&!nt.vaoActive;function un(){function xn(){Ge(tn,".drawElementsInstancedANGLE(",[Et,Zr,$t,pr+"<<(("+$t+"-"+qn+")>>1)",jr],");")}function gn(){Ge(tn,".drawArraysInstancedANGLE(",[Et,pr,Zr,jr],");")}Ce&&Ce!=="null"?hr?xn():(Ge("if(",Ce,"){"),xn(),Ge("}else{"),gn(),Ge("}")):gn()}function Sn(){function xn(){Ge(Je+".drawElements("+[Et,Zr,$t,pr+"<<(("+$t+"-"+qn+")>>1)"]+");")}function gn(){Ge(Je+".drawArrays("+[Et,pr,Zr]+");")}Ce&&Ce!=="null"?hr?xn():(Ge("if(",Ce,"){"),xn(),Ge("}else{"),gn(),Ge("}")):gn()}wr&&(typeof jr!="number"||jr>=0)?typeof jr=="string"?(Ge("if(",jr,">0){"),un(),Ge("}else if(",jr,"<0){"),Sn(),Ge("}")):un():Sn()}function Qn(Se,ce,Ge,ct,Pt){var Je=ni(),Be=Je.proc("body",Pt);return me.optional(function(){Je.commandStr=ce.commandStr,Je.command=Je.link(ce.commandStr)}),wr&&(Je.instancing=Be.def(Je.shared.extensions,".angle_instanced_arrays")),Se(Je,Be,Ge,ct),Je.compile().body}function ki(Se,ce,Ge,ct){co(Se,ce),Ge.useVAO?Ge.drawVAO?ce(Se.shared.vao,".setVAO(",Ge.drawVAO.append(Se,ce),");"):ce(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ce(Se.shared.vao,".setVAO(null);"),jo(Se,ce,Ge,ct.attributes,function(){return!0})),ea(Se,ce,Ge,ct.uniforms,function(){return!0},!1),ss(Se,ce,ce,Ge)}function la(Se,ce){var Ge=Se.proc("draw",1);co(Se,Ge),So(Se,Ge,ce.context),$o(Se,Ge,ce.framebuffer),Zo(Se,Ge,ce),os(Se,Ge,ce.state),mi(Se,Ge,ce,!1,!0);var ct=ce.shader.progVar.append(Se,Ge);if(Ge(Se.shared.gl,".useProgram(",ct,".program);"),ce.shader.program)ki(Se,Ge,ce,ce.shader.program);else{Ge(Se.shared.vao,".setVAO(null);");var Pt=Se.global.def("{}"),Je=Ge.def(ct,".id"),Be=Ge.def(Pt,"[",Je,"]");Ge(Se.cond(Be).then(Be,".call(this,a0);").else(Be,"=",Pt,"[",Je,"]=",Se.link(function(nt){return Qn(ki,Se,ce,nt,1)}),"(",ct,");",Be,".call(this,a0);"))}Object.keys(ce.state).length>0&&Ge(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ge(Se.shared.vao,".setVAO(null);")}function wo(Se,ce,Ge,ct){Se.batchId="a1",co(Se,ce);function Pt(){return!0}jo(Se,ce,Ge,ct.attributes,Pt),ea(Se,ce,Ge,ct.uniforms,Pt,!1),ss(Se,ce,ce,Ge)}function rl(Se,ce,Ge,ct){co(Se,ce);var Pt=Ge.contextDep,Je=ce.def(),Be="a0",nt="a1",ye=ce.def();Se.shared.props=ye,Se.batchId=Je;var Ze=Se.scope(),Ce=Se.scope();ce(Ze.entry,"for(",Je,"=0;",Je,"<",nt,";++",Je,"){",ye,"=",Be,"[",Je,"];",Ce,"}",Ze.exit);function ft($t){return $t.contextDep&&Pt||$t.propDep}function Et($t){return!ft($t)}if(Ge.needsContext&&So(Se,Ce,Ge.context),Ge.needsFramebuffer&&$o(Se,Ce,Ge.framebuffer),os(Se,Ce,Ge.state,ft),Ge.profile&&ft(Ge.profile)&&mi(Se,Ce,Ge,!1,!0),ct)Ge.useVAO?Ge.drawVAO?ft(Ge.drawVAO)?Ce(Se.shared.vao,".setVAO(",Ge.drawVAO.append(Se,Ce),");"):Ze(Se.shared.vao,".setVAO(",Ge.drawVAO.append(Se,Ze),");"):Ze(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(Ze(Se.shared.vao,".setVAO(null);"),jo(Se,Ze,Ge,ct.attributes,Et),jo(Se,Ce,Ge,ct.attributes,ft)),ea(Se,Ze,Ge,ct.uniforms,Et,!1),ea(Se,Ce,Ge,ct.uniforms,ft,!0),ss(Se,Ze,Ce,Ge);else{var pr=Se.global.def("{}"),Zr=Ge.shader.progVar.append(Se,Ce),jr=Ce.def(Zr,".id"),tn=Ce.def(pr,"[",jr,"]");Ce(Se.shared.gl,".useProgram(",Zr,".program);","if(!",tn,"){",tn,"=",pr,"[",jr,"]=",Se.link(function($t){return Qn(wo,Se,Ge,$t,2)}),"(",Zr,");}",tn,".call(this,a0[",Je,"],",Je,");")}}function Pe(Se,ce){var Ge=Se.proc("batch",2);Se.batchId="0",co(Se,Ge);var ct=!1,Pt=!0;Object.keys(ce.context).forEach(function(pr){ct=ct||ce.context[pr].propDep}),ct||(So(Se,Ge,ce.context),Pt=!1);var Je=ce.framebuffer,Be=!1;Je?(Je.propDep?ct=Be=!0:Je.contextDep&&ct&&(Be=!0),Be||$o(Se,Ge,Je)):$o(Se,Ge,null),ce.state.viewport&&ce.state.viewport.propDep&&(ct=!0);function nt(pr){return pr.contextDep&&ct||pr.propDep}Zo(Se,Ge,ce),os(Se,Ge,ce.state,function(pr){return!nt(pr)}),(!ce.profile||!nt(ce.profile))&&mi(Se,Ge,ce,!1,"a1"),ce.contextDep=ct,ce.needsContext=Pt,ce.needsFramebuffer=Be;var ye=ce.shader.progVar;if(ye.contextDep&&ct||ye.propDep)rl(Se,Ge,ce,null);else{var Ze=ye.append(Se,Ge);if(Ge(Se.shared.gl,".useProgram(",Ze,".program);"),ce.shader.program)rl(Se,Ge,ce,ce.shader.program);else{Ge(Se.shared.vao,".setVAO(null);");var Ce=Se.global.def("{}"),ft=Ge.def(Ze,".id"),Et=Ge.def(Ce,"[",ft,"]");Ge(Se.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",Ce,"[",ft,"]=",Se.link(function(pr){return Qn(rl,Se,ce,pr,2)}),"(",Ze,");",Et,".call(this,a0,a1);"))}}Object.keys(ce.state).length>0&&Ge(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ge(Se.shared.vao,".setVAO(null);")}function Bt(Se,ce){var Ge=Se.proc("scope",3);Se.batchId="a2";var ct=Se.shared,Pt=ct.current;So(Se,Ge,ce.context),ce.framebuffer&&ce.framebuffer.append(Se,Ge),ap(Object.keys(ce.state)).forEach(function(Be){var nt=ce.state[Be],ye=nt.append(Se,Ge);ha(ye)?ye.forEach(function(Ze,Ce){Ge.set(Se.next[Be],"["+Ce+"]",Ze)}):Ge.set(ct.next,"."+Be,ye)}),mi(Se,Ge,ce,!0,!0),[Ro,sf,Dc,Df,Uo].forEach(function(Be){var nt=ce.draw[Be];!nt||Ge.set(ct.draw,"."+Be,""+nt.append(Se,Ge))}),Object.keys(ce.uniforms).forEach(function(Be){var nt=ce.uniforms[Be].append(Se,Ge);Array.isArray(nt)&&(nt="["+nt.join()+"]"),Ge.set(ct.uniforms,"["+le.id(Be)+"]",nt)}),Object.keys(ce.attributes).forEach(function(Be){var nt=ce.attributes[Be].append(Se,Ge),ye=Se.scopeAttrib(Be);Object.keys(new st).forEach(function(Ze){Ge.set(ye,"."+Ze,nt[Ze])})}),ce.scopeVAO&&Ge.set(ct.vao,".targetVAO",ce.scopeVAO.append(Se,Ge));function Je(Be){var nt=ce.shader[Be];nt&&Ge.set(ct.shader,"."+Be,nt.append(Se,Ge))}Je(ml),Je(Rl),Object.keys(ce.state).length>0&&(Ge(Pt,".dirty=true;"),Ge.exit(Pt,".dirty=true;")),Ge("a1(",Se.shared.context,",a0,",Se.batchId,");")}function wt(Se){if(!(typeof Se!="object"||ha(Se))){for(var ce=Object.keys(Se),Ge=0;Ge<ce.length;++Ge)if(nn.isDynamic(Se[ce[Ge]]))return!0;return!1}}function pn(Se,ce,Ge){var ct=ce.static[Ge];if(!ct||!wt(ct))return;var Pt=Se.global,Je=Object.keys(ct),Be=!1,nt=!1,ye=!1,Ze=Se.global.def("{}");Je.forEach(function(ft){var Et=ct[ft];if(nn.isDynamic(Et)){typeof Et=="function"&&(Et=ct[ft]=nn.unbox(Et));var pr=Js(Et,null);Be=Be||pr.thisDep,ye=ye||pr.propDep,nt=nt||pr.contextDep}else{switch(Pt(Ze,".",ft,"="),typeof Et){case"number":Pt(Et);break;case"string":Pt('"',Et,'"');break;case"object":Array.isArray(Et)&&Pt("[",Et.join(),"]");break;default:Pt(Se.link(Et));break}Pt(";")}});function Ce(ft,Et){Je.forEach(function(pr){var Zr=ct[pr];if(!!nn.isDynamic(Zr)){var jr=ft.invoke(Et,Zr);Et(Ze,".",pr,"=",jr,";")}})}ce.dynamic[Ge]=new nn.DynamicVariable(vo,{thisDep:Be,contextDep:nt,propDep:ye,ref:Ze,append:Ce}),delete ce.static[Ge]}function Zi(Se,ce,Ge,ct,Pt){var Je=ni();Je.stats=Je.link(Pt),Object.keys(ce.static).forEach(function(nt){pn(Je,ce,nt)}),Vp.forEach(function(nt){pn(Je,Se,nt)});var Be=Ko(Se,ce,Ge,ct,Je);return la(Je,Be),Bt(Je,Be),Pe(Je,Be),v(Je.compile(),{destroy:function(){Be.shader.program.destroy()}})}return{next:Jr,current:Nr,procs:function(){var Se=ni(),ce=Se.proc("poll"),Ge=Se.proc("refresh"),ct=Se.block();ce(ct),Ge(ct);var Pt=Se.shared,Je=Pt.gl,Be=Pt.next,nt=Pt.current;ct(nt,".dirty=false;"),$o(Se,ce),$o(Se,Ge,null,!0);var ye;wr&&(ye=Se.link(wr)),Fe.oes_vertex_array_object&&Ge(Se.link(Fe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<kt.maxAttributes;++Ze){var Ce=Ge.def(Pt.attributes,"[",Ze,"]"),ft=Se.cond(Ce,".buffer");ft.then(Je,".enableVertexAttribArray(",Ze,");",Je,".bindBuffer(",ff,",",Ce,".buffer.buffer);",Je,".vertexAttribPointer(",Ze,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else(Je,".disableVertexAttribArray(",Ze,");",Je,".vertexAttrib4f(",Ze,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),Ge(ft),wr&&Ge(ye,".vertexAttribDivisorANGLE(",Ze,",",Ce,".divisor);")}return Ge(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(rr).forEach(function(Et){var pr=rr[Et],Zr=ct.def(Be,".",Et),jr=Se.block();jr("if(",Zr,"){",Je,".enable(",pr,")}else{",Je,".disable(",pr,")}",nt,".",Et,"=",Zr,";"),Ge(jr),ce("if(",Zr,"!==",nt,".",Et,"){",jr,"}")}),Object.keys(ar).forEach(function(Et){var pr=ar[Et],Zr=Nr[Et],jr,tn,$t=Se.block();if($t(Je,".",pr,"("),ha(Zr)){var hr=Zr.length;jr=Se.global.def(Be,".",Et),tn=Se.global.def(nt,".",Et),$t(Ve(hr,function(un){return jr+"["+un+"]"}),");",Ve(hr,function(un){return tn+"["+un+"]="+jr+"["+un+"];"}).join("")),ce("if(",Ve(hr,function(un){return jr+"["+un+"]!=="+tn+"["+un+"]"}).join("||"),"){",$t,"}")}else jr=ct.def(Be,".",Et),tn=ct.def(nt,".",Et),$t(jr,");",nt,".",Et,"=",jr,";"),ce("if(",jr,"!==",tn,"){",$t,"}");Ge($t)}),Se.compile()}(),compile:Zi}}function Jp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Id=34918,Qp=34919,op=35007,dv=function(B,le){if(!le.ext_disjoint_timer_query)return null;var Fe=[];function kt(){return Fe.pop()||le.ext_disjoint_timer_query.createQueryEXT()}function ur(wr){Fe.push(wr)}var It=[];function tr(wr){var Ur=kt();le.ext_disjoint_timer_query.beginQueryEXT(op,Ur),It.push(Ur),xr(It.length-1,It.length,wr)}function dr(){le.ext_disjoint_timer_query.endQueryEXT(op)}function _r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Sr=[];function Lr(){return Sr.pop()||new _r}function kr(wr){Sr.push(wr)}var Dr=[];function xr(wr,Ur,fr){var Nr=Lr();Nr.startQueryIndex=wr,Nr.endQueryIndex=Ur,Nr.sum=0,Nr.stats=fr,Dr.push(Nr)}var Ar=[],st=[];function Ut(){var wr,Ur,fr=It.length;if(fr!==0){st.length=Math.max(st.length,fr+1),Ar.length=Math.max(Ar.length,fr+1),Ar[0]=0,st[0]=0;var Nr=0;for(wr=0,Ur=0;Ur<It.length;++Ur){var Jr=It[Ur];le.ext_disjoint_timer_query.getQueryObjectEXT(Jr,Qp)?(Nr+=le.ext_disjoint_timer_query.getQueryObjectEXT(Jr,Id),ur(Jr)):It[wr++]=Jr,Ar[Ur+1]=Nr,st[Ur+1]=wr}for(It.length=wr,wr=0,Ur=0;Ur<Dr.length;++Ur){var Fn=Dr[Ur],rr=Fn.startQueryIndex,ar=Fn.endQueryIndex;Fn.sum+=Ar[ar]-Ar[rr];var _n=st[rr],Xr=st[ar];Xr===_n?(Fn.stats.gpuTime+=Fn.sum/1e6,kr(Fn)):(Fn.startQueryIndex=_n,Fn.endQueryIndex=Xr,Dr[wr++]=Fn)}Dr.length=wr}}return{beginQuery:tr,endQuery:dr,pushScopeStats:xr,update:Ut,getNumPendingQueries:function(){return It.length},clear:function(){Fe.push.apply(Fe,It);for(var wr=0;wr<Fe.length;wr++)le.ext_disjoint_timer_query.deleteQueryEXT(Fe[wr]);It.length=0,Fe.length=0},restore:function(){It.length=0,Fe.length=0}}},Od=16384,mf=256,sp=1024,ed=34962,gf="webglcontextlost",Oa="webglcontextrestored",up=1,Fl=2,yf=3;function xh(B,le){for(var Fe=0;Fe<B.length;++Fe)if(B[Fe]===le)return Fe;return-1}function Wf(B){var le=ge(B);if(!le)return null;var Fe=le.gl,kt=Fe.getContextAttributes(),ur=Fe.isContextLost(),It=Ie(Fe,le);if(!It)return null;var tr=hs(),dr=Jp(),_r=It.extensions,Sr=dv(Fe,_r),Lr=Ya(),kr=Fe.drawingBufferWidth,Dr=Fe.drawingBufferHeight,xr={tick:0,time:0,viewportWidth:kr,viewportHeight:Dr,framebufferWidth:kr,framebufferHeight:Dr,drawingBufferWidth:kr,drawingBufferHeight:Dr,pixelRatio:le.pixelRatio},Ar={},st={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ut=bc(Fe,_r),wr=N(Fe,dr,le,Nr),Ur=Vu(Fe,_r,wr,dr),fr=xt(Fe,_r,Ut,dr,wr,Ur,st);function Nr(Qn){return fr.destroyBuffer(Qn)}var Jr=zr(Fe,tr,dr,le),Fn=vs(Fe,_r,Ut,function(){_n.procs.poll()},xr,dr,le),rr=Ml(Fe,_r,Ut,dr,le),ar=Le(Fe,_r,Ut,Fn,rr,dr),_n=$p(Fe,tr,_r,Ut,wr,Ur,Fn,ar,Ar,fr,Jr,st,xr,Sr,le),Xr=Cn(Fe,ar,_n.procs.poll,xr,kt,_r,Ut),Tr=_n.next,Yr=Fe.canvas,Qr=[],vi=[],ni=[],qr=[le.onDestroy],an=null;function Yn(){if(Qr.length===0){Sr&&Sr.update(),an=null;return}an=Ti.next(Yn),co();for(var Qn=Qr.length-1;Qn>=0;--Qn){var ki=Qr[Qn];ki&&ki(xr,null,0)}Fe.flush(),Sr&&Sr.update()}function ci(){!an&&Qr.length>0&&(an=Ti.next(Yn))}function Ui(){an&&(Ti.cancel(Yn),an=null)}function ao(Qn){Qn.preventDefault(),ur=!0,Ui(),vi.forEach(function(ki){ki()})}function oo(Qn){Fe.getError(),ur=!1,It.restore(),Jr.restore(),wr.restore(),Fn.restore(),rr.restore(),ar.restore(),fr.restore(),Sr&&Sr.restore(),_n.procs.refresh(),ci(),ni.forEach(function(ki){ki()})}var Ni=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!Ni&&Yr&&(Yr.addEventListener(gf,ao,!1),Yr.addEventListener(Oa,oo,!1));function as(){Qr.length=0,Ui(),!Ni&&Yr&&(Yr.removeEventListener(gf,ao),Yr.removeEventListener(Oa,oo)),Jr.clear(),ar.clear(),rr.clear(),fr.clear(),Fn.clear(),Ur.clear(),wr.clear(),Sr&&Sr.clear(),qr.forEach(function(Qn){Qn()})}function Wa(Qn){me(!!Qn,"invalid args to regl({...})"),me.type(Qn,"object","invalid args to regl({...})");function ki(Je){var Be=v({},Je);delete Be.uniforms,delete Be.attributes,delete Be.context,delete Be.vao,"stencil"in Be&&Be.stencil.op&&(Be.stencil.opBack=Be.stencil.opFront=Be.stencil.op,delete Be.stencil.op);function nt(ye){if(ye in Be){var Ze=Be[ye];delete Be[ye],Object.keys(Ze).forEach(function(Ce){Be[ye+"."+Ce]=Ze[Ce]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in Je&&(Be.vao=Je.vao),Be}function la(Je,Be){var nt={},ye={};return Object.keys(Je).forEach(function(Ze){var Ce=Je[Ze];if(nn.isDynamic(Ce)){ye[Ze]=nn.unbox(Ce,Ze);return}else if(Be&&Array.isArray(Ce)){for(var ft=0;ft<Ce.length;++ft)if(nn.isDynamic(Ce[ft])){ye[Ze]=nn.unbox(Ce,Ze);return}}nt[Ze]=Ce}),{dynamic:ye,static:nt}}var wo=la(Qn.context||{},!0),rl=la(Qn.uniforms||{},!0),Pe=la(Qn.attributes||{},!1),Bt=la(ki(Qn),!1),wt={gpuTime:0,cpuTime:0,count:0},pn=_n.compile(Bt,Pe,rl,wo,wt),Zi=pn.draw,Se=pn.batch,ce=pn.scope,Ge=[];function ct(Je){for(;Ge.length<Je;)Ge.push(null);return Ge}function Pt(Je,Be){var nt;if(ur&&me.raise("context lost"),typeof Je=="function")return ce.call(this,null,Je,0);if(typeof Be=="function")if(typeof Je=="number")for(nt=0;nt<Je;++nt)ce.call(this,null,Be,nt);else if(Array.isArray(Je))for(nt=0;nt<Je.length;++nt)ce.call(this,Je[nt],Be,nt);else return ce.call(this,Je,Be,0);else if(typeof Je=="number"){if(Je>0)return Se.call(this,ct(Je|0),Je|0)}else if(Array.isArray(Je)){if(Je.length)return Se.call(this,Je,Je.length)}else return Zi.call(this,Je)}return v(Pt,{stats:wt,destroy:function(){pn.destroy()}})}var Ko=ar.setFBO=Wa({framebuffer:nn.define.call(null,up,"framebuffer")});function So(Qn,ki){var la=0;_n.procs.poll();var wo=ki.color;wo&&(Fe.clearColor(+wo[0]||0,+wo[1]||0,+wo[2]||0,+wo[3]||0),la|=Od),"depth"in ki&&(Fe.clearDepth(+ki.depth),la|=mf),"stencil"in ki&&(Fe.clearStencil(ki.stencil|0),la|=sp),me(!!la,"called regl.clear with no buffer specified"),Fe.clear(la)}function $o(Qn){if(me(typeof Qn=="object"&&Qn,"regl.clear() takes an object as input"),"framebuffer"in Qn)if(Qn.framebuffer&&Qn.framebuffer_reglType==="framebufferCube")for(var ki=0;ki<6;++ki)Ko(v({framebuffer:Qn.framebuffer.faces[ki]},Qn),So);else Ko(Qn,So);else So(null,Qn)}function Zo(Qn){me.type(Qn,"function","regl.frame() callback must be a function"),Qr.push(Qn);function ki(){var la=xh(Qr,Qn);me(la>=0,"cannot cancel a frame twice");function wo(){var rl=xh(Qr,wo);Qr[rl]=Qr[Qr.length-1],Qr.length-=1,Qr.length<=0&&Ui()}Qr[la]=wo}return ci(),{cancel:ki}}function os(){var Qn=Tr.viewport,ki=Tr.scissor_box;Qn[0]=Qn[1]=ki[0]=ki[1]=0,xr.viewportWidth=xr.framebufferWidth=xr.drawingBufferWidth=Qn[2]=ki[2]=Fe.drawingBufferWidth,xr.viewportHeight=xr.framebufferHeight=xr.drawingBufferHeight=Qn[3]=ki[3]=Fe.drawingBufferHeight}function co(){xr.tick+=1,xr.time=jo(),os(),_n.procs.poll()}function mi(){Fn.refresh(),os(),_n.procs.refresh(),Sr&&Sr.update()}function jo(){return(Ya()-Lr)/1e3}mi();function ea(Qn,ki){me.type(ki,"function","listener callback must be a function");var la;switch(Qn){case"frame":return Zo(ki);case"lost":la=vi;break;case"restore":la=ni;break;case"destroy":la=qr;break;default:me.raise("invalid event, must be one of frame,lost,restore,destroy")}return la.push(ki),{cancel:function(){for(var wo=0;wo<la.length;++wo)if(la[wo]===ki){la[wo]=la[la.length-1],la.pop();return}}}}var ss=v(Wa,{clear:$o,prop:nn.define.bind(null,up),context:nn.define.bind(null,Fl),this:nn.define.bind(null,yf),draw:Wa({}),buffer:function(Qn){return wr.create(Qn,ed,!1,!1)},elements:function(Qn){return Ur.create(Qn,!1)},texture:Fn.create2D,cube:Fn.createCube,renderbuffer:rr.create,framebuffer:ar.create,framebufferCube:ar.createCube,vao:fr.createVAO,attributes:kt,frame:Zo,on:ea,limits:Ut,hasExtension:function(Qn){return Ut.extensions.indexOf(Qn.toLowerCase())>=0},read:Xr,destroy:as,_gl:Fe,_refresh:mi,poll:function(){co(),Sr&&Sr.update()},now:jo,stats:dr});return le.onDone(null,ss),ss}return Wf})},58380:function(Ue){function H(R,Y,$){switch($.length){case 0:return R.call(Y);case 1:return R.call(Y,$[0]);case 2:return R.call(Y,$[0],$[1]);case 3:return R.call(Y,$[0],$[1],$[2])}return R.apply(Y,$)}Ue.exports=H},77412:function(Ue){function H(R,Y){for(var $=-1,v=R==null?0:R.length;++$<v&&Y(R[$],$,R)!==!1;);return R}Ue.exports=H},47443:function(Ue,H,R){var Y=R(42118);function $(v,ee){var F=v==null?0:v.length;return!!F&&Y(v,ee,0)>-1}Ue.exports=$},1196:function(Ue){function H(R,Y,$){for(var v=-1,ee=R==null?0:R.length;++v<ee;)if($(Y,R[v]))return!0;return!1}Ue.exports=H},29932:function(Ue){function H(R,Y){for(var $=-1,v=R==null?0:R.length,ee=Array(v);++$<v;)ee[$]=Y(R[$],$,R);return ee}Ue.exports=H},62663:function(Ue){function H(R,Y,$,v){var ee=-1,F=R==null?0:R.length;for(v&&F&&($=R[++ee]);++ee<F;)$=Y($,R[ee],ee,R);return $}Ue.exports=H},49029:function(Ue){var H=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function R(Y){return Y.match(H)||[]}Ue.exports=R},86556:function(Ue,H,R){var Y=R(89465),$=R(77813);function v(ee,F,J){(J!==void 0&&!$(ee[F],J)||J===void 0&&!(F in ee))&&Y(ee,F,J)}Ue.exports=v},34865:function(Ue,H,R){var Y=R(89465),$=R(77813),v=Object.prototype,ee=v.hasOwnProperty;function F(J,re,Ee){var ne=J[re];(!(ee.call(J,re)&&$(ne,Ee))||Ee===void 0&&!(re in J))&&Y(J,re,Ee)}Ue.exports=F},44037:function(Ue,H,R){var Y=R(98363),$=R(3674);function v(ee,F){return ee&&Y(F,$(F),ee)}Ue.exports=v},63886:function(Ue,H,R){var Y=R(98363),$=R(81704);function v(ee,F){return ee&&Y(F,$(F),ee)}Ue.exports=v},89465:function(Ue,H,R){var Y=R(38777);function $(v,ee,F){ee=="__proto__"&&Y?Y(v,ee,{configurable:!0,enumerable:!0,value:F,writable:!0}):v[ee]=F}Ue.exports=$},29750:function(Ue){function H(R,Y,$){return R===R&&($!==void 0&&(R=R<=$?R:$),Y!==void 0&&(R=R>=Y?R:Y)),R}Ue.exports=H},85990:function(Ue,H,R){var Y=R(46384),$=R(77412),v=R(34865),ee=R(44037),F=R(63886),J=R(64626),re=R(278),Ee=R(18805),ne=R(1911),je=R(58234),we=R(46904),et=R(64160),Mt=R(43824),nr=R(29148),_t=R(38517),Xt=R(1469),Ct=R(44144),ot=R(56688),ut=R(13218),Jt=R(72928),X=R(3674),Yt=R(81704),dt=1,qe=2,ht=4,$e="[object Arguments]",Rt="[object Array]",yr="[object Boolean]",Rr="[object Date]",Hr="[object Error]",Te="[object Function]",Ye="[object GeneratorFunction]",ke="[object Map]",At="[object Number]",gt="[object Object]",Ft="[object RegExp]",qt="[object Set]",Cr="[object String]",Hn="[object Symbol]",hn="[object WeakMap]",Ki="[object ArrayBuffer]",Bn="[object DataView]",Gn="[object Float32Array]",hi="[object Float64Array]",Wn="[object Int8Array]",si="[object Int16Array]",aa="[object Int32Array]",Ri="[object Uint8Array]",Si="[object Uint8ClampedArray]",Vi="[object Uint16Array]",ua="[object Uint32Array]",wi={};wi[$e]=wi[Rt]=wi[Ki]=wi[Bn]=wi[yr]=wi[Rr]=wi[Gn]=wi[hi]=wi[Wn]=wi[si]=wi[aa]=wi[ke]=wi[At]=wi[gt]=wi[Ft]=wi[qt]=wi[Cr]=wi[Hn]=wi[Ri]=wi[Si]=wi[Vi]=wi[ua]=!0,wi[Hr]=wi[Te]=wi[hn]=!1;function xa(An,yi,zi,$i,ja,me){var Ln,Va=yi&dt,fs=yi&qe,zt=yi&ht;if(zi&&(Ln=ja?zi(An,$i,ja,me):zi(An)),Ln!==void 0)return Ln;if(!ut(An))return An;var ir=Xt(An);if(ir){if(Ln=Mt(An),!Va)return re(An,Ln)}else{var Ir=et(An),I=Ir==Te||Ir==Ye;if(Ct(An))return J(An,Va);if(Ir==gt||Ir==$e||I&&!ja){if(Ln=fs||I?{}:_t(An),!Va)return fs?ne(An,F(Ln,An)):Ee(An,ee(Ln,An))}else{if(!wi[Ir])return ja?An:{};Ln=nr(An,Ir,Va)}}me||(me=new Y);var sr=me.get(An);if(sr)return sr;me.set(An,Ln),Jt(An)?An.forEach(function(Zn){Ln.add(xa(Zn,yi,zi,Zn,An,me))}):ot(An)&&An.forEach(function(Zn,nn){Ln.set(nn,xa(Zn,yi,zi,nn,An,me))});var On=zt?fs?we:je:fs?Yt:X,ui=ir?void 0:On(An);return $(ui||An,function(Zn,nn){ui&&(nn=Zn,Zn=An[nn]),v(Ln,nn,xa(Zn,yi,zi,nn,An,me))}),Ln}Ue.exports=xa},3118:function(Ue,H,R){var Y=R(13218),$=Object.create,v=function(){function ee(){}return function(F){if(!Y(F))return{};if($)return $(F);ee.prototype=F;var J=new ee;return ee.prototype=void 0,J}}();Ue.exports=v},41848:function(Ue){function H(R,Y,$,v){for(var ee=R.length,F=$+(v?1:-1);v?F--:++F<ee;)if(Y(R[F],F,R))return F;return-1}Ue.exports=H},28483:function(Ue,H,R){var Y=R(25063),$=Y();Ue.exports=$},42118:function(Ue,H,R){var Y=R(41848),$=R(62722),v=R(42351);function ee(F,J,re){return J===J?v(F,J,re):Y(F,$,re)}Ue.exports=ee},25588:function(Ue,H,R){var Y=R(64160),$=R(37005),v="[object Map]";function ee(F){return $(F)&&Y(F)==v}Ue.exports=ee},62722:function(Ue){function H(R){return R!==R}Ue.exports=H},29221:function(Ue,H,R){var Y=R(64160),$=R(37005),v="[object Set]";function ee(F){return $(F)&&Y(F)==v}Ue.exports=ee},10313:function(Ue,H,R){var Y=R(13218),$=R(25726),v=R(33498),ee=Object.prototype,F=ee.hasOwnProperty;function J(re){if(!Y(re))return v(re);var Ee=$(re),ne=[];for(var je in re)je=="constructor"&&(Ee||!F.call(re,je))||ne.push(je);return ne}Ue.exports=J},42980:function(Ue,H,R){var Y=R(46384),$=R(86556),v=R(28483),ee=R(59783),F=R(13218),J=R(81704),re=R(36390);function Ee(ne,je,we,et,Mt){ne!==je&&v(je,function(nr,_t){if(Mt||(Mt=new Y),F(nr))ee(ne,je,_t,we,Ee,et,Mt);else{var Xt=et?et(re(ne,_t),nr,_t+"",ne,je,Mt):void 0;Xt===void 0&&(Xt=nr),$(ne,_t,Xt)}},J)}Ue.exports=Ee},59783:function(Ue,H,R){var Y=R(86556),$=R(64626),v=R(77133),ee=R(278),F=R(38517),J=R(35694),re=R(1469),Ee=R(29246),ne=R(44144),je=R(23560),we=R(13218),et=R(68630),Mt=R(36719),nr=R(36390),_t=R(59881);function Xt(Ct,ot,ut,Jt,X,Yt,dt){var qe=nr(Ct,ut),ht=nr(ot,ut),$e=dt.get(ht);if($e){Y(Ct,ut,$e);return}var Rt=Yt?Yt(qe,ht,ut+"",Ct,ot,dt):void 0,yr=Rt===void 0;if(yr){var Rr=re(ht),Hr=!Rr&&ne(ht),Te=!Rr&&!Hr&&Mt(ht);Rt=ht,Rr||Hr||Te?re(qe)?Rt=qe:Ee(qe)?Rt=ee(qe):Hr?(yr=!1,Rt=$(ht,!0)):Te?(yr=!1,Rt=v(ht,!0)):Rt=[]:et(ht)||J(ht)?(Rt=qe,J(qe)?Rt=_t(qe):(!we(qe)||je(qe))&&(Rt=F(ht))):yr=!1}yr&&(dt.set(ht,Rt),X(Rt,ht,Jt,Yt,dt),dt.delete(ht)),Y(Ct,ut,Rt)}Ue.exports=Xt},40371:function(Ue){function H(R){return function(Y){return Y==null?void 0:Y[R]}}Ue.exports=H},18674:function(Ue){function H(R){return function(Y){return R==null?void 0:R[Y]}}Ue.exports=H},5976:function(Ue,H,R){var Y=R(6557),$=R(45357),v=R(30061);function ee(F,J){return v($(F,J,Y),F+"")}Ue.exports=ee},56560:function(Ue,H,R){var Y=R(75703),$=R(38777),v=R(6557),ee=$?function(F,J){return $(F,"toString",{configurable:!0,enumerable:!1,value:Y(J),writable:!0})}:v;Ue.exports=ee},80531:function(Ue,H,R){var Y=R(62705),$=R(29932),v=R(1469),ee=R(33448),F=1/0,J=Y?Y.prototype:void 0,re=J?J.toString:void 0;function Ee(ne){if(typeof ne=="string")return ne;if(v(ne))return $(ne,Ee)+"";if(ee(ne))return re?re.call(ne):"";var je=ne+"";return je=="0"&&1/ne==-F?"-0":je}Ue.exports=Ee},45652:function(Ue,H,R){var Y=R(88668),$=R(47443),v=R(1196),ee=R(74757),F=R(23593),J=R(21814),re=200;function Ee(ne,je,we){var et=-1,Mt=$,nr=ne.length,_t=!0,Xt=[],Ct=Xt;if(we)_t=!1,Mt=v;else if(nr>=re){var ot=je?null:F(ne);if(ot)return J(ot);_t=!1,Mt=ee,Ct=new Y}else Ct=je?[]:Xt;e:for(;++et<nr;){var ut=ne[et],Jt=je?je(ut):ut;if(ut=we||ut!==0?ut:0,_t&&Jt===Jt){for(var X=Ct.length;X--;)if(Ct[X]===Jt)continue e;je&&Ct.push(Jt),Xt.push(ut)}else Mt(Ct,Jt,we)||(Ct!==Xt&&Ct.push(Jt),Xt.push(ut))}return Xt}Ue.exports=Ee},74318:function(Ue,H,R){var Y=R(11149);function $(v){var ee=new v.constructor(v.byteLength);return new Y(ee).set(new Y(v)),ee}Ue.exports=$},64626:function(Ue,H,R){Ue=R.nmd(Ue);var Y=R(55639),$=H&&!H.nodeType&&H,v=$&&!0&&Ue&&!Ue.nodeType&&Ue,ee=v&&v.exports===$,F=ee?Y.Buffer:void 0,J=F?F.allocUnsafe:void 0;function re(Ee,ne){if(ne)return Ee.slice();var je=Ee.length,we=J?J(je):new Ee.constructor(je);return Ee.copy(we),we}Ue.exports=re},57157:function(Ue,H,R){var Y=R(74318);function $(v,ee){var F=ee?Y(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.byteLength)}Ue.exports=$},93147:function(Ue){var H=/\w*$/;function R(Y){var $=new Y.constructor(Y.source,H.exec(Y));return $.lastIndex=Y.lastIndex,$}Ue.exports=R},40419:function(Ue,H,R){var Y=R(62705),$=Y?Y.prototype:void 0,v=$?$.valueOf:void 0;function ee(F){return v?Object(v.call(F)):{}}Ue.exports=ee},77133:function(Ue,H,R){var Y=R(74318);function $(v,ee){var F=ee?Y(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.length)}Ue.exports=$},278:function(Ue){function H(R,Y){var $=-1,v=R.length;for(Y||(Y=Array(v));++$<v;)Y[$]=R[$];return Y}Ue.exports=H},98363:function(Ue,H,R){var Y=R(34865),$=R(89465);function v(ee,F,J,re){var Ee=!J;J||(J={});for(var ne=-1,je=F.length;++ne<je;){var we=F[ne],et=re?re(J[we],ee[we],we,J,ee):void 0;et===void 0&&(et=ee[we]),Ee?$(J,we,et):Y(J,we,et)}return J}Ue.exports=v},18805:function(Ue,H,R){var Y=R(98363),$=R(99551);function v(ee,F){return Y(ee,$(ee),F)}Ue.exports=v},1911:function(Ue,H,R){var Y=R(98363),$=R(51442);function v(ee,F){return Y(ee,$(ee),F)}Ue.exports=v},21463:function(Ue,H,R){var Y=R(5976),$=R(16612);function v(ee){return Y(function(F,J){var re=-1,Ee=J.length,ne=Ee>1?J[Ee-1]:void 0,je=Ee>2?J[2]:void 0;for(ne=ee.length>3&&typeof ne=="function"?(Ee--,ne):void 0,je&&$(J[0],J[1],je)&&(ne=Ee<3?void 0:ne,Ee=1),F=Object(F);++re<Ee;){var we=J[re];we&&ee(F,we,re,ne)}return F})}Ue.exports=v},25063:function(Ue){function H(R){return function(Y,$,v){for(var ee=-1,F=Object(Y),J=v(Y),re=J.length;re--;){var Ee=J[R?re:++ee];if($(F[Ee],Ee,F)===!1)break}return Y}}Ue.exports=H},98805:function(Ue,H,R){var Y=R(40180),$=R(62689),v=R(83140),ee=R(79833);function F(J){return function(re){re=ee(re);var Ee=$(re)?v(re):void 0,ne=Ee?Ee[0]:re.charAt(0),je=Ee?Y(Ee,1).join(""):re.slice(1);return ne[J]()+je}}Ue.exports=F},35393:function(Ue,H,R){var Y=R(62663),$=R(53816),v=R(58748),ee="['\u2019]",F=RegExp(ee,"g");function J(re){return function(Ee){return Y(v($(Ee).replace(F,"")),re,"")}}Ue.exports=J},23593:function(Ue,H,R){var Y=R(58525),$=R(50308),v=R(21814),ee=1/0,F=Y&&1/v(new Y([,-0]))[1]==ee?function(J){return new Y(J)}:$;Ue.exports=F},69389:function(Ue,H,R){var Y=R(18674),$={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=Y($);Ue.exports=v},38777:function(Ue,H,R){var Y=R(10852),$=function(){try{var v=Y(Object,"defineProperty");return v({},"",{}),v}catch(ee){}}();Ue.exports=$},46904:function(Ue,H,R){var Y=R(68866),$=R(51442),v=R(81704);function ee(F){return Y(F,v,$)}Ue.exports=ee},85924:function(Ue,H,R){var Y=R(5569),$=Y(Object.getPrototypeOf,Object);Ue.exports=$},51442:function(Ue,H,R){var Y=R(62488),$=R(85924),v=R(99551),ee=R(70479),F=Object.getOwnPropertySymbols,J=F?function(re){for(var Ee=[];re;)Y(Ee,v(re)),re=$(re);return Ee}:ee;Ue.exports=J},93157:function(Ue){var H=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function R(Y){return H.test(Y)}Ue.exports=R},43824:function(Ue){var H=Object.prototype,R=H.hasOwnProperty;function Y($){var v=$.length,ee=new $.constructor(v);return v&&typeof $[0]=="string"&&R.call($,"index")&&(ee.index=$.index,ee.input=$.input),ee}Ue.exports=Y},29148:function(Ue,H,R){var Y=R(74318),$=R(57157),v=R(93147),ee=R(40419),F=R(77133),J="[object Boolean]",re="[object Date]",Ee="[object Map]",ne="[object Number]",je="[object RegExp]",we="[object Set]",et="[object String]",Mt="[object Symbol]",nr="[object ArrayBuffer]",_t="[object DataView]",Xt="[object Float32Array]",Ct="[object Float64Array]",ot="[object Int8Array]",ut="[object Int16Array]",Jt="[object Int32Array]",X="[object Uint8Array]",Yt="[object Uint8ClampedArray]",dt="[object Uint16Array]",qe="[object Uint32Array]";function ht($e,Rt,yr){var Rr=$e.constructor;switch(Rt){case nr:return Y($e);case J:case re:return new Rr(+$e);case _t:return $($e,yr);case Xt:case Ct:case ot:case ut:case Jt:case X:case Yt:case dt:case qe:return F($e,yr);case Ee:return new Rr;case ne:case et:return new Rr($e);case je:return v($e);case we:return new Rr;case Mt:return ee($e)}}Ue.exports=ht},38517:function(Ue,H,R){var Y=R(3118),$=R(85924),v=R(25726);function ee(F){return typeof F.constructor=="function"&&!v(F)?Y($(F)):{}}Ue.exports=ee},16612:function(Ue,H,R){var Y=R(77813),$=R(98612),v=R(65776),ee=R(13218);function F(J,re,Ee){if(!ee(Ee))return!1;var ne=typeof re;return(ne=="number"?$(Ee)&&v(re,Ee.length):ne=="string"&&re in Ee)?Y(Ee[re],J):!1}Ue.exports=F},33498:function(Ue){function H(R){var Y=[];if(R!=null)for(var $ in Object(R))Y.push($);return Y}Ue.exports=H},45357:function(Ue,H,R){var Y=R(58380),$=Math.max;function v(ee,F,J){return F=$(F===void 0?ee.length-1:F,0),function(){for(var re=arguments,Ee=-1,ne=$(re.length-F,0),je=Array(ne);++Ee<ne;)je[Ee]=re[F+Ee];Ee=-1;for(var we=Array(F+1);++Ee<F;)we[Ee]=re[Ee];return we[F]=J(je),Y(ee,this,we)}}Ue.exports=v},36390:function(Ue){function H(R,Y){if(!(Y==="constructor"&&typeof R[Y]=="function")&&Y!="__proto__")return R[Y]}Ue.exports=H},30061:function(Ue,H,R){var Y=R(56560),$=R(21275),v=$(Y);Ue.exports=v},21275:function(Ue){var H=800,R=16,Y=Date.now;function $(v){var ee=0,F=0;return function(){var J=Y(),re=R-(J-F);if(F=J,re>0){if(++ee>=H)return arguments[0]}else ee=0;return v.apply(void 0,arguments)}}Ue.exports=$},42351:function(Ue){function H(R,Y,$){for(var v=$-1,ee=R.length;++v<ee;)if(R[v]===Y)return v;return-1}Ue.exports=H},2757:function(Ue){var H="\\ud800-\\udfff",R="\\u0300-\\u036f",Y="\\ufe20-\\ufe2f",$="\\u20d0-\\u20ff",v=R+Y+$,ee="\\u2700-\\u27bf",F="a-z\\xdf-\\xf6\\xf8-\\xff",J="\\xac\\xb1\\xd7\\xf7",re="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ee="\\u2000-\\u206f",ne=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",je="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",et=J+re+Ee+ne,Mt="['\u2019]",nr="["+et+"]",_t="["+v+"]",Xt="\\d+",Ct="["+ee+"]",ot="["+F+"]",ut="[^"+H+et+Xt+ee+F+je+"]",Jt="\\ud83c[\\udffb-\\udfff]",X="(?:"+_t+"|"+Jt+")",Yt="[^"+H+"]",dt="(?:\\ud83c[\\udde6-\\uddff]){2}",qe="[\\ud800-\\udbff][\\udc00-\\udfff]",ht="["+je+"]",$e="\\u200d",Rt="(?:"+ot+"|"+ut+")",yr="(?:"+ht+"|"+ut+")",Rr="(?:"+Mt+"(?:d|ll|m|re|s|t|ve))?",Hr="(?:"+Mt+"(?:D|LL|M|RE|S|T|VE))?",Te=X+"?",Ye="["+we+"]?",ke="(?:"+$e+"(?:"+[Yt,dt,qe].join("|")+")"+Ye+Te+")*",At="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ft=Ye+Te+ke,qt="(?:"+[Ct,dt,qe].join("|")+")"+Ft,Cr=RegExp([ht+"?"+ot+"+"+Rr+"(?="+[nr,ht,"$"].join("|")+")",yr+"+"+Hr+"(?="+[nr,ht+Rt,"$"].join("|")+")",ht+"?"+Rt+"+"+Rr,ht+"+"+Hr,gt,At,Xt,qt].join("|"),"g");function Hn(hn){return hn.match(Cr)||[]}Ue.exports=Hn},68929:function(Ue,H,R){var Y=R(48403),$=R(35393),v=$(function(ee,F,J){return F=F.toLowerCase(),ee+(J?Y(F):F)});Ue.exports=v},48403:function(Ue,H,R){var Y=R(79833),$=R(11700);function v(ee){return $(Y(ee).toLowerCase())}Ue.exports=v},74691:function(Ue,H,R){var Y=R(29750),$=R(14841);function v(ee,F,J){return J===void 0&&(J=F,F=void 0),J!==void 0&&(J=$(J),J=J===J?J:0),F!==void 0&&(F=$(F),F=F===F?F:0),Y($(ee),F,J)}Ue.exports=v},50361:function(Ue,H,R){var Y=R(85990),$=1,v=4;function ee(F){return Y(F,$|v)}Ue.exports=ee},75703:function(Ue){function H(R){return function(){return R}}Ue.exports=H},53816:function(Ue,H,R){var Y=R(69389),$=R(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ee="\\u0300-\\u036f",F="\\ufe20-\\ufe2f",J="\\u20d0-\\u20ff",re=ee+F+J,Ee="["+re+"]",ne=RegExp(Ee,"g");function je(we){return we=$(we),we&&we.replace(v,Y).replace(ne,"")}Ue.exports=je},6557:function(Ue){function H(R){return R}Ue.exports=H},29246:function(Ue,H,R){var Y=R(98612),$=R(37005);function v(ee){return $(ee)&&Y(ee)}Ue.exports=v},56688:function(Ue,H,R){var Y=R(25588),$=R(7518),v=R(31167),ee=v&&v.isMap,F=ee?$(ee):Y;Ue.exports=F},14293:function(Ue){function H(R){return R==null}Ue.exports=H},81763:function(Ue,H,R){var Y=R(44239),$=R(37005),v="[object Number]";function ee(F){return typeof F=="number"||$(F)&&Y(F)==v}Ue.exports=ee},68630:function(Ue,H,R){var Y=R(44239),$=R(85924),v=R(37005),ee="[object Object]",F=Function.prototype,J=Object.prototype,re=F.toString,Ee=J.hasOwnProperty,ne=re.call(Object);function je(we){if(!v(we)||Y(we)!=ee)return!1;var et=$(we);if(et===null)return!0;var Mt=Ee.call(et,"constructor")&&et.constructor;return typeof Mt=="function"&&Mt instanceof Mt&&re.call(Mt)==ne}Ue.exports=je},72928:function(Ue,H,R){var Y=R(29221),$=R(7518),v=R(31167),ee=v&&v.isSet,F=ee?$(ee):Y;Ue.exports=F},47037:function(Ue,H,R){var Y=R(44239),$=R(1469),v=R(37005),ee="[object String]";function F(J){return typeof J=="string"||!$(J)&&v(J)&&Y(J)==ee}Ue.exports=F},81704:function(Ue,H,R){var Y=R(14636),$=R(10313),v=R(98612);function ee(F){return v(F)?Y(F,!0):$(F)}Ue.exports=ee},82492:function(Ue,H,R){var Y=R(42980),$=R(21463),v=$(function(ee,F,J){Y(ee,F,J)});Ue.exports=v},30236:function(Ue,H,R){var Y=R(42980),$=R(21463),v=$(function(ee,F,J,re){Y(ee,F,J,re)});Ue.exports=v},50308:function(Ue){function H(){}Ue.exports=H},59881:function(Ue,H,R){var Y=R(98363),$=R(81704);function v(ee){return Y(ee,$(ee))}Ue.exports=v},79833:function(Ue,H,R){var Y=R(80531);function $(v){return v==null?"":Y(v)}Ue.exports=$},44908:function(Ue,H,R){var Y=R(45652);function $(v){return v&&v.length?Y(v):[]}Ue.exports=$},11700:function(Ue,H,R){var Y=R(98805),$=Y("toUpperCase");Ue.exports=$},58748:function(Ue,H,R){var Y=R(49029),$=R(93157),v=R(79833),ee=R(2757);function F(J,re,Ee){return J=v(J),re=Ee?void 0:re,re===void 0?$(J)?ee(J):Y(J):J.match(re)||[]}Ue.exports=F},6158:function(Ue){(function(H,R){Ue.exports=R()})(this,function(){"use strict";var H,R,Y;function $(v,ee){if(!H)H=ee;else if(!R)R=ee;else{var F="var sharedChunk = {}; ("+H+")(sharedChunk); ("+R+")(sharedChunk);",J={};H(J),Y=ee(J),typeof window!="undefined"&&(Y.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}return $(["exports"],function(v){"use strict";function ee(t,a){return t(a={exports:{}},a.exports),a.exports}var F=J;function J(t,a,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=s,this.p2y=h}J.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},J.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},J.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},J.prototype.solveCurveX=function(t,a){var s,h,m,x,S;for(a===void 0&&(a=1e-6),m=t,S=0;S<8;S++){if(x=this.sampleCurveX(m)-t,Math.abs(x)<a)return m;var T=this.sampleCurveDerivativeX(m);if(Math.abs(T)<1e-6)break;m-=x/T}if((m=t)<(s=0))return s;if(m>(h=1))return h;for(;s<h;){if(x=this.sampleCurveX(m),Math.abs(x-t)<a)return m;t>x?s=m:h=m,m=.5*(h-s)+s}return m},J.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var re=Ee;function Ee(t,a){this.x=t,this.y=a}Ee.prototype={clone:function(){return new Ee(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),h=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,a){var s=Math.cos(t),h=Math.sin(t),m=a.y+h*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-h*(this.y-a.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ee.convert=function(t){return t instanceof Ee?t:Array.isArray(t)?new Ee(t[0],t[1]):t};var ne=typeof self!="undefined"?self:{},je=Math.pow(2,53)-1;function we(t,a,s,h){var m=new F(t,a,s,h);return function(x){return m.solve(x)}}var et=we(.25,.1,.25,1);function Mt(t,a,s){return Math.min(s,Math.max(a,t))}function nr(t,a,s){var h=s-a,m=((t-a)%h+h)%h+a;return m===a?s:m}function _t(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,m=a;h<m.length;h+=1){var x=m[h];for(var S in x)t[S]=x[S]}return t}var Xt=1;function Ct(){return Xt++}function ot(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ut(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Jt(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function X(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Yt(t,a,s){var h={};for(var m in t)h[m]=a.call(s||this,t[m],m,t);return h}function dt(t,a,s){var h={};for(var m in t)a.call(s||this,t[m],m,t)&&(h[m]=t[m]);return h}function qe(t){return Array.isArray(t)?t.map(qe):typeof t=="object"&&t?Yt(t,qe):t}var ht={};function $e(t){ht[t]||(typeof console!="undefined"&&console.warn(t),ht[t]=!0)}function Rt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function yr(t){for(var a=0,s=0,h=t.length,m=h-1,x=void 0,S=void 0;s<h;m=s++)a+=((S=t[m]).x-(x=t[s]).x)*(x.y+S.y);return a}function Rr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Hr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,m,x,S){var T=x||S;return a[m]=!T||T.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var Te=null;function Ye(t){if(Te==null){var a=t.navigator?t.navigator.userAgent:null;Te=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Te}function ke(t){try{var a=ne[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var At,gt,Ft,qt,Cr=ne.performance&&ne.performance.now?ne.performance.now.bind(ne.performance):Date.now.bind(Date),Hn=ne.requestAnimationFrame||ne.mozRequestAnimationFrame||ne.webkitRequestAnimationFrame||ne.msRequestAnimationFrame,hn=ne.cancelAnimationFrame||ne.mozCancelAnimationFrame||ne.webkitCancelAnimationFrame||ne.msCancelAnimationFrame,Ki={now:Cr,frame:function(t){var a=Hn(t);return{cancel:function(){return hn(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=ne.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return At||(At=ne.document.createElement("a")),At.href=t,At.href},hardwareConcurrency:ne.navigator&&ne.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ne.devicePixelRatio},get prefersReducedMotion(){return!!ne.matchMedia&&(gt==null&&(gt=ne.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},Bn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Gn={supported:!1,testSupport:function(t){!hi&&qt&&(Wn?si(t):Ft=t)}},hi=!1,Wn=!1;function si(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;Gn.supported=!0}catch(s){}t.deleteTexture(a),hi=!0}ne.document&&((qt=ne.document.createElement("img")).onload=function(){Ft&&si(Ft),Ft=null,Wn=!0},qt.onerror=function(){hi=!0,Ft=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var aa="01",Ri=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function Si(t){return t.indexOf("mapbox:")===0}Ri.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",aa,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ri.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ri.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Ri.prototype.normalizeStyleURL=function(t,a){if(!Si(t))return t;var s=xa(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Ri.prototype.normalizeGlyphsURL=function(t,a){if(!Si(t))return t;var s=xa(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Ri.prototype.normalizeSourceURL=function(t,a){if(!Si(t))return t;var s=xa(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Ri.prototype.normalizeSpriteURL=function(t,a,s,h){var m=xa(t);return Si(t)?(m.path="/styles/v1"+m.path+"/sprite"+a+s,this._makeAPIURL(m,this._customAccessToken||h)):(m.path+=""+a+s,An(m))},Ri.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Si(t))return t;var s=xa(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ki.devicePixelRatio>=2||a===512?"@2x":"")+(Gn.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var h=this._customAccessToken||function(m){for(var x=0,S=m;x<S.length;x+=1){var T=S[x].match(/^access_token=(.*)$/);if(T)return T[1]}return null}(s.params)||Bn.ACCESS_TOKEN;return Bn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,h)},Ri.prototype.canonicalizeTileURL=function(t,a){var s=xa(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=s.path.replace("/v4/","");var m=s.params;return a&&(m=m.filter(function(x){return!x.match(/^access_token=/)})),m.length&&(h+="?"+m.join("&")),h},Ri.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&Si(a),h=[],m=0,x=t.tiles||[];m<x.length;m+=1){var S=x[m];ua(S)?h.push(this.canonicalizeTileURL(S,s)):h.push(S)}return h},Ri.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=xa(Bn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Bn.REQUIRE_ACCESS_TOKEN)return An(t);if(!(a=a||Bn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(x){return x.indexOf("access_token")===-1}),t.params.push("access_token="+a),An(t)};var Vi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ua(t){return Vi.test(t)}var wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xa(t){var a=t.match(wi);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function An(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function yi(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(ne.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var zi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};zi.prototype.getStorageKey=function(t){var a,s=yi(Bn.ACCESS_TOKEN);return a=s&&s.u?ne.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(h,m){return String.fromCharCode(Number("0x"+m))})):Bn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},zi.prototype.fetchEventData=function(){var t=ke("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var h=ne.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var m=ne.localStorage.getItem(s);m&&(this.anonId=m)}catch(x){$e("Unable to read from LocalStorage")}},zi.prototype.saveEventData=function(){var t=ke("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{ne.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ne.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){$e("Unable to write to LocalStorage")}},zi.prototype.processRequests=function(t){},zi.prototype.postEvent=function(t,a,s,h){var m=this;if(Bn.EVENTS_URL){var x=xa(Bn.EVENTS_URL);x.params.push("access_token="+(h||Bn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:aa,userId:this.anonId},T=a?_t(S,a):S,k={url:An(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=Sa(k,function(z){m.pendingRequest=null,s(z),m.saveEventData(),m.processRequests(h)})}},zi.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var $i,ja,me=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,h,m,x){this.skuToken=m,(Bn.EVENTS_URL&&x||Bn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(S){return Si(S)||ua(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},x)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var m=this.queue.shift(),x=m.id,S=m.timestamp;x&&this.success[x]||(this.anonId||this.fetchEventData(),ut(this.anonId)||(this.anonId=ot()),this.postEvent(S,{skuToken:this.skuToken},function(T){T||x&&(h.success[x]=!0)},s))}},a}(zi),Ln=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,h){Bn.EVENTS_URL&&Bn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(m){return Si(m)||ua(m)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var m=yi(Bn.ACCESS_TOKEN),x=m?m.u:Bn.ACCESS_TOKEN,S=x!==this.eventData.tokenU;ut(this.anonId)||(this.anonId=ot(),S=!0);var T=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(T),j=(T-this.eventData.lastSuccess)/864e5;S=S||j>=1||j<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(T,{"enabled.telemetry":!1},function(G){G||(h.eventData.lastSuccess=T,h.eventData.tokenU=x)},s)}},a}(zi)),Va=Ln.postTurnstileEvent.bind(Ln),fs=new me,zt=fs.postMapLoadEvent.bind(fs),ir=500,Ir=50;function I(){ne.caches&&!$i&&($i=ne.caches.open("mapbox-tiles"))}function sr(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var On,ui=1/0;function Zn(){return On==null&&(On=ne.OffscreenCanvas&&new ne.OffscreenCanvas(1,1).getContext("2d")&&typeof ne.createImageBitmap=="function"),On}var nn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(nn);var Ti=function(t){function a(s,h,m){h===401&&ua(m)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=h,this.url=m,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Mi=Rr()?function(){return self.worker&&self.worker.referrer}:function(){return(ne.location.protocol==="blob:"?ne.parent:ne).location.href},Ya,hs,va=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(Mi())&&!/^\w+:/.test(s))){if(ne.fetch&&ne.Request&&ne.AbortController&&ne.Request.prototype.hasOwnProperty("signal"))return function(h,m){var x,S=new ne.AbortController,T=new ne.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Mi(),signal:S.signal}),k=!1,z=!1,j=(x=T.url).indexOf("sku=")>0&&ua(x);h.type==="json"&&T.headers.set("Accept","application/json");var G=function(oe,Me,Re){if(!z){if(oe&&oe.message!=="SecurityError"&&$e(oe),Me&&Re)return te(Me);var Ke=Date.now();ne.fetch(T).then(function(ze){if(ze.ok){var at=j?ze.clone():null;return te(ze,at,Ke)}return m(new Ti(ze.statusText,ze.status,h.url))}).catch(function(ze){ze.code!==20&&m(new Error(ze.message))})}},te=function(oe,Me,Re){(h.type==="arrayBuffer"?oe.arrayBuffer():h.type==="json"?oe.json():oe.text()).then(function(Ke){z||(Me&&Re&&function(ze,at,St){if(I(),$i){var Zt={status:at.status,statusText:at.statusText,headers:new ne.Headers};at.headers.forEach(function(cr,Mr){return Zt.headers.set(Mr,cr)});var Wt=Hr(at.headers.get("Cache-Control")||"");Wt["no-store"]||(Wt["max-age"]&&Zt.headers.set("Expires",new Date(St+1e3*Wt["max-age"]).toUTCString()),new Date(Zt.headers.get("Expires")).getTime()-St<42e4||function(cr,Mr){if(ja===void 0)try{new Response(new ReadableStream),ja=!0}catch(Pr){ja=!1}ja?Mr(cr.body):cr.blob().then(Mr)}(at,function(cr){var Mr=new ne.Response(cr,Zt);I(),$i&&$i.then(function(Pr){return Pr.put(sr(ze.url),Mr)}).catch(function(Pr){return $e(Pr.message)})}))}}(T,Me,Re),k=!0,m(null,Ke,oe.headers.get("Cache-Control"),oe.headers.get("Expires")))}).catch(function(Ke){z||m(new Error(Ke.message))})};return j?function(oe,Me){if(I(),!$i)return Me(null);var Re=sr(oe.url);$i.then(function(Ke){Ke.match(Re).then(function(ze){var at=function(St){if(!St)return!1;var Zt=new Date(St.headers.get("Expires")||0),Wt=Hr(St.headers.get("Cache-Control")||"");return Zt>Date.now()&&!Wt["no-cache"]}(ze);Ke.delete(Re),at&&Ke.put(Re,ze.clone()),Me(null,ze,at)}).catch(Me)}).catch(Me)}(T,G):G(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,a);if(Rr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(h,m){var x=new ne.XMLHttpRequest;for(var S in x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer"),h.headers)x.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=function(){m(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var T=x.response;if(h.type==="json")try{T=JSON.parse(x.response)}catch(k){return m(k)}m(null,T,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else m(new Ti(x.statusText,x.status,h.url))},x.send(h.body),{cancel:function(){return x.abort()}}}(t,a)},Ra=function(t,a){return va(_t(t,{type:"arrayBuffer"}),a)},Sa=function(t,a){return va(_t(t,{method:"POST"}),a)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ya=[],hs=0;var K=function(t,a){if(Gn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hs>=Bn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ya.push(s),s}hs++;var h=!1,m=function(){if(!h)for(h=!0,hs--;Ya.length&&hs<Bn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Ya.shift();S.cancelled||(S.cancel=K(S.requestParameters,S.callback).cancel)}},x=Ra(t,function(S,T,k,z){m(),S?a(S):T&&(Zn()?function(j,G){var te=new ne.Blob([new Uint8Array(j)],{type:"image/png"});ne.createImageBitmap(te).then(function(oe){G(null,oe)}).catch(function(oe){G(new Error("Could not load image because of "+oe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(T,a):function(j,G,te,oe){var Me=new ne.Image,Re=ne.URL;Me.onload=function(){G(null,Me),Re.revokeObjectURL(Me.src),Me.onload=null,ne.requestAnimationFrame(function(){Me.src=V})},Me.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ke=new ne.Blob([new Uint8Array(j)],{type:"image/png"});Me.cacheControl=te,Me.expires=oe,Me.src=j.byteLength?Re.createObjectURL(Ke):V}(T,a,k,z))});return{cancel:function(){x.cancel(),m()}}};function se(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function ge(t,a,s){if(s&&s[t]){var h=s[t].indexOf(a);h!==-1&&s[t].splice(h,1)}}var Ie=function(t,a){a===void 0&&(a={}),_t(this,a),this.type=t},Ve=function(t){function a(s,h){h===void 0&&(h={}),t.call(this,"error",_t({error:s},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ie),rt=function(){};rt.prototype.on=function(t,a){return this._listeners=this._listeners||{},se(t,a,this._listeners),this},rt.prototype.off=function(t,a){return ge(t,a,this._listeners),ge(t,a,this._oneTimeListeners),this},rt.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},se(t,a,this._oneTimeListeners),this},rt.prototype.fire=function(t,a){typeof t=="string"&&(t=new Ie(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var h=0,m=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];h<m.length;h+=1)m[h].call(this,t);for(var x=0,S=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];x<S.length;x+=1){var T=S[x];ge(s,T,this._oneTimeListeners),T.call(this,t)}var k=this._eventedParent;k&&(_t(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ve&&console.error(t.error);return this},rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},rt.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},De=function(t,a,s,h){this.message=(t?t+": ":"")+s,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function yt(t){var a=t.value;return a?[new De(t.key,a,"constants have been deprecated as of v8")]:[]}function vr(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,m=a;h<m.length;h+=1){var x=m[h];for(var S in x)t[S]=x[S]}return t}function Lt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=Dt(t[s]);return a}return Lt(t)}var gr=function(t){function a(s,h){t.call(this,h),this.message=h,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),bn=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,h=a;s<h.length;s+=1){var m=h[s];this.bindings[m[0]]=m[1]}};bn.prototype.concat=function(t){return new bn(this,t)},bn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},bn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var ln={kind:"null"},Tt={kind:"number"},on={kind:"string"},Vr={kind:"boolean"},Wr={kind:"color"},ii={kind:"object"},en={kind:"value"},Ci={kind:"collator"},ta={kind:"formatted"},gi={kind:"resolvedImage"};function Pi(t,a){return{kind:"array",itemType:t,N:a}}function _i(t){if(t.kind==="array"){var a=_i(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var Jn=[ln,Tt,on,Vr,Wr,ta,ii,Pi(en),gi];function Xi(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Xi(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,h=Jn;s<h.length;s+=1)if(!Xi(h[s],a))return null}}return"Expected "+_i(t)+" but found "+_i(a)+" instead."}function La(t,a){return a.some(function(s){return s.kind===t.kind})}function oa(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var Ii=ee(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(T){return(T=Math.round(T))<0?0:T>255?255:T}function m(T){return h(T[T.length-1]==="%"?parseFloat(T)/100*255:parseInt(T))}function x(T){return(k=T[T.length-1]==="%"?parseFloat(T)/100:parseFloat(T))<0?0:k>1?1:k;var k}function S(T,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?T+(k-T)*z*6:2*z<1?k:3*z<2?T+(k-T)*(2/3-z)*6:T}try{a.parseCSSColor=function(T){var k,z=T.replace(/ /g,"").toLowerCase();if(z in s)return s[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var j=z.indexOf("("),G=z.indexOf(")");if(j!==-1&&G+1===z.length){var te=z.substr(0,j),oe=z.substr(j+1,G-(j+1)).split(","),Me=1;switch(te){case"rgba":if(oe.length!==4)return null;Me=x(oe.pop());case"rgb":return oe.length!==3?null:[m(oe[0]),m(oe[1]),m(oe[2]),Me];case"hsla":if(oe.length!==4)return null;Me=x(oe.pop());case"hsl":if(oe.length!==3)return null;var Re=(parseFloat(oe[0])%360+360)%360/360,Ke=x(oe[1]),ze=x(oe[2]),at=ze<=.5?ze*(Ke+1):ze+Ke-ze*Ke,St=2*ze-at;return[h(255*S(St,at,Re+1/3)),h(255*S(St,at,Re)),h(255*S(St,at,Re-1/3)),Me];default:return null}}return null}}catch(T){}}).parseCSSColor,Gi=function(t,a,s,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=s,this.a=h};Gi.parse=function(t){if(t){if(t instanceof Gi)return t;if(typeof t=="string"){var a=Ii(t);if(a)return new Gi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Gi.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+h+")"},Gi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Gi.black=new Gi(0,0,0,1),Gi.white=new Gi(1,1,1,1),Gi.transparent=new Gi(0,0,0,0),Gi.red=new Gi(1,0,0,1);var Na=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Na.prototype.compare=function(t,a){return this.collator.compare(t,a)},Na.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var tu=function(t,a,s,h,m){this.text=t,this.image=a,this.scale=s,this.fontStack=h,this.textColor=m},wa=function(t){this.sections=t};wa.fromString=function(t){return new wa([new tu(t,null,null,null,null)])},wa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},wa.factory=function(t){return t instanceof wa?t:wa.fromString(t)},wa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},wa.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var m={};h.fontStack&&(m["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(m["font-scale"]=h.scale),h.textColor&&(m["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(m)}}return t};var Ca=function(t){this.name=t.name,this.available=t.available};function ys(t,a,s,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,s,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,s,h]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ps(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Gi||t instanceof Na||t instanceof wa||t instanceof Ca)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!ps(s[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!ps(t[h]))return!1;return!0}return!1}function ra(t){if(t===null)return ln;if(typeof t=="string")return on;if(typeof t=="boolean")return Vr;if(typeof t=="number")return Tt;if(t instanceof Gi)return Wr;if(t instanceof Na)return Ci;if(t instanceof wa)return ta;if(t instanceof Ca)return gi;if(Array.isArray(t)){for(var a,s=t.length,h=0,m=t;h<m.length;h+=1){var x=ra(m[h]);if(a){if(a===x)continue;a=en;break}a=x}return Pi(a||en,s)}return ii}function Bu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Gi||t instanceof wa||t instanceof Ca?t.toString():JSON.stringify(t)}Ca.prototype.toString=function(){return this.name},Ca.fromString=function(t){return t?new Ca({name:t,available:!1}):null},Ca.prototype.serialize=function(){return["image",this.name]};var fo=function(t,a){this.type=t,this.value=a};fo.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ps(t[1]))return a.error("invalid value");var s=t[1],h=ra(s),m=a.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new fo(h,s)},fo.prototype.evaluate=function(){return this.value},fo.prototype.eachChild=function(){},fo.prototype.outputDefined=function(){return!0},fo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gi?["rgba"].concat(this.value.toArray()):this.value instanceof wa?this.value.serialize():this.value};var Ba=function(t){this.name="ExpressionEvaluationError",this.message=t};Ba.prototype.toJSON=function(){return this.message};var eo={string:on,number:Tt,boolean:Vr,object:ii},Ji=function(t,a){this.type=t,this.args=a};Ji.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,h=1,m=t[0];if(m==="array"){var x,S;if(t.length>2){var T=t[1];if(typeof T!="string"||!(T in eo)||T==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=eo[T],h++}else x=en;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}s=Pi(x,S)}else s=eo[m];for(var k=[];h<t.length;h++){var z=a.parse(t[h],h,en);if(!z)return null;k.push(z)}return new Ji(s,k)},Ji.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!Xi(this.type,ra(s)))return s;if(a===this.args.length-1)throw new Ba("Expected value to be of type "+_i(this.type)+", but found "+_i(ra(s))+" instead.")}return null},Ji.prototype.eachChild=function(t){this.args.forEach(t)},Ji.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Ji.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(m){return m.serialize()}))};var Go=function(t){this.type=ta,this.sections=t};Go.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var h=[],m=!1,x=1;x<=t.length-1;++x){var S=t[x];if(m&&typeof S=="object"&&!Array.isArray(S)){m=!1;var T=null;if(S["font-scale"]&&!(T=a.parse(S["font-scale"],1,Tt)))return null;var k=null;if(S["text-font"]&&!(k=a.parse(S["text-font"],1,Pi(on))))return null;var z=null;if(S["text-color"]&&!(z=a.parse(S["text-color"],1,Wr)))return null;var j=h[h.length-1];j.scale=T,j.font=k,j.textColor=z}else{var G=a.parse(t[x],1,en);if(!G)return null;var te=G.type.kind;if(te!=="string"&&te!=="value"&&te!=="null"&&te!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:G,scale:null,font:null,textColor:null})}}return new Go(h)},Go.prototype.evaluate=function(t){return new wa(this.sections.map(function(a){var s=a.content.evaluate(t);return ra(s)===gi?new tu("",s,null,null,null):new tu(Bu(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},Go.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t.push(h.content.serialize());var m={};h.scale&&(m["font-scale"]=h.scale.serialize()),h.font&&(m["text-font"]=h.font.serialize()),h.textColor&&(m["text-color"]=h.textColor.serialize()),t.push(m)}return t};var Ho=function(t){this.type=gi,this.input=t};Ho.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,on);return s?new Ho(s):a.error("No image name provided.")},Ho.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=Ca.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Ho.prototype.eachChild=function(t){t(this.input)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){return["image",this.input.serialize()]};var zu={"to-boolean":Vr,"to-color":Wr,"to-number":Tt,"to-string":on},_o=function(t,a){this.type=t,this.args=a};_o.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=zu[s],m=[],x=1;x<t.length;x++){var S=a.parse(t[x],x,en);if(!S)return null;m.push(S)}return new _o(h,m)},_o.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,h=0,m=this.args;h<m.length;h+=1){if(s=null,(a=m[h].evaluate(t))instanceof Gi)return a;if(typeof a=="string"){var x=t.parseColor(a);if(x)return x}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":ys(a[0],a[1],a[2],a[3])))return new Gi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ba(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var S=null,T=0,k=this.args;T<k.length;T+=1){if((S=k[T].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ba("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?wa.fromString(Bu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ca.fromString(Bu(this.args[0].evaluate(t))):Bu(this.args[0].evaluate(t))},_o.prototype.eachChild=function(t){this.args.forEach(t)},_o.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},_o.prototype.serialize=function(){if(this.type.kind==="formatted")return new Go([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ho(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Wo=["Unknown","Point","LineString","Polygon"],ma=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ma.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ma.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Wo[this.feature.type]:this.feature.type:null},ma.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ma.prototype.canonicalID=function(){return this.canonical},ma.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ma.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Gi.parse(t)),a};var ho=function(t,a,s,h){this.name=t,this.type=a,this._evaluate=s,this.args=h};ho.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ho.prototype.eachChild=function(t){this.args.forEach(t)},ho.prototype.outputDefined=function(){return!1},ho.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},ho.parse=function(t,a){var s,h=t[0],m=ho.definitions[h];if(!m)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var x=Array.isArray(m)?m[0]:m.type,S=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=S.filter(function(Nn){var fn=Nn[0];return!Array.isArray(fn)||fn.length===t.length-1}),k=null,z=0,j=T;z<j.length;z+=1){var G=j[z],te=G[0],oe=G[1];k=new Gs(a.registry,a.path,null,a.scope);for(var Me=[],Re=!1,Ke=1;Ke<t.length;Ke++){var ze=t[Ke],at=Array.isArray(te)?te[Ke-1]:te.type,St=k.parse(ze,1+Me.length,at);if(!St){Re=!0;break}Me.push(St)}if(!Re)if(Array.isArray(te)&&te.length!==Me.length)k.error("Expected "+te.length+" arguments, but found "+Me.length+" instead.");else{for(var Zt=0;Zt<Me.length;Zt++){var Wt=Array.isArray(te)?te[Zt]:te.type,cr=Me[Zt];k.concat(Zt+1).checkSubtype(Wt,cr.type)}if(k.errors.length===0)return new ho(h,x,oe,Me)}}if(T.length===1)(s=a.errors).push.apply(s,k.errors);else{for(var Mr=(T.length?T:S).map(function(Nn){var fn;return fn=Nn[0],Array.isArray(fn)?"("+fn.map(_i).join(", ")+")":"("+_i(fn.type)+"...)"}).join(" | "),Pr=[],Rn=1;Rn<t.length;Rn++){var cn=a.parse(t[Rn],1+Pr.length);if(!cn)return null;Pr.push(_i(cn.type))}a.error("Expected arguments of type "+Mr+", but found ("+Pr.join(", ")+") instead.")}return null},ho.register=function(t,a){for(var s in ho.definitions=a,a)t[s]=ho};var Xo=function(t,a,s){this.type=Ci,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function to(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function ru(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function bc(t,a){var s=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,m=Math.pow(2,a.z);return[Math.round(s*m*8192),Math.round(h*m*8192)]}function Os(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function ie(t,a){for(var s,h,m,x,S,T,k,z=!1,j=0,G=a.length;j<G;j++)for(var te=a[j],oe=0,Me=te.length;oe<Me-1;oe++){if((x=(s=t)[0]-(h=te[oe])[0])*(k=s[1]-(m=te[oe+1])[1])-(T=s[0]-m[0])*(S=s[1]-h[1])==0&&x*T<=0&&S*k<=0)return!1;Os(t,te[oe],te[oe+1])&&(z=!z)}return z}function xe(t,a){for(var s=0;s<a.length;s++)if(ie(t,a[s]))return!0;return!1}function Qe(t,a,s,h){var m=h[0]-s[0],x=h[1]-s[1],S=(t[0]-s[0])*x-m*(t[1]-s[1]),T=(a[0]-s[0])*x-m*(a[1]-s[1]);return S>0&&T<0||S<0&&T>0}function Ot(t,a,s){for(var h=0,m=s;h<m.length;h+=1)for(var x=m[h],S=0;S<x.length-1;++S)if((G=[(j=x[S+1])[0]-(z=x[S])[0],j[1]-z[1]])[0]*(te=[(k=a)[0]-(T=t)[0],k[1]-T[1]])[1]-G[1]*te[0]!=0&&Qe(T,k,z,j)&&Qe(z,j,T,k))return!0;var T,k,z,j,G,te;return!1}function Fr(t,a){for(var s=0;s<t.length;++s)if(!ie(t[s],a))return!1;for(var h=0;h<t.length-1;++h)if(Ot(t[h],t[h+1],a))return!1;return!0}function pt(t,a){for(var s=0;s<a.length;s++)if(Fr(t,a[s]))return!0;return!1}function jt(t,a,s){for(var h=[],m=0;m<t.length;m++){for(var x=[],S=0;S<t[m].length;S++){var T=bc(t[m][S],s);to(a,T),x.push(T)}h.push(x)}return h}function ro(t,a,s){for(var h=[],m=0;m<t.length;m++){var x=jt(t[m],a,s);h.push(x)}return h}function Qi(t,a,s,h){if(t[0]<s[0]||t[0]>s[2]){var m=.5*h,x=t[0]-s[0]>m?-h:s[0]-t[0]>m?h:0;x===0&&(x=t[0]-s[2]>m?-h:s[2]-t[0]>m?h:0),t[0]+=x}to(a,t)}function Ga(t,a,s,h){for(var m=8192*Math.pow(2,h.z),x=[8192*h.x,8192*h.y],S=[],T=0,k=t;T<k.length;T+=1)for(var z=0,j=k[T];z<j.length;z+=1){var G=j[z],te=[G.x+x[0],G.y+x[1]];Qi(te,a,s,m),S.push(te)}return S}function Yo(t,a,s,h){for(var m,x=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],T=[],k=0,z=t;k<z.length;k+=1){for(var j=[],G=0,te=z[k];G<te.length;G+=1){var oe=te[G],Me=[oe.x+S[0],oe.y+S[1]];to(a,Me),j.push(Me)}T.push(j)}if(a[2]-a[0]<=x/2){(m=a)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(var Re=0,Ke=T;Re<Ke.length;Re+=1)for(var ze=0,at=Ke[Re];ze<at.length;ze+=1)Qi(at[ze],a,s,x)}return T}Xo.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var h=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Vr);if(!h)return null;var m=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Vr);if(!m)return null;var x=null;return s.locale&&!(x=a.parse(s.locale,1,on))?null:new Xo(h,m,x)},Xo.prototype.evaluate=function(t){return new Na(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Xo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Xo.prototype.outputDefined=function(){return!1},Xo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var En=function(t,a){this.type=Vr,this.geojson=t,this.geometries=a};function vn(t){if(t instanceof ho&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof En)return!1;var a=!0;return t.eachChild(function(s){a&&!vn(s)&&(a=!1)}),a}function Qt(t){if(t instanceof ho&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!Qt(s)&&(a=!1)}),a}function No(t,a){if(t instanceof ho&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(h){s&&!No(h,a)&&(s=!1)}),s}En.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ps(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var h=0;h<s.features.length;++h){var m=s.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new En(s,s.features[h].geometry)}else if(s.type==="Feature"){var x=s.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new En(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new En(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},En.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(s.type==="Polygon"){var S=jt(s.coordinates,m,x),T=Ga(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var k=0,z=T;k<z.length;k+=1)if(!ie(z[k],S))return!1}if(s.type==="MultiPolygon"){var j=ro(s.coordinates,m,x),G=Ga(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var te=0,oe=G;te<oe.length;te+=1)if(!xe(oe[te],j))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(s.type==="Polygon"){var S=jt(s.coordinates,m,x),T=Yo(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var k=0,z=T;k<z.length;k+=1)if(!Fr(z[k],S))return!1}if(s.type==="MultiPolygon"){var j=ro(s.coordinates,m,x),G=Yo(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var te=0,oe=G;te<oe.length;te+=1)if(!pt(oe[te],j))return!1}return!0}(t,this.geometries)}return!1},En.prototype.eachChild=function(){},En.prototype.outputDefined=function(){return!0},En.prototype.serialize=function(){return["within",this.geojson]};var be=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};be.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new be(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},be.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},be.prototype.eachChild=function(){},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){return["var",this.name]};var Gs=function(t,a,s,h,m){a===void 0&&(a=[]),h===void 0&&(h=new bn),m===void 0&&(m=[]),this.registry=t,this.path=a,this.key=a.map(function(x){return"["+x+"]"}).join(""),this.scope=h,this.errors=m,this.expectedType=s};function nu(t,a){for(var s,h=t.length-1,m=0,x=h,S=0;m<=x;)if((s=t[S=Math.floor((m+x)/2)])<=a){if(S===h||a<t[S+1])return S;m=S+1}else{if(!(s>a))throw new Ba("Input is not a number.");x=S-1}return 0}Gs.prototype.parse=function(t,a,s,h,m){return m===void 0&&(m={}),a?this.concat(a,s,h)._parse(t,m):this._parse(t,m)},Gs.prototype._parse=function(t,a){function s(z,j,G){return G==="assert"?new Ji(j,[z]):G==="coerce"?new _o(j,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var m=this.registry[h];if(m){var x=m.parse(t,this);if(!x)return null;if(this.expectedType){var S=this.expectedType,T=x.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||T.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(S,T))return null}else x=s(x,S,a.typeAnnotation||"coerce");else x=s(x,S,a.typeAnnotation||"assert")}if(!(x instanceof fo)&&x.type.kind!=="resolvedImage"&&function z(j){if(j instanceof be)return z(j.boundExpression);if(j instanceof ho&&j.name==="error"||j instanceof Xo||j instanceof En)return!1;var G=j instanceof _o||j instanceof Ji,te=!0;return j.eachChild(function(oe){te=G?te&&z(oe):te&&oe instanceof fo}),!!te&&vn(j)&&No(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(x)){var k=new ma;try{x=new fo(x.type,x.evaluate(k))}catch(z){return this.error(z.message),null}}return x}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Gs.prototype.concat=function(t,a,s){var h=typeof t=="number"?this.path.concat(t):this.path,m=s?this.scope.concat(s):this.scope;return new Gs(this.registry,h,a||null,m,this.errors)},Gs.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var h=""+this.key+a.map(function(m){return"["+m+"]"}).join("");this.errors.push(new gr(h,t))},Gs.prototype.checkSubtype=function(t,a){var s=Xi(t,a);return s&&this.error(s),s};var ds=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,m=s;h<m.length;h+=1){var x=m[h],S=x[1];this.labels.push(x[0]),this.outputs.push(S)}};function sa(t,a,s){return t*(1-s)+a*s}ds.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Tt);if(!s)return null;var h=[],m=null;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);for(var x=1;x<t.length;x+=2){var S=x===1?-1/0:t[x],T=t[x+1],k=x,z=x+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var j=a.parse(T,z,m);if(!j)return null;m=m||j.type,h.push([S,j])}return new ds(m,s,h)},ds.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var m=a.length;return h>=a[m-1]?s[m-1].evaluate(t):s[nu(a,h)].evaluate(t)},ds.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},ds.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ds.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var po=Object.freeze({__proto__:null,number:sa,color:function(t,a,s){return new Gi(sa(t.r,a.r,s),sa(t.g,a.g,s),sa(t.b,a.b,s),sa(t.a,a.a,s))},array:function(t,a,s){return t.map(function(h,m){return sa(h,a[m],s)})}}),Xl=6/29*3*(6/29),Ec=Math.PI/180,Uu=180/Math.PI;function Sc(t){return t>.008856451679035631?Math.pow(t,1/3):t/Xl+4/29}function Sl(t){return t>6/29?t*t*t:Xl*(t-4/29)}function Zu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function iu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ju(t){var a=iu(t.r),s=iu(t.g),h=iu(t.b),m=Sc((.4124564*a+.3575761*s+.1804375*h)/.95047),x=Sc((.2126729*a+.7151522*s+.072175*h)/1);return{l:116*x-16,a:500*(m-x),b:200*(x-Sc((.0193339*a+.119192*s+.9503041*h)/1.08883)),alpha:t.a}}function y(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*Sl(a),s=.95047*Sl(s),h=1.08883*Sl(h),new Gi(Zu(3.2404542*s-1.5371385*a-.4985314*h),Zu(-.969266*s+1.8760108*a+.041556*h),Zu(.0556434*s-.2040259*a+1.0572252*h),t.alpha)}function C(t,a,s){var h=a-t;return t+s*(h>180||h<-180?h-360*Math.round(h/360):h)}var N={forward:ju,reverse:y,interpolate:function(t,a,s){return{l:sa(t.l,a.l,s),a:sa(t.a,a.a,s),b:sa(t.b,a.b,s),alpha:sa(t.alpha,a.alpha,s)}}},O={forward:function(t){var a=ju(t),s=a.l,h=a.a,m=a.b,x=Math.atan2(m,h)*Uu;return{h:x<0?x+360:x,c:Math.sqrt(h*h+m*m),l:s,alpha:t.a}},reverse:function(t){var a=t.h*Ec,s=t.c;return y({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:C(t.h,a.h,s),c:sa(t.c,a.c,s),l:sa(t.l,a.l,s),alpha:sa(t.alpha,a.alpha,s)}}},q=Object.freeze({__proto__:null,lab:N,hcl:O}),_e=function(t,a,s,h,m){this.type=t,this.operator=a,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(var x=0,S=m;x<S.length;x+=1){var T=S[x],k=T[1];this.labels.push(T[0]),this.outputs.push(k)}};function We(t,a,s,h){var m=h-s,x=t-s;return m===0?0:a===1?x/m:(Math.pow(a,x)-1)/(Math.pow(a,m)-1)}_e.interpolationFactor=function(t,a,s,h){var m=0;if(t.name==="exponential")m=We(a,t.base,s,h);else if(t.name==="linear")m=We(a,1,s,h);else if(t.name==="cubic-bezier"){var x=t.controlPoints;m=new F(x[0],x[1],x[2],x[3]).solve(We(a,1,s,h))}return m},_e.parse=function(t,a){var s=t[0],h=t[1],m=t[2],x=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var T=h.slice(1);if(T.length!==4||T.some(function(Ke){return typeof Ke!="number"||Ke<0||Ke>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(m=a.parse(m,2,Tt)))return null;var k=[],z=null;s==="interpolate-hcl"||s==="interpolate-lab"?z=Wr:a.expectedType&&a.expectedType.kind!=="value"&&(z=a.expectedType);for(var j=0;j<x.length;j+=2){var G=x[j],te=x[j+1],oe=j+3,Me=j+4;if(typeof G!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(k.length&&k[k.length-1][0]>=G)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);var Re=a.parse(te,Me,z);if(!Re)return null;z=z||Re.type,k.push([G,Re])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new _e(z,s,h,m,k):a.error("Type "+_i(z)+" is not interpolatable.")},_e.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var m=a.length;if(h>=a[m-1])return s[m-1].evaluate(t);var x=nu(a,h),S=_e.interpolationFactor(this.interpolation,h,a[x],a[x+1]),T=s[x].evaluate(t),k=s[x+1].evaluate(t);return this.operator==="interpolate"?po[this.type.kind.toLowerCase()](T,k,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(T),O.forward(k),S)):N.reverse(N.interpolate(N.forward(T),N.forward(k),S))},_e.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},_e.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_e.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var lt=function(t,a){this.type=t,this.args=a};lt.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,h=a.expectedType;h&&h.kind!=="value"&&(s=h);for(var m=[],x=0,S=t.slice(1);x<S.length;x+=1){var T=a.parse(S[x],1+m.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,m.push(T)}var k=h&&m.some(function(z){return Xi(h,z.type)});return new lt(k?en:s,m)},lt.prototype.evaluate=function(t){for(var a,s=null,h=0,m=0,x=this.args;m<x.length&&(h++,(s=x[m].evaluate(t))&&s instanceof Ca&&!s.available&&(a||(a=s.name),s=null,h===this.args.length&&(s=a)),s===null);m+=1);return s},lt.prototype.eachChild=function(t){this.args.forEach(t)},lt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},lt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var vt=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};vt.prototype.evaluate=function(t){return this.result.evaluate(t)},vt.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},vt.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],h=1;h<t.length-1;h+=2){var m=t[h];if(typeof m!="string")return a.error("Expected string, but found "+typeof m+" instead.",h);if(/[^a-zA-Z0-9_]/.test(m))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var x=a.parse(t[h+1],h+1);if(!x)return null;s.push([m,x])}var S=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return S?new vt(s,S):null},vt.prototype.outputDefined=function(){return this.result.outputDefined()},vt.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var h=s[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var lr=function(t,a,s){this.type=t,this.index=a,this.input=s};lr.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Tt),h=a.parse(t[2],2,Pi(a.expectedType||en));return s&&h?new lr(h.type.itemType,s,h):null},lr.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new Ba("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new Ba("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new Ba("Array index must be an integer, but found "+a+" instead.");return s[a]},lr.prototype.eachChild=function(t){t(this.index),t(this.input)},lr.prototype.outputDefined=function(){return!1},lr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Er=function(t,a){this.type=Vr,this.needle=t,this.haystack=a};Er.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,en),h=a.parse(t[2],2,en);return s&&h?La(s.type,[Vr,on,Tt,ln,en])?new Er(s,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead"):null},Er.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!oa(a,["boolean","string","number","null"]))throw new Ba("Expected first argument to be of type boolean, string, number or null, but found "+_i(ra(a))+" instead.");if(!oa(s,["string","array"]))throw new Ba("Expected second argument to be of type array or string, but found "+_i(ra(s))+" instead.");return s.indexOf(a)>=0},Er.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},Er.prototype.outputDefined=function(){return!0},Er.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Mn=function(t,a,s){this.type=Tt,this.needle=t,this.haystack=a,this.fromIndex=s};Mn.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,en),h=a.parse(t[2],2,en);if(!s||!h)return null;if(!La(s.type,[Vr,on,Tt,ln,en]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Tt);return m?new Mn(s,h,m):null}return new Mn(s,h)},Mn.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!oa(a,["boolean","string","number","null"]))throw new Ba("Expected first argument to be of type boolean, string, number or null, but found "+_i(ra(a))+" instead.");if(!oa(s,["string","array"]))throw new Ba("Expected second argument to be of type array or string, but found "+_i(ra(s))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return s.indexOf(a,h)}return s.indexOf(a)},Mn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Mn.prototype.outputDefined=function(){return!1},Mn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var li=function(t,a,s,h,m,x){this.inputType=t,this.type=a,this.input=s,this.cases=h,this.outputs=m,this.otherwise=x};li.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var m={},x=[],S=2;S<t.length-1;S+=2){var T=t[S],k=t[S+1];Array.isArray(T)||(T=[T]);var z=a.concat(S);if(T.length===0)return z.error("Expected at least one branch label.");for(var j=0,G=T;j<G.length;j+=1){var te=G[j];if(typeof te!="number"&&typeof te!="string")return z.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof te=="number"&&Math.floor(te)!==te)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,ra(te)))return null}else s=ra(te);if(m[String(te)]!==void 0)return z.error("Branch labels must be unique.");m[String(te)]=x.length}var oe=a.parse(k,S,h);if(!oe)return null;h=h||oe.type,x.push(oe)}var Me=a.parse(t[1],1,en);if(!Me)return null;var Re=a.parse(t[t.length-1],t.length-1,h);return Re?Me.type.kind!=="value"&&a.concat(1).checkSubtype(s,Me.type)?null:new li(s,h,Me,m,x,Re):null},li.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(ra(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},li.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},li.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},li.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],h={},m=0,x=Object.keys(this.cases).sort();m<x.length;m+=1){var S=x[m];(G=h[this.cases[S]])===void 0?(h[this.cases[S]]=s.length,s.push([this.cases[S],[S]])):s[G][1].push(S)}for(var T=function(oe){return t.inputType.kind==="number"?Number(oe):oe},k=0,z=s;k<z.length;k+=1){var j=z[k],G=j[0],te=j[1];a.push(te.length===1?T(te[0]):te.map(T)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var $n=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};$n.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var h=[],m=1;m<t.length-1;m+=2){var x=a.parse(t[m],m,Vr);if(!x)return null;var S=a.parse(t[m+1],m+1,s);if(!S)return null;h.push([x,S]),s=s||S.type}var T=a.parse(t[t.length-1],t.length-1,s);return T?new $n(s,h,T):null},$n.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],m=h[1];if(h[0].evaluate(t))return m.evaluate(t)}return this.otherwise.evaluate(t)},$n.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],m=h[1];t(h[0]),t(m)}t(this.otherwise)},$n.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},$n.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Yi=function(t,a,s,h){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=h};function fa(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Pa(t,a,s,h){return h.compare(a,s)===0}function Hi(t,a,s){var h=t!=="=="&&t!=="!=";return function(){function m(x,S,T){this.type=Vr,this.lhs=x,this.rhs=S,this.collator=T,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}return m.parse=function(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");var T=x[0],k=S.parse(x[1],1,en);if(!k)return null;if(!fa(T,k.type))return S.concat(1).error('"'+T+`" comparisons are not supported for type '`+_i(k.type)+"'.");var z=S.parse(x[2],2,en);if(!z)return null;if(!fa(T,z.type))return S.concat(2).error('"'+T+`" comparisons are not supported for type '`+_i(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+_i(k.type)+"' and '"+_i(z.type)+"'.");h&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new Ji(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new Ji(k.type,[z])));var j=null;if(x.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(j=S.parse(x[3],3,Ci)))return null}return new m(k,z,j)},m.prototype.evaluate=function(x){var S=this.lhs.evaluate(x),T=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){var k=ra(S),z=ra(T);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new Ba('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var j=ra(S),G=ra(T);if(j.kind!=="string"||G.kind!=="string")return a(x,S,T)}return this.collator?s(x,S,T,this.collator.evaluate(x)):a(x,S,T)},m.prototype.eachChild=function(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)},m.prototype.outputDefined=function(){return!0},m.prototype.serialize=function(){var x=[t];return this.eachChild(function(S){x.push(S.serialize())}),x},m}()}Yi.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,en),h=a.parse(t[2],2,Tt);if(!s||!h)return null;if(!La(s.type,[Pi(en),on,en]))return a.error("Expected first argument to be of type array or string, but found "+_i(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Tt);return m?new Yi(s.type,s,h,m):null}return new Yi(s.type,s,h)},Yi.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!oa(a,["string","array"]))throw new Ba("Expected first argument to be of type array or string, but found "+_i(ra(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(s,h)}return a.slice(s)},Yi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Mo=Hi("==",function(t,a,s){return a===s},Pa),_s=Hi("!=",function(t,a,s){return a!==s},function(t,a,s,h){return!Pa(0,a,s,h)}),sl=Hi("<",function(t,a,s){return a<s},function(t,a,s,h){return h.compare(a,s)<0}),Gc=Hi(">",function(t,a,s){return a>s},function(t,a,s,h){return h.compare(a,s)>0}),Vu=Hi("<=",function(t,a,s){return a<=s},function(t,a,s,h){return h.compare(a,s)<=0}),wc=Hi(">=",function(t,a,s){return a>=s},function(t,a,s,h){return h.compare(a,s)>=0}),wu=function(t,a,s,h,m){this.type=on,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=m};wu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Tt);if(!s)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var m=null;if(h.locale&&!(m=a.parse(h.locale,1,on)))return null;var x=null;if(h.currency&&!(x=a.parse(h.currency,1,on)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=a.parse(h["min-fraction-digits"],1,Tt)))return null;var T=null;return h["max-fraction-digits"]&&!(T=a.parse(h["max-fraction-digits"],1,Tt))?null:new wu(s,m,x,S,T)},wu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},wu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},wu.prototype.outputDefined=function(){return!1},wu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var cu=function(t){this.type=Tt,this.input=t};cu.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+_i(s.type)+" instead."):new cu(s):null},cu.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ba("Expected value to be of type string or array, but found "+_i(ra(a))+" instead.")},cu.prototype.eachChild=function(t){t(this.input)},cu.prototype.outputDefined=function(){return!1},cu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var xo={"==":Mo,"!=":_s,">":Gc,"<":sl,">=":wc,"<=":Vu,array:Ji,at:lr,boolean:Ji,case:$n,coalesce:lt,collator:Xo,format:Go,image:Ho,in:Er,"index-of":Mn,interpolate:_e,"interpolate-hcl":_e,"interpolate-lab":_e,length:cu,let:vt,literal:fo,match:li,number:Ji,"number-format":wu,object:Ji,slice:Yi,step:ds,string:Ji,"to-boolean":_o,"to-color":_o,"to-number":_o,"to-string":_o,var:be,within:En};function ha(t,a){var s=a[0],h=a[1],m=a[2],x=a[3];s=s.evaluate(t),h=h.evaluate(t),m=m.evaluate(t);var S=x?x.evaluate(t):1,T=ys(s,h,m,S);if(T)throw new Ba(T);return new Gi(s/255*S,h/255*S,m/255*S,S)}function th(t,a){return t in a}function rh(t,a){var s=a[t];return s===void 0?null:s}function uo(t){return{type:t}}function Mf(t){return{result:"success",value:t}}function fu(t){return{result:"error",value:t}}function Rs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Cc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function ul(t){return!!t.expression&&t.expression.interpolated}function ba(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function wl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Yl(t){return t}function es(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function Pf(t,a,s,h,m){return es(typeof s===m?h[s]:void 0,t.default,a.default)}function nh(t,a,s){if(ba(s)!=="number")return es(t.default,a.default);var h=t.stops.length;if(h===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[h-1][0])return t.stops[h-1][1];var m=nu(t.stops.map(function(x){return x[0]}),s);return t.stops[m][1]}function ih(t,a,s){var h=t.base!==void 0?t.base:1;if(ba(s)!=="number")return es(t.default,a.default);var m=t.stops.length;if(m===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[m-1][0])return t.stops[m-1][1];var x=nu(t.stops.map(function(G){return G[0]}),s),S=function(G,te,oe,Me){var Re=Me-oe,Ke=G-oe;return Re===0?0:te===1?Ke/Re:(Math.pow(te,Ke)-1)/(Math.pow(te,Re)-1)}(s,h,t.stops[x][0],t.stops[x+1][0]),T=t.stops[x][1],k=t.stops[x+1][1],z=po[a.type]||Yl;if(t.colorSpace&&t.colorSpace!=="rgb"){var j=q[t.colorSpace];z=function(G,te){return j.reverse(j.interpolate(j.forward(G),j.forward(te),S))}}return typeof T.evaluate=="function"?{evaluate:function(){for(var G=[],te=arguments.length;te--;)G[te]=arguments[te];var oe=T.evaluate.apply(void 0,G),Me=k.evaluate.apply(void 0,G);if(oe!==void 0&&Me!==void 0)return z(oe,Me,S)}}:z(T,k,S)}function Hc(t,a,s){return a.type==="color"?s=Gi.parse(s):a.type==="formatted"?s=wa.fromString(s.toString()):a.type==="resolvedImage"?s=Ca.fromString(s.toString()):ba(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),es(s,t.default,a.default)}ho.register(xo,{error:[{kind:"error"},[on],function(t,a){throw new Ba(a[0].evaluate(t))}],typeof:[on,[en],function(t,a){return _i(ra(a[0].evaluate(t)))}],"to-rgba":[Pi(Tt,4),[Wr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[Wr,[Tt,Tt,Tt],ha],rgba:[Wr,[Tt,Tt,Tt,Tt],ha],has:{type:Vr,overloads:[[[on],function(t,a){return th(a[0].evaluate(t),t.properties())}],[[on,ii],function(t,a){var s=a[1];return th(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:en,overloads:[[[on],function(t,a){return rh(a[0].evaluate(t),t.properties())}],[[on,ii],function(t,a){var s=a[1];return rh(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[en,[on],function(t,a){return rh(a[0].evaluate(t),t.featureState||{})}],properties:[ii,[],function(t){return t.properties()}],"geometry-type":[on,[],function(t){return t.geometryType()}],id:[en,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[en,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Tt,uo(Tt),function(t,a){for(var s=0,h=0,m=a;h<m.length;h+=1)s+=m[h].evaluate(t);return s}],"*":[Tt,uo(Tt),function(t,a){for(var s=1,h=0,m=a;h<m.length;h+=1)s*=m[h].evaluate(t);return s}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Tt],function(t,a){return-a[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Tt,[Tt],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Tt,[Tt],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Tt,[Tt],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Tt,[Tt],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Tt,[Tt],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Tt,[Tt],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Tt,uo(Tt),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Tt,uo(Tt),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Tt,[Tt],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Tt,[Tt],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Tt,[Tt],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Tt,[Tt],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Vr,[on,en],function(t,a){var s=a[0],h=a[1];return t.properties()[s.value]===h.value}],"filter-id-==":[Vr,[en],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[Vr,[on],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[Vr,[on,en],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],x=h.value;return typeof m==typeof x&&m<x}],"filter-id-<":[Vr,[en],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h<m}],"filter->":[Vr,[on,en],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],x=h.value;return typeof m==typeof x&&m>x}],"filter-id->":[Vr,[en],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h>m}],"filter-<=":[Vr,[on,en],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],x=h.value;return typeof m==typeof x&&m<=x}],"filter-id-<=":[Vr,[en],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h<=m}],"filter->=":[Vr,[on,en],function(t,a){var s=a[0],h=a[1],m=t.properties()[s.value],x=h.value;return typeof m==typeof x&&m>=x}],"filter-id->=":[Vr,[en],function(t,a){var s=a[0],h=t.id(),m=s.value;return typeof h==typeof m&&h>=m}],"filter-has":[Vr,[en],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Vr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Vr,[Pi(on)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Vr,[Pi(en)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Vr,[on,Pi(en)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[Vr,[on,Pi(en)],function(t,a){var s=a[0],h=a[1];return function(m,x,S,T){for(;S<=T;){var k=S+T>>1;if(x[k]===m)return!0;x[k]>m?T=k-1:S=k+1}return!1}(t.properties()[s.value],h.value,0,h.value.length-1)}],all:{type:Vr,overloads:[[[Vr,Vr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[uo(Vr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(!h[s].evaluate(t))return!1;return!0}]]},any:{type:Vr,overloads:[[[Vr,Vr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[uo(Vr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(h[s].evaluate(t))return!0;return!1}]]},"!":[Vr,[Vr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Vr,[on],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[on,[on],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[on,[on],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[on,uo(en),function(t,a){return a.map(function(s){return Bu(s.evaluate(t))}).join("")}],"resolved-locale":[on,[Ci],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var ll=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new ma,this._defaultValue=a?function(s){return s.type==="color"&&wl(s.default)?new Gi(0,0,0,0):s.type==="color"?Gi.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function Bo(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in xo}function Cu(t,a){var s=new Gs(xo,[],a?function(m){var x={color:Wr,string:on,number:Tt,enum:on,boolean:Vr,formatted:ta,resolvedImage:gi};return m.type==="array"?Pi(x[m.value]||en,m.length):x[m.type]}(a):void 0),h=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Mf(new ll(h,a)):fu(s.errors)}ll.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,m,x){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)},ll.prototype.evaluate=function(t,a,s,h,m,x){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=x||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ba("Expected value to be one of "+Object.keys(this._enumValues).map(function(T){return JSON.stringify(T)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console!="undefined"&&console.warn(T.message)),this._defaultValue}};var Gu=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Qt(a.expression)};Gu.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,m,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,m,x)},Gu.prototype.evaluate=function(t,a,s,h,m,x){return this._styleExpression.evaluate(t,a,s,h,m,x)};var zo=function(t,a,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Qt(a.expression),this.interpolationType=h};function Cl(t,a){if((t=Cu(t,a)).result==="error")return t;var s=t.value.expression,h=vn(s);if(!h&&!Rs(a))return fu([new gr("","data expressions not supported")]);var m=No(s,["zoom"]);if(!m&&!Cc(a))return fu([new gr("","zoom expressions not supported")]);var x=function S(T){var k=null;if(T instanceof vt)k=S(T.result);else if(T instanceof lt)for(var z=0,j=T.args;z<j.length&&!(k=S(j[z]));z+=1);else(T instanceof ds||T instanceof _e)&&T.input instanceof ho&&T.input.name==="zoom"&&(k=T);return k instanceof gr||T.eachChild(function(G){var te=S(G);te instanceof gr?k=te:!k&&te?k=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&te&&k!==te&&(k=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(s);return x||m?x instanceof gr?fu([x]):x instanceof _e&&!ul(a)?fu([new gr("",'"interpolate" expressions cannot be used with this property')]):Mf(x?new zo(h?"camera":"composite",t.value,x.labels,x instanceof _e?x.interpolation:void 0):new Gu(h?"constant":"source",t.value)):fu([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}zo.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,m,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,m,x)},zo.prototype.evaluate=function(t,a,s,h,m,x){return this._styleExpression.evaluate(t,a,s,h,m,x)},zo.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?_e.interpolationFactor(this.interpolationType,t,a,s):0};var Hu=function(t,a){this._parameters=t,this._specification=a,vr(this,function s(h,m){var x,S,T,k=m.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",j=z||!(z||h.property!==void 0),G=h.type||(ul(m)?"exponential":"interval");if(k&&((h=vr({},h)).stops&&(h.stops=h.stops.map(function(cn){return[cn[0],Gi.parse(cn[1])]})),h.default=Gi.parse(h.default?h.default:m.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!q[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(G==="exponential")x=ih;else if(G==="interval")x=nh;else if(G==="categorical"){x=Pf,S=Object.create(null);for(var te=0,oe=h.stops;te<oe.length;te+=1){var Me=oe[te];S[Me[0]]=Me[1]}T=typeof h.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');x=Hc}if(z){for(var Re={},Ke=[],ze=0;ze<h.stops.length;ze++){var at=h.stops[ze],St=at[0].zoom;Re[St]===void 0&&(Re[St]={zoom:St,type:h.type,property:h.property,default:h.default,stops:[]},Ke.push(St)),Re[St].stops.push([at[0].value,at[1]])}for(var Zt=[],Wt=0,cr=Ke;Wt<cr.length;Wt+=1){var Mr=cr[Wt];Zt.push([Re[Mr].zoom,s(Re[Mr],m)])}var Pr={name:"linear"};return{kind:"composite",interpolationType:Pr,interpolationFactor:_e.interpolationFactor.bind(void 0,Pr),zoomStops:Zt.map(function(cn){return cn[0]}),evaluate:function(cn,Nn){var fn=cn.zoom;return ih({stops:Zt,base:h.base},m,fn).evaluate(fn,Nn)}}}if(j){var Rn=G==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Rn,interpolationFactor:_e.interpolationFactor.bind(void 0,Rn),zoomStops:h.stops.map(function(cn){return cn[0]}),evaluate:function(cn){return x(h,m,cn.zoom,S,T)}}}return{kind:"source",evaluate:function(cn,Nn){var fn=Nn&&Nn.properties?Nn.properties[h.property]:void 0;return fn===void 0?es(h.default,m.default):x(h,m,fn,S,T)}}}(this._parameters,this._specification))};function Hs(t){var a=t.key,s=t.value,h=t.valueSpec||{},m=t.objectElementValidators||{},x=t.style,S=t.styleSpec,T=[],k=ba(s);if(k!=="object")return[new De(a,s,"object expected, "+k+" found")];for(var z in s){var j=z.split(".")[0],G=h[j]||h["*"],te=void 0;if(m[j])te=m[j];else if(h[j])te=Di;else if(m["*"])te=m["*"];else{if(!h["*"]){T.push(new De(a,s[z],'unknown property "'+z+'"'));continue}te=Di}T=T.concat(te({key:(a&&a+".")+z,value:s[z],valueSpec:G,style:x,styleSpec:S,object:s,objectKey:z},s))}for(var oe in h)m[oe]||h[oe].required&&h[oe].default===void 0&&s[oe]===void 0&&T.push(new De(a,s,'missing required property "'+oe+'"'));return T}function Wc(t){var a=t.value,s=t.valueSpec,h=t.style,m=t.styleSpec,x=t.key,S=t.arrayElementValidator||Di;if(ba(a)!=="array")return[new De(x,a,"array expected, "+ba(a)+" found")];if(s.length&&a.length!==s.length)return[new De(x,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new De(x,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var T={type:s.value,values:s.values};m.$version<7&&(T.function=s.function),ba(s.value)==="object"&&(T=s.value);for(var k=[],z=0;z<a.length;z++)k=k.concat(S({array:a,arrayIndex:z,value:a[z],valueSpec:T,style:h,styleSpec:m,key:x+"["+z+"]"}));return k}function Xc(t){var a=t.key,s=t.value,h=t.valueSpec,m=ba(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new De(a,s,"number expected, "+m+" found")]:"minimum"in h&&s<h.minimum?[new De(a,s,s+" is less than the minimum value "+h.minimum)]:"maximum"in h&&s>h.maximum?[new De(a,s,s+" is greater than the maximum value "+h.maximum)]:[]}function Yc(t){var a,s,h,m=t.valueSpec,x=Lt(t.value.type),S={},T=x!=="categorical"&&t.value.property===void 0,k=!T,z=ba(t.value.stops)==="array"&&ba(t.value.stops[0])==="array"&&ba(t.value.stops[0][0])==="object",j=Hs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(oe){if(x==="identity")return[new De(oe.key,oe.value,'identity function may not have a "stops" property')];var Me=[],Re=oe.value;return Me=Me.concat(Wc({key:oe.key,value:Re,valueSpec:oe.valueSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:G})),ba(Re)==="array"&&Re.length===0&&Me.push(new De(oe.key,Re,"array must have at least one stop")),Me},default:function(oe){return Di({key:oe.key,value:oe.value,valueSpec:m,style:oe.style,styleSpec:oe.styleSpec})}}});return x==="identity"&&T&&j.push(new De(t.key,t.value,'missing required property "property"')),x==="identity"||t.value.stops||j.push(new De(t.key,t.value,'missing required property "stops"')),x==="exponential"&&t.valueSpec.expression&&!ul(t.valueSpec)&&j.push(new De(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Rs(t.valueSpec)?j.push(new De(t.key,t.value,"property functions not supported")):T&&!Cc(t.valueSpec)&&j.push(new De(t.key,t.value,"zoom functions not supported"))),x!=="categorical"&&!z||t.value.property!==void 0||j.push(new De(t.key,t.value,'"property" property is required')),j;function G(oe){var Me=[],Re=oe.value,Ke=oe.key;if(ba(Re)!=="array")return[new De(Ke,Re,"array expected, "+ba(Re)+" found")];if(Re.length!==2)return[new De(Ke,Re,"array length 2 expected, length "+Re.length+" found")];if(z){if(ba(Re[0])!=="object")return[new De(Ke,Re,"object expected, "+ba(Re[0])+" found")];if(Re[0].zoom===void 0)return[new De(Ke,Re,"object stop key must have zoom")];if(Re[0].value===void 0)return[new De(Ke,Re,"object stop key must have value")];if(h&&h>Lt(Re[0].zoom))return[new De(Ke,Re[0].zoom,"stop zoom values must appear in ascending order")];Lt(Re[0].zoom)!==h&&(h=Lt(Re[0].zoom),s=void 0,S={}),Me=Me.concat(Hs({key:Ke+"[0]",value:Re[0],valueSpec:{zoom:{}},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:Xc,value:te}}))}else Me=Me.concat(te({key:Ke+"[0]",value:Re[0],valueSpec:{},style:oe.style,styleSpec:oe.styleSpec},Re));return Bo(Dt(Re[1]))?Me.concat([new De(Ke+"[1]",Re[1],"expressions are not allowed in function stops.")]):Me.concat(Di({key:Ke+"[1]",value:Re[1],valueSpec:m,style:oe.style,styleSpec:oe.styleSpec}))}function te(oe,Me){var Re=ba(oe.value),Ke=Lt(oe.value),ze=oe.value!==null?oe.value:Me;if(a){if(Re!==a)return[new De(oe.key,ze,Re+" stop domain type must match previous stop domain type "+a)]}else a=Re;if(Re!=="number"&&Re!=="string"&&Re!=="boolean")return[new De(oe.key,ze,"stop domain value must be a number, string, or boolean")];if(Re!=="number"&&x!=="categorical"){var at="number expected, "+Re+" found";return Rs(m)&&x===void 0&&(at+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(oe.key,ze,at)]}return x!=="categorical"||Re!=="number"||isFinite(Ke)&&Math.floor(Ke)===Ke?x!=="categorical"&&Re==="number"&&s!==void 0&&Ke<s?[new De(oe.key,ze,"stop domain values must appear in ascending order")]:(s=Ke,x==="categorical"&&Ke in S?[new De(oe.key,ze,"stop domain values must be unique")]:(S[Ke]=!0,[])):[new De(oe.key,ze,"integer expected, found "+Ke)]}}function Wu(t){var a=(t.expressionContext==="property"?Cl:Cu)(Dt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new De(""+t.key+h.key,t.value,h.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new De(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Qt(s))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Qt(s))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!No(s,["zoom","feature-state"]))return[new De(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!vn(s))return[new De(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ql(t){var a=t.key,s=t.value,h=t.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(Lt(s))===-1&&m.push(new De(a,s,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(h.values).indexOf(Lt(s))===-1&&m.push(new De(a,s,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(s)+" found")),m}function Ac(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var h=s[a];if(!Ac(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Hu.deserialize=function(t){return new Hu(t._parameters,t._specification)},Hu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var qc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Ac(t)||(t=Mc(t));var a=Cu(t,qc);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,h,m){return a.value.evaluate(s,h,{},m)},needGeometry:function s(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var m=1;m<h.length;m++)if(s(h[m]))return!0;return!1}(t)}}function ah(t,a){return t<a?-1:t>a?1:0}function Mc(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?cl(t[1],t[2],"=="):s==="!="?Au(cl(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?cl(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(Mc))):s==="all"?["all"].concat(t.slice(1).map(Mc)):s==="none"?["all"].concat(t.slice(1).map(Mc).map(Au)):s==="in"?Kc(t[1],t.slice(2)):s==="!in"?Au(Kc(t[1],t.slice(2))):s==="has"?$c(t[1]):s==="!has"?Au($c(t[1])):s!=="within"||t}function cl(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function Kc(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(ah)]]:["filter-in-small",t,["literal",a]]}}function $c(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Au(t){return["!",t]}function Jc(t){return Ac(Dt(t.value))?Wu(vr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var h=s.value,m=s.key;if(ba(h)!=="array")return[new De(m,h,"array expected, "+ba(h)+" found")];var x,S=s.styleSpec,T=[];if(h.length<1)return[new De(m,h,"filter array must have at least 1 element")];switch(T=T.concat(ql({key:m+"[0]",value:h[0],valueSpec:S.filter_operator,style:s.style,styleSpec:s.styleSpec})),Lt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Lt(h[1])==="$type"&&T.push(new De(m,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&T.push(new De(m,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(x=ba(h[1]))!=="string"&&T.push(new De(m+"[1]",h[1],"string expected, "+x+" found"));for(var k=2;k<h.length;k++)x=ba(h[k]),Lt(h[1])==="$type"?T=T.concat(ql({key:m+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:s.style,styleSpec:s.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&T.push(new De(m+"["+k+"]",h[k],"string, number, or boolean expected, "+x+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)T=T.concat(a({key:m+"["+z+"]",value:h[z],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":x=ba(h[1]),h.length!==2?T.push(new De(m,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="string"&&T.push(new De(m+"[1]",h[1],"string expected, "+x+" found"));break;case"within":x=ba(h[1]),h.length!==2?T.push(new De(m,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="object"&&T.push(new De(m+"[1]",h[1],"object expected, "+x+" found"))}return T}(t)}function If(t,a){var s=t.key,h=t.style,m=t.styleSpec,x=t.value,S=t.objectKey,T=m[a+"_"+t.layerType];if(!T)return[];var k=S.match(/^(.*)-transition$/);if(a==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return Di({key:s,value:x,valueSpec:m.transition,style:h,styleSpec:m});var z,j=t.valueSpec||T[S];if(!j)return[new De(s,x,'unknown property "'+S+'"')];if(ba(x)==="string"&&Rs(j)&&!j.tokens&&(z=/^{([^}]+)}$/.exec(x)))return[new De(s,x,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&G.push(new De(s,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&wl(Dt(x))&&Lt(x.type)==="identity"&&G.push(new De(s,x,'"text-font" does not support identity functions'))),G.concat(Di({key:t.key,value:x,valueSpec:j,style:h,styleSpec:m,expressionContext:"property",propertyType:a,propertyKey:S}))}function oh(t){return If(t,"paint")}function Al(t){return If(t,"layout")}function Yh(t){var a=[],s=t.value,h=t.key,m=t.style,x=t.styleSpec;s.type||s.ref||a.push(new De(h,s,'either "type" or "ref" is required'));var S,T=Lt(s.type),k=Lt(s.ref);if(s.id)for(var z=Lt(s.id),j=0;j<t.arrayIndex;j++){var G=m.layers[j];Lt(G.id)===z&&a.push(new De(h,s.id,'duplicate layer id "'+s.id+'", previously used at line '+G.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in s&&a.push(new De(h,s[Me],'"'+Me+'" is prohibited for ref layers'))}),m.layers.forEach(function(Me){Lt(Me.id)===k&&(S=Me)}),S?S.ref?a.push(new De(h,s.ref,"ref cannot reference another ref layer")):T=Lt(S.type):a.push(new De(h,s.ref,'ref layer "'+k+'" not found'));else if(T!=="background")if(s.source){var te=m.sources&&m.sources[s.source],oe=te&&Lt(te.type);te?oe==="vector"&&T==="raster"?a.push(new De(h,s.source,'layer "'+s.id+'" requires a raster source')):oe==="raster"&&T!=="raster"?a.push(new De(h,s.source,'layer "'+s.id+'" requires a vector source')):oe!=="vector"||s["source-layer"]?oe==="raster-dem"&&T!=="hillshade"?a.push(new De(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!s.paint||!s.paint["line-gradient"]||oe==="geojson"&&te.lineMetrics||a.push(new De(h,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new De(h,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new De(h,s.source,'source "'+s.source+'" not found'))}else a.push(new De(h,s,'missing required property "source"'));return a=a.concat(Hs({key:h,value:s,valueSpec:x.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Di({key:h+".type",value:s.type,valueSpec:x.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Jc,layout:function(Me){return Hs({layer:s,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Re){return Al(vr({layerType:T},Re))}}})},paint:function(Me){return Hs({layer:s,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Re){return oh(vr({layerType:T},Re))}}})}}}))}function ts(t){var a=t.value,s=t.key,h=ba(a);return h!=="string"?[new De(s,a,"string expected, "+h+" found")]:[]}var Ha={promoteId:function(t){var a=t.key,s=t.value;if(ba(s)==="string")return ts({key:a,value:s});var h=[];for(var m in s)h.push.apply(h,ts({key:a+"."+m,value:s[m]}));return h}};function Kl(t){var a=t.value,s=t.key,h=t.styleSpec,m=t.style;if(!a.type)return[new De(s,a,'"type" is required')];var x,S=Lt(a.type);switch(S){case"vector":case"raster":case"raster-dem":return Hs({key:s,value:a,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Ha});case"geojson":if(x=Hs({key:s,value:a,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:Ha}),a.cluster)for(var T in a.clusterProperties){var k=a.clusterProperties[T],z=k[0],j=typeof z=="string"?[z,["accumulated"],["get",T]]:z;x.push.apply(x,Wu({key:s+"."+T+".map",value:k[1],expressionContext:"cluster-map"})),x.push.apply(x,Wu({key:s+"."+T+".reduce",value:j,expressionContext:"cluster-reduce"}))}return x;case"video":return Hs({key:s,value:a,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return Hs({key:s,value:a,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new De(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ql({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:h})}}function Tl(t){var a=t.value,s=t.styleSpec,h=s.light,m=t.style,x=[],S=ba(a);if(a===void 0)return x;if(S!=="object")return x.concat([new De("light",a,"object expected, "+S+" found")]);for(var T in a){var k=T.match(/^(.*)-transition$/);x=x.concat(k&&h[k[1]]&&h[k[1]].transition?Di({key:T,value:a[T],valueSpec:s.transition,style:m,styleSpec:s}):h[T]?Di({key:T,value:a[T],valueSpec:h[T],style:m,styleSpec:s}):[new De(T,a[T],'unknown property "'+T+'"')])}return x}var au={"*":function(){return[]},array:Wc,boolean:function(t){var a=t.value,s=t.key,h=ba(a);return h!=="boolean"?[new De(s,a,"boolean expected, "+h+" found")]:[]},number:Xc,color:function(t){var a=t.key,s=t.value,h=ba(s);return h!=="string"?[new De(a,s,"color expected, "+h+" found")]:Ii(s)===null?[new De(a,s,'color expected, "'+s+'" found')]:[]},constants:yt,enum:ql,filter:Jc,function:Yc,layer:Yh,object:Hs,source:Kl,light:Tl,string:ts,formatted:function(t){return ts(t).length===0?[]:Wu(t)},resolvedImage:function(t){return ts(t).length===0?[]:Wu(t)}};function Di(t){var a=t.value,s=t.valueSpec,h=t.styleSpec;return s.expression&&wl(Lt(a))?Yc(t):s.expression&&Bo(Dt(a))?Wu(t):s.type&&au[s.type]?au[s.type](t):Hs(vr({},t,{valueSpec:s.type?h[s.type]:s}))}function ka(t){var a=t.value,s=t.key,h=ts(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new De(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new De(s,a,'"glyphs" url must include a "{range}" token'))),h}function Ls(t,a){a===void 0&&(a=pe);var s=[];return s=s.concat(Di({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:ka,"*":function(){return[]}}})),t.constants&&(s=s.concat(yt({key:"constants",value:t.constants,style:t,styleSpec:a}))),Qc(s)}function Qc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function fl(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return Qc(t.apply(this,a))}}Ls.source=fl(Kl),Ls.light=fl(Tl),Ls.layer=fl(Yh),Ls.filter=fl(Jc),Ls.paintProperty=fl(oh),Ls.layoutProperty=fl(Al);var ef=Ls,qh=ef.light,Kh=ef.paintProperty,Pc=ef.layoutProperty;function $l(t,a){var s=!1;if(a&&a.length)for(var h=0,m=a;h<m.length;h+=1)t.fire(new Ve(new Error(m[h].message))),s=!0;return s}var Xu=Po;function Po(t,a,s){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(a=m[1])+2*(s=m[2]);for(var x=0;x<this.d*this.d;x++){var S=m[3+x],T=m[3+x+1];h.push(S===T?null:m.subarray(S,T))}var k=m[3+h.length+1];this.keys=m.subarray(m[3+h.length],k),this.bboxes=m.subarray(k),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var j=s/a*t;this.min=-j,this.max=t+j}Po.prototype.insert=function(t,a,s,h,m){this._forEachCell(a,s,h,m,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m)},Po.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Po.prototype._insertCell=function(t,a,s,h,m,x){this.cells[m].push(x)},Po.prototype.query=function(t,a,s,h,m){var x=this.min,S=this.max;if(t<=x&&a<=x&&S<=s&&S<=h&&!m)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(t,a,s,h,this._queryCell,T,{},m),T},Po.prototype._queryCell=function(t,a,s,h,m,x,S,T){var k=this.cells[m];if(k!==null)for(var z=this.keys,j=this.bboxes,G=0;G<k.length;G++){var te=k[G];if(S[te]===void 0){var oe=4*te;(T?T(j[oe+0],j[oe+1],j[oe+2],j[oe+3]):t<=j[oe+2]&&a<=j[oe+3]&&s>=j[oe+0]&&h>=j[oe+1])?(S[te]=!0,x.push(z[te])):S[te]=!1}}},Po.prototype._forEachCell=function(t,a,s,h,m,x,S,T){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(a),j=this._convertToCellCoord(s),G=this._convertToCellCoord(h),te=k;te<=j;te++)for(var oe=z;oe<=G;oe++){var Me=this.d*oe+te;if((!T||T(this._convertFromCellCoord(te),this._convertFromCellCoord(oe),this._convertFromCellCoord(te+1),this._convertFromCellCoord(oe+1)))&&m.call(this,t,a,s,h,Me,x,S,T))return}},Po.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Po.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Po.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var m=new Int32Array(a+s+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=a,S=0;S<t.length;S++){var T=t[S];m[3+S]=x,m.set(T,x),x+=T.length}return m[3+t.length]=x,m.set(this.keys,x),m[3+t.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer};var Jl=ne.ImageData,Ql=ne.ImageBitmap,qa={};function mn(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),qa[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var no in mn("Object",Object),Xu.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Xu.deserialize=function(t){return new Xu(t.buffer)},mn("Grid",Xu),mn("Color",Gi),mn("Error",Error),mn("ResolvedImage",Ca),mn("StylePropertyFunction",Hu),mn("StyleExpression",ll,{omit:["_evaluator"]}),mn("ZoomDependentExpression",zo),mn("ZoomConstantExpression",Gu),mn("CompoundExpression",ho,{omit:["_evaluate"]}),xo)xo[no]._classRegistryKey||mn("Expression_"+no,xo[no]);function Yu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function qu(t){return Ql&&t instanceof Ql}function hu(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Yu(t)||qu(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof Jl)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],m=0,x=t;m<x.length;m+=1)h.push(hu(x[m],a));return h}if(typeof t=="object"){var S=t.constructor,T=S._classRegistryKey;if(!T)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,a):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(qa[T].omit.indexOf(z)>=0)){var j=t[z];k[z]=qa[T].shallow.indexOf(z)>=0?j:hu(j,a)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return T!=="Object"&&(k.$name=T),k}throw new Error("can't serialize object of type "+typeof t)}function ks(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Yu(t)||qu(t)||ArrayBuffer.isView(t)||t instanceof Jl)return t;if(Array.isArray(t))return t.map(ks);if(typeof t=="object"){var a=t.$name||"Object",s=qa[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var h=Object.create(s.prototype),m=0,x=Object.keys(t);m<x.length;m+=1){var S=x[m];if(S!=="$name"){var T=t[S];h[S]=qa[a].shallow.indexOf(S)>=0?T:ks(T)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Of=function(){this.first=!0};Of.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var Kr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function tf(t){for(var a=0,s=t;a<s.length;a+=1)if(Rf(s[a].charCodeAt(0)))return!0;return!1}function Rf(t){return!(t!==746&&t!==747&&(t<4352||!(Kr["Bopomofo Extended"](t)||Kr.Bopomofo(t)||Kr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Kr["CJK Compatibility Ideographs"](t)||Kr["CJK Compatibility"](t)||Kr["CJK Radicals Supplement"](t)||Kr["CJK Strokes"](t)||!(!Kr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Kr["CJK Unified Ideographs Extension A"](t)||Kr["CJK Unified Ideographs"](t)||Kr["Enclosed CJK Letters and Months"](t)||Kr["Hangul Compatibility Jamo"](t)||Kr["Hangul Jamo Extended-A"](t)||Kr["Hangul Jamo Extended-B"](t)||Kr["Hangul Jamo"](t)||Kr["Hangul Syllables"](t)||Kr.Hiragana(t)||Kr["Ideographic Description Characters"](t)||Kr.Kanbun(t)||Kr["Kangxi Radicals"](t)||Kr["Katakana Phonetic Extensions"](t)||Kr.Katakana(t)&&t!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Kr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](t)||Kr["Unified Canadian Aboriginal Syllabics Extended"](t)||Kr["Vertical Forms"](t)||Kr["Yijing Hexagram Symbols"](t)||Kr["Yi Syllables"](t)||Kr["Yi Radicals"](t))))}function Tu(t){return!(Rf(t)||function(a){return!!(Kr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Kr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Kr["Letterlike Symbols"](a)||Kr["Number Forms"](a)||Kr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Kr["Control Pictures"](a)&&a!==9251||Kr["Optical Character Recognition"](a)||Kr["Enclosed Alphanumerics"](a)||Kr["Geometric Shapes"](a)||Kr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Kr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Kr["CJK Symbols and Punctuation"](a)||Kr.Katakana(a)||Kr["Private Use Area"](a)||Kr["CJK Compatibility Forms"](a)||Kr["Small Form Variants"](a)||Kr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function za(t){return t>=1424&&t<=2303||Kr["Arabic Presentation Forms-A"](t)||Kr["Arabic Presentation Forms-B"](t)}function Ds(t,a){return!(!a&&za(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Kr.Khmer(t))}function rf(t){for(var a=0,s=t;a<s.length;a+=1)if(za(s[a].charCodeAt(0)))return!0;return!1}var Mu=null,ws="unavailable",bo=null,sh=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ws="error"),Mu&&Mu(t)};function ga(){Lf.fire(new Ie("pluginStateChange",{pluginStatus:ws,pluginURL:bo}))}var Lf=new rt,uh=function(){return ws},Ws=function(){if(ws!=="deferred"||!bo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws="loading",ga(),bo&&Ra({url:bo},function(t){t?sh(t):(ws="loaded",ga())})},Cs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ws==="loaded"||Cs.applyArabicShaping!=null},isLoading:function(){return ws==="loading"},setState:function(t){ws=t.pluginStatus,bo=t.pluginURL},isParsed:function(){return Cs.applyArabicShaping!=null&&Cs.processBidirectionalText!=null&&Cs.processStyledBidirectionalText!=null},getPluginURL:function(){return bo}},Oi=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Of,this.transition={})};Oi.prototype.isSupportedScript=function(t){return function(a,s){for(var h=0,m=a;h<m.length;h+=1)if(!Ds(m[h].charCodeAt(0),s))return!1;return!0}(t,Cs.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var pu=function(t,a){this.property=t,this.value=a,this.expression=function(s,h){if(wl(s))return new Hu(s,h);if(Bo(s)){var m=Cl(s,h);if(m.result==="error")throw new Error(m.value.map(function(S){return S.key+": "+S.message}).join(", "));return m.value}var x=s;return typeof s=="string"&&h.type==="color"&&(x=Gi.parse(s)),{kind:"constant",evaluate:function(){return x}}}(a===void 0?t.specification.default:a,t.specification)};pu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},pu.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var pa=function(t){this.property=t,this.value=new pu(t,void 0)};pa.prototype.transitioned=function(t,a){return new Fs(this.property,this.value,a,_t({},t.transition,this.transition),t.now)},pa.prototype.untransitioned=function(){return new Fs(this.property,this.value,null,{},0)};var lo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};lo.prototype.getValue=function(t){return qe(this._values[t].value.value)},lo.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new pa(this._values[t].property)),this._values[t].value=new pu(this._values[t].property,a===null?void 0:qe(a))},lo.prototype.getTransition=function(t){return qe(this._values[t].transition)},lo.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new pa(this._values[t].property)),this._values[t].transition=qe(a)||void 0},lo.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],m=this.getValue(h);m!==void 0&&(t[h]=m);var x=this.getTransition(h);x!==void 0&&(t[h+"-transition"]=x)}return t},lo.prototype.transitioned=function(t,a){for(var s=new ou(this._properties),h=0,m=Object.keys(this._values);h<m.length;h+=1){var x=m[h];s._values[x]=this._values[x].transitioned(t,a._values[x])}return s},lo.prototype.untransitioned=function(){for(var t=new ou(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a];t._values[h]=this._values[h].untransitioned()}return t};var Fs=function(t,a,s,h,m){this.property=t,this.value=a,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)};Fs.prototype.possiblyEvaluate=function(t,a,s){var h=t.now||0,m=this.value.possiblyEvaluate(t,a,s),x=this.prior;if(x){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return x.possiblyEvaluate(t,a,s);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,a,s),m,function(T){if(T<=0)return 0;if(T>=1)return 1;var k=T*T,z=k*T;return 4*(T<.5?z:3*(T-k)+z-.75)}(S))}return m};var ou=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};ou.prototype.possiblyEvaluate=function(t,a,s){for(var h=new Bs(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var S=x[m];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h},ou.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Ns=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ns.prototype.getValue=function(t){return qe(this._values[t].value)},Ns.prototype.setValue=function(t,a){this._values[t]=new pu(this._values[t].property,a===null?void 0:qe(a))},Ns.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],m=this.getValue(h);m!==void 0&&(t[h]=m)}return t},Ns.prototype.possiblyEvaluate=function(t,a,s){for(var h=new Bs(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var S=x[m];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h};var vs=function(t,a,s){this.property=t,this.value=a,this.parameters=s};vs.prototype.isConstant=function(){return this.value.kind==="constant"},vs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},vs.prototype.evaluate=function(t,a,s,h){return this.property.evaluate(this.value,this.parameters,t,a,s,h)};var Bs=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Bs.prototype.get=function(t){return this._values[t]};var Pn=function(t){this.specification=t};Pn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},Pn.prototype.interpolate=function(t,a,s){var h=po[this.specification.type];return h?h(t,a,s):t};var wn=function(t,a){this.specification=t,this.overrides=a};wn.prototype.possiblyEvaluate=function(t,a,s,h){return new vs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,h)}:t.expression,a)},wn.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new vs(this,{kind:"constant",value:void 0},t.parameters);var h=po[this.specification.type];return h?new vs(this,{kind:"constant",value:h(t.value.value,a.value.value,s)},t.parameters):t},wn.prototype.evaluate=function(t,a,s,h,m,x){return t.kind==="constant"?t.value:t.evaluate(a,s,h,m,x)};var ec=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h,m,x){if(s.value===void 0)return new vs(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){var S=s.expression.evaluate(h,null,{},m,x),T=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(T,T,T,h);return new vs(this,{kind:"constant",value:k},h)}if(s.expression.kind==="camera"){var z=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new vs(this,{kind:"constant",value:z},h)}return new vs(this,s.expression,h)},a.prototype.evaluate=function(s,h,m,x,S,T){if(s.kind==="source"){var k=s.evaluate(h,m,x,S,T);return this._calculate(k,k,k,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},m,x),s.evaluate({zoom:Math.floor(h.zoom)},m,x),s.evaluate({zoom:Math.floor(h.zoom)+1},m,x),h):s.value},a.prototype._calculate=function(s,h,m,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}},a.prototype.interpolate=function(s){return s},a}(wn),ms=function(t){this.specification=t};ms.prototype.possiblyEvaluate=function(t,a,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var m=t.expression.evaluate(a,null,{},s,h);return this._calculate(m,m,m,a)}return this._calculate(t.expression.evaluate(new Oi(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Oi(Math.floor(a.zoom),a)),t.expression.evaluate(new Oi(Math.floor(a.zoom+1),a)),a)}},ms.prototype._calculate=function(t,a,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},ms.prototype.interpolate=function(t){return t};var du=function(t){this.specification=t};du.prototype.possiblyEvaluate=function(t,a,s,h){return!!t.expression.evaluate(a,null,{},s,h)},du.prototype.interpolate=function(){return!1};var qo=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new pu(s,void 0),m=this.defaultTransitionablePropertyValues[a]=new pa(s);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};mn("DataDrivenProperty",wn),mn("DataConstantProperty",Pn),mn("CrossFadedDataDrivenProperty",ec),mn("CrossFadedProperty",ms),mn("ColorRampProperty",du);var Ea=function(t){function a(s,h){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Ns(h.layout)),h.paint)){for(var m in this._transitionablePaint=new lo(h.paint),s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(var x in s.layout)this.setLayoutProperty(x,s.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bs(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,h,m){m===void 0&&(m={}),h!=null&&this._validate(Pc,"layers."+this.id+".layout."+s,s,h,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)},a.prototype.getPaintProperty=function(s){return X(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,h,m){if(m===void 0&&(m={}),h!=null&&this._validate(Kh,"layers."+this.id+".paint."+s,s,h,m))return!1;if(X(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),h||void 0),!1;var x=this._transitionablePaint._values[s],S=x.property.specification["property-type"]==="cross-faded-data-driven",T=x.value.isDataDriven(),k=x.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);var z=this._transitionablePaint._values[s].value;return z.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(s,k,z)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,m){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),dt(s,function(h,m){return!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(s,h,m,x,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&$l(this,s.call(ef,{key:h,layerType:this.type,objectKey:m,value:x,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var h=this.paint.get(s);if(h instanceof vs&&Rs(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(rt),Ic={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Oc=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},da=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Aa(t,a){a===void 0&&(a=1);var s=0,h=0;return{members:t.map(function(m){var x=Ic[m.type].BYTES_PER_ELEMENT,S=s=Rc(s,Math.max(a,x)),T=m.components||1;return h=Math.max(h,x),s+=x*T,{name:m.name,type:m.type,components:T,offset:S}}),size:Rc(s,Math.max(h,a)),alignment:a}}function Rc(t,a){return Math.ceil(t/a)*a}da.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},da.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},da.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},da.prototype.clear=function(){this.length=0},da.prototype.resize=function(t){this.reserve(t),this.length=t},da.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},da.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ml=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var m=this.length;return this.resize(m+1),this.emplace(m,s,h)},a.prototype.emplace=function(s,h,m){var x=2*s;return this.int16[x+0]=h,this.int16[x+1]=m,s},a}(da);Ml.prototype.bytesPerElement=4,mn("StructArrayLayout2i4",Ml);var vu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,x)},a.prototype.emplace=function(s,h,m,x,S){var T=4*s;return this.int16[T+0]=h,this.int16[T+1]=m,this.int16[T+2]=x,this.int16[T+3]=S,s},a}(da);vu.prototype.bytesPerElement=8,mn("StructArrayLayout4i8",vu);var Xs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,m,x,S,T)},a.prototype.emplace=function(s,h,m,x,S,T,k){var z=6*s;return this.int16[z+0]=h,this.int16[z+1]=m,this.int16[z+2]=x,this.int16[z+3]=S,this.int16[z+4]=T,this.int16[z+5]=k,s},a}(da);Xs.prototype.bytesPerElement=12,mn("StructArrayLayout2i4i12",Xs);var Io=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,m,x,S,T)},a.prototype.emplace=function(s,h,m,x,S,T,k){var z=4*s,j=8*s;return this.int16[z+0]=h,this.int16[z+1]=m,this.uint8[j+4]=x,this.uint8[j+5]=S,this.uint8[j+6]=T,this.uint8[j+7]=k,s},a}(da);Io.prototype.bytesPerElement=8,mn("StructArrayLayout2i4ub8",Io);var hl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var m=this.length;return this.resize(m+1),this.emplace(m,s,h)},a.prototype.emplace=function(s,h,m){var x=2*s;return this.float32[x+0]=h,this.float32[x+1]=m,s},a}(da);hl.prototype.bytesPerElement=8,mn("StructArrayLayout2f8",hl);var mu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T,k,z,j,G){var te=this.length;return this.resize(te+1),this.emplace(te,s,h,m,x,S,T,k,z,j,G)},a.prototype.emplace=function(s,h,m,x,S,T,k,z,j,G,te){var oe=10*s;return this.uint16[oe+0]=h,this.uint16[oe+1]=m,this.uint16[oe+2]=x,this.uint16[oe+3]=S,this.uint16[oe+4]=T,this.uint16[oe+5]=k,this.uint16[oe+6]=z,this.uint16[oe+7]=j,this.uint16[oe+8]=G,this.uint16[oe+9]=te,s},a}(da);mu.prototype.bytesPerElement=20,mn("StructArrayLayout10ui20",mu);var nf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T,k,z,j,G,te,oe){var Me=this.length;return this.resize(Me+1),this.emplace(Me,s,h,m,x,S,T,k,z,j,G,te,oe)},a.prototype.emplace=function(s,h,m,x,S,T,k,z,j,G,te,oe,Me){var Re=12*s;return this.int16[Re+0]=h,this.int16[Re+1]=m,this.int16[Re+2]=x,this.int16[Re+3]=S,this.uint16[Re+4]=T,this.uint16[Re+5]=k,this.uint16[Re+6]=z,this.uint16[Re+7]=j,this.int16[Re+8]=G,this.int16[Re+9]=te,this.int16[Re+10]=oe,this.int16[Re+11]=Me,s},a}(da);nf.prototype.bytesPerElement=24,mn("StructArrayLayout4i4ui4i24",nf);var Pl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,m)},a.prototype.emplace=function(s,h,m,x){var S=3*s;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=x,s},a}(da);Pl.prototype.bytesPerElement=12,mn("StructArrayLayout3f12",Pl);var Il=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint32[1*s+0]=h,s},a}(da);Il.prototype.bytesPerElement=4,mn("StructArrayLayout1ul4",Il);var Ol=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T,k,z,j){var G=this.length;return this.resize(G+1),this.emplace(G,s,h,m,x,S,T,k,z,j)},a.prototype.emplace=function(s,h,m,x,S,T,k,z,j,G){var te=10*s,oe=5*s;return this.int16[te+0]=h,this.int16[te+1]=m,this.int16[te+2]=x,this.int16[te+3]=S,this.int16[te+4]=T,this.int16[te+5]=k,this.uint32[oe+3]=z,this.uint16[te+8]=j,this.uint16[te+9]=G,s},a}(da);Ol.prototype.bytesPerElement=20,mn("StructArrayLayout6i1ul2ui20",Ol);var tc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,m,x,S,T)},a.prototype.emplace=function(s,h,m,x,S,T,k){var z=6*s;return this.int16[z+0]=h,this.int16[z+1]=m,this.int16[z+2]=x,this.int16[z+3]=S,this.int16[z+4]=T,this.int16[z+5]=k,s},a}(da);tc.prototype.bytesPerElement=12,mn("StructArrayLayout2i2i2i12",tc);var pl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S){var T=this.length;return this.resize(T+1),this.emplace(T,s,h,m,x,S)},a.prototype.emplace=function(s,h,m,x,S,T){var k=4*s,z=8*s;return this.float32[k+0]=h,this.float32[k+1]=m,this.float32[k+2]=x,this.int16[z+6]=S,this.int16[z+7]=T,s},a}(da);pl.prototype.bytesPerElement=16,mn("StructArrayLayout2f1f2i16",pl);var lh=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,x)},a.prototype.emplace=function(s,h,m,x,S){var T=12*s,k=3*s;return this.uint8[T+0]=h,this.uint8[T+1]=m,this.float32[k+1]=x,this.float32[k+2]=S,s},a}(da);lh.prototype.bytesPerElement=12,mn("StructArrayLayout2ub2f12",lh);var Ku=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,m)},a.prototype.emplace=function(s,h,m,x){var S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=x,s},a}(da);Ku.prototype.bytesPerElement=6,mn("StructArrayLayout3ui6",Ku);var Pu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re,Ke,ze,at){var St=this.length;return this.resize(St+1),this.emplace(St,s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re,Ke,ze,at)},a.prototype.emplace=function(s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re,Ke,ze,at,St){var Zt=24*s,Wt=12*s,cr=48*s;return this.int16[Zt+0]=h,this.int16[Zt+1]=m,this.uint16[Zt+2]=x,this.uint16[Zt+3]=S,this.uint32[Wt+2]=T,this.uint32[Wt+3]=k,this.uint32[Wt+4]=z,this.uint16[Zt+10]=j,this.uint16[Zt+11]=G,this.uint16[Zt+12]=te,this.float32[Wt+7]=oe,this.float32[Wt+8]=Me,this.uint8[cr+36]=Re,this.uint8[cr+37]=Ke,this.uint8[cr+38]=ze,this.uint32[Wt+10]=at,this.int16[Zt+22]=St,s},a}(da);Pu.prototype.bytesPerElement=48,mn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Pu);var kf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re,Ke,ze,at,St,Zt,Wt,cr,Mr,Pr,Rn,cn,Nn,fn,Ai){var ei=this.length;return this.resize(ei+1),this.emplace(ei,s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re,Ke,ze,at,St,Zt,Wt,cr,Mr,Pr,Rn,cn,Nn,fn,Ai)},a.prototype.emplace=function(s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re,Ke,ze,at,St,Zt,Wt,cr,Mr,Pr,Rn,cn,Nn,fn,Ai,ei){var Tn=34*s,ji=17*s;return this.int16[Tn+0]=h,this.int16[Tn+1]=m,this.int16[Tn+2]=x,this.int16[Tn+3]=S,this.int16[Tn+4]=T,this.int16[Tn+5]=k,this.int16[Tn+6]=z,this.int16[Tn+7]=j,this.uint16[Tn+8]=G,this.uint16[Tn+9]=te,this.uint16[Tn+10]=oe,this.uint16[Tn+11]=Me,this.uint16[Tn+12]=Re,this.uint16[Tn+13]=Ke,this.uint16[Tn+14]=ze,this.uint16[Tn+15]=at,this.uint16[Tn+16]=St,this.uint16[Tn+17]=Zt,this.uint16[Tn+18]=Wt,this.uint16[Tn+19]=cr,this.uint16[Tn+20]=Mr,this.uint16[Tn+21]=Pr,this.uint16[Tn+22]=Rn,this.uint32[ji+12]=cn,this.float32[ji+13]=Nn,this.float32[ji+14]=fn,this.float32[ji+15]=Ai,this.float32[ji+16]=ei,s},a}(da);kf.prototype.bytesPerElement=68,mn("StructArrayLayout8i15ui1ul4f68",kf);var dl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.float32[1*s+0]=h,s},a}(da);dl.prototype.bytesPerElement=4,mn("StructArrayLayout1f4",dl);var Ys=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,m)},a.prototype.emplace=function(s,h,m,x){var S=3*s;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=x,s},a}(da);Ys.prototype.bytesPerElement=6,mn("StructArrayLayout3i6",Ys);var af=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,s,h,m)},a.prototype.emplace=function(s,h,m,x){var S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=x,s},a}(da);af.prototype.bytesPerElement=8,mn("StructArrayLayout1ul2ui8",af);var gu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var m=this.length;return this.resize(m+1),this.emplace(m,s,h)},a.prototype.emplace=function(s,h,m){var x=2*s;return this.uint16[x+0]=h,this.uint16[x+1]=m,s},a}(da);gu.prototype.bytesPerElement=4,mn("StructArrayLayout2ui4",gu);var ch=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint16[1*s+0]=h,s},a}(da);ch.prototype.bytesPerElement=2,mn("StructArrayLayout1ui2",ch);var rc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,m,x){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,x)},a.prototype.emplace=function(s,h,m,x,S){var T=4*s;return this.float32[T+0]=h,this.float32[T+1]=m,this.float32[T+2]=x,this.float32[T+3]=S,s},a}(da);rc.prototype.bytesPerElement=16,mn("StructArrayLayout4f16",rc);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new re(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(Oc);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(Ol);mn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(Oc);c.prototype.size=48;var p=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new c(this,s)},a}(Pu);mn("PlacedSymbolArray",p);var b=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(Oc);b.prototype.size=68;var w=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new b(this,s)},a}(kf);mn("SymbolInstanceArray",w);var A=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(dl);mn("GlyphOffsetArray",A);var L=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(Ys);mn("SymbolLineVertexArray",L);var U=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(Oc);U.prototype.size=8;var W=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new U(this,s)},a}(af);mn("FeatureIndexArray",W);var fe=Aa([{name:"a_pos",components:2,type:"Int16"}],4).members,he=function(t){t===void 0&&(t=[]),this.segments=t};function de(t,a){return 256*(t=Mt(Math.floor(t),0,255))+Mt(Math.floor(a),0,255)}he.prototype.prepareSegment=function(t,a,s,h){var m=this.segments[this.segments.length-1];return t>he.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+he.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!m||m.vertexLength+t>he.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m},he.prototype.get=function(){return this.segments},he.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var h in s.vaos)s.vaos[h].destroy()}},he.simpleSegment=function(t,a,s,h){return new he([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])},he.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mn("SegmentVector",he);var Le=Aa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Oe=ee(function(t){t.exports=function(a,s){var h,m,x,S,T,k,z,j;for(m=a.length-(h=3&a.length),x=s,T=3432918353,k=461845907,j=0;j<m;)z=255&a.charCodeAt(j)|(255&a.charCodeAt(++j))<<8|(255&a.charCodeAt(++j))<<16|(255&a.charCodeAt(++j))<<24,++j,x=27492+(65535&(S=5*(65535&(x=(x^=z=(65535&(z=(z=(65535&z)*T+(((z>>>16)*T&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&a.charCodeAt(j+2))<<16;case 2:z^=(255&a.charCodeAt(j+1))<<8;case 1:x^=z=(65535&(z=(z=(65535&(z^=255&a.charCodeAt(j)))*T+(((z>>>16)*T&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return x^=a.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Xe=ee(function(t){t.exports=function(a,s){for(var h,m=a.length,x=s^m,S=0;m>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:x^=(255&a.charCodeAt(S+2))<<16;case 2:x^=(255&a.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&a.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),Ae=Oe,He=Xe;Ae.murmur3=Oe,Ae.murmur2=He;var tt=function(){this.ids=[],this.positions=[],this.indexed=!1};tt.prototype.add=function(t,a,s,h){this.ids.push(Gt(t)),this.positions.push(a,s,h)},tt.prototype.getPositions=function(t){for(var a=Gt(t),s=0,h=this.ids.length-1;s<h;){var m=s+h>>1;this.ids[m]>=a?h=m:s=m+1}for(var x=[];this.ids[s]===a;)x.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return x},tt.serialize=function(t,a){var s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function m(x,S,T,k){for(;T<k;){for(var z=x[T+k>>1],j=T-1,G=k+1;;){do j++;while(x[j]<z);do G--;while(x[G]>z);if(j>=G)break;Nt(x,j,G),Nt(S,3*j,3*G),Nt(S,3*j+1,3*G+1),Nt(S,3*j+2,3*G+2)}G-T<k-G?(m(x,S,T,G),T=G+1):(m(x,S,G+1,k),k=G)}}(s,h,0,s.length-1),a&&a.push(s.buffer,h.buffer),{ids:s,positions:h}},tt.deserialize=function(t){var a=new tt;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var xt=Math.pow(2,53)-1;function Gt(t){var a=+t;return!isNaN(a)&&a<=xt?a:Ae(String(t))}function Nt(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}mn("FeaturePositionMap",tt);var er=function(t,a){this.gl=t.gl,this.location=a},mr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(er),zr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(er),Br=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(er),sn=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(er),kn=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(er),Dn=function(t){function a(s,h){t.call(this,s,h),this.current=Gi.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(er),Cn=new Float32Array(16),Fi=function(t){function a(s,h){t.call(this,s,h),this.current=Cn}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(er);function $r(t){return[de(255*t.r,255*t.g),de(255*t.b,255*t.a)]}var ai=function(t,a,s){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=s};ai.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},ai.prototype.getBinding=function(t,a,s){return this.type==="color"?new Dn(t,a):new zr(t,a)};var ri=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ri.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},ri.prototype.setUniform=function(t,a,s,h){var m=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)},ri.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new kn(t,a):new zr(t,a)};var qn=function(t,a,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(m){return{name:"a_"+m,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new h};qn.prototype.populatePaintArray=function(t,a,s,h,m){var x=this.paintVertexArray.length,S=this.expression.evaluate(new Oi(0),a,{},h,[],m);this.paintVertexArray.resize(t),this._setPaintValue(x,t,S)},qn.prototype.updatePaintArray=function(t,a,s,h){var m=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,a,m)},qn.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var h=$r(s),m=t;m<a;m++)this.paintVertexArray.emplace(m,h[0],h[1]);else{for(var x=t;x<a;x++)this.paintVertexArray.emplace(x,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},qn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var jn=function(t,a,s,h,m,x){this.expression=t,this.uniformNames=a.map(function(S){return"u_"+S+"_t"}),this.type=s,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(function(S){return{name:"a_"+S,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new x};jn.prototype.populatePaintArray=function(t,a,s,h,m){var x=this.expression.evaluate(new Oi(this.zoom),a,{},h,[],m),S=this.expression.evaluate(new Oi(this.zoom+1),a,{},h,[],m),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,x,S)},jn.prototype.updatePaintArray=function(t,a,s,h){var m=this.expression.evaluate({zoom:this.zoom},s,h),x=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,a,m,x)},jn.prototype._setPaintValue=function(t,a,s,h){if(this.type==="color")for(var m=$r(s),x=$r(h),S=t;S<a;S++)this.paintVertexArray.emplace(S,m[0],m[1],x[0],x[1]);else{for(var T=t;T<a;T++)this.paintVertexArray.emplace(T,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}},jn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},jn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Mt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)},jn.prototype.getBinding=function(t,a,s){return new zr(t,a)};var pi=function(t,a,s,h,m,x){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=h,this.layerId=x,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};pi.prototype.populatePaintArray=function(t,a,s){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],s)},pi.prototype.updatePaintArray=function(t,a,s,h,m){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],m)},pi.prototype._setPaintValues=function(t,a,s,h){if(h&&s){var m=h[s.min],x=h[s.mid],S=h[s.max];if(m&&x&&S)for(var T=t;T<a;T++)this.zoomInPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],x.pixelRatio,m.pixelRatio),this.zoomOutPaintVertexArray.emplace(T,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}},pi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Le.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Le.members,this.expression.isStateDependent))},pi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Xn=function(t,a,s){this.binders={},this._buffers=[];var h=[];for(var m in t.paint._values)if(s(m)){var x=t.paint.get(m);if(x instanceof vs&&Rs(x.property.specification)){var S=qi(m,t.type),T=x.value,k=x.property.specification.type,z=x.property.useIntegerZoom,j=x.property.specification["property-type"],G=j==="cross-faded"||j==="cross-faded-data-driven";if(T.kind==="constant")this.binders[m]=G?new ri(T.value,S):new ai(T.value,S,k),h.push("/u_"+m);else if(T.kind==="source"||G){var te=Li(m,k,"source");this.binders[m]=G?new pi(T,k,z,a,te,t.id):new qn(T,S,k,te),h.push("/a_"+m)}else{var oe=Li(m,k,"composite");this.binders[m]=new jn(T,S,k,z,a,oe),h.push("/z_"+m)}}}this.cacheKey=h.sort().join("")};Xn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof qn||a instanceof jn?a.maxValue:0},Xn.prototype.populatePaintArrays=function(t,a,s,h,m){for(var x in this.binders){var S=this.binders[x];(S instanceof qn||S instanceof jn||S instanceof pi)&&S.populatePaintArray(t,a,s,h,m)}},Xn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var h=this.binders[s];h instanceof ri&&h.setConstantPatternPositions(t,a)}},Xn.prototype.updatePaintArrays=function(t,a,s,h,m){var x=!1;for(var S in t)for(var T=0,k=a.getPositions(S);T<k.length;T+=1){var z=k[T],j=s.feature(z.index);for(var G in this.binders){var te=this.binders[G];if((te instanceof qn||te instanceof jn||te instanceof pi)&&te.expression.isStateDependent===!0){var oe=h.paint.get(G);te.expression=oe.value,te.updatePaintArray(z.start,z.end,j,t[S],m),x=!0}}}return x},Xn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof ai||s instanceof ri)&&t.push.apply(t,s.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Xn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof qn||s instanceof jn)for(var h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof pi)for(var m=0;m<Le.members.length;m++)t.push(Le.members[m].name)}return t},Xn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ai||s instanceof ri||s instanceof jn)for(var h=0,m=s.uniformNames;h<m.length;h+=1)t.push(m[h])}return t},Xn.prototype.getPaintVertexBuffers=function(){return this._buffers},Xn.prototype.getUniforms=function(t,a){var s=[];for(var h in this.binders){var m=this.binders[h];if(m instanceof ai||m instanceof ri||m instanceof jn)for(var x=0,S=m.uniformNames;x<S.length;x+=1){var T=S[x];if(a[T]){var k=m.getBinding(t,a[T],T);s.push({name:T,property:h,binding:k})}}}return s},Xn.prototype.setUniforms=function(t,a,s,h){for(var m=0,x=a;m<x.length;m+=1){var S=x[m],T=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,s.get(k),T)}},Xn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof pi){var h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof qn||s instanceof jn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Xn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof qn||s instanceof jn||s instanceof pi)&&s.upload(t)}this.updatePaintBuffers()},Xn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof qn||a instanceof jn||a instanceof pi)&&a.destroy()}};var Vn=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var h=0,m=t;h<m.length;h+=1){var x=m[h];this.programConfigurations[x.id]=new Xn(x,a,s)}this.needsUpload=!1,this._featureMap=new tt,this._bufferOffset=0};function qi(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function Li(t,a,s){var h={color:{source:hl,composite:rc},number:{source:dl,composite:hl}},m=function(x){return{"line-pattern":{source:mu,composite:mu},"fill-pattern":{source:mu,composite:mu},"fill-extrusion-pattern":{source:mu,composite:mu}}[x]}(t);return m&&m[s]||h[a][s]}Vn.prototype.populatePaintArrays=function(t,a,s,h,m,x){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,a,h,m,x);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Vn.prototype.updatePaintArrays=function(t,a,s,h){for(var m=0,x=s;m<x.length;m+=1){var S=x[m];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,a,S,h)||this.needsUpload}},Vn.prototype.get=function(t){return this.programConfigurations[t]},Vn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},Vn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},mn("ConstantBinder",ai),mn("CrossFadedConstantBinder",ri),mn("SourceExpressionBinder",qn),mn("CrossFadedCompositeBinder",pi),mn("CompositeExpressionBinder",jn),mn("ProgramConfiguration",Xn,{omit:["_buffers"]}),mn("ProgramConfigurationSet",Vn);var vo=Math.pow(2,14)-1,Oo=-vo-1;function Ia(t){for(var a=8192/t.extent,s=t.loadGeometry(),h=0;h<s.length;h++)for(var m=s[h],x=0;x<m.length;x++){var S=m[x],T=Math.round(S.x*a),k=Math.round(S.y*a);S.x=Mt(T,Oo,vo),S.y=Mt(k,Oo,vo),(T<S.x||T>S.x+1||k<S.y||k>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function mo(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?Ia(t):[]}}function zs(t,a,s,h,m){t.emplaceBack(2*a+(h+1)/2,2*s+(m+1)/2)}var xs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ml,this.indexArray=new Ku,this.segments=new he,this.programConfigurations=new Vn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function $u(t,a){for(var s=0;s<t.length;s++)if(qs(a,t[s]))return!0;for(var h=0;h<a.length;h++)if(qs(t,a[h]))return!0;return!!Lc(t,a)}function rs(t,a,s){return!!qs(t,a)||!!As(a,t,s)}function Eo(t,a){if(t.length===1)return Qu(a,t[0]);for(var s=0;s<a.length;s++)for(var h=a[s],m=0;m<h.length;m++)if(qs(t,h[m]))return!0;for(var x=0;x<t.length;x++)if(Qu(a,t[x]))return!0;for(var S=0;S<a.length;S++)if(Lc(t,a[S]))return!0;return!1}function su(t,a,s){if(t.length>1){if(Lc(t,a))return!0;for(var h=0;h<a.length;h++)if(As(a[h],t,s))return!0}for(var m=0;m<t.length;m++)if(As(t[m],a,s))return!0;return!1}function Lc(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var h=t[s],m=t[s+1],x=0;x<a.length-1;x++)if(nc(h,m,a[x],a[x+1]))return!0;return!1}function nc(t,a,s,h){return Rt(t,s,h)!==Rt(a,s,h)&&Rt(t,a,s)!==Rt(t,a,h)}function As(t,a,s){var h=s*s;if(a.length===1)return t.distSqr(a[0])<h;for(var m=1;m<a.length;m++)if(Ju(t,a[m-1],a[m])<h)return!0;return!1}function Ju(t,a,s){var h=a.distSqr(s);if(h===0)return t.distSqr(a);var m=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/h;return t.distSqr(m<0?a:m>1?s:s.sub(a)._mult(m)._add(a))}function Qu(t,a){for(var s,h,m,x=!1,S=0;S<t.length;S++)for(var T=0,k=(s=t[S]).length-1;T<s.length;k=T++)(h=s[T]).y>a.y!=(m=s[k]).y>a.y&&a.x<(m.x-h.x)*(a.y-h.y)/(m.y-h.y)+h.x&&(x=!x);return x}function qs(t,a){for(var s=!1,h=0,m=t.length-1;h<t.length;m=h++){var x=t[h],S=t[m];x.y>a.y!=S.y>a.y&&a.x<(S.x-x.x)*(a.y-x.y)/(S.y-x.y)+x.x&&(s=!s)}return s}function vl(t,a,s){var h=s[0],m=s[2];if(t.x<h.x&&a.x<h.x||t.x>m.x&&a.x>m.x||t.y<h.y&&a.y<h.y||t.y>m.y&&a.y>m.y)return!1;var x=Rt(t,a,s[0]);return x!==Rt(t,a,s[1])||x!==Rt(t,a,s[2])||x!==Rt(t,a,s[3])}function Us(t,a,s){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:s.programConfigurations.get(a.id).getMaxValue(t)}function io(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function yu(t,a,s,h,m){if(!a[0]&&!a[1])return t;var x=re.convert(a)._mult(m);s==="viewport"&&x._rotate(-h);for(var S=[],T=0;T<t.length;T++)S.push(t[T].sub(x));return S}xs.prototype.populate=function(t,a,s){var h=this.layers[0],m=[],x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(var S=0,T=t;S<T.length;S+=1){var k=T[S],z=k.feature,j=k.id,G=k.index,te=k.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,Me=mo(z,oe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),Me,s)){var Re=x?x.evaluate(Me,{},s):void 0,Ke={id:j,properties:z.properties,type:z.type,sourceLayerIndex:te,index:G,geometry:oe?Me.geometry:Ia(z),patterns:{},sortKey:Re};m.push(Ke)}}x&&m.sort(function(Pr,Rn){return Pr.sortKey-Rn.sortKey});for(var ze=0,at=m;ze<at.length;ze+=1){var St=at[ze],Zt=St.geometry,Wt=St.index,cr=St.sourceLayerIndex,Mr=t[Wt].feature;this.addFeature(St,Zt,Wt,s),a.featureIndex.insert(Mr,Zt,Wt,cr,this.index)}},xs.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},xs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},xs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},xs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},xs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},xs.prototype.addFeature=function(t,a,s,h){for(var m=0,x=a;m<x.length;m+=1)for(var S=0,T=x[m];S<T.length;S+=1){var k=T[S],z=k.x,j=k.y;if(!(z<0||z>=8192||j<0||j>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),te=G.vertexLength;zs(this.layoutVertexArray,z,j,-1,-1),zs(this.layoutVertexArray,z,j,1,-1),zs(this.layoutVertexArray,z,j,1,1),zs(this.layoutVertexArray,z,j,-1,1),this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+3,te+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)},mn("CircleBucket",xs,{omit:["layers"]});var Iu=new qo({"circle-sort-key":new wn(pe.layout_circle["circle-sort-key"])}),_u={paint:new qo({"circle-radius":new wn(pe.paint_circle["circle-radius"]),"circle-color":new wn(pe.paint_circle["circle-color"]),"circle-blur":new wn(pe.paint_circle["circle-blur"]),"circle-opacity":new wn(pe.paint_circle["circle-opacity"]),"circle-translate":new Pn(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Pn(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pn(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pn(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(pe.paint_circle["circle-stroke-opacity"])}),layout:Iu},na=typeof Float32Array!="undefined"?Float32Array:Array;function Zs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ns(t,a,s){var h=a[0],m=a[1],x=a[2],S=a[3],T=a[4],k=a[5],z=a[6],j=a[7],G=a[8],te=a[9],oe=a[10],Me=a[11],Re=a[12],Ke=a[13],ze=a[14],at=a[15],St=s[0],Zt=s[1],Wt=s[2],cr=s[3];return t[0]=St*h+Zt*T+Wt*G+cr*Re,t[1]=St*m+Zt*k+Wt*te+cr*Ke,t[2]=St*x+Zt*z+Wt*oe+cr*ze,t[3]=St*S+Zt*j+Wt*Me+cr*at,t[4]=(St=s[4])*h+(Zt=s[5])*T+(Wt=s[6])*G+(cr=s[7])*Re,t[5]=St*m+Zt*k+Wt*te+cr*Ke,t[6]=St*x+Zt*z+Wt*oe+cr*ze,t[7]=St*S+Zt*j+Wt*Me+cr*at,t[8]=(St=s[8])*h+(Zt=s[9])*T+(Wt=s[10])*G+(cr=s[11])*Re,t[9]=St*m+Zt*k+Wt*te+cr*Ke,t[10]=St*x+Zt*z+Wt*oe+cr*ze,t[11]=St*S+Zt*j+Wt*Me+cr*at,t[12]=(St=s[12])*h+(Zt=s[13])*T+(Wt=s[14])*G+(cr=s[15])*Re,t[13]=St*m+Zt*k+Wt*te+cr*Ke,t[14]=St*x+Zt*z+Wt*oe+cr*ze,t[15]=St*S+Zt*j+Wt*Me+cr*at,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var is,ic=ns;function kc(t,a,s){var h=a[0],m=a[1],x=a[2],S=a[3];return t[0]=s[0]*h+s[4]*m+s[8]*x+s[12]*S,t[1]=s[1]*h+s[5]*m+s[9]*x+s[13]*S,t[2]=s[2]*h+s[6]*m+s[10]*x+s[14]*S,t[3]=s[3]*h+s[7]*m+s[11]*x+s[15]*S,t}is=new na(3),na!=Float32Array&&(is[0]=0,is[1]=0,is[2]=0),function(){var t=new na(4);na!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var of=(function(){var t=new na(2);na!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,_u)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new xs(s)},a.prototype.queryRadius=function(s){var h=s;return Us("circle-radius",this,h)+Us("circle-stroke-width",this,h)+io(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,h,m,x,S,T,k,z){for(var j=yu(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,k),G=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),te=this.paint.get("circle-pitch-alignment")==="map",oe=te?j:function(Mr,Pr){return Mr.map(function(Rn){return Ks(Rn,Pr)})}(j,z),Me=te?G*k:G,Re=0,Ke=x;Re<Ke.length;Re+=1)for(var ze=0,at=Ke[Re];ze<at.length;ze+=1){var St=at[ze],Zt=te?St:Ks(St,z),Wt=Me,cr=kc([],[St.x,St.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Wt*=cr[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Wt*=T.cameraToCenterDistance/cr[3]),rs(oe,Zt,Wt))return!0}return!1},a}(Ea));function Ks(t,a){var s=kc([],[t.x,t.y,0,1],a);return new re(s[0]/s[3],s[1]/s[3])}var ac=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(xs);function uu(t,a,s,h){var m=a.width,x=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==m*x*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(m*x*s);return t.width=m,t.height=x,t.data=h,t}function ml(t,a,s){var h=a.width,m=a.height;if(h!==t.width||m!==t.height){var x=uu({},{width:h,height:m},s);Rl(t,x,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,m)},s),t.width=h,t.height=m,t.data=x.data}}function Rl(t,a,s,h,m,x){if(m.width===0||m.height===0)return a;if(m.width>t.width||m.height>t.height||s.x>t.width-m.width||s.y>t.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>a.width||m.height>a.height||h.x>a.width-m.width||h.y>a.height-m.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,T=a.data,k=0;k<m.height;k++)for(var z=((s.y+k)*t.width+s.x)*x,j=((h.y+k)*a.width+h.x)*x,G=0;G<m.width*x;G++)T[j+G]=S[z+G];return a}mn("HeatmapBucket",ac,{omit:["layers"]});var Ro=function(t,a){uu(this,t,1,a)};Ro.prototype.resize=function(t){ml(this,t,1)},Ro.prototype.clone=function(){return new Ro({width:this.width,height:this.height},new Uint8Array(this.data))},Ro.copy=function(t,a,s,h,m){Rl(t,a,s,h,m,1)};var Uo=function(t,a){uu(this,t,4,a)};Uo.prototype.resize=function(t){ml(this,t,4)},Uo.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Uo.prototype.clone=function(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))},Uo.copy=function(t,a,s,h,m){Rl(t,a,s,h,m,4)},mn("AlphaImage",Ro),mn("RGBAImage",Uo);var Dc={paint:new qo({"heatmap-radius":new wn(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pn(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pn(pe.paint_heatmap["heatmap-opacity"])})};function sf(t){var a={},s=t.resolution||256,h=t.clips?t.clips.length:1,m=t.image||new Uo({width:s,height:h}),x=function(Me,Re,Ke){a[t.evaluationKey]=Ke;var ze=t.expression.evaluate(a);m.data[Me+Re+0]=Math.floor(255*ze.r/ze.a),m.data[Me+Re+1]=Math.floor(255*ze.g/ze.a),m.data[Me+Re+2]=Math.floor(255*ze.b/ze.a),m.data[Me+Re+3]=Math.floor(255*ze.a)};if(t.clips)for(var S=0,T=0;S<h;++S,T+=4*s)for(var k=0,z=0;k<s;k++,z+=4){var j=k/(s-1),G=t.clips[S];x(T,z,G.start*(1-j)+G.end*j)}else for(var te=0,oe=0;te<s;te++,oe+=4)x(0,oe,te/(s-1));return m}var Df=function(t){function a(s){t.call(this,s,Dc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new ac(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=sf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(Ea),uf={paint:new qo({"hillshade-illumination-direction":new Pn(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pn(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pn(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pn(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pn(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pn(pe.paint_hillshade["hillshade-accent-color"])})},fh=function(t){function a(s){t.call(this,s,uf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(Ea),$h=Aa([{name:"a_pos",components:2,type:"Int16"}],4).members,oc=Ff,lf=Ff;function Ff(t,a,s){s=s||2;var h,m,x,S,T,k,z,j=a&&a.length,G=j?a[0]*s:t.length,te=jp(t,0,G,s,!0),oe=[];if(!te||te.next===te.prev)return oe;if(j&&(te=function(Re,Ke,ze,at){var St,Zt,Wt,cr=[];for(St=0,Zt=Ke.length;St<Zt;St++)(Wt=jp(Re,Ke[St]*at,St<Zt-1?Ke[St+1]*at:Re.length,at,!1))===Wt.next&&(Wt.steiner=!0),cr.push(Pd(Wt));for(cr.sort(Td),St=0;St<cr.length;St++)Md(cr[St],ze),ze=Ll(ze,ze.next);return ze}(t,a,te,s)),t.length>80*s){h=x=t[0],m=S=t[1];for(var Me=s;Me<G;Me+=s)(T=t[Me])<h&&(h=T),(k=t[Me+1])<m&&(m=k),T>x&&(x=T),k>S&&(S=k);z=(z=Math.max(x-h,S-m))!==0?1/z:0}return cf(te,oe,s,h,m,z),oe}function jp(t,a,s,h,m){var x,S;if(m===zf(t,a,s,h)>0)for(x=a;x<s;x+=h)S=Bf(x,t[x],t[x+1],S);else for(x=s-h;x>=a;x-=h)S=Bf(x,t[x],t[x+1],S);return S&&ph(S,S.next)&&(sc(S),S=S.next),S}function Ll(t,a){if(!t)return t;a||(a=t);var s,h=t;do if(s=!1,h.steiner||!ph(h,h.next)&&Lo(h.prev,h,h.next)!==0)h=h.next;else{if(sc(h),(h=a=h.prev)===h.next)break;s=!0}while(s||h!==a);return a}function cf(t,a,s,h,m,x,S){if(t){!S&&x&&function(j,G,te,oe){var Me=j;do Me.z===null&&(Me.z=hh(Me.x,Me.y,G,te,oe)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==j);Me.prevZ.nextZ=null,Me.prevZ=null,function(Re){var Ke,ze,at,St,Zt,Wt,cr,Mr,Pr=1;do{for(ze=Re,Re=null,Zt=null,Wt=0;ze;){for(Wt++,at=ze,cr=0,Ke=0;Ke<Pr&&(cr++,at=at.nextZ);Ke++);for(Mr=Pr;cr>0||Mr>0&&at;)cr!==0&&(Mr===0||!at||ze.z<=at.z)?(St=ze,ze=ze.nextZ,cr--):(St=at,at=at.nextZ,Mr--),Zt?Zt.nextZ=St:Re=St,St.prevZ=Zt,Zt=St;ze=at}Zt.nextZ=null,Pr*=2}while(Wt>1)}(Me)}(t,h,m,x);for(var T,k,z=t;t.prev!==t.next;)if(T=t.prev,k=t.next,x?Vp(t,h,m,x):Jh(t))a.push(T.i/s),a.push(t.i/s),a.push(k.i/s),sc(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?cf(t=ff(Ll(t),a,s),a,s,h,m,x,2):S===2&&Qh(t,a,s,h,m,x):cf(Ll(t),a,s,h,m,x,1);break}}}function Jh(t){var a=t.prev,s=t,h=t.next;if(Lo(a,s,h)>=0)return!1;for(var m=t.next.next;m!==t.prev;){if(Fc(a.x,a.y,s.x,s.y,h.x,h.y,m.x,m.y)&&Lo(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Vp(t,a,s,h){var m=t.prev,x=t,S=t.next;if(Lo(m,x,S)>=0)return!1;for(var T=m.x>x.x?m.x>S.x?m.x:S.x:x.x>S.x?x.x:S.x,k=m.y>x.y?m.y>S.y?m.y:S.y:x.y>S.y?x.y:S.y,z=hh(m.x<x.x?m.x<S.x?m.x:S.x:x.x<S.x?x.x:S.x,m.y<x.y?m.y<S.y?m.y:S.y:x.y<S.y?x.y:S.y,a,s,h),j=hh(T,k,a,s,h),G=t.prevZ,te=t.nextZ;G&&G.z>=z&&te&&te.z<=j;){if(G!==t.prev&&G!==t.next&&Fc(m.x,m.y,x.x,x.y,S.x,S.y,G.x,G.y)&&Lo(G.prev,G,G.next)>=0||(G=G.prevZ,te!==t.prev&&te!==t.next&&Fc(m.x,m.y,x.x,x.y,S.x,S.y,te.x,te.y)&&Lo(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;G&&G.z>=z;){if(G!==t.prev&&G!==t.next&&Fc(m.x,m.y,x.x,x.y,S.x,S.y,G.x,G.y)&&Lo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;te&&te.z<=j;){if(te!==t.prev&&te!==t.next&&Fc(m.x,m.y,x.x,x.y,S.x,S.y,te.x,te.y)&&Lo(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function ff(t,a,s){var h=t;do{var m=h.prev,x=h.next.next;!ph(m,x)&&Hp(m,h,h.next,x)&&Nf(m,x)&&Nf(x,m)&&(a.push(m.i/s),a.push(h.i/s),a.push(x.i/s),sc(h),sc(h.next),h=t=x),h=h.next}while(h!==t);return Ll(h)}function Qh(t,a,s,h,m,x){var S=t;do{for(var T=S.next.next;T!==S.prev;){if(S.i!==T.i&&ep(S,T)){var k=kl(S,T);return S=Ll(S,S.next),k=Ll(k,k.next),cf(S,a,s,h,m,x),void cf(k,a,s,h,m,x)}T=T.next}S=S.next}while(S!==t)}function Td(t,a){return t.x-a.x}function Md(t,a){if(a=function(h,m){var x,S=m,T=h.x,k=h.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var j=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(j<=T&&j>z){if(z=j,j===T){if(k===S.y)return S;if(k===S.next.y)return S.next}x=S.x<S.next.x?S:S.next}}S=S.next}while(S!==m);if(!x)return null;if(T===z)return x;var G,te=x,oe=x.x,Me=x.y,Re=1/0;S=x;do T>=S.x&&S.x>=oe&&T!==S.x&&Fc(k<Me?T:z,k,oe,Me,k<Me?z:T,k,S.x,S.y)&&(G=Math.abs(k-S.y)/(T-S.x),Nf(S,h)&&(G<Re||G===Re&&(S.x>x.x||S.x===x.x&&Gp(x,S)))&&(x=S,Re=G)),S=S.next;while(S!==te);return x}(t,a)){var s=kl(a,t);Ll(a,a.next),Ll(s,s.next)}}function Gp(t,a){return Lo(t.prev,t,a.prev)<0&&Lo(a.next,t,t.next)<0}function hh(t,a,s,h,m){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*m)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*m)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Pd(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function Fc(t,a,s,h,m,x,S,T){return(m-S)*(a-T)-(t-S)*(x-T)>=0&&(t-S)*(h-T)-(s-S)*(a-T)>=0&&(s-S)*(x-T)-(m-S)*(h-T)>=0}function ep(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,h){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==h.i&&m.next.i!==h.i&&Hp(m,m.next,s,h))return!0;m=m.next}while(m!==s);return!1}(t,a)&&(Nf(t,a)&&Nf(a,t)&&function(s,h){var m=s,x=!1,S=(s.x+h.x)/2,T=(s.y+h.y)/2;do m.y>T!=m.next.y>T&&m.next.y!==m.y&&S<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(x=!x),m=m.next;while(m!==s);return x}(t,a)&&(Lo(t.prev,t,a.prev)||Lo(t,a.prev,a))||ph(t,a)&&Lo(t.prev,t,t.next)>0&&Lo(a.prev,a,a.next)>0)}function Lo(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function ph(t,a){return t.x===a.x&&t.y===a.y}function Hp(t,a,s,h){var m=vh(Lo(t,a,s)),x=vh(Lo(t,a,h)),S=vh(Lo(s,h,t)),T=vh(Lo(s,h,a));return m!==x&&S!==T||!(m!==0||!dh(t,s,a))||!(x!==0||!dh(t,h,a))||!(S!==0||!dh(s,t,h))||!(T!==0||!dh(s,a,h))}function dh(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function vh(t){return t>0?1:t<0?-1:0}function Nf(t,a){return Lo(t.prev,t,t.next)<0?Lo(t,a,t.next)>=0&&Lo(t,t.prev,a)>=0:Lo(t,a,t.prev)<0||Lo(t,t.next,a)<0}function kl(t,a){var s=new hf(t.i,t.x,t.y),h=new hf(a.i,a.x,a.y),m=t.next,x=a.prev;return t.next=a,a.prev=t,s.next=m,m.prev=s,h.next=s,s.prev=h,x.next=h,h.prev=x,h}function Bf(t,a,s,h){var m=new hf(t,a,s);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function sc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hf(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zf(t,a,s,h){for(var m=0,x=a,S=s-h;x<s;x+=h)m+=(t[S]-t[x])*(t[x+1]+t[S+1]),S=x;return m}function Uf(t,a,s,h,m){(function x(S,T,k,z,j){for(;z>k;){if(z-k>600){var G=z-k+1,te=T-k+1,oe=Math.log(G),Me=.5*Math.exp(2*oe/3),Re=.5*Math.sqrt(oe*Me*(G-Me)/G)*(te-G/2<0?-1:1);x(S,T,Math.max(k,Math.floor(T-te*Me/G+Re)),Math.min(z,Math.floor(T+(G-te)*Me/G+Re)),j)}var Ke=S[T],ze=k,at=z;for(Dl(S,k,T),j(S[z],Ke)>0&&Dl(S,k,z);ze<at;){for(Dl(S,ze,at),ze++,at--;j(S[ze],Ke)<0;)ze++;for(;j(S[at],Ke)>0;)at--}j(S[k],Ke)===0?Dl(S,k,at):Dl(S,++at,z),at<=T&&(k=at+1),T<=at&&(z=at-1)}})(t,a,s||0,h||t.length-1,m||mh)}function Dl(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}function mh(t,a){return t<a?-1:t>a?1:0}function Zf(t,a){var s=t.length;if(s<=1)return[t];for(var h,m,x=[],S=0;S<s;S++){var T=yr(t[S]);T!==0&&(t[S].area=Math.abs(T),m===void 0&&(m=T<0),m===T<0?(h&&x.push(h),h=[t[S]]):h.push(t[S]))}if(h&&x.push(h),a>1)for(var k=0;k<x.length;k++)x[k].length<=a||(Uf(x[k],a,1,x[k].length-1,jf),x[k]=x[k].slice(0,a));return x}function jf(t,a){return a.area-t.area}function Nc(t,a,s){for(var h=s.patternDependencies,m=!1,x=0,S=a;x<S.length;x+=1){var T=S[x].paint.get(t+"-pattern");T.isConstant()||(m=!0);var k=T.constantOr(null);k&&(m=!0,h[k.to]=!0,h[k.from]=!0)}return m}function pf(t,a,s,h,m){for(var x=m.patternDependencies,S=0,T=a;S<T.length;S+=1){var k=T[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var j=z.evaluate({zoom:h-1},s,{},m.availableImages),G=z.evaluate({zoom:h},s,{},m.availableImages),te=z.evaluate({zoom:h+1},s,{},m.availableImages);G=G&&G.name?G.name:G,te=te&&te.name?te.name:te,x[j=j&&j.name?j.name:j]=!0,x[G]=!0,x[te]=!0,s.patterns[k.id]={min:j,mid:G,max:te}}}return s}Ff.deviation=function(t,a,s,h){var m=a&&a.length,x=Math.abs(zf(t,0,m?a[0]*s:t.length,s));if(m)for(var S=0,T=a.length;S<T;S++)x-=Math.abs(zf(t,a[S]*s,S<T-1?a[S+1]*s:t.length,s));var k=0;for(S=0;S<h.length;S+=3){var z=h[S]*s,j=h[S+1]*s,G=h[S+2]*s;k+=Math.abs((t[z]-t[G])*(t[j+1]-t[z+1])-(t[z]-t[j])*(t[G+1]-t[z+1]))}return x===0&&k===0?0:Math.abs((k-x)/x)},Ff.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},h=0,m=0;m<t.length;m++){for(var x=0;x<t[m].length;x++)for(var S=0;S<a;S++)s.vertices.push(t[m][x][S]);m>0&&s.holes.push(h+=t[m-1].length)}return s},oc.default=lf;var $s=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ml,this.indexArray=new Ku,this.indexArray2=new gu,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new he,this.segments2=new he,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};$s.prototype.populate=function(t,a,s){this.hasPattern=Nc("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),m=[],x=0,S=t;x<S.length;x+=1){var T=S[x],k=T.feature,z=T.id,j=T.index,G=T.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,oe=mo(k,te);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),oe,s)){var Me=h?h.evaluate(oe,{},s,a.availableImages):void 0,Re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:G,index:j,geometry:te?oe.geometry:Ia(k),patterns:{},sortKey:Me};m.push(Re)}}h&&m.sort(function(Mr,Pr){return Mr.sortKey-Pr.sortKey});for(var Ke=0,ze=m;Ke<ze.length;Ke+=1){var at=ze[Ke],St=at.geometry,Zt=at.index,Wt=at.sourceLayerIndex;if(this.hasPattern){var cr=pf("fill",this.layers,at,this.zoom,a);this.patternFeatures.push(cr)}else this.addFeature(at,St,Zt,s,{});a.featureIndex.insert(t[Zt].feature,St,Zt,Wt,this.index)}},$s.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},$s.prototype.addFeatures=function(t,a,s){for(var h=0,m=this.patternFeatures;h<m.length;h+=1){var x=m[h];this.addFeature(x,x.geometry,x.index,a,s)}},$s.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$s.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$s.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$h),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},$s.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},$s.prototype.addFeature=function(t,a,s,h,m){for(var x=0,S=Zf(a,500);x<S.length;x+=1){for(var T=S[x],k=0,z=0,j=T;z<j.length;z+=1)k+=j[z].length;for(var G=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),te=G.vertexLength,oe=[],Me=[],Re=0,Ke=T;Re<Ke.length;Re+=1){var ze=Ke[Re];if(ze.length!==0){ze!==T[0]&&Me.push(oe.length/2);var at=this.segments2.prepareSegment(ze.length,this.layoutVertexArray,this.indexArray2),St=at.vertexLength;this.layoutVertexArray.emplaceBack(ze[0].x,ze[0].y),this.indexArray2.emplaceBack(St+ze.length-1,St),oe.push(ze[0].x),oe.push(ze[0].y);for(var Zt=1;Zt<ze.length;Zt++)this.layoutVertexArray.emplaceBack(ze[Zt].x,ze[Zt].y),this.indexArray2.emplaceBack(St+Zt-1,St+Zt),oe.push(ze[Zt].x),oe.push(ze[Zt].y);at.vertexLength+=ze.length,at.primitiveLength+=ze.length}}for(var Wt=oc(oe,Me),cr=0;cr<Wt.length;cr+=3)this.indexArray.emplaceBack(te+Wt[cr],te+Wt[cr+1],te+Wt[cr+2]);G.vertexLength+=k,G.primitiveLength+=Wt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,h)},mn("FillBucket",$s,{omit:["layers","patternFeatures"]});var Vf=new qo({"fill-sort-key":new wn(pe.layout_fill["fill-sort-key"])}),Gf={paint:new qo({"fill-antialias":new Pn(pe.paint_fill["fill-antialias"]),"fill-opacity":new wn(pe.paint_fill["fill-opacity"]),"fill-color":new wn(pe.paint_fill["fill-color"]),"fill-outline-color":new wn(pe.paint_fill["fill-outline-color"]),"fill-translate":new Pn(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Pn(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ec(pe.paint_fill["fill-pattern"])}),layout:Vf},Hf=function(t){function a(s){t.call(this,s,Gf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h);var m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new $s(s)},a.prototype.queryRadius=function(){return io(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,h,m,x,S,T,k){return Eo(yu(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,k),x)},a.prototype.isTileClipped=function(){return!0},a}(Ea),gh=Aa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Gr=gl;function gl(t,a,s,h,m){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=m,t.readFields(Ht,this,a)}function Ht(t,a,s){t==1?a.id=s.readVarint():t==2?function(h,m){for(var x=h.readVarint()+h.pos;h.pos<x;){var S=m._keys[h.readVarint()],T=m._values[h.readVarint()];m.properties[S]=T}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function Wp(t){for(var a,s,h=0,m=0,x=t.length,S=x-1;m<x;S=m++)h+=((s=t[S]).x-(a=t[m]).x)*(a.y+s.y);return h}gl.types=["Unknown","Point","LineString","Polygon"],gl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,h=1,m=0,x=0,S=0,T=[];t.pos<s;){if(m<=0){var k=t.readVarint();h=7&k,m=k>>3}if(m--,h===1||h===2)x+=t.readSVarint(),S+=t.readSVarint(),h===1&&(a&&T.push(a),a=[]),a.push(new re(x,S));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&T.push(a),T},gl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,h=0,m=0,x=0,S=1/0,T=-1/0,k=1/0,z=-1/0;t.pos<a;){if(h<=0){var j=t.readVarint();s=7&j,h=j>>3}if(h--,s===1||s===2)(m+=t.readSVarint())<S&&(S=m),m>T&&(T=m),(x+=t.readSVarint())<k&&(k=x),x>z&&(z=x);else if(s!==7)throw new Error("unknown command "+s)}return[S,k,T,z]},gl.prototype.toGeoJSON=function(t,a,s){var h,m,x=this.extent*Math.pow(2,s),S=this.extent*t,T=this.extent*a,k=this.loadGeometry(),z=gl.types[this.type];function j(oe){for(var Me=0;Me<oe.length;Me++){var Re=oe[Me];oe[Me]=[360*(Re.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Re.y+T)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<k.length;h++)G[h]=k[h][0];j(k=G);break;case 2:for(h=0;h<k.length;h++)j(k[h]);break;case 3:for(k=function(oe){var Me=oe.length;if(Me<=1)return[oe];for(var Re,Ke,ze=[],at=0;at<Me;at++){var St=Wp(oe[at]);St!==0&&(Ke===void 0&&(Ke=St<0),Ke===St<0?(Re&&ze.push(Re),Re=[oe[at]]):Re.push(oe[at]))}return Re&&ze.push(Re),ze}(k),h=0;h<k.length;h++)for(m=0;m<k[h].length;m++)j(k[h][m])}k.length===1?k=k[0]:z="Multi"+z;var te={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(te.id=this.id),te};var yh=tp;function tp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Xp,this,a),this.length=this._features.length}function Xp(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(h){for(var m=null,x=h.readVarint()+h.pos;h.pos<x;){var S=h.readVarint()>>3;m=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return m}(s))}function Yp(t,a,s){if(t===3){var h=new yh(s,s.readVarint()+s.pos);h.length&&(a[h.name]=h)}}tp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new Gr(this._pbf,a,this.extent,this._keys,this._values)};var xu={VectorTile:function(t,a){this.layers=t.readFields(Yp,{},a)},VectorTileFeature:Gr,VectorTileLayer:yh},rp=xu.VectorTileFeature.types,uc=Math.pow(2,13);function df(t,a,s,h,m,x,S,T){t.emplaceBack(a,s,2*Math.floor(h*uc)+S,m*uc*2,x*uc*2,Math.round(T))}var el=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Xs,this.indexArray=new Ku,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new he,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function np(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}el.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=Nc("fill-extrusion",this.layers,a);for(var h=0,m=t;h<m.length;h+=1){var x=m[h],S=x.feature,T=x.id,k=x.index,z=x.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,G=mo(S,j);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),G,s)){var te={id:T,sourceLayerIndex:z,index:k,geometry:j?G.geometry:Ia(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(pf("fill-extrusion",this.layers,te,this.zoom,a)):this.addFeature(te,te.geometry,k,s,{}),a.featureIndex.insert(S,te.geometry,k,z,this.index,!0)}}},el.prototype.addFeatures=function(t,a,s){for(var h=0,m=this.features;h<m.length;h+=1){var x=m[h];this.addFeature(x,x.geometry,x.index,a,s)}},el.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},el.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},el.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},el.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},el.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},el.prototype.addFeature=function(t,a,s,h,m){for(var x=0,S=Zf(a,500);x<S.length;x+=1){for(var T=S[x],k=0,z=0,j=T;z<j.length;z+=1)k+=j[z].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),te=0,oe=T;te<oe.length;te+=1){var Me=oe[te];if(Me.length!==0&&!((ji=Me).every(function(xi){return xi.x<0})||ji.every(function(xi){return xi.x>8192})||ji.every(function(xi){return xi.y<0})||ji.every(function(xi){return xi.y>8192})))for(var Re=0,Ke=0;Ke<Me.length;Ke++){var ze=Me[Ke];if(Ke>=1){var at=Me[Ke-1];if(!np(ze,at)){G.vertexLength+4>he.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var St=ze.sub(at)._perp()._unit(),Zt=at.dist(ze);Re+Zt>32768&&(Re=0),df(this.layoutVertexArray,ze.x,ze.y,St.x,St.y,0,0,Re),df(this.layoutVertexArray,ze.x,ze.y,St.x,St.y,0,1,Re),df(this.layoutVertexArray,at.x,at.y,St.x,St.y,0,0,Re+=Zt),df(this.layoutVertexArray,at.x,at.y,St.x,St.y,0,1,Re);var Wt=G.vertexLength;this.indexArray.emplaceBack(Wt,Wt+2,Wt+1),this.indexArray.emplaceBack(Wt+1,Wt+2,Wt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+k>he.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),rp[t.type]==="Polygon"){for(var cr=[],Mr=[],Pr=G.vertexLength,Rn=0,cn=T;Rn<cn.length;Rn+=1){var Nn=cn[Rn];if(Nn.length!==0){Nn!==T[0]&&Mr.push(cr.length/2);for(var fn=0;fn<Nn.length;fn++){var Ai=Nn[fn];df(this.layoutVertexArray,Ai.x,Ai.y,0,0,1,1,0),cr.push(Ai.x),cr.push(Ai.y)}}}for(var ei=oc(cr,Mr),Tn=0;Tn<ei.length;Tn+=3)this.indexArray.emplaceBack(Pr+ei[Tn],Pr+ei[Tn+2],Pr+ei[Tn+1]);G.primitiveLength+=ei.length/3,G.vertexLength+=k}}var ji;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,h)},mn("FillExtrusionBucket",el,{omit:["layers","features"]});var qp={paint:new qo({"fill-extrusion-opacity":new Pn(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pn(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pn(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ec(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wn(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pn(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},tl=function(t){function a(s){t.call(this,s,qp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new el(s)},a.prototype.queryRadius=function(){return io(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,h,m,x,S,T,k,z){var j=yu(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,k),G=this.paint.get("fill-extrusion-height").evaluate(h,m),te=this.paint.get("fill-extrusion-base").evaluate(h,m),oe=function(Re,Ke,ze,at){for(var St=[],Zt=0,Wt=Re;Zt<Wt.length;Zt+=1){var cr=Wt[Zt],Mr=[cr.x,cr.y,0,1];kc(Mr,Mr,Ke),St.push(new re(Mr[0]/Mr[3],Mr[1]/Mr[3]))}return St}(j,z),Me=function(Re,Ke,ze,at){for(var St=[],Zt=[],Wt=at[8]*Ke,cr=at[9]*Ke,Mr=at[10]*Ke,Pr=at[11]*Ke,Rn=at[8]*ze,cn=at[9]*ze,Nn=at[10]*ze,fn=at[11]*ze,Ai=0,ei=Re;Ai<ei.length;Ai+=1){for(var Tn=[],ji=[],xi=0,bi=ei[Ai];xi<bi.length;xi+=1){var zn=bi[xi],ti=zn.x,so=zn.y,Co=at[0]*ti+at[4]*so+at[12],go=at[1]*ti+at[5]*so+at[13],ae=at[2]*ti+at[6]*so+at[14],yo=at[3]*ti+at[7]*so+at[15],Jo=ae+Mr,Qo=yo+Pr,Ts=Co+Rn,ls=go+cn,Ms=ae+Nn,Ka=yo+fn,cs=new re((Co+Wt)/Qo,(go+cr)/Qo);cs.z=Jo/Qo,Tn.push(cs);var Wi=new re(Ts/Ka,ls/Ka);Wi.z=Ms/Ka,ji.push(Wi)}St.push(Tn),Zt.push(ji)}return[St,Zt]}(x,te,G,z);return function(Re,Ke,ze){var at=1/0;Eo(ze,Ke)&&(at=lc(ze,Ke[0]));for(var St=0;St<Ke.length;St++)for(var Zt=Ke[St],Wt=Re[St],cr=0;cr<Zt.length-1;cr++){var Mr=Zt[cr],Pr=[Mr,Zt[cr+1],Wt[cr+1],Wt[cr],Mr];$u(ze,Pr)&&(at=Math.min(at,lc(ze,Pr)))}return at!==1/0&&at}(Me[0],Me[1],oe)},a}(Ea);function Bc(t,a){return t.x*a.x+t.y*a.y}function lc(t,a){if(t.length===1){for(var s,h=0,m=a[h++];!s||m.equals(s);)if(!(s=a[h++]))return 1/0;for(;h<a.length;h++){var x=a[h],S=t[0],T=s.sub(m),k=x.sub(m),z=S.sub(m),j=Bc(T,T),G=Bc(T,k),te=Bc(k,k),oe=Bc(z,T),Me=Bc(z,k),Re=j*te-G*G,Ke=(te*oe-G*Me)/Re,ze=(j*Me-G*oe)/Re,at=m.z*(1-Ke-ze)+s.z*Ke+x.z*ze;if(isFinite(at))return at}return 1/0}for(var St=1/0,Zt=0,Wt=a;Zt<Wt.length;Zt+=1)St=Math.min(St,Wt[Zt].z);return St}var cc=Aa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ip=Aa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,_h=xu.VectorTileFeature.types,vf=Math.cos(Math.PI/180*37.5),ap=Math.pow(2,14)/.5,ya=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new Io,this.layoutVertexArray2=new hl,this.indexArray=new Ku,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new he,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};ya.prototype.populate=function(t,a,s){this.hasPattern=Nc("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),m=[],x=0,S=t;x<S.length;x+=1){var T=S[x],k=T.feature,z=T.id,j=T.index,G=T.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,oe=mo(k,te);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),oe,s)){var Me=h?h.evaluate(oe,{},s):void 0,Re={id:z,properties:k.properties,type:k.type,sourceLayerIndex:G,index:j,geometry:te?oe.geometry:Ia(k),patterns:{},sortKey:Me};m.push(Re)}}h&&m.sort(function(Mr,Pr){return Mr.sortKey-Pr.sortKey});for(var Ke=0,ze=m;Ke<ze.length;Ke+=1){var at=ze[Ke],St=at.geometry,Zt=at.index,Wt=at.sourceLayerIndex;if(this.hasPattern){var cr=pf("line",this.layers,at,this.zoom,a);this.patternFeatures.push(cr)}else this.addFeature(at,St,Zt,s,{});a.featureIndex.insert(t[Zt].feature,St,Zt,Wt,this.index)}},ya.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},ya.prototype.addFeatures=function(t,a,s){for(var h=0,m=this.patternFeatures;h<m.length;h+=1){var x=m[h];this.addFeature(x,x.geometry,x.index,a,s)}},ya.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ya.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ya.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,ip)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ya.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ya.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ya.prototype.addFeature=function(t,a,s,h,m){var x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),T=x.get("line-cap"),k=x.get("line-miter-limit"),z=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var j=0,G=a;j<G.length;j+=1)this.addLine(G[j],t,S,T,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,h)},ya.prototype.addLine=function(t,a,s,h,m,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var T=_h[a.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(T?3:2))){s==="bevel"&&(m=1.05);var j,G=this.overscaling<=16?122880/(512*this.overscaling):0,te=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),oe=void 0,Me=void 0,Re=void 0,Ke=void 0;this.e1=this.e2=-1,T&&(Ke=t[z].sub(j=t[k-2])._unit()._perp());for(var ze=z;ze<k;ze++)if(!(Me=ze===k-1?T?t[z+1]:void 0:t[ze+1])||!t[ze].equals(Me)){Ke&&(Re=Ke),j&&(oe=j),j=t[ze],Ke=Me?Me.sub(j)._unit()._perp():Re;var at=(Re=Re||Ke).add(Ke);at.x===0&&at.y===0||at._unit();var St=Re.x*Ke.x+Re.y*Ke.y,Zt=at.x*Ke.x+at.y*Ke.y,Wt=Zt!==0?1/Zt:1/0,cr=2*Math.sqrt(2-2*Zt),Mr=Zt<vf&&oe&&Me,Pr=Re.x*Ke.y-Re.y*Ke.x>0;if(Mr&&ze>z){var Rn=j.dist(oe);if(Rn>2*G){var cn=j.sub(j.sub(oe)._mult(G/Rn)._round());this.updateDistance(oe,cn),this.addCurrentVertex(cn,Re,0,0,te),oe=cn}}var Nn=oe&&Me,fn=Nn?s:T?"butt":h;if(Nn&&fn==="round"&&(Wt<x?fn="miter":Wt<=2&&(fn="fakeround")),fn==="miter"&&Wt>m&&(fn="bevel"),fn==="bevel"&&(Wt>2&&(fn="flipbevel"),Wt<m&&(fn="miter")),oe&&this.updateDistance(oe,j),fn==="miter")at._mult(Wt),this.addCurrentVertex(j,at,0,0,te);else if(fn==="flipbevel"){if(Wt>100)at=Ke.mult(-1);else{var Ai=Wt*Re.add(Ke).mag()/Re.sub(Ke).mag();at._perp()._mult(Ai*(Pr?-1:1))}this.addCurrentVertex(j,at,0,0,te),this.addCurrentVertex(j,at.mult(-1),0,0,te)}else if(fn==="bevel"||fn==="fakeround"){var ei=-Math.sqrt(Wt*Wt-1),Tn=Pr?ei:0,ji=Pr?0:ei;if(oe&&this.addCurrentVertex(j,Re,Tn,ji,te),fn==="fakeround")for(var xi=Math.round(180*cr/Math.PI/20),bi=1;bi<xi;bi++){var zn=bi/xi;if(zn!==.5){var ti=zn-.5;zn+=zn*ti*(zn-1)*((1.0904+St*(St*(3.55645-1.43519*St)-3.2452))*ti*ti+(.848013+St*(.215638*St-1.06021)))}var so=Ke.sub(Re)._mult(zn)._add(Re)._unit()._mult(Pr?-1:1);this.addHalfVertex(j,so.x,so.y,!1,Pr,0,te)}Me&&this.addCurrentVertex(j,Ke,-Tn,-ji,te)}else if(fn==="butt")this.addCurrentVertex(j,at,0,0,te);else if(fn==="square"){var Co=oe?1:-1;this.addCurrentVertex(j,at,Co,Co,te)}else fn==="round"&&(oe&&(this.addCurrentVertex(j,Re,0,0,te),this.addCurrentVertex(j,Re,1,1,te,!0)),Me&&(this.addCurrentVertex(j,Ke,-1,-1,te,!0),this.addCurrentVertex(j,Ke,0,0,te)));if(Mr&&ze<k-1){var go=j.dist(Me);if(go>2*G){var ae=j.add(Me.sub(j)._mult(G/go)._round());this.updateDistance(j,ae),this.addCurrentVertex(ae,Ke,0,0,te),j=ae}}}}},ya.prototype.addCurrentVertex=function(t,a,s,h,m,x){x===void 0&&(x=!1);var S=a.y*h-a.x,T=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,x,!1,s,m),this.addHalfVertex(t,S,T,x,!0,-h,m),this.distance>ap/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,h,m,x))},ya.prototype.addHalfVertex=function(t,a,s,h,m,x,S){var T=.5*(this.lineClips?this.scaledDistance*(ap-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(x===0?0:x<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),m?this.e2=k:this.e1=k},ya.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ya.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},mn("LineBucket",ya,{omit:["layers","patternFeatures"]});var fc=new qo({"line-cap":new Pn(pe.layout_line["line-cap"]),"line-join":new wn(pe.layout_line["line-join"]),"line-miter-limit":new Pn(pe.layout_line["line-miter-limit"]),"line-round-limit":new Pn(pe.layout_line["line-round-limit"]),"line-sort-key":new wn(pe.layout_line["line-sort-key"])}),ko={paint:new qo({"line-opacity":new wn(pe.paint_line["line-opacity"]),"line-color":new wn(pe.paint_line["line-color"]),"line-translate":new Pn(pe.paint_line["line-translate"]),"line-translate-anchor":new Pn(pe.paint_line["line-translate-anchor"]),"line-width":new wn(pe.paint_line["line-width"]),"line-gap-width":new wn(pe.paint_line["line-gap-width"]),"line-offset":new wn(pe.paint_line["line-offset"]),"line-blur":new wn(pe.paint_line["line-blur"]),"line-dasharray":new ms(pe.paint_line["line-dasharray"]),"line-pattern":new ec(pe.paint_line["line-pattern"]),"line-gradient":new du(pe.paint_line["line-gradient"])}),layout:fc},Js=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h){return h=new Oi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,s,h)},a.prototype.evaluate=function(s,h,m,x){return h=_t({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,s,h,m,x)},a}(wn))(ko.paint.properties["line-width"].specification);Js.useIntegerZoom=!0;var Kp=function(t){function a(s){t.call(this,s,ko),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ds,this.gradientVersion=(this.gradientVersion+1)%je)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h),this.paint._values["line-floorwidth"]=Js.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new ya(s)},a.prototype.queryRadius=function(s){var h=s,m=$p(Us("line-width",this,h),Us("line-gap-width",this,h)),x=Us("line-offset",this,h);return m/2+Math.abs(x)+io(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,h,m,x,S,T,k){var z=yu(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,k),j=k/2*$p(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),G=this.paint.get("line-offset").evaluate(h,m);return G&&(x=function(te,oe){for(var Me=[],Re=new re(0,0),Ke=0;Ke<te.length;Ke++){for(var ze=te[Ke],at=[],St=0;St<ze.length;St++){var Zt=ze[St],Wt=ze[St+1],cr=St===0?Re:Zt.sub(ze[St-1])._unit()._perp(),Mr=St===ze.length-1?Re:Wt.sub(Zt)._unit()._perp(),Pr=cr._add(Mr)._unit();Pr._mult(1/(Pr.x*Mr.x+Pr.y*Mr.y)),at.push(Pr._mult(oe)._add(Zt))}Me.push(at)}return Me}(x,G*k)),function(te,oe,Me){for(var Re=0;Re<oe.length;Re++){var Ke=oe[Re];if(te.length>=3){for(var ze=0;ze<Ke.length;ze++)if(qs(te,Ke[ze]))return!0}if(su(te,Ke,Me))return!0}return!1}(z,x,j)},a.prototype.isTileClipped=function(){return!0},a}(Ea);function $p(t,a){return a>0?a+2*t:t}var Jp=Aa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Id=Aa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Qp=(Aa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Aa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),op=(Aa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Aa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),dv=Aa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Od(t,a,s){return t.sections.forEach(function(h){h.text=function(m,x,S){var T=x.layout.get("text-transform").evaluate(S,{});return T==="uppercase"?m=m.toLocaleUpperCase():T==="lowercase"&&(m=m.toLocaleLowerCase()),Cs.applyArabicShaping&&(m=Cs.applyArabicShaping(m)),m}(h.text,a,s)}),t}Aa([{name:"triangle",components:3,type:"Uint16"}]),Aa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Aa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Aa([{type:"Float32",name:"offsetX"}]),Aa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var mf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},sp=function(t,a,s,h,m){var x,S,T=8*m-h-1,k=(1<<T)-1,z=k>>1,j=-7,G=s?m-1:0,te=s?-1:1,oe=t[a+G];for(G+=te,x=oe&(1<<-j)-1,oe>>=-j,j+=T;j>0;x=256*x+t[a+G],G+=te,j-=8);for(S=x&(1<<-j)-1,x>>=-j,j+=h;j>0;S=256*S+t[a+G],G+=te,j-=8);if(x===0)x=1-z;else{if(x===k)return S?NaN:1/0*(oe?-1:1);S+=Math.pow(2,h),x-=z}return(oe?-1:1)*S*Math.pow(2,x-h)},ed=function(t,a,s,h,m,x){var S,T,k,z=8*x-m-1,j=(1<<z)-1,G=j>>1,te=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,oe=h?0:x-1,Me=h?1:-1,Re=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(T=isNaN(a)?1:0,S=j):(S=Math.floor(Math.log(a)/Math.LN2),a*(k=Math.pow(2,-S))<1&&(S--,k*=2),(a+=S+G>=1?te/k:te*Math.pow(2,1-G))*k>=2&&(S++,k/=2),S+G>=j?(T=0,S=j):S+G>=1?(T=(a*k-1)*Math.pow(2,m),S+=G):(T=a*Math.pow(2,G-1)*Math.pow(2,m),S=0));m>=8;t[s+oe]=255&T,oe+=Me,T/=256,m-=8);for(S=S<<m|T,z+=m;z>0;t[s+oe]=255&S,oe+=Me,S/=256,z-=8);t[s+oe-Me]|=128*Re},gf=Oa;function Oa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Oa.Varint=0,Oa.Fixed64=1,Oa.Bytes=2,Oa.Fixed32=5;var up=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Fl(t){return t.type===Oa.Bytes?t.readVarint()+t.pos:t.pos+1}function yf(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function xh(t,a,s){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(h);for(var m=s.pos-1;m>=t;m--)s.buf[m+h]=s.buf[m]}function Wf(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function B(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function le(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function Fe(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function kt(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function ur(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function It(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function tr(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function dr(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function _r(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function Sr(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function Lr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function kr(t,a,s){t===1&&s.readMessage(Dr,a)}function Dr(t,a,s){if(t===3){var h=s.readMessage(xr,{}),m=h.width,x=h.height,S=h.left,T=h.top,k=h.advance;a.push({id:h.id,bitmap:new Ro({width:m+6,height:x+6},h.bitmap),metrics:{width:m,height:x,left:S,top:T,advance:k}})}}function xr(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function Ar(t){for(var a=0,s=0,h=0,m=t;h<m.length;h+=1){var x=m[h];a+=x.w*x.h,s=Math.max(s,x.w)}t.sort(function(Re,Ke){return Ke.h-Re.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],T=0,k=0,z=0,j=t;z<j.length;z+=1)for(var G=j[z],te=S.length-1;te>=0;te--){var oe=S[te];if(!(G.w>oe.w||G.h>oe.h)){if(G.x=oe.x,G.y=oe.y,k=Math.max(k,G.y+G.h),T=Math.max(T,G.x+G.w),G.w===oe.w&&G.h===oe.h){var Me=S.pop();te<S.length&&(S[te]=Me)}else G.h===oe.h?(oe.x+=G.w,oe.w-=G.w):G.w===oe.w?(oe.y+=G.h,oe.h-=G.h):(S.push({x:oe.x+G.w,y:oe.y,w:oe.w-G.w,h:G.h}),oe.y+=G.h,oe.h-=G.h);break}}return{w:T,h:k,fill:a/(T*k)||0}}Oa.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),m=h>>3,x=this.pos;this.type=7&h,t(m,a,this),this.pos===x&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=_r(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Lr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_r(this.buf,this.pos)+4294967296*_r(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=_r(this.buf,this.pos)+4294967296*Lr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=sp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=sp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,h=this.buf;return a=127&(s=h[this.pos++]),s<128?a:(a|=(127&(s=h[this.pos++]))<<7,s<128?a:(a|=(127&(s=h[this.pos++]))<<14,s<128?a:(a|=(127&(s=h[this.pos++]))<<21,s<128?a:function(m,x,S){var T,k,z=S.buf;if(T=(112&(k=z[S.pos++]))>>4,k<128||(T|=(127&(k=z[S.pos++]))<<3,k<128)||(T|=(127&(k=z[S.pos++]))<<10,k<128)||(T|=(127&(k=z[S.pos++]))<<17,k<128)||(T|=(127&(k=z[S.pos++]))<<24,k<128)||(T|=(1&(k=z[S.pos++]))<<31,k<128))return yf(m,T,x);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&up?function(s,h,m){return up.decode(s.subarray(h,m))}(this.buf,a,t):function(s,h,m){for(var x="",S=h;S<m;){var T,k,z,j=s[S],G=null,te=j>239?4:j>223?3:j>191?2:1;if(S+te>m)break;te===1?j<128&&(G=j):te===2?(192&(T=s[S+1]))==128&&(G=(31&j)<<6|63&T)<=127&&(G=null):te===3?(k=s[S+2],(192&(T=s[S+1]))==128&&(192&k)==128&&((G=(15&j)<<12|(63&T)<<6|63&k)<=2047||G>=55296&&G<=57343)&&(G=null)):te===4&&(k=s[S+2],z=s[S+3],(192&(T=s[S+1]))==128&&(192&k)==128&&(192&z)==128&&((G=(15&j)<<18|(63&T)<<12|(63&k)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,te=1):G>65535&&(G-=65536,x+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),x+=String.fromCharCode(G),S+=te}return x}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==Oa.Bytes)return t.push(this.readVarint(a));var s=Fl(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==Oa.Bytes)return t.push(this.readSVarint());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Oa.Bytes)return t.push(this.readBoolean());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Oa.Bytes)return t.push(this.readFloat());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Oa.Bytes)return t.push(this.readDouble());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Oa.Bytes)return t.push(this.readFixed32());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Oa.Bytes)return t.push(this.readSFixed32());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Oa.Bytes)return t.push(this.readFixed64());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Oa.Bytes)return t.push(this.readSFixed64());var a=Fl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===Oa.Varint)for(;this.buf[this.pos++]>127;);else if(a===Oa.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Oa.Fixed32)this.pos+=4;else{if(a!==Oa.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Sr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Sr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Sr(this.buf,-1&t,this.pos),Sr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Sr(this.buf,-1&t,this.pos),Sr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var h,m;if(a>=0?(h=a%4294967296|0,m=a/4294967296|0):(m=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,m=m+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(x,S,T){T.buf[T.pos++]=127&x|128,x>>>=7,T.buf[T.pos++]=127&x|128,x>>>=7,T.buf[T.pos++]=127&x|128,x>>>=7,T.buf[T.pos++]=127&x|128,T.buf[T.pos]=127&(x>>>=7)}(h,0,s),function(x,S){var T=(7&x)<<4;S.buf[S.pos++]|=T|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(m,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,m,x){for(var S,T,k=0;k<m.length;k++){if((S=m.charCodeAt(k))>55295&&S<57344){if(!T){S>56319||k+1===m.length?(h[x++]=239,h[x++]=191,h[x++]=189):T=S;continue}if(S<56320){h[x++]=239,h[x++]=191,h[x++]=189,T=S;continue}S=T-55296<<10|S-56320|65536,T=null}else T&&(h[x++]=239,h[x++]=191,h[x++]=189,T=null);S<128?h[x++]=S:(S<2048?h[x++]=S>>6|192:(S<65536?h[x++]=S>>12|224:(h[x++]=S>>18|240,h[x++]=S>>12&63|128),h[x++]=S>>6&63|128),h[x++]=63&S|128)}return x}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&xh(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),ed(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ed(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var h=this.pos-s;h>=128&&xh(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,s){this.writeTag(t,Oa.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,Wf,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,B,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,kt,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,le,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,Fe,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,ur,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,It,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,tr,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,dr,a)},writeBytesField:function(t,a){this.writeTag(t,Oa.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,Oa.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,Oa.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,Oa.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,Oa.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,Oa.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,Oa.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,Oa.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,Oa.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,Oa.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var st=function(t,a){var s=a.pixelRatio,h=a.version,m=a.stretchX,x=a.stretchY,S=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=m,this.stretchY=x,this.content=S,this.version=h},Ut={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ut.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ut.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ut.tlbr.get=function(){return this.tl.concat(this.br)},Ut.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(st.prototype,Ut);var wr=function(t,a){var s={},h={};this.haveRenderCallbacks=[];var m=[];this.addImages(t,s,m),this.addImages(a,h,m);var x=Ar(m),S=new Uo({width:x.w||1,height:x.h||1});for(var T in t){var k=t[T],z=s[T].paddedRect;Uo.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var j in a){var G=a[j],te=h[j].paddedRect,oe=te.x+1,Me=te.y+1,Re=G.data.width,Ke=G.data.height;Uo.copy(G.data,S,{x:0,y:0},{x:oe,y:Me},G.data),Uo.copy(G.data,S,{x:0,y:Ke-1},{x:oe,y:Me-1},{width:Re,height:1}),Uo.copy(G.data,S,{x:0,y:0},{x:oe,y:Me+Ke},{width:Re,height:1}),Uo.copy(G.data,S,{x:Re-1,y:0},{x:oe-1,y:Me},{width:1,height:Ke}),Uo.copy(G.data,S,{x:0,y:0},{x:oe+Re,y:Me},{width:1,height:Ke})}this.image=S,this.iconPositions=s,this.patternPositions=h};wr.prototype.addImages=function(t,a,s){for(var h in t){var m=t[h],x={x:0,y:0,w:m.data.width+2,h:m.data.height+2};s.push(x),a[h]=new st(x,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},wr.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},wr.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;s.update(a.data,void 0,{x:h[0],y:h[1]})}},mn("ImagePosition",st),mn("ImageAtlas",wr);var Ur={horizontal:1,vertical:2,horizontalOnly:3},fr=function(){this.scale=1,this.fontStack="",this.imageName=null};fr.forText=function(t,a){var s=new fr;return s.scale=t||1,s.fontStack=a,s},fr.forImage=function(t){var a=new fr;return a.imageName=t,a};var Nr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Jr(t,a,s,h,m,x,S,T,k,z,j,G,te,oe,Me,Re){var Ke,ze=Nr.fromFeature(t,m);G===Ur.vertical&&ze.verticalizePunctuation();var at=Cs.processBidirectionalText,St=Cs.processStyledBidirectionalText;if(at&&ze.sections.length===1){Ke=[];for(var Zt=0,Wt=at(ze.toString(),Yr(ze,z,x,a,h,oe,Me));Zt<Wt.length;Zt+=1){var cr=Wt[Zt],Mr=new Nr;Mr.text=cr,Mr.sections=ze.sections;for(var Pr=0;Pr<cr.length;Pr++)Mr.sectionIndex.push(0);Ke.push(Mr)}}else if(St){Ke=[];for(var Rn=0,cn=St(ze.text,ze.sectionIndex,Yr(ze,z,x,a,h,oe,Me));Rn<cn.length;Rn+=1){var Nn=cn[Rn],fn=new Nr;fn.text=Nn[0],fn.sectionIndex=Nn[1],fn.sections=ze.sections,Ke.push(fn)}}else Ke=function(Tn,ji){for(var xi=[],bi=Tn.text,zn=0,ti=0,so=ji;ti<so.length;ti+=1){var Co=so[ti];xi.push(Tn.substring(zn,Co)),zn=Co}return zn<bi.length&&xi.push(Tn.substring(zn,bi.length)),xi}(ze,Yr(ze,z,x,a,h,oe,Me));var Ai=[],ei={positionedLines:Ai,text:ze.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(Tn,ji,xi,bi,zn,ti,so,Co,go,ae,yo,Jo){for(var Qo=0,Ts=-17,ls=0,Ms=0,Ka=Co==="right"?1:Co==="left"?0:.5,cs=0,Wi=0,Da=zn;Wi<Da.length;Wi+=1){var Ma=Da[Wi];Ma.trim();var ia=Ma.getMaxScale(),Vs=24*(ia-1),Ps={positionedGlyphs:[],lineOffset:0};Tn.positionedLines[cs]=Ps;var $a=Ps.positionedGlyphs,Do=0;if(Ma.length()){for(var Es=0;Es<Ma.length();Es++){var ca=Ma.getSection(Es),Bl=Ma.getSectionIndex(Es),Eu=Ma.getCharCode(Es),Ru=0,Ao=null,zl=null,nl=null,Eh=24,Ul=!(go===Ur.horizontal||!yo&&!Rf(Eu)||yo&&(Fn[Eu]||(Zl=Eu,Kr.Arabic(Zl)||Kr["Arabic Supplement"](Zl)||Kr["Arabic Extended-A"](Zl)||Kr["Arabic Presentation Forms-A"](Zl)||Kr["Arabic Presentation Forms-B"](Zl))));if(ca.imageName){var Sh=bi[ca.imageName];if(!Sh)continue;nl=ca.imageName,Tn.iconsInText=Tn.iconsInText||!0,zl=Sh.paddedRect;var Lu=Sh.displaySize;ca.scale=24*ca.scale/Jo,Ru=Vs+(24-Lu[1]*ca.scale),Eh=(Ao={width:Lu[0],height:Lu[1],left:1,top:-3,advance:Ul?Lu[1]:Lu[0]}).advance;var wh=Ul?Lu[0]*ca.scale-24*ia:Lu[1]*ca.scale-24*ia;wh>0&&wh>Do&&(Do=wh)}else{var id=xi[ca.fontStack],hc=id&&id[Eu];if(hc&&hc.rect)zl=hc.rect,Ao=hc.metrics;else{var Ch=ji[ca.fontStack],cp=Ch&&Ch[Eu];if(!cp)continue;Ao=cp.metrics}Ru=24*(ia-ca.scale)}Ul?(Tn.verticalizable=!0,$a.push({glyph:Eu,imageName:nl,x:Qo,y:Ts+Ru,vertical:Ul,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Bl,metrics:Ao,rect:zl}),Qo+=Eh*ca.scale+ae):($a.push({glyph:Eu,imageName:nl,x:Qo,y:Ts+Ru,vertical:Ul,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Bl,metrics:Ao,rect:zl}),Qo+=Ao.advance*ca.scale+ae)}$a.length!==0&&(ls=Math.max(Qo-ae,ls),vi($a,0,$a.length-1,Ka,Do)),Qo=0;var fp=ti*ia+Do;Ps.lineOffset=Math.max(Do,Vs),Ts+=fp,Ms=Math.max(fp,Ms),++cs}else Ts+=ti,++cs}var Zl,Ah=Ts- -17,Yf=Qr(so),pc=Yf.horizontalAlign,hp=Yf.verticalAlign;(function(ad,od,Th,pp,dp,Mh,Ph,Ih,vp){var qf,mp=(od-Th)*dp;qf=Mh!==Ph?-Ih*pp- -17:(-pp*vp+.5)*Ph;for(var Kf=0,Oh=ad;Kf<Oh.length;Kf+=1)for(var bf=0,Rh=Oh[Kf].positionedGlyphs;bf<Rh.length;bf+=1){var $f=Rh[bf];$f.x+=mp,$f.y+=qf}})(Tn.positionedLines,Ka,pc,hp,ls,Ms,ti,Ah,zn.length),Tn.top+=-hp*Ah,Tn.bottom=Tn.top+Ah,Tn.left+=-pc*ls,Tn.right=Tn.left+ls}(ei,a,s,h,Ke,S,T,k,G,z,te,Re),!function(Tn){for(var ji=0,xi=Tn;ji<xi.length;ji+=1)if(xi[ji].positionedGlyphs.length!==0)return!1;return!0}(Ai)&&ei}Nr.fromFeature=function(t,a){for(var s=new Nr,h=0;h<t.sections.length;h++){var m=t.sections[h];m.image?s.addImageSection(m):s.addTextSection(m,a)}return s},Nr.prototype.length=function(){return this.text.length},Nr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Nr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Nr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Nr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var h=t.charCodeAt(s+1)||null,m=t.charCodeAt(s-1)||null;a+=h&&Tu(h)&&!mf[t[s+1]]||m&&Tu(m)&&!mf[t[s-1]]||!mf[t[s]]?t[s]:mf[t[s]]}return a}(this.text)},Nr.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&Fn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Fn[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Nr.prototype.substring=function(t,a){var s=new Nr;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Nr.prototype.toString=function(){return this.text},Nr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Nr.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(fr.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(s)},Nr.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(fr.forImage(a)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Nr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Fn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rr={};function ar(t,a,s,h,m,x){if(a.imageName){var S=h[a.imageName];return S?S.displaySize[0]*a.scale*24/x+m:0}var T=s[a.fontStack],k=T&&T[t];return k?k.metrics.advance*a.scale+m:0}function _n(t,a,s,h){var m=Math.pow(t-a,2);return h?t<a?m/2:2*m:m+Math.abs(s)*s}function Xr(t,a,s){var h=0;return t===10&&(h-=1e4),s&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function Tr(t,a,s,h,m,x){for(var S=null,T=_n(a,s,m,x),k=0,z=h;k<z.length;k+=1){var j=z[k],G=_n(a-j.x,s,m,x)+j.badness;G<=T&&(S=j,T=G)}return{index:t,x:a,priorBreak:S,badness:T}}function Yr(t,a,s,h,m,x,S){if(x!=="point")return[];if(!t)return[];for(var T,k=[],z=function(Ke,ze,at,St,Zt,Wt){for(var cr=0,Mr=0;Mr<Ke.length();Mr++){var Pr=Ke.getSection(Mr);cr+=ar(Ke.getCharCode(Mr),Pr,St,Zt,ze,Wt)}return cr/Math.max(1,Math.ceil(cr/at))}(t,a,s,h,m,S),j=t.text.indexOf("\u200B")>=0,G=0,te=0;te<t.length();te++){var oe=t.getSection(te),Me=t.getCharCode(te);if(Fn[Me]||(G+=ar(Me,oe,h,m,a,S)),te<t.length()-1){var Re=!((T=Me)<11904||!(Kr["Bopomofo Extended"](T)||Kr.Bopomofo(T)||Kr["CJK Compatibility Forms"](T)||Kr["CJK Compatibility Ideographs"](T)||Kr["CJK Compatibility"](T)||Kr["CJK Radicals Supplement"](T)||Kr["CJK Strokes"](T)||Kr["CJK Symbols and Punctuation"](T)||Kr["CJK Unified Ideographs Extension A"](T)||Kr["CJK Unified Ideographs"](T)||Kr["Enclosed CJK Letters and Months"](T)||Kr["Halfwidth and Fullwidth Forms"](T)||Kr.Hiragana(T)||Kr["Ideographic Description Characters"](T)||Kr["Kangxi Radicals"](T)||Kr["Katakana Phonetic Extensions"](T)||Kr.Katakana(T)||Kr["Vertical Forms"](T)||Kr["Yi Radicals"](T)||Kr["Yi Syllables"](T)));(rr[Me]||Re||oe.imageName)&&k.push(Tr(te+1,G,z,k,Xr(Me,t.getCharCode(te+1),Re&&j),!1))}}return function Ke(ze){return ze?Ke(ze.priorBreak).concat(ze.index):[]}(Tr(t.length(),G,z,k,0,!0))}function Qr(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function vi(t,a,s,h,m){if(h||m)for(var x=t[s],S=(t[s].x+x.metrics.advance*x.scale)*h,T=a;T<=s;T++)t[T].x-=S,t[T].y+=m}function ni(t,a,s,h,m,x){var S,T=t.image;if(T.content){var k=T.content,z=T.pixelRatio||1;S=[k[0]/z,k[1]/z,T.displaySize[0]-k[2]/z,T.displaySize[1]-k[3]/z]}var j,G,te,oe,Me=a.left*x,Re=a.right*x;s==="width"||s==="both"?(oe=m[0]+Me-h[3],G=m[0]+Re+h[1]):G=(oe=m[0]+(Me+Re-T.displaySize[0])/2)+T.displaySize[0];var Ke=a.top*x,ze=a.bottom*x;return s==="height"||s==="both"?(j=m[1]+Ke-h[0],te=m[1]+ze+h[2]):te=(j=m[1]+(Ke+ze-T.displaySize[1])/2)+T.displaySize[1],{image:T,top:j,right:G,bottom:te,left:oe,collisionPadding:S}}rr[10]=!0,rr[32]=!0,rr[38]=!0,rr[40]=!0,rr[41]=!0,rr[43]=!0,rr[45]=!0,rr[47]=!0,rr[173]=!0,rr[183]=!0,rr[8203]=!0,rr[8208]=!0,rr[8211]=!0,rr[8231]=!0;var qr=function(t){function a(s,h,m,x){t.call(this,s,h),this.angle=m,x!==void 0&&(this.segment=x)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(re);function an(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Oi(t+1))};if(s.kind==="source")return{kind:"source"};for(var h=s.zoomStops,m=s.interpolationType,x=0;x<h.length&&h[x]<=t;)x++;for(var S=x=Math.max(0,x-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var T=h[x],k=h[S];return s.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:k,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:k,minSize:s.evaluate(new Oi(T)),maxSize:s.evaluate(new Oi(k)),interpolationType:m}}function Yn(t,a,s){var h=a.uSize,m=s.lowerSize;return t.kind==="source"?m/128:t.kind==="composite"?sa(m/128,s.upperSize/128,a.uSizeT):h}function ci(t,a){var s=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var m=t.interpolationType,x=m?Mt(_e.interpolationFactor(m,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=sa(t.minSize,t.maxSize,x):s=x}return{uSizeT:s,uSize:h}}mn("Anchor",qr);var Ui=Object.freeze({__proto__:null,getSizeData:an,evaluateSizeForFeature:Yn,evaluateSizeForZoom:ci,SIZE_PACK_FACTOR:128});function ao(t,a,s,h,m){if(a.segment===void 0)return!0;for(var x=a,S=a.segment+1,T=0;T>-s/2;){if(--S<0)return!1;T-=t[S].dist(x),x=t[S]}T+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;T<s/2;){var j=t[S],G=t[S+1];if(!G)return!1;var te=t[S-1].angleTo(j)-j.angleTo(G);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:T,angleDelta:te}),z+=te;T-k[0].distance>h;)z-=k.shift().angleDelta;if(z>m)return!1;S++,T+=j.dist(G)}return!0}function oo(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Ni(t,a,s){return t?.6*a*s:0}function as(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Wa(t,a,s,h,m,x){for(var S=Ni(s,m,x),T=as(s,h)*x,k=0,z=oo(t)/2,j=0;j<t.length-1;j++){var G=t[j],te=t[j+1],oe=G.dist(te);if(k+oe>z){var Me=(z-k)/oe,Re=sa(G.x,te.x,Me),Ke=sa(G.y,te.y,Me),ze=new qr(Re,Ke,te.angleTo(G),j);return ze._round(),!S||ao(t,ze,T,S,a)?ze:void 0}k+=oe}}function Ko(t,a,s,h,m,x,S,T,k){var z=Ni(h,x,S),j=as(h,m),G=j*S,te=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return a-G<a/4&&(a=G+a/4),function oe(Me,Re,Ke,ze,at,St,Zt,Wt,cr){for(var Mr=St/2,Pr=oo(Me),Rn=0,cn=Re-Ke,Nn=[],fn=0;fn<Me.length-1;fn++){for(var Ai=Me[fn],ei=Me[fn+1],Tn=Ai.dist(ei),ji=ei.angleTo(Ai);cn+Ke<Rn+Tn;){var xi=((cn+=Ke)-Rn)/Tn,bi=sa(Ai.x,ei.x,xi),zn=sa(Ai.y,ei.y,xi);if(bi>=0&&bi<cr&&zn>=0&&zn<cr&&cn-Mr>=0&&cn+Mr<=Pr){var ti=new qr(bi,zn,ji,fn);ti._round(),ze&&!ao(Me,ti,St,ze,at)||Nn.push(ti)}}Rn+=Tn}return Wt||Nn.length||Zt||(Nn=oe(Me,Rn/2,Ke,ze,at,St,Zt,!0,cr)),Nn}(t,te?a/2*T%a:(j/2+2*x)*S*T%a,a,z,s,G,te,!1,k)}function So(t,a,s,h,m){for(var x=[],S=0;S<t.length;S++)for(var T=t[S],k=void 0,z=0;z<T.length-1;z++){var j=T[z],G=T[z+1];j.x<a&&G.x<a||(j.x<a?j=new re(a,j.y+(a-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<a&&(G=new re(a,j.y+(a-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<s&&G.y<s||(j.y<s?j=new re(j.x+(s-j.y)/(G.y-j.y)*(G.x-j.x),s)._round():G.y<s&&(G=new re(j.x+(s-j.y)/(G.y-j.y)*(G.x-j.x),s)._round()),j.x>=h&&G.x>=h||(j.x>=h?j=new re(h,j.y+(h-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=h&&(G=new re(h,j.y+(h-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=m&&G.y>=m||(j.y>=m?j=new re(j.x+(m-j.y)/(G.y-j.y)*(G.x-j.x),m)._round():G.y>=m&&(G=new re(j.x+(m-j.y)/(G.y-j.y)*(G.x-j.x),m)._round()),k&&j.equals(k[k.length-1])||x.push(k=[j]),k.push(G)))))}return x}function $o(t,a,s,h){var m=[],x=t.image,S=x.pixelRatio,T=x.paddedRect.w-2,k=x.paddedRect.h-2,z=t.right-t.left,j=t.bottom-t.top,G=x.stretchX||[[0,T]],te=x.stretchY||[[0,k]],oe=function(bi,zn){return bi+zn[1]-zn[0]},Me=G.reduce(oe,0),Re=te.reduce(oe,0),Ke=T-Me,ze=k-Re,at=0,St=Me,Zt=0,Wt=Re,cr=0,Mr=Ke,Pr=0,Rn=ze;if(x.content&&h){var cn=x.content;at=Zo(G,0,cn[0]),Zt=Zo(te,0,cn[1]),St=Zo(G,cn[0],cn[2]),Wt=Zo(te,cn[1],cn[3]),cr=cn[0]-at,Pr=cn[1]-Zt,Mr=cn[2]-cn[0]-St,Rn=cn[3]-cn[1]-Wt}var Nn=function(bi,zn,ti,so){var Co=co(bi.stretch-at,St,z,t.left),go=mi(bi.fixed-cr,Mr,bi.stretch,Me),ae=co(zn.stretch-Zt,Wt,j,t.top),yo=mi(zn.fixed-Pr,Rn,zn.stretch,Re),Jo=co(ti.stretch-at,St,z,t.left),Qo=mi(ti.fixed-cr,Mr,ti.stretch,Me),Ts=co(so.stretch-Zt,Wt,j,t.top),ls=mi(so.fixed-Pr,Rn,so.stretch,Re),Ms=new re(Co,ae),Ka=new re(Jo,ae),cs=new re(Jo,Ts),Wi=new re(Co,Ts),Da=new re(go/S,yo/S),Ma=new re(Qo/S,ls/S),ia=a*Math.PI/180;if(ia){var Vs=Math.sin(ia),Ps=Math.cos(ia),$a=[Ps,-Vs,Vs,Ps];Ms._matMult($a),Ka._matMult($a),Wi._matMult($a),cs._matMult($a)}var Do=bi.stretch+bi.fixed,Es=zn.stretch+zn.fixed;return{tl:Ms,tr:Ka,bl:Wi,br:cs,tex:{x:x.paddedRect.x+1+Do,y:x.paddedRect.y+1+Es,w:ti.stretch+ti.fixed-Do,h:so.stretch+so.fixed-Es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Da,pixelOffsetBR:Ma,minFontScaleX:Mr/S/z,minFontScaleY:Rn/S/j,isSDF:s}};if(h&&(x.stretchX||x.stretchY))for(var fn=os(G,Ke,Me),Ai=os(te,ze,Re),ei=0;ei<fn.length-1;ei++)for(var Tn=fn[ei],ji=fn[ei+1],xi=0;xi<Ai.length-1;xi++)m.push(Nn(Tn,Ai[xi],ji,Ai[xi+1]));else m.push(Nn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:k+1}));return m}function Zo(t,a,s){for(var h=0,m=0,x=t;m<x.length;m+=1){var S=x[m];h+=Math.max(a,Math.min(s,S[1]))-Math.max(a,Math.min(s,S[0]))}return h}function os(t,a,s){for(var h=[{fixed:-1,stretch:0}],m=0,x=t;m<x.length;m+=1){var S=x[m],T=S[0],k=S[1],z=h[h.length-1];h.push({fixed:T-z.stretch,stretch:z.stretch}),h.push({fixed:T-z.stretch,stretch:z.stretch+(k-T)})}return h.push({fixed:a+1,stretch:s}),h}function co(t,a,s,h){return t/a*s+h}function mi(t,a,s,h){return t-a*s/h}var jo=function(t,a,s,h,m,x,S,T,k,z){if(this.boxStartIndex=t.length,k){var j=x.top,G=x.bottom,te=x.collisionPadding;te&&(j-=te[1],G+=te[3]);var oe=G-j;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{var Me=x.top*S-T,Re=x.bottom*S+T,Ke=x.left*S-T,ze=x.right*S+T,at=x.collisionPadding;if(at&&(Ke-=at[0]*S,Me-=at[1]*S,ze+=at[2]*S,Re+=at[3]*S),z){var St=new re(Ke,Me),Zt=new re(ze,Me),Wt=new re(Ke,Re),cr=new re(ze,Re),Mr=z*Math.PI/180;St._rotate(Mr),Zt._rotate(Mr),Wt._rotate(Mr),cr._rotate(Mr),Ke=Math.min(St.x,Zt.x,Wt.x,cr.x),ze=Math.max(St.x,Zt.x,Wt.x,cr.x),Me=Math.min(St.y,Zt.y,Wt.y,cr.y),Re=Math.max(St.y,Zt.y,Wt.y,cr.y)}t.emplaceBack(a.x,a.y,Ke,Me,ze,Re,s,h,m)}this.boxEndIndex=t.length},ea=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=ss),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function ss(t,a){return t<a?-1:t>a?1:0}function Qn(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var h=1/0,m=1/0,x=-1/0,S=-1/0,T=t[0],k=0;k<T.length;k++){var z=T[k];(!k||z.x<h)&&(h=z.x),(!k||z.y<m)&&(m=z.y),(!k||z.x>x)&&(x=z.x),(!k||z.y>S)&&(S=z.y)}var j=Math.min(x-h,S-m),G=j/2,te=new ea([],ki);if(j===0)return new re(h,m);for(var oe=h;oe<x;oe+=j)for(var Me=m;Me<S;Me+=j)te.push(new la(oe+G,Me+G,G,t));for(var Re=function(at){for(var St=0,Zt=0,Wt=0,cr=at[0],Mr=0,Pr=cr.length,Rn=Pr-1;Mr<Pr;Rn=Mr++){var cn=cr[Mr],Nn=cr[Rn],fn=cn.x*Nn.y-Nn.x*cn.y;Zt+=(cn.x+Nn.x)*fn,Wt+=(cn.y+Nn.y)*fn,St+=3*fn}return new la(Zt/St,Wt/St,0,at)}(t),Ke=te.length;te.length;){var ze=te.pop();(ze.d>Re.d||!Re.d)&&(Re=ze,s&&console.log("found best %d after %d probes",Math.round(1e4*ze.d)/1e4,Ke)),ze.max-Re.d<=a||(te.push(new la(ze.p.x-(G=ze.h/2),ze.p.y-G,G,t)),te.push(new la(ze.p.x+G,ze.p.y-G,G,t)),te.push(new la(ze.p.x-G,ze.p.y+G,G,t)),te.push(new la(ze.p.x+G,ze.p.y+G,G,t)),Ke+=4)}return s&&(console.log("num probes: "+Ke),console.log("best distance: "+Re.d)),Re.p}function ki(t,a){return a.max-t.max}function la(t,a,s,h){this.p=new re(t,a),this.h=s,this.d=function(m,x){for(var S=!1,T=1/0,k=0;k<x.length;k++)for(var z=x[k],j=0,G=z.length,te=G-1;j<G;te=j++){var oe=z[j],Me=z[te];oe.y>m.y!=Me.y>m.y&&m.x<(Me.x-oe.x)*(m.y-oe.y)/(Me.y-oe.y)+oe.x&&(S=!S),T=Math.min(T,Ju(m,oe,Me))}return(S?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ea.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ea.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},ea.prototype.peek=function(){return this.data[0]},ea.prototype._up=function(t){for(var a=this.data,s=this.compare,h=a[t];t>0;){var m=t-1>>1,x=a[m];if(s(h,x)>=0)break;a[t]=x,t=m}a[t]=h},ea.prototype._down=function(t){for(var a=this.data,s=this.compare,h=this.length>>1,m=a[t];t<h;){var x=1+(t<<1),S=a[x],T=x+1;if(T<this.length&&s(a[T],S)<0&&(x=T,S=a[T]),s(S,m)>=0)break;a[t]=S,t=x}a[t]=m};var wo=Number.POSITIVE_INFINITY;function rl(t,a){return a[1]!==wo?function(s,h,m){var x=0,S=0;switch(h=Math.abs(h),m=Math.abs(m),s){case"top-right":case"top-left":case"top":S=m-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-m}switch(s){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,S]}(t,a[0],a[1]):function(s,h){var m=0,x=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-h;break;case"top":x=h-7}switch(s){case"top-right":case"bottom-right":m=-S;break;case"top-left":case"bottom-left":m=S;break;case"left":m=h;break;case"right":m=-h}return[m,x]}(t,a[0])}function Pe(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bt(t,a,s,h,m,x,S,T,k,z,j,G,te,oe,Me){var Re=function(Zt,Wt,cr,Mr,Pr,Rn,cn,Nn){for(var fn=Mr.layout.get("text-rotate").evaluate(Rn,{})*Math.PI/180,Ai=[],ei=0,Tn=Wt.positionedLines;ei<Tn.length;ei+=1)for(var ji=Tn[ei],xi=0,bi=ji.positionedGlyphs;xi<bi.length;xi+=1){var zn=bi[xi];if(zn.rect){var ti=zn.rect||{},so=4,Co=!0,go=1,ae=0,yo=(Pr||Nn)&&zn.vertical,Jo=zn.metrics.advance*zn.scale/2;if(Nn&&Wt.verticalizable&&(ae=ji.lineOffset/2-(zn.imageName?-(24-zn.metrics.width*zn.scale)/2:24*(zn.scale-1))),zn.imageName){var Qo=cn[zn.imageName];Co=Qo.sdf,so=1/(go=Qo.pixelRatio)}var Ts=Pr?[zn.x+Jo,zn.y]:[0,0],ls=Pr?[0,0]:[zn.x+Jo+cr[0],zn.y+cr[1]-ae],Ms=[0,0];yo&&(Ms=ls,ls=[0,0]);var Ka=(zn.metrics.left-so)*zn.scale-Jo+ls[0],cs=(-zn.metrics.top-so)*zn.scale+ls[1],Wi=Ka+ti.w*zn.scale/go,Da=cs+ti.h*zn.scale/go,Ma=new re(Ka,cs),ia=new re(Wi,cs),Vs=new re(Ka,Da),Ps=new re(Wi,Da);if(yo){var $a=new re(-Jo,Jo- -17),Do=-Math.PI/2,Es=12-Jo,ca=new re(22-Es,-(zn.imageName?Es:0)),Bl=new(Function.prototype.bind.apply(re,[null].concat(Ms)));Ma._rotateAround(Do,$a)._add(ca)._add(Bl),ia._rotateAround(Do,$a)._add(ca)._add(Bl),Vs._rotateAround(Do,$a)._add(ca)._add(Bl),Ps._rotateAround(Do,$a)._add(ca)._add(Bl)}if(fn){var Eu=Math.sin(fn),Ru=Math.cos(fn),Ao=[Ru,-Eu,Eu,Ru];Ma._matMult(Ao),ia._matMult(Ao),Vs._matMult(Ao),Ps._matMult(Ao)}var zl=new re(0,0),nl=new re(0,0);Ai.push({tl:Ma,tr:ia,bl:Vs,br:Ps,tex:ti,writingMode:Wt.writingMode,glyphOffset:Ts,sectionIndex:zn.sectionIndex,isSDF:Co,pixelOffsetTL:zl,pixelOffsetBR:nl,minFontScaleX:0,minFontScaleY:0})}}return Ai}(0,s,T,m,x,S,h,t.allowVerticalPlacement),Ke=t.textSizeData,ze=null;Ke.kind==="source"?(ze=[128*m.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ke.kind==="composite"&&((ze=[128*oe.compositeTextSizes[0].evaluate(S,{},Me),128*oe.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||ze[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Re,ze,T,x,S,z,a,k.lineStartIndex,k.lineLength,te,Me);for(var at=0,St=j;at<St.length;at+=1)G[St[at]]=t.text.placedSymbolArray.length-1;return 4*Re.length}function wt(t){for(var a in t)return t[a];return null}function pn(t,a,s,h){var m=t.compareText;if(a in m){for(var x=m[a],S=x.length-1;S>=0;S--)if(h.dist(x[S])<s)return!0}else m[a]=[];return m[a].push(h),!1}var Zi=xu.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ce(t,a,s,h,m,x,S,T,k,z,j,G,te){var oe=T?Math.min(32640,Math.round(T[0])):0,Me=T?Math.min(32640,Math.round(T[1])):0;t.emplaceBack(a,s,Math.round(32*h),Math.round(32*m),x,S,(oe<<1)+(k?1:0),Me,16*z,16*j,256*G,256*te)}function Ge(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function ct(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(rf(s[a].text))return!0;return!1}var Pt=function(t){this.layoutVertexArray=new nf,this.indexArray=new Ku,this.programConfigurations=t,this.segments=new he,this.dynamicLayoutVertexArray=new Pl,this.opacityVertexArray=new Il,this.placedSymbolArray=new p};Pt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Pt.prototype.upload=function(t,a,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Id.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))},Pt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},mn("SymbolBuffers",Pt);var Je=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new he,this.collisionVertexArray=new lh};Je.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Qp.members,!0)},Je.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},mn("CollisionBuffers",Je);var Be=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zs([]),this.placementViewportMatrix=Zs([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=an(this.zoom,a["text-size"]),this.iconSizeData=an(this.zoom,a["icon-size"]);var s=this.layers[0].layout,h=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(x){return Ur[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};Be.prototype.createArrays=function(){this.text=new Pt(new Vn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Pt(new Vn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new A,this.lineVertexArray=new L,this.symbolInstances=new w},Be.prototype.calculateGlyphDependencies=function(t,a,s,h,m){for(var x=0;x<t.length;x++)if(a[t.charCodeAt(x)]=!0,(s||h)&&m){var S=mf[t.charAt(x)];S&&(a[S.charCodeAt(0)]=!0)}},Be.prototype.populate=function(t,a,s){var h=this.layers[0],m=h.layout,x=m.get("text-font"),S=m.get("text-field"),T=m.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof wa&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),z=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,j=m.get("symbol-sort-key");if(this.features=[],k||z){for(var G=a.iconDependencies,te=a.glyphDependencies,oe=a.availableImages,Me=new Oi(this.zoom),Re=0,Ke=t;Re<Ke.length;Re+=1){var ze=Ke[Re],at=ze.feature,St=ze.id,Zt=ze.index,Wt=ze.sourceLayerIndex,cr=h._featureFilter.needGeometry,Mr=mo(at,cr);if(h._featureFilter.filter(Me,Mr,s)){cr||(Mr.geometry=Ia(at));var Pr=void 0;if(k){var Rn=h.getValueAndResolveTokens("text-field",Mr,s,oe),cn=wa.factory(Rn);ct(cn)&&(this.hasRTLText=!0),(!this.hasRTLText||uh()==="unavailable"||this.hasRTLText&&Cs.isParsed())&&(Pr=Od(cn,h,Mr))}var Nn=void 0;if(z){var fn=h.getValueAndResolveTokens("icon-image",Mr,s,oe);Nn=fn instanceof Ca?fn:Ca.fromString(fn)}if(Pr||Nn){var Ai=this.sortFeaturesByKey?j.evaluate(Mr,{},s):void 0;if(this.features.push({id:St,text:Pr,icon:Nn,index:Zt,sourceLayerIndex:Wt,geometry:Mr.geometry,properties:at.properties,type:Zi[at.type],sortKey:Ai}),Nn&&(G[Nn.name]=!0),Pr){var ei=x.evaluate(Mr,{},s).join(","),Tn=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ur.vertical)>=0;for(var ji=0,xi=Pr.sections;ji<xi.length;ji+=1){var bi=xi[ji];if(bi.image)G[bi.image.name]=!0;else{var zn=tf(Pr.toString()),ti=bi.fontStack||ei,so=te[ti]=te[ti]||{};this.calculateGlyphDependencies(bi.text,so,Tn,this.allowVerticalPlacement,zn)}}}}}}m.get("symbol-placement")==="line"&&(this.features=function(Co){var go={},ae={},yo=[],Jo=0;function Qo($a){yo.push(Co[$a]),Jo++}function Ts($a,Do,Es){var ca=ae[$a];return delete ae[$a],ae[Do]=ca,yo[ca].geometry[0].pop(),yo[ca].geometry[0]=yo[ca].geometry[0].concat(Es[0]),ca}function ls($a,Do,Es){var ca=go[Do];return delete go[Do],go[$a]=ca,yo[ca].geometry[0].shift(),yo[ca].geometry[0]=Es[0].concat(yo[ca].geometry[0]),ca}function Ms($a,Do,Es){var ca=Es?Do[0][Do[0].length-1]:Do[0][0];return $a+":"+ca.x+":"+ca.y}for(var Ka=0;Ka<Co.length;Ka++){var cs=Co[Ka],Wi=cs.geometry,Da=cs.text?cs.text.toString():null;if(Da){var Ma=Ms(Da,Wi),ia=Ms(Da,Wi,!0);if(Ma in ae&&ia in go&&ae[Ma]!==go[ia]){var Vs=ls(Ma,ia,Wi),Ps=Ts(Ma,ia,yo[Vs].geometry);delete go[Ma],delete ae[ia],ae[Ms(Da,yo[Ps].geometry,!0)]=Ps,yo[Vs].geometry=null}else Ma in ae?Ts(Ma,ia,Wi):ia in go?ls(Ma,ia,Wi):(Qo(Ka),go[Ma]=Jo-1,ae[ia]=Jo-1)}else Qo(Ka)}return yo.filter(function($a){return $a.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Co,go){return Co.sortKey-go.sortKey})}},Be.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},Be.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Be.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Be.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Be.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Be.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Be.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),m=t.dist(a[t.segment]),x={},S=t.segment+1;S<a.length;S++)x[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:h},S<a.length-1&&(h+=a[S+1].dist(a[S]));for(var T=t.segment||0;T>=0;T--)x[T]={x:a[T].x,y:a[T].y,tileUnitDistanceFromAnchor:m},T>0&&(m+=a[T-1].dist(a[T]));for(var k=0;k<a.length;k++){var z=x[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Be.prototype.addSymbols=function(t,a,s,h,m,x,S,T,k,z,j,G){for(var te=t.indexArray,oe=t.layoutVertexArray,Me=t.segments.prepareSegment(4*a.length,oe,te,this.canOverlap?x.sortKey:void 0),Re=this.glyphOffsetArray.length,Ke=Me.vertexLength,ze=this.allowVerticalPlacement&&S===Ur.vertical?Math.PI/2:0,at=x.text&&x.text.sections,St=0;St<a.length;St++){var Zt=a[St],Wt=Zt.tl,cr=Zt.tr,Mr=Zt.bl,Pr=Zt.br,Rn=Zt.tex,cn=Zt.pixelOffsetTL,Nn=Zt.pixelOffsetBR,fn=Zt.minFontScaleX,Ai=Zt.minFontScaleY,ei=Zt.glyphOffset,Tn=Zt.isSDF,ji=Zt.sectionIndex,xi=Me.vertexLength,bi=ei[1];ce(oe,T.x,T.y,Wt.x,bi+Wt.y,Rn.x,Rn.y,s,Tn,cn.x,cn.y,fn,Ai),ce(oe,T.x,T.y,cr.x,bi+cr.y,Rn.x+Rn.w,Rn.y,s,Tn,Nn.x,cn.y,fn,Ai),ce(oe,T.x,T.y,Mr.x,bi+Mr.y,Rn.x,Rn.y+Rn.h,s,Tn,cn.x,Nn.y,fn,Ai),ce(oe,T.x,T.y,Pr.x,bi+Pr.y,Rn.x+Rn.w,Rn.y+Rn.h,s,Tn,Nn.x,Nn.y,fn,Ai),Ge(t.dynamicLayoutVertexArray,T,ze),te.emplaceBack(xi,xi+1,xi+2),te.emplaceBack(xi+1,xi+2,xi+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ei[0]),St!==a.length-1&&ji===a[St+1].sectionIndex||t.programConfigurations.populatePaintArrays(oe.length,x,x.index,{},G,at&&at[ji])}t.placedSymbolArray.emplaceBack(T.x,T.y,Re,this.glyphOffsetArray.length-Re,Ke,k,z,T.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],S,0,!1,0,j)},Be.prototype._addCollisionDebugVertex=function(t,a,s,h,m,x){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,m,Math.round(x.x),Math.round(x.y))},Be.prototype.addCollisionDebugVertices=function(t,a,s,h,m,x,S){var T=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=T.vertexLength,z=m.layoutVertexArray,j=m.collisionVertexArray,G=S.anchorX,te=S.anchorY;this._addCollisionDebugVertex(z,j,x,G,te,new re(t,a)),this._addCollisionDebugVertex(z,j,x,G,te,new re(s,a)),this._addCollisionDebugVertex(z,j,x,G,te,new re(s,h)),this._addCollisionDebugVertex(z,j,x,G,te,new re(t,h)),T.vertexLength+=4;var oe=m.indexArray;oe.emplaceBack(k,k+1),oe.emplaceBack(k+1,k+2),oe.emplaceBack(k+2,k+3),oe.emplaceBack(k+3,k),T.primitiveLength+=4},Be.prototype.addDebugCollisionBoxes=function(t,a,s,h){for(var m=t;m<a;m++){var x=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,h?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,s)}},Be.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Je(tc,op.members,gu),this.iconCollisionBox=new Je(tc,op.members,gu);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},Be.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,h,m,x,S,T,k){for(var z={},j=a;j<s;j++){var G=t.get(j);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},z.textFeatureIndex=G.featureIndex;break}for(var te=h;te<m;te++){var oe=t.get(te);z.verticalTextBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},z.verticalTextFeatureIndex=oe.featureIndex;break}for(var Me=x;Me<S;Me++){var Re=t.get(Me);z.iconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,anchorPointX:Re.anchorPointX,anchorPointY:Re.anchorPointY},z.iconFeatureIndex=Re.featureIndex;break}for(var Ke=T;Ke<k;Ke++){var ze=t.get(Ke);z.verticalIconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},z.verticalIconFeatureIndex=ze.featureIndex;break}return z},Be.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Be.prototype.hasTextData=function(){return this.text.segments.get().length>0},Be.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Be.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Be.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Be.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Be.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),h=s.vertexStartIndex+4*s.numGlyphs,m=s.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)},Be.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),h=[],m=[],x=[],S=0;S<this.symbolInstances.length;++S){x.push(S);var T=this.symbolInstances.get(S);h.push(0|Math.round(a*T.anchorX+s*T.anchorY)),m.push(T.featureIndex)}return x.sort(function(k,z){return h[k]-h[z]||m[z]-m[k]}),x},Be.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Be.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,h=this.symbolInstanceIndexes;s<h.length;s+=1){var m=this.symbolInstances.get(h[s]);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(function(x,S,T){x>=0&&T.indexOf(x)===S&&a.addIndicesForPlacedSymbol(a.text,x)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},mn("SymbolBucket",Be,{omit:["layers","collisionBoxArray","features","compareText"]}),Be.MAX_GLYPHS=65535,Be.addDynamicAttributes=Ge;var nt=new qo({"symbol-placement":new Pn(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Pn(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pn(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pn(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pn(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pn(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pn(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pn(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(pe.layout_symbol["icon-size"]),"icon-text-fit":new Pn(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pn(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(pe.layout_symbol["icon-image"]),"icon-rotate":new wn(pe.layout_symbol["icon-rotate"]),"icon-padding":new Pn(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Pn(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(pe.layout_symbol["icon-offset"]),"icon-anchor":new wn(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pn(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pn(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pn(pe.layout_symbol["text-rotation-alignment"]),"text-field":new wn(pe.layout_symbol["text-field"]),"text-font":new wn(pe.layout_symbol["text-font"]),"text-size":new wn(pe.layout_symbol["text-size"]),"text-max-width":new wn(pe.layout_symbol["text-max-width"]),"text-line-height":new Pn(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(pe.layout_symbol["text-letter-spacing"]),"text-justify":new wn(pe.layout_symbol["text-justify"]),"text-radial-offset":new wn(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pn(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new wn(pe.layout_symbol["text-anchor"]),"text-max-angle":new Pn(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Pn(pe.layout_symbol["text-writing-mode"]),"text-rotate":new wn(pe.layout_symbol["text-rotate"]),"text-padding":new Pn(pe.layout_symbol["text-padding"]),"text-keep-upright":new Pn(pe.layout_symbol["text-keep-upright"]),"text-transform":new wn(pe.layout_symbol["text-transform"]),"text-offset":new wn(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Pn(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pn(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Pn(pe.layout_symbol["text-optional"])}),ye={paint:new qo({"icon-opacity":new wn(pe.paint_symbol["icon-opacity"]),"icon-color":new wn(pe.paint_symbol["icon-color"]),"icon-halo-color":new wn(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Pn(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pn(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new wn(pe.paint_symbol["text-opacity"]),"text-color":new wn(pe.paint_symbol["text-color"],{runtimeType:Wr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new wn(pe.paint_symbol["text-halo-color"]),"text-halo-width":new wn(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(pe.paint_symbol["text-halo-blur"]),"text-translate":new Pn(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Pn(pe.paint_symbol["text-translate-anchor"])}),layout:nt},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ln,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},mn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Ce=function(t){function a(s){t.call(this,s,ye)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){if(t.prototype.recalculate.call(this,s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var m=this.layout.get("text-writing-mode");if(m){for(var x=[],S=0,T=m;S<T.length;S+=1){var k=T[S];x.indexOf(k)<0&&x.push(k)}this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,h,m,x){var S=this.layout.get(s).evaluate(h,{},m,x),T=this._unevaluatedLayout._values[s];return T.isDataDriven()||Bo(T.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(j,G){return G in k?String(k[G]):""})}(h.properties,S)},a.prototype.createBucket=function(s){return new Be(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,h=ye.paint.overridableProperties;s<h.length;s+=1){var m=h[s];if(a.hasPaintOverride(this.layout,m)){var x,S=this.paint.get(m),T=new Ze(S),k=new ll(T,S.property.specification);x=S.value.kind==="constant"||S.value.kind==="source"?new Gu("source",k):new zo("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[m]=new vs(S.property,x,S.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,h){var m=s.get("text-field"),x=ye.paint.properties[h],S=!1,T=function(j){for(var G=0,te=j;G<te.length;G+=1)if(x.overrides&&x.overrides.hasOverride(te[G]))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof wa)T(m.value.value.sections);else if(m.value.kind==="source"){var k=function(j){S||(j instanceof fo&&ra(j.value)===ta?T(j.value.sections):j instanceof Go?T(j.sections):j.eachChild(k))},z=m.value;z._styleExpression&&k(z._styleExpression.expression)}return S},a}(Ea),ft={paint:new qo({"background-color":new Pn(pe.paint_background["background-color"]),"background-pattern":new ms(pe.paint_background["background-pattern"]),"background-opacity":new Pn(pe.paint_background["background-opacity"])})},Et=function(t){function a(s){t.call(this,s,ft)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ea),pr={paint:new qo({"raster-opacity":new Pn(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pn(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pn(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pn(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Pn(pe.paint_raster["raster-saturation"]),"raster-contrast":new Pn(pe.paint_raster["raster-contrast"]),"raster-resampling":new Pn(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Pn(pe.paint_raster["raster-fade-duration"])})},Zr=function(t){function a(s){t.call(this,s,pr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Ea),jr=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(Ea),tn={circle:of,heatmap:Df,hillshade:fh,fill:Hf,"fill-extrusion":tl,line:Kp,symbol:Ce,background:Et,raster:Zr},$t=ne.HTMLImageElement,hr=ne.HTMLCanvasElement,un=ne.HTMLVideoElement,Sn=ne.ImageData,xn=ne.ImageBitmap,gn=function(t,a,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,h)};gn.prototype.update=function(t,a,s){var h=t.width,m=t.height,x=!(this.size&&this.size[0]===h&&this.size[1]===m||s),S=this.context,T=S.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!a||a.premultiply!==!1)),x)this.size=[h,m],t instanceof $t||t instanceof hr||t instanceof un||t instanceof Sn||xn&&t instanceof xn?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,h,m,0,this.format,T.UNSIGNED_BYTE,t.data);else{var k=s||{x:0,y:0},z=k.x,j=k.y;t instanceof $t||t instanceof hr||t instanceof un||t instanceof Sn||xn&&t instanceof xn?T.texSubImage2D(T.TEXTURE_2D,0,z,j,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,z,j,h,m,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)},gn.prototype.bind=function(t,a,s){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),s!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},gn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},gn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Kn=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};Kn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Kn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ta=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Jt(["receive","process"],this),this.invoker=new Kn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Rr()?t:ne};function gs(t,a,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}Ta.prototype.send=function(t,a,s,h,m){var x=this;m===void 0&&(m=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[S]=s);var T=Ye(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!s,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:hu(a,T)},T),{cancel:function(){s&&delete x.callbacks[S],x.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:x.mapId})}}},Ta.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else Rr()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},Ta.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},Ta.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(ks(a.error)):h(null,ks(a.data)))}else{var m=!1,x=Ye(this.globalScope)?void 0:[],S=a.hasCallback?function(j,G){m=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:j?hu(j):null,data:hu(G,x)},x)}:function(j){m=!0},T=null,k=ks(a.data);if(this.parent[a.type])T=this.parent[a.type](a.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=a.type.split(".");T=this.parent.getWorkerSource(a.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+a.type));!m&&T&&T.cancel&&(this.cancelCallbacks[t]=T.cancel)}},Ta.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ua=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ua.prototype.setNorthEast=function(t){return this._ne=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},Ua.prototype.setSouthWest=function(t){return this._sw=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},Ua.prototype.extend=function(t){var a,s,h=this._sw,m=this._ne;if(t instanceof _a)a=t,s=t;else{if(!(t instanceof Ua))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ua.convert(t)):this.extend(_a.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return h||m?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),m.lng=Math.max(s.lng,m.lng),m.lat=Math.max(s.lat,m.lat)):(this._sw=new _a(a.lng,a.lat),this._ne=new _a(s.lng,s.lat)),this},Ua.prototype.getCenter=function(){return new _a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ua.prototype.getSouthWest=function(){return this._sw},Ua.prototype.getNorthEast=function(){return this._ne},Ua.prototype.getNorthWest=function(){return new _a(this.getWest(),this.getNorth())},Ua.prototype.getSouthEast=function(){return new _a(this.getEast(),this.getSouth())},Ua.prototype.getWest=function(){return this._sw.lng},Ua.prototype.getSouth=function(){return this._sw.lat},Ua.prototype.getEast=function(){return this._ne.lng},Ua.prototype.getNorth=function(){return this._ne.lat},Ua.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ua.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ua.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ua.prototype.contains=function(t){var a=_a.convert(t),s=a.lng,h=a.lat,m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m},Ua.convert=function(t){return!t||t instanceof Ua?t:new Ua(t)};var _a=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_a.prototype.wrap=function(){return new _a(nr(this.lng,-180,180),this.lat)},_a.prototype.toArray=function(){return[this.lng,this.lat]},_a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_a.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,h=t.lat*a,m=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(m,1))},_a.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new Ua(new _a(this.lng-s,this.lat-a),new _a(this.lng+s,this.lat+a))},_a.convert=function(t){if(t instanceof _a)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _a(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _a(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nl=2*Math.PI*63710088e-1;function js(t){return Nl*Math.cos(t*Math.PI/180)}function yl(t){return(180+t)/360}function Ou(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function td(t,a){return t/js(a)}function bu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var zc=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};zc.fromLngLat=function(t,a){a===void 0&&(a=0);var s=_a.convert(t);return new zc(yl(s.lng),Ou(s.lat),td(a,s.lat))},zc.prototype.toLngLat=function(){return new _a(360*this.x-180,bu(this.y))},zc.prototype.toAltitude=function(){return this.z*js(bu(this.y))},zc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nl*(t=bu(this.y),1/Math.cos(t*Math.PI/180));var t};var bh=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=rd(0,t,t,a,s)};bh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},bh.prototype.url=function(t,a){var s,h,m,x,S,T=(h=this.y,m=this.z,x=gs(256*(s=this.x),256*(h=Math.pow(2,m)-h-1),m),S=gs(256*(s+1),256*(h+1),m),x[0]+","+x[1]+","+S[0]+","+S[1]),k=function(z,j,G){for(var te,oe="",Me=z;Me>0;Me--)oe+=(j&(te=1<<Me-1)?1:0)+(G&te?2:0);return oe}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",T)},bh.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new re(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},bh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Sm=function(t,a){this.wrap=t,this.canonical=a,this.key=rd(t,a.z,a.z,a.x,a.y)},us=function(t,a,s,h,m){this.overscaledZ=t,this.wrap=a,this.canonical=new bh(s,+h,+m),this.key=rd(a,t,s,h,m)};function rd(t,a,s,h,m){(t*=2)<0&&(t=-1*t-1);var x=1<<s;return(x*x*t+x*m+h).toString(36)+s.toString(36)+a.toString(36)}us.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},us.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new us(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},us.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?rd(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):rd(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},us.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},us.prototype.children=function(t){if(this.overscaledZ>=t)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new us(a,this.wrap,a,s,h),new us(a,this.wrap,a,s+1,h),new us(a,this.wrap,a,s,h+1),new us(a,this.wrap,a,s+1,h+1)]},us.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},us.prototype.wrapped=function(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.unwrapTo=function(t){return new us(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},us.prototype.toUnwrapped=function(){return new Sm(this.wrap,this.canonical)},us.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},us.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new zc(t.x-this.wrap,t.y))},mn("CanonicalTileID",bh),mn("OverscaledTileID",us,{omit:["posMatrix"]});var _f=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return $e('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var m=0;m<h;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(h,m)]=this.data[this._idx(h-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,h)]=this.data[this._idx(m,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};_f.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[h],s[h+1],s[h+2])},_f.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},_f.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},_f.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},_f.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},_f.prototype.getPixels=function(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},_f.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,m=a*this.dim+this.dim,x=s*this.dim,S=s*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(s){case-1:x=S-1;break;case 1:S=x+1}for(var T=-a*this.dim,k=-s*this.dim,z=x;z<S;z++)for(var j=h;j<m;j++)this.data[this._idx(j,z)]=t.data[this._idx(j+T,z+k)]},mn("DEMData",_f);var Rd=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};Rd.prototype.encode=function(t){return this._stringToNumber[t]},Rd.prototype.decode=function(t){return this._numberToString[t]};var Ld=function(t,a,s,h,m){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=h,this.properties=t.properties,this.id=m},vv={geometry:{configurable:!0}};vv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},vv.geometry.set=function(t){this._geometry=t},Ld.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(Ld.prototype,vv);var lp=function(){this.state={},this.stateChanges={},this.deletedStates={}};lp.prototype.updateState=function(t,a,s){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},_t(this.stateChanges[t][h],s),this.deletedStates[t]===null)for(var m in this.deletedStates[t]={},this.state[t])m!==h&&(this.deletedStates[t][m]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var x in this.deletedStates[t][h]={},this.state[t][h])s[x]||(this.deletedStates[t][h][x]=null);else for(var S in s)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},lp.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},lp.prototype.getState=function(t,a){var s=String(a),h=_t({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var m=this.deletedStates[t][a];if(m===null)return{};for(var x in m)delete h[x]}return h},lp.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},lp.prototype.coalesceChanges=function(t,a){var s={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var m={};for(var x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),_t(this.state[h][x],this.stateChanges[h][x]),m[x]=this.state[h][x];s[h]=m}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var T={};if(this.deletedStates[S]===null)for(var k in this.state[S])T[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var j=0,G=Object.keys(this.deletedStates[S][z]);j<G.length;j+=1)delete this.state[S][z][G[j]];T[z]=this.state[S][z]}s[S]=s[S]||{},_t(s[S],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var te in t)t[te].setFeatureState(s,a)};var xf=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Xu(8192,16,0),this.grid3D=new Xu(8192,16,0),this.featureIndexArray=new W,this.promoteId=a};function wm(t,a,s,h,m){return Yt(t,function(x,S){var T=a instanceof Bs?a.get(S):null;return T&&T.evaluate?T.evaluate(s,h,m):T})}function nd(t){for(var a=1/0,s=1/0,h=-1/0,m=-1/0,x=0,S=t;x<S.length;x+=1){var T=S[x];a=Math.min(a,T.x),s=Math.min(s,T.y),h=Math.max(h,T.x),m=Math.max(m,T.y)}return{minX:a,minY:s,maxX:h,maxY:m}}function l0(t,a){return a-t}xf.prototype.insert=function(t,a,s,h,m,x){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,m);for(var T=x?this.grid3D:this.grid,k=0;k<a.length;k++){for(var z=a[k],j=[1/0,1/0,-1/0,-1/0],G=0;G<z.length;G++){var te=z[G];j[0]=Math.min(j[0],te.x),j[1]=Math.min(j[1],te.y),j[2]=Math.max(j[2],te.x),j[3]=Math.max(j[3],te.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&T.insert(S,j[0],j[1],j[2],j[3])}},xf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xu.VectorTile(new gf(this.rawTileData)).layers,this.sourceLayerCoder=new Rd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},xf.prototype.query=function(t,a,s,h){var m=this;this.loadVTLayers();for(var x=t.params||{},S=8192/t.tileSize/t.scale,T=Tc(x.filter),k=t.queryGeometry,z=t.queryPadding*S,j=nd(k),G=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),te=nd(t.cameraQueryGeometry),oe=this.grid3D.query(te.minX-z,te.minY-z,te.maxX+z,te.maxY+z,function(Zt,Wt,cr,Mr){return function(Pr,Rn,cn,Nn,fn){for(var Ai=0,ei=Pr;Ai<ei.length;Ai+=1){var Tn=ei[Ai];if(Rn<=Tn.x&&cn<=Tn.y&&Nn>=Tn.x&&fn>=Tn.y)return!0}var ji=[new re(Rn,cn),new re(Rn,fn),new re(Nn,fn),new re(Nn,cn)];if(Pr.length>2){for(var xi=0,bi=ji;xi<bi.length;xi+=1)if(qs(Pr,bi[xi]))return!0}for(var zn=0;zn<Pr.length-1;zn++)if(vl(Pr[zn],Pr[zn+1],ji))return!0;return!1}(t.cameraQueryGeometry,Zt-z,Wt-z,cr+z,Mr+z)}),Me=0,Re=oe;Me<Re.length;Me+=1)G.push(Re[Me]);G.sort(l0);for(var Ke,ze={},at=function(Zt){var Wt=G[Zt];if(Wt!==Ke){Ke=Wt;var cr=m.featureIndexArray.get(Wt),Mr=null;m.loadMatchingFeature(ze,cr.bucketIndex,cr.sourceLayerIndex,cr.featureIndex,T,x.layers,x.availableImages,a,s,h,function(Pr,Rn,cn){return Mr||(Mr=Ia(Pr)),Rn.queryIntersectsFeature(k,Pr,cn,Mr,m.z,t.transform,S,t.pixelPosMatrix)})}},St=0;St<G.length;St++)at(St);return ze},xf.prototype.loadMatchingFeature=function(t,a,s,h,m,x,S,T,k,z,j){var G=this.bucketLayerIDs[a];if(!x||function(Pr,Rn){for(var cn=0;cn<Pr.length;cn++)if(Rn.indexOf(Pr[cn])>=0)return!0;return!1}(x,G)){var te=this.sourceLayerCoder.decode(s),oe=this.vtLayers[te].feature(h);if(m.needGeometry){var Me=mo(oe,!0);if(!m.filter(new Oi(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!m.filter(new Oi(this.tileID.overscaledZ),oe))return;for(var Re=this.getId(oe,te),Ke=0;Ke<G.length;Ke++){var ze=G[Ke];if(!(x&&x.indexOf(ze)<0)){var at=T[ze];if(at){var St={};Re!==void 0&&z&&(St=z.getState(at.sourceLayer||"_geojsonTileLayer",Re));var Zt=_t({},k[ze]);Zt.paint=wm(Zt.paint,at.paint,oe,St,S),Zt.layout=wm(Zt.layout,at.layout,oe,St,S);var Wt=!j||j(oe,at,St);if(Wt){var cr=new Ld(oe,this.z,this.x,this.y,Re);cr.layer=Zt;var Mr=t[ze];Mr===void 0&&(Mr=t[ze]=[]),Mr.push({featureIndex:h,feature:cr,intersectionZ:Wt})}}}}}},xf.prototype.lookupSymbolFeatures=function(t,a,s,h,m,x,S,T){var k={};this.loadVTLayers();for(var z=Tc(m),j=0,G=t;j<G.length;j+=1)this.loadMatchingFeature(k,s,h,G[j],z,x,S,T,a);return k},xf.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var h=0,m=s[a];h<m.length;h+=1)if(t===m[h])return!0;return!1},xf.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},mn("FeatureIndex",xf,{omit:["rawTileData","sourceLayerCoder"]});var bs=function(t,a){this.tileID=t,this.uid=Ct(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};bs.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<Ki.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},bs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},bs.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,j){var G={};if(!j)return G;for(var te=function(){var Re=Me[oe],Ke=Re.layerIds.map(function(St){return j.getLayer(St)}).filter(Boolean);if(Ke.length!==0){Re.layers=Ke,Re.stateDependentLayerIds&&(Re.stateDependentLayers=Re.stateDependentLayerIds.map(function(St){return Ke.filter(function(Zt){return Zt.id===St})[0]}));for(var ze=0,at=Ke;ze<at.length;ze+=1)G[at[ze].id]=Re}},oe=0,Me=z;oe<Me.length;oe+=1)te();return G}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var m=this.buckets[h];if(m instanceof Be){if(this.hasSymbolBuckets=!0,!s)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var x in this.buckets){var S=this.buckets[x];if(S instanceof Be&&S.hasRTLText){this.hasRTLText=!0,Cs.isLoading()||Cs.isLoaded()||uh()!=="deferred"||Ws();break}}for(var T in this.queryPadding=0,this.buckets){var k=this.buckets[T];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(T).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},bs.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},bs.prototype.getBucket=function(t){return this.buckets[t.id]},bs.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},bs.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},bs.prototype.queryRenderedFeatures=function(t,a,s,h,m,x,S,T,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:x,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:S,queryPadding:this.queryPadding*k},t,a,s):{}},bs.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var h=s.loadVTLayers(),m=a?a.sourceLayer:"",x=h._geojsonTileLayer||h[m];if(x)for(var S=Tc(a&&a.filter),T=this.tileID.canonical,k=T.z,z=T.x,j=T.y,G={z:k,x:z,y:j},te=0;te<x.length;te++){var oe=x.feature(te);if(S.needGeometry){var Me=mo(oe,!0);if(!S.filter(new Oi(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new Oi(this.tileID.overscaledZ),oe))continue;var Re=s.getId(oe,m),Ke=new Ld(oe,k,z,j,Re);Ke.tile=G,t.push(Ke)}}},bs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},bs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},bs.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=Hr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),m=!1;if(this.expirationTime>h)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{var x=this.expirationTime-a;x?this.expirationTime=h+Math.max(x,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},bs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},bs.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var m=this.buckets[h],x=m.layers[0].sourceLayer||"_geojsonTileLayer",S=s[x],T=t[x];if(S&&T&&Object.keys(T).length!==0){m.update(T,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=a&&a.style&&a.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(m)))}}}},bs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},bs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ki.now()},bs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},bs.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Ki.now()+t},bs.prototype.setDependencies=function(t,a){for(var s={},h=0,m=a;h<m.length;h+=1)s[m[h]]=!0;this.dependencies[t]=s},bs.prototype.hasDependency=function(t,a){for(var s=0,h=t;s<h.length;s+=1){var m=this.dependencies[h[s]];if(m){for(var x=0,S=a;x<S.length;x+=1)if(m[S[x]])return!0}}return!1};var Xf=ne.performance,Cm=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Xf.mark(this._marks.start)};Cm.prototype.finish=function(){Xf.mark(this._marks.end);var t=Xf.getEntriesByName(this._marks.measure);return t.length===0&&(Xf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Xf.getEntriesByName(this._marks.measure),Xf.clearMarks(this._marks.start),Xf.clearMarks(this._marks.end),Xf.clearMeasures(this._marks.measure)),t},v.Actor=Ta,v.AlphaImage=Ro,v.CanonicalTileID=bh,v.CollisionBoxArray=f,v.Color=Gi,v.DEMData=_f,v.DataConstantProperty=Pn,v.DictionaryCoder=Rd,v.EXTENT=8192,v.ErrorEvent=Ve,v.EvaluationParameters=Oi,v.Event=Ie,v.Evented=rt,v.FeatureIndex=xf,v.FillBucket=$s,v.FillExtrusionBucket=el,v.ImageAtlas=wr,v.ImagePosition=st,v.LineBucket=ya,v.LngLat=_a,v.LngLatBounds=Ua,v.MercatorCoordinate=zc,v.ONE_EM=24,v.OverscaledTileID=us,v.Point=re,v.Point$1=re,v.Properties=qo,v.Protobuf=gf,v.RGBAImage=Uo,v.RequestManager=Ri,v.RequestPerformance=Cm,v.ResourceType=nn,v.SegmentVector=he,v.SourceFeatureState=lp,v.StructArrayLayout1ui2=ch,v.StructArrayLayout2f1f2i16=pl,v.StructArrayLayout2i4=Ml,v.StructArrayLayout3ui6=Ku,v.StructArrayLayout4i8=vu,v.SymbolBucket=Be,v.Texture=gn,v.Tile=bs,v.Transitionable=lo,v.Uniform1f=zr,v.Uniform1i=mr,v.Uniform2f=Br,v.Uniform3f=sn,v.Uniform4f=kn,v.UniformColor=Dn,v.UniformMatrix4f=Fi,v.UnwrappedTileID=Sm,v.ValidationError=De,v.WritingMode=Ur,v.ZoomHistory=Of,v.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},v.addDynamicAttributes=Ge,v.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var h=t.length,m=new Array(t.length),x=null;t.forEach(function(S,T){a(S,function(k,z){k&&(x=k),m[T]=z,--h==0&&s(x,m)})})},v.bezier=we,v.bindAll=Jt,v.browser=Ki,v.cacheEntryPossiblyAdded=function(t){++ui>Ir&&(t.getActor().send("enforceCacheSizeLimit",ir),ui=0)},v.clamp=Mt,v.clearTileCache=function(t){var a=ne.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},v.clipLine=So,v.clone=function(t){var a=new na(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},v.clone$1=qe,v.clone$2=function(t){var a=new na(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},v.collisionCircleLayout=dv,v.config=Bn,v.create=function(){var t=new na(16);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new na(9);return na!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new na(4);return na!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=ee,v.createExpression=Cu,v.createLayout=Aa,v.createStyleLayer=function(t){return t.type==="custom"?new jr(t):new tn[t.type](t)},v.cross=function(t,a,s){var h=a[0],m=a[1],x=a[2],S=s[0],T=s[1],k=s[2];return t[0]=m*k-x*T,t[1]=x*S-h*k,t[2]=h*T-m*S,t},v.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],s[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var m in a)if(!t(a[m],s[m]))return!1;return!0}return a===s},v.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},v.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},v.ease=et,v.emitValidationErrors=$l,v.endsWith=X,v.enforceCacheSizeLimit=function(t){I(),$i&&$i.then(function(a){a.keys().then(function(s){for(var h=0;h<s.length-t;h++)a.delete(s[h])})})},v.evaluateSizeForFeature=Yn,v.evaluateSizeForZoom=ci,v.evaluateVariableOffset=rl,v.evented=Lf,v.extend=_t,v.featureFilter=Tc,v.filterObject=dt,v.fromRotation=function(t,a){var s=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=s,t[2]=0,t[3]=-s,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=Qr,v.getAnchorJustification=Pe,v.getArrayBuffer=Ra,v.getImage=K,v.getJSON=function(t,a){return va(_t(t,{type:"json"}),a)},v.getRTLTextPluginStatus=uh,v.getReferrer=Mi,v.getVideo=function(t,a){var s,h,m=ne.document.createElement("video");m.muted=!0,m.onloadstart=function(){a(null,m)};for(var x=0;x<t.length;x++){var S=ne.document.createElement("source");s=t[x],h=void 0,(h=ne.document.createElement("a")).href=s,(h.protocol!==ne.document.location.protocol||h.host!==ne.document.location.host)&&(m.crossOrigin="Anonymous"),S.src=t[x],m.appendChild(S)}return{cancel:function(){}}},v.identity=Zs,v.invert=function(t,a){var s=a[0],h=a[1],m=a[2],x=a[3],S=a[4],T=a[5],k=a[6],z=a[7],j=a[8],G=a[9],te=a[10],oe=a[11],Me=a[12],Re=a[13],Ke=a[14],ze=a[15],at=s*T-h*S,St=s*k-m*S,Zt=s*z-x*S,Wt=h*k-m*T,cr=h*z-x*T,Mr=m*z-x*k,Pr=j*Re-G*Me,Rn=j*Ke-te*Me,cn=j*ze-oe*Me,Nn=G*Ke-te*Re,fn=G*ze-oe*Re,Ai=te*ze-oe*Ke,ei=at*Ai-St*fn+Zt*Nn+Wt*cn-cr*Rn+Mr*Pr;return ei?(t[0]=(T*Ai-k*fn+z*Nn)*(ei=1/ei),t[1]=(m*fn-h*Ai-x*Nn)*ei,t[2]=(Re*Mr-Ke*cr+ze*Wt)*ei,t[3]=(te*cr-G*Mr-oe*Wt)*ei,t[4]=(k*cn-S*Ai-z*Rn)*ei,t[5]=(s*Ai-m*cn+x*Rn)*ei,t[6]=(Ke*Zt-Me*Mr-ze*St)*ei,t[7]=(j*Mr-te*Zt+oe*St)*ei,t[8]=(S*fn-T*cn+z*Pr)*ei,t[9]=(h*cn-s*fn-x*Pr)*ei,t[10]=(Me*cr-Re*Zt+ze*at)*ei,t[11]=(G*Zt-j*cr-oe*at)*ei,t[12]=(T*Rn-S*Nn-k*Pr)*ei,t[13]=(s*Nn-h*Rn+m*Pr)*ei,t[14]=(Re*St-Me*Wt-Ke*at)*ei,t[15]=(j*Wt-G*St+te*at)*ei,t):null},v.isChar=Kr,v.isMapboxURL=Si,v.keysDifference=function(t,a){var s=[];for(var h in t)h in a||s.push(h);return s},v.makeRequest=va,v.mapObject=Yt,v.mercatorXfromLng=yl,v.mercatorYfromLat=Ou,v.mercatorZfromAltitude=td,v.mul=ic,v.multiply=ns,v.mvt=xu,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,a){var s=a[0],h=a[1],m=a[2],x=s*s+h*h+m*m;return x>0&&(x=1/Math.sqrt(x)),t[0]=a[0]*x,t[1]=a[1]*x,t[2]=a[2]*x,t},v.number=sa,v.offscreenCanvasSupported=Zn,v.ortho=function(t,a,s,h,m,x,S){var T=1/(a-s),k=1/(h-m),z=1/(x-S);return t[0]=-2*T,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(a+s)*T,t[13]=(m+h)*k,t[14]=(S+x)*z,t[15]=1,t},v.parseGlyphPBF=function(t){return new gf(t).readFields(kr,[])},v.pbf=gf,v.performSymbolLayout=function(t,a,s,h,m,x,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var T=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var j=t.textSizeData,G=j.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Oi(j.minZoom),S),k["text-size"].possiblyEvaluate(new Oi(G),S)]}if(t.iconSizeData.kind==="composite"){var te=t.iconSizeData,oe=te.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Oi(te.minZoom),S),k["icon-size"].possiblyEvaluate(new Oi(oe),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new Oi(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new Oi(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new Oi(18));for(var Me=24*T.get("text-line-height"),Re=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Ke=T.get("text-keep-upright"),ze=T.get("text-size"),at=function(){var Wt=Zt[St],cr=T.get("text-font").evaluate(Wt,{},S).join(","),Mr=ze.evaluate(Wt,{},S),Pr=z.layoutTextSize.evaluate(Wt,{},S),Rn=z.layoutIconSize.evaluate(Wt,{},S),cn={horizontal:{},vertical:void 0},Nn=Wt.text,fn=[0,0];if(Nn){var Ai=Nn.toString(),ei=24*T.get("text-letter-spacing").evaluate(Wt,{},S),Tn=function(Wi){for(var Da=0,Ma=Wi;Da<Ma.length;Da+=1)if(ia=Ma[Da].charCodeAt(0),Kr.Arabic(ia)||Kr["Arabic Supplement"](ia)||Kr["Arabic Extended-A"](ia)||Kr["Arabic Presentation Forms-A"](ia)||Kr["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(Ai)?ei:0,ji=T.get("text-anchor").evaluate(Wt,{},S),xi=T.get("text-variable-anchor");if(!xi){var bi=T.get("text-radial-offset").evaluate(Wt,{},S);fn=bi?rl(ji,[24*bi,wo]):T.get("text-offset").evaluate(Wt,{},S).map(function(Wi){return 24*Wi})}var zn=Re?"center":T.get("text-justify").evaluate(Wt,{},S),ti=T.get("symbol-placement"),so=ti==="point"?24*T.get("text-max-width").evaluate(Wt,{},S):0,Co=function(){t.allowVerticalPlacement&&tf(Ai)&&(cn.vertical=Jr(Nn,a,s,m,cr,so,Me,ji,"left",Tn,fn,Ur.vertical,!0,ti,Pr,Mr))};if(!Re&&xi){for(var go=zn==="auto"?xi.map(function(Wi){return Pe(Wi)}):[zn],ae=!1,yo=0;yo<go.length;yo++){var Jo=go[yo];if(!cn.horizontal[Jo])if(ae)cn.horizontal[Jo]=cn.horizontal[0];else{var Qo=Jr(Nn,a,s,m,cr,so,Me,"center",Jo,Tn,fn,Ur.horizontal,!1,ti,Pr,Mr);Qo&&(cn.horizontal[Jo]=Qo,ae=Qo.positionedLines.length===1)}}Co()}else{zn==="auto"&&(zn=Pe(ji));var Ts=Jr(Nn,a,s,m,cr,so,Me,ji,zn,Tn,fn,Ur.horizontal,!1,ti,Pr,Mr);Ts&&(cn.horizontal[zn]=Ts),Co(),tf(Ai)&&Re&&Ke&&(cn.vertical=Jr(Nn,a,s,m,cr,so,Me,ji,zn,Tn,fn,Ur.vertical,!1,ti,Pr,Mr))}}var ls=void 0,Ms=!1;if(Wt.icon&&Wt.icon.name){var Ka=h[Wt.icon.name];Ka&&(ls=function(Wi,Da,Ma){var ia=Qr(Ma),Vs=Da[0]-Wi.displaySize[0]*ia.horizontalAlign,Ps=Da[1]-Wi.displaySize[1]*ia.verticalAlign;return{image:Wi,top:Ps,bottom:Ps+Wi.displaySize[1],left:Vs,right:Vs+Wi.displaySize[0]}}(m[Wt.icon.name],T.get("icon-offset").evaluate(Wt,{},S),T.get("icon-anchor").evaluate(Wt,{},S)),Ms=Ka.sdf,t.sdfIcons===void 0?t.sdfIcons=Ka.sdf:t.sdfIcons!==Ka.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ka.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var cs=wt(cn.horizontal)||cn.vertical;t.iconsInText=!!cs&&cs.iconsInText,(cs||ls)&&function(Wi,Da,Ma,ia,Vs,Ps,$a,Do,Es,ca,Bl){var Eu=Ps.textMaxSize.evaluate(Da,{});Eu===void 0&&(Eu=$a);var Ru,Ao=Wi.layers[0].layout,zl=Ao.get("icon-offset").evaluate(Da,{},Bl),nl=wt(Ma.horizontal),Eh=$a/24,Ul=Wi.tilePixelRatio*Eh,Sh=Wi.tilePixelRatio*Eu/24,Lu=Wi.tilePixelRatio*Do,wh=Wi.tilePixelRatio*Ao.get("symbol-spacing"),id=Ao.get("text-padding")*Wi.tilePixelRatio,hc=Ao.get("icon-padding")*Wi.tilePixelRatio,Ch=Ao.get("text-max-angle")/180*Math.PI,cp=Ao.get("text-rotation-alignment")==="map"&&Ao.get("symbol-placement")!=="point",fp=Ao.get("icon-rotation-alignment")==="map"&&Ao.get("symbol-placement")!=="point",Zl=Ao.get("symbol-placement"),Ah=wh/2,Yf=Ao.get("icon-text-fit");ia&&Yf!=="none"&&(Wi.allowVerticalPlacement&&Ma.vertical&&(Ru=ni(ia,Ma.vertical,Yf,Ao.get("icon-text-fit-padding"),zl,Eh)),nl&&(ia=ni(ia,nl,Yf,Ao.get("icon-text-fit-padding"),zl,Eh)));var pc=function(Qs,Lh){Lh.x<0||Lh.x>=8192||Lh.y<0||Lh.y>=8192||function(To,_l,mv,Uc,cd,Fd,gp,jl,yp,kh,_p,xp,fd,Nd,bp,gv,yv,_v,Bd,xv,ku,Ep,zd,Vl,bv){var Dh,Ef,Fh,Nh,Bh,zh=To.addToLineVertexArray(_l,mv),Ev=0,Sv=0,wv=0,Cv=0,Ud=-1,Zd=-1,Zc={},Av=Ae(""),jd=0,Vd=0;if(jl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(jd=(Dh=jl.layout.get("text-offset").evaluate(ku,{},Vl).map(function(Ap){return 24*Ap}))[0],Vd=Dh[1]):(jd=24*jl.layout.get("text-radial-offset").evaluate(ku,{},Vl),Vd=wo),To.allowVerticalPlacement&&Uc.vertical){var Tv=jl.layout.get("text-rotate").evaluate(ku,{},Vl)+90;Nh=new jo(yp,_l,kh,_p,xp,Uc.vertical,fd,Nd,bp,Tv),gp&&(Bh=new jo(yp,_l,kh,_p,xp,gp,yv,_v,bp,Tv))}if(cd){var Gd=jl.layout.get("icon-rotate").evaluate(ku,{}),Mv=jl.layout.get("icon-text-fit")!=="none",Sp=$o(cd,Gd,zd,Mv),dc=gp?$o(gp,Gd,zd,Mv):void 0;Fh=new jo(yp,_l,kh,_p,xp,cd,yv,_v,!1,Gd),Ev=4*Sp.length;var Hd=To.iconSizeData,Uh=null;Hd.kind==="source"?(Uh=[128*jl.layout.get("icon-size").evaluate(ku,{})])[0]>32640&&$e(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Hd.kind==="composite"&&((Uh=[128*Ep.compositeIconSizes[0].evaluate(ku,{},Vl),128*Ep.compositeIconSizes[1].evaluate(ku,{},Vl)])[0]>32640||Uh[1]>32640)&&$e(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),To.addSymbols(To.icon,Sp,Uh,xv,Bd,ku,!1,_l,zh.lineStartIndex,zh.lineLength,-1,Vl),Ud=To.icon.placedSymbolArray.length-1,dc&&(Sv=4*dc.length,To.addSymbols(To.icon,dc,Uh,xv,Bd,ku,Ur.vertical,_l,zh.lineStartIndex,zh.lineLength,-1,Vl),Zd=To.icon.placedSymbolArray.length-1)}for(var Wd in Uc.horizontal){var Zh=Uc.horizontal[Wd];if(!Ef){Av=Ae(Zh.text);var Pv=jl.layout.get("text-rotate").evaluate(ku,{},Vl);Ef=new jo(yp,_l,kh,_p,xp,Zh,fd,Nd,bp,Pv)}var wp=Zh.positionedLines.length===1;if(wv+=Bt(To,_l,Zh,Fd,jl,bp,ku,gv,zh,Uc.vertical?Ur.horizontal:Ur.horizontalOnly,wp?Object.keys(Uc.horizontal):[Wd],Zc,Ud,Ep,Vl),wp)break}Uc.vertical&&(Cv+=Bt(To,_l,Uc.vertical,Fd,jl,bp,ku,gv,zh,Ur.vertical,["vertical"],Zc,Zd,Ep,Vl));var Iv=Ef?Ef.boxStartIndex:To.collisionBoxArray.length,Ov=Ef?Ef.boxEndIndex:To.collisionBoxArray.length,Am=Nh?Nh.boxStartIndex:To.collisionBoxArray.length,Tm=Nh?Nh.boxEndIndex:To.collisionBoxArray.length,Mm=Fh?Fh.boxStartIndex:To.collisionBoxArray.length,Rv=Fh?Fh.boxEndIndex:To.collisionBoxArray.length,Lv=Bh?Bh.boxStartIndex:To.collisionBoxArray.length,kv=Bh?Bh.boxEndIndex:To.collisionBoxArray.length,xl=-1,Cp=function(Ap,Xd){return Ap&&Ap.circleDiameter?Math.max(Ap.circleDiameter,Xd):Xd};xl=Cp(Ef,xl),xl=Cp(Nh,xl),xl=Cp(Fh,xl);var Dv=(xl=Cp(Bh,xl))>-1?1:0;Dv&&(xl*=bv/24),To.glyphOffsetArray.length>=Be.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ku.sortKey!==void 0&&To.addToSortKeyRanges(To.symbolInstances.length,ku.sortKey),To.symbolInstances.emplaceBack(_l.x,_l.y,Zc.right>=0?Zc.right:-1,Zc.center>=0?Zc.center:-1,Zc.left>=0?Zc.left:-1,Zc.vertical||-1,Ud,Zd,Av,Iv,Ov,Am,Tm,Mm,Rv,Lv,kv,kh,wv,Cv,Ev,Sv,Dv,0,fd,jd,Vd,xl)}(Wi,Lh,Qs,Ma,ia,Vs,Ru,Wi.layers[0],Wi.collisionBoxArray,Da.index,Da.sourceLayerIndex,Wi.index,Ul,id,cp,Es,Lu,hc,fp,zl,Da,Ps,ca,Bl,$a)};if(Zl==="line")for(var hp=0,ad=So(Da.geometry,0,0,8192,8192);hp<ad.length;hp+=1)for(var od=ad[hp],Th=0,pp=Ko(od,wh,Ch,Ma.vertical||nl,ia,24,Sh,Wi.overscaling,8192);Th<pp.length;Th+=1){var dp=pp[Th];nl&&pn(Wi,nl.text,Ah,dp)||pc(od,dp)}else if(Zl==="line-center")for(var Mh=0,Ph=Da.geometry;Mh<Ph.length;Mh+=1){var Ih=Ph[Mh];if(Ih.length>1){var vp=Wa(Ih,Ch,Ma.vertical||nl,ia,24,Sh);vp&&pc(Ih,vp)}}else if(Da.type==="Polygon")for(var qf=0,mp=Zf(Da.geometry,0);qf<mp.length;qf+=1){var Kf=mp[qf],Oh=Qn(Kf,16);pc(Kf[0],new qr(Oh.x,Oh.y,0))}else if(Da.type==="LineString")for(var bf=0,Rh=Da.geometry;bf<Rh.length;bf+=1){var $f=Rh[bf];pc($f,new qr($f[0].x,$f[0].y,0))}else if(Da.type==="Point")for(var sd=0,kd=Da.geometry;sd<kd.length;sd+=1)for(var ud=0,Dd=kd[sd];ud<Dd.length;ud+=1){var ld=Dd[ud];pc([ld],new qr(ld.x,ld.y,0))}}(t,Wt,cn,ls,h,z,Pr,Rn,fn,Ms,S)},St=0,Zt=t.features;St<Zt.length;St+=1)at();x&&t.generateCollisionDebugBuffers()},v.perspective=function(t,a,s,h,m){var x,S=1/Math.tan(a/2);return t[0]=S/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,m!=null&&m!==1/0?(t[10]=(m+h)*(x=1/(h-m)),t[14]=2*m*h*x):(t[10]=-1,t[14]=-2*h),t},v.pick=function(t,a){for(var s={},h=0;h<a.length;h++){var m=a[h];m in t&&(s[m]=t[m])}return s},v.plugin=Cs,v.polygonIntersectsPolygon=$u,v.postMapLoadEvent=zt,v.postTurnstileEvent=Va,v.potpack=Ar,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=mn,v.registerForPluginStateChange=function(t){return t({pluginStatus:ws,pluginURL:bo}),Lf.on("pluginStateChange",t),t},v.renderColorRamp=sf,v.rotate=function(t,a,s){var h=a[0],m=a[1],x=a[2],S=a[3],T=Math.sin(s),k=Math.cos(s);return t[0]=h*k+x*T,t[1]=m*k+S*T,t[2]=h*-T+x*k,t[3]=m*-T+S*k,t},v.rotateX=function(t,a,s){var h=Math.sin(s),m=Math.cos(s),x=a[4],S=a[5],T=a[6],k=a[7],z=a[8],j=a[9],G=a[10],te=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=x*m+z*h,t[5]=S*m+j*h,t[6]=T*m+G*h,t[7]=k*m+te*h,t[8]=z*m-x*h,t[9]=j*m-S*h,t[10]=G*m-T*h,t[11]=te*m-k*h,t},v.rotateZ=function(t,a,s){var h=Math.sin(s),m=Math.cos(s),x=a[0],S=a[1],T=a[2],k=a[3],z=a[4],j=a[5],G=a[6],te=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=x*m+z*h,t[1]=S*m+j*h,t[2]=T*m+G*h,t[3]=k*m+te*h,t[4]=z*m-x*h,t[5]=j*m-S*h,t[6]=G*m-T*h,t[7]=te*m-k*h,t},v.scale=function(t,a,s){var h=s[0],m=s[1],x=s[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*m,t[5]=a[5]*m,t[6]=a[6]*m,t[7]=a[7]*m,t[8]=a[8]*x,t[9]=a[9]*x,t[10]=a[10]*x,t[11]=a[11]*x,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},v.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},v.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},v.setCacheLimits=function(t,a){ir=t,Ir=a},v.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),ws==="deferred"||ws==="loading"||ws==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");bo=Ki.resolveURL(t),ws="deferred",Mu=a,ga(),s||Ws()},v.sphericalToCartesian=function(t){var a=t[0],s=t[1],h=t[2];return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h)}},v.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},v.styleSpec=pe,v.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},v.symbolSize=Ui,v.transformMat3=function(t,a,s){var h=a[0],m=a[1],x=a[2];return t[0]=h*s[0]+m*s[3]+x*s[6],t[1]=h*s[1]+m*s[4]+x*s[7],t[2]=h*s[2]+m*s[5]+x*s[8],t},v.transformMat4=kc,v.translate=function(t,a,s){var h,m,x,S,T,k,z,j,G,te,oe,Me,Re=s[0],Ke=s[1],ze=s[2];return a===t?(t[12]=a[0]*Re+a[4]*Ke+a[8]*ze+a[12],t[13]=a[1]*Re+a[5]*Ke+a[9]*ze+a[13],t[14]=a[2]*Re+a[6]*Ke+a[10]*ze+a[14],t[15]=a[3]*Re+a[7]*Ke+a[11]*ze+a[15]):(m=a[1],x=a[2],S=a[3],T=a[4],k=a[5],z=a[6],j=a[7],G=a[8],te=a[9],oe=a[10],Me=a[11],t[0]=h=a[0],t[1]=m,t[2]=x,t[3]=S,t[4]=T,t[5]=k,t[6]=z,t[7]=j,t[8]=G,t[9]=te,t[10]=oe,t[11]=Me,t[12]=h*Re+T*Ke+G*ze+a[12],t[13]=m*Re+k*Ke+te*ze+a[13],t[14]=x*Re+z*Ke+oe*ze+a[14],t[15]=S*Re+j*Ke+Me*ze+a[15]),t},v.triggerPluginCompletionEvent=sh,v.uniqueId=Ct,v.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},v.validateLight=qh,v.validateStyle=ef,v.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},v.vectorTile=xu,v.version="1.13.2",v.warnOnce=$e,v.webpSupported=Gn,v.window=ne,v.wrap=nr}),$(["./shared"],function(v){"use strict";function ee(V){var K=typeof V;if(K==="number"||K==="boolean"||K==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var se="[",ge=0,Ie=V;ge<Ie.length;ge+=1)se+=ee(Ie[ge])+",";return se+"]"}for(var Ve=Object.keys(V).sort(),rt="{",pe=0;pe<Ve.length;pe++)rt+=JSON.stringify(Ve[pe])+":"+ee(V[Ve[pe]])+",";return rt+"}"}function F(V){for(var K="",se=0,ge=v.refProperties;se<ge.length;se+=1)K+="/"+ee(V[ge[se]]);return K}var J=function(V){this.keyCache={},V&&this.replace(V)};J.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},J.prototype.update=function(V,K){for(var se=this,ge=0,Ie=V;ge<Ie.length;ge+=1){var Ve=Ie[ge];this._layerConfigs[Ve.id]=Ve;var rt=this._layers[Ve.id]=v.createStyleLayer(Ve);rt._featureFilter=v.featureFilter(rt.filter),this.keyCache[Ve.id]&&delete this.keyCache[Ve.id]}for(var pe=0,De=K;pe<De.length;pe+=1){var yt=De[pe];delete this.keyCache[yt],delete this._layerConfigs[yt],delete this._layers[yt]}this.familiesBySource={};for(var vr=0,Lt=function(Vr,Wr){for(var ii={},en=0;en<Vr.length;en++){var Ci=Wr&&Wr[Vr[en].id]||F(Vr[en]);Wr&&(Wr[Vr[en].id]=Ci);var ta=ii[Ci];ta||(ta=ii[Ci]=[]),ta.push(Vr[en])}var gi=[];for(var Pi in ii)gi.push(ii[Pi]);return gi}(v.values(this._layerConfigs),this.keyCache);vr<Lt.length;vr+=1){var Dt=Lt[vr].map(function(Vr){return se._layers[Vr.id]}),gr=Dt[0];if(gr.visibility!=="none"){var bn=gr.source||"",ln=this.familiesBySource[bn];ln||(ln=this.familiesBySource[bn]={});var Tt=gr.sourceLayer||"_geojsonTileLayer",on=ln[Tt];on||(on=ln[Tt]=[]),on.push(Dt)}}};var re=function(V){var K={},se=[];for(var ge in V){var Ie=V[ge],Ve=K[ge]={};for(var rt in Ie){var pe=Ie[+rt];if(pe&&pe.bitmap.width!==0&&pe.bitmap.height!==0){var De={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};se.push(De),Ve[rt]={rect:De,metrics:pe.metrics}}}}var yt=v.potpack(se),vr=new v.AlphaImage({width:yt.w||1,height:yt.h||1});for(var Lt in V){var Dt=V[Lt];for(var gr in Dt){var bn=Dt[+gr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var ln=K[Lt][gr].rect;v.AlphaImage.copy(bn.bitmap,vr,{x:0,y:0},{x:ln.x+1,y:ln.y+1},bn.bitmap)}}}this.image=vr,this.positions=K};v.register("GlyphAtlas",re);var Ee=function(V){this.tileID=new v.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function ne(V,K,se){for(var ge=new v.EvaluationParameters(K),Ie=0,Ve=V;Ie<Ve.length;Ie+=1)Ve[Ie].recalculate(ge,se)}function je(V,K){var se=v.getArrayBuffer(V.request,function(ge,Ie,Ve,rt){ge?K(ge):Ie&&K(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Ie)),rawData:Ie,cacheControl:Ve,expires:rt})});return function(){se.cancel(),K()}}Ee.prototype.parse=function(V,K,se,ge,Ie){var Ve=this;this.status="parsing",this.data=V,this.collisionBoxArray=new v.CollisionBoxArray;var rt=new v.DictionaryCoder(Object.keys(V.layers).sort()),pe=new v.FeatureIndex(this.tileID,this.promoteId);pe.bucketLayerIDs=[];var De,yt,vr,Lt,Dt={},gr={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:se},bn=K.familiesBySource[this.source];for(var ln in bn){var Tt=V.layers[ln];if(Tt){Tt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+ln+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var on=rt.encode(ln),Vr=[],Wr=0;Wr<Tt.length;Wr++){var ii=Tt.feature(Wr),en=pe.getId(ii,ln);Vr.push({feature:ii,id:en,index:Wr,sourceLayerIndex:on})}for(var Ci=0,ta=bn[ln];Ci<ta.length;Ci+=1){var gi=ta[Ci],Pi=gi[0];Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(ne(gi,this.zoom,se),(Dt[Pi.id]=Pi.createBucket({index:pe.bucketLayerIDs.length,layers:gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:on,sourceID:this.source})).populate(Vr,gr,this.tileID.canonical),pe.bucketLayerIDs.push(gi.map(function(oa){return oa.id})))}}}var _i=v.mapObject(gr.glyphDependencies,function(oa){return Object.keys(oa).map(Number)});Object.keys(_i).length?ge.send("getGlyphs",{uid:this.uid,stacks:_i},function(oa,Ii){De||(De=oa,yt=Ii,La.call(Ve))}):yt={};var Jn=Object.keys(gr.iconDependencies);Jn.length?ge.send("getImages",{icons:Jn,source:this.source,tileID:this.tileID,type:"icons"},function(oa,Ii){De||(De=oa,vr=Ii,La.call(Ve))}):vr={};var Xi=Object.keys(gr.patternDependencies);function La(){if(De)return Ie(De);if(yt&&vr&&Lt){var oa=new re(yt),Ii=new v.ImageAtlas(vr,Lt);for(var Gi in Dt){var Na=Dt[Gi];Na instanceof v.SymbolBucket?(ne(Na.layers,this.zoom,se),v.performSymbolLayout(Na,yt,oa.positions,vr,Ii.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Na.hasPattern&&(Na instanceof v.LineBucket||Na instanceof v.FillBucket||Na instanceof v.FillExtrusionBucket)&&(ne(Na.layers,this.zoom,se),Na.addFeatures(gr,this.tileID.canonical,Ii.patternPositions))}this.status="done",Ie(null,{buckets:v.values(Dt).filter(function(tu){return!tu.isEmpty()}),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oa.image,imageAtlas:Ii,glyphMap:this.returnDependencies?yt:null,iconMap:this.returnDependencies?vr:null,glyphPositions:this.returnDependencies?oa.positions:null})}}Xi.length?ge.send("getImages",{icons:Xi,source:this.source,tileID:this.tileID,type:"patterns"},function(oa,Ii){De||(De=oa,Lt=Ii,La.call(Ve))}):Lt={},La.call(this)};var we=function(V,K,se,ge){this.actor=V,this.layerIndex=K,this.availableImages=se,this.loadVectorData=ge||je,this.loading={},this.loaded={}};we.prototype.loadTile=function(V,K){var se=this,ge=V.uid;this.loading||(this.loading={});var Ie=!!(V&&V.request&&V.request.collectResourceTiming)&&new v.RequestPerformance(V.request),Ve=this.loading[ge]=new Ee(V);Ve.abort=this.loadVectorData(V,function(rt,pe){if(delete se.loading[ge],rt||!pe)return Ve.status="done",se.loaded[ge]=Ve,K(rt);var De=pe.rawData,yt={};pe.expires&&(yt.expires=pe.expires),pe.cacheControl&&(yt.cacheControl=pe.cacheControl);var vr={};if(Ie){var Lt=Ie.finish();Lt&&(vr.resourceTiming=JSON.parse(JSON.stringify(Lt)))}Ve.vectorTile=pe.vectorTile,Ve.parse(pe.vectorTile,se.layerIndex,se.availableImages,se.actor,function(Dt,gr){if(Dt||!gr)return K(Dt);K(null,v.extend({rawTileData:De.slice(0)},gr,yt,vr))}),se.loaded=se.loaded||{},se.loaded[ge]=Ve})},we.prototype.reloadTile=function(V,K){var se=this,ge=this.loaded,Ie=V.uid,Ve=this;if(ge&&ge[Ie]){var rt=ge[Ie];rt.showCollisionBoxes=V.showCollisionBoxes;var pe=function(De,yt){var vr=rt.reloadCallback;vr&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,Ve.layerIndex,se.availableImages,Ve.actor,vr)),K(De,yt)};rt.status==="parsing"?rt.reloadCallback=pe:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}},we.prototype.abortTile=function(V,K){var se=this.loading,ge=V.uid;se&&se[ge]&&se[ge].abort&&(se[ge].abort(),delete se[ge]),K()},we.prototype.removeTile=function(V,K){var se=this.loaded,ge=V.uid;se&&se[ge]&&delete se[ge],K()};var et=v.window.ImageBitmap,Mt=function(){this.loaded={}};function nr(V,K){if(V.length!==0){_t(V[0],K);for(var se=1;se<V.length;se++)_t(V[se],!K)}}function _t(V,K){for(var se=0,ge=0,Ie=V.length,Ve=Ie-1;ge<Ie;Ve=ge++)se+=(V[ge][0]-V[Ve][0])*(V[Ve][1]+V[ge][1]);se>=0!=!!K&&V.reverse()}Mt.prototype.loadTile=function(V,K){var se=V.uid,ge=V.encoding,Ie=V.rawImageData,Ve=et&&Ie instanceof et?this.getImageData(Ie):Ie,rt=new v.DEMData(se,Ve,ge);this.loaded=this.loaded||{},this.loaded[se]=rt,K(null,rt)},Mt.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:K.width,height:K.height},K.data)},Mt.prototype.removeTile=function(V){var K=this.loaded,se=V.uid;K&&K[se]&&delete K[se]};var Xt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ct=function(V){this._feature=V,this.extent=v.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};Ct.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],K=0,se=this._feature.geometry;K<se.length;K+=1){var ge=se[K];V.push([new v.Point$1(ge[0],ge[1])])}return V}for(var Ie=[],Ve=0,rt=this._feature.geometry;Ve<rt.length;Ve+=1){for(var pe=[],De=0,yt=rt[Ve];De<yt.length;De+=1){var vr=yt[De];pe.push(new v.Point$1(vr[0],vr[1]))}Ie.push(pe)}return Ie},Ct.prototype.toGeoJSON=function(V,K,se){return Xt.call(this,V,K,se)};var ot=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=V.length,this._features=V};ot.prototype.feature=function(V){return new Ct(this._features[V])};var ut=v.vectorTile.VectorTileFeature,Jt=X;function X(V,K){this.options=K||{},this.features=V,this.length=V.length}function Yt(V,K){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=K||4096}X.prototype.feature=function(V){return new Yt(this.features[V],this.options.extent)},Yt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var K=0;K<V.length;K++){for(var se=V[K],ge=[],Ie=0;Ie<se.length;Ie++)ge.push(new v.Point$1(se[Ie][0],se[Ie][1]));this.geometry.push(ge)}return this.geometry},Yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,K=1/0,se=-1/0,ge=1/0,Ie=-1/0,Ve=0;Ve<V.length;Ve++)for(var rt=V[Ve],pe=0;pe<rt.length;pe++){var De=rt[pe];K=Math.min(K,De.x),se=Math.max(se,De.x),ge=Math.min(ge,De.y),Ie=Math.max(Ie,De.y)}return[K,ge,se,Ie]},Yt.prototype.toGeoJSON=ut.prototype.toGeoJSON;var dt=ht,qe=Jt;function ht(V){var K=new v.pbf;return function(se,ge){for(var Ie in se.layers)ge.writeMessage(3,$e,se.layers[Ie])}(V,K),K.finish()}function $e(V,K){var se;K.writeVarintField(15,V.version||1),K.writeStringField(1,V.name||""),K.writeVarintField(5,V.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<V.length;se++)ge.feature=V.feature(se),K.writeMessage(2,Rt,ge);var Ie=ge.keys;for(se=0;se<Ie.length;se++)K.writeStringField(3,Ie[se]);var Ve=ge.values;for(se=0;se<Ve.length;se++)K.writeMessage(4,Ye,Ve[se])}function Rt(V,K){var se=V.feature;se.id!==void 0&&K.writeVarintField(1,se.id),K.writeMessage(2,yr,V),K.writeVarintField(3,se.type),K.writeMessage(4,Te,se)}function yr(V,K){var se=V.feature,ge=V.keys,Ie=V.values,Ve=V.keycache,rt=V.valuecache;for(var pe in se.properties){var De=Ve[pe];De===void 0&&(ge.push(pe),Ve[pe]=De=ge.length-1),K.writeVarint(De);var yt=se.properties[pe],vr=typeof yt;vr!=="string"&&vr!=="boolean"&&vr!=="number"&&(yt=JSON.stringify(yt));var Lt=vr+":"+yt,Dt=rt[Lt];Dt===void 0&&(Ie.push(yt),rt[Lt]=Dt=Ie.length-1),K.writeVarint(Dt)}}function Rr(V,K){return(K<<3)+(7&V)}function Hr(V){return V<<1^V>>31}function Te(V,K){for(var se=V.loadGeometry(),ge=V.type,Ie=0,Ve=0,rt=se.length,pe=0;pe<rt;pe++){var De=se[pe],yt=1;ge===1&&(yt=De.length),K.writeVarint(Rr(1,yt));for(var vr=ge===3?De.length-1:De.length,Lt=0;Lt<vr;Lt++){Lt===1&&ge!==1&&K.writeVarint(Rr(2,vr-1));var Dt=De[Lt].x-Ie,gr=De[Lt].y-Ve;K.writeVarint(Hr(Dt)),K.writeVarint(Hr(gr)),Ie+=Dt,Ve+=gr}ge===3&&K.writeVarint(Rr(7,1))}}function Ye(V,K){var se=typeof V;se==="string"?K.writeStringField(1,V):se==="boolean"?K.writeBooleanField(7,V):se==="number"&&(V%1!=0?K.writeDoubleField(3,V):V<0?K.writeSVarintField(6,V):K.writeVarintField(5,V))}function ke(V,K,se,ge){At(V,se,ge),At(K,2*se,2*ge),At(K,2*se+1,2*ge+1)}function At(V,K,se){var ge=V[K];V[K]=V[se],V[se]=ge}function gt(V,K,se,ge){var Ie=V-se,Ve=K-ge;return Ie*Ie+Ve*Ve}dt.fromVectorTileJs=ht,dt.fromGeojsonVt=function(V,K){K=K||{};var se={};for(var ge in V)se[ge]=new Jt(V[ge].features,K),se[ge].name=ge,se[ge].version=K.version,se[ge].extent=K.extent;return ht({layers:se})},dt.GeoJSONWrapper=qe;var Ft=function(V){return V[0]},qt=function(V){return V[1]},Cr=function(V,K,se,ge,Ie){K===void 0&&(K=Ft),se===void 0&&(se=qt),ge===void 0&&(ge=64),Ie===void 0&&(Ie=Float64Array),this.nodeSize=ge,this.points=V;for(var Ve=V.length<65536?Uint16Array:Uint32Array,rt=this.ids=new Ve(V.length),pe=this.coords=new Ie(2*V.length),De=0;De<V.length;De++)rt[De]=De,pe[2*De]=K(V[De]),pe[2*De+1]=se(V[De]);(function yt(vr,Lt,Dt,gr,bn,ln){if(!(bn-gr<=Dt)){var Tt=gr+bn>>1;(function on(Vr,Wr,ii,en,Ci,ta){for(;Ci>en;){if(Ci-en>600){var gi=Ci-en+1,Pi=ii-en+1,_i=Math.log(gi),Jn=.5*Math.exp(2*_i/3),Xi=.5*Math.sqrt(_i*Jn*(gi-Jn)/gi)*(Pi-gi/2<0?-1:1);on(Vr,Wr,ii,Math.max(en,Math.floor(ii-Pi*Jn/gi+Xi)),Math.min(Ci,Math.floor(ii+(gi-Pi)*Jn/gi+Xi)),ta)}var La=Wr[2*ii+ta],oa=en,Ii=Ci;for(ke(Vr,Wr,en,ii),Wr[2*Ci+ta]>La&&ke(Vr,Wr,en,Ci);oa<Ii;){for(ke(Vr,Wr,oa,Ii),oa++,Ii--;Wr[2*oa+ta]<La;)oa++;for(;Wr[2*Ii+ta]>La;)Ii--}Wr[2*en+ta]===La?ke(Vr,Wr,en,Ii):ke(Vr,Wr,++Ii,Ci),Ii<=ii&&(en=Ii+1),ii<=Ii&&(Ci=Ii-1)}})(vr,Lt,Tt,gr,bn,ln%2),yt(vr,Lt,Dt,gr,Tt-1,ln+1),yt(vr,Lt,Dt,Tt+1,bn,ln+1)}})(rt,pe,ge,0,rt.length-1,0)};Cr.prototype.range=function(V,K,se,ge){return function(Ie,Ve,rt,pe,De,yt,vr){for(var Lt,Dt,gr=[0,Ie.length-1,0],bn=[];gr.length;){var ln=gr.pop(),Tt=gr.pop(),on=gr.pop();if(Tt-on<=vr)for(var Vr=on;Vr<=Tt;Vr++)Dt=Ve[2*Vr+1],(Lt=Ve[2*Vr])>=rt&&Lt<=De&&Dt>=pe&&Dt<=yt&&bn.push(Ie[Vr]);else{var Wr=Math.floor((on+Tt)/2);Dt=Ve[2*Wr+1],(Lt=Ve[2*Wr])>=rt&&Lt<=De&&Dt>=pe&&Dt<=yt&&bn.push(Ie[Wr]);var ii=(ln+1)%2;(ln===0?rt<=Lt:pe<=Dt)&&(gr.push(on),gr.push(Wr-1),gr.push(ii)),(ln===0?De>=Lt:yt>=Dt)&&(gr.push(Wr+1),gr.push(Tt),gr.push(ii))}}return bn}(this.ids,this.coords,V,K,se,ge,this.nodeSize)},Cr.prototype.within=function(V,K,se){return function(ge,Ie,Ve,rt,pe,De){for(var yt=[0,ge.length-1,0],vr=[],Lt=pe*pe;yt.length;){var Dt=yt.pop(),gr=yt.pop(),bn=yt.pop();if(gr-bn<=De)for(var ln=bn;ln<=gr;ln++)gt(Ie[2*ln],Ie[2*ln+1],Ve,rt)<=Lt&&vr.push(ge[ln]);else{var Tt=Math.floor((bn+gr)/2),on=Ie[2*Tt],Vr=Ie[2*Tt+1];gt(on,Vr,Ve,rt)<=Lt&&vr.push(ge[Tt]);var Wr=(Dt+1)%2;(Dt===0?Ve-pe<=on:rt-pe<=Vr)&&(yt.push(bn),yt.push(Tt-1),yt.push(Wr)),(Dt===0?Ve+pe>=on:rt+pe>=Vr)&&(yt.push(Tt+1),yt.push(gr),yt.push(Wr))}}return vr}(this.ids,this.coords,V,K,se,this.nodeSize)};var Hn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},hn=function(V){this.options=aa(Object.create(Hn),V),this.trees=new Array(this.options.maxZoom+1)};function Ki(V,K,se,ge,Ie){return{x:V,y:K,zoom:1/0,id:se,parentId:-1,numPoints:ge,properties:Ie}}function Bn(V,K){var se=V.geometry.coordinates,ge=se[1];return{x:Wn(se[0]),y:si(ge),zoom:1/0,index:K,parentId:-1}}function Gn(V){return{type:"Feature",id:V.id,properties:hi(V),geometry:{type:"Point",coordinates:[(ge=V.x,360*(ge-.5)),(K=V.y,se=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(se))/Math.PI-90)]}};var K,se,ge}function hi(V){var K=V.numPoints,se=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return aa(aa({},V.properties),{cluster:!0,cluster_id:V.id,point_count:K,point_count_abbreviated:se})}function Wn(V){return V/360+.5}function si(V){var K=Math.sin(V*Math.PI/180),se=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return se<0?0:se>1?1:se}function aa(V,K){for(var se in K)V[se]=K[se];return V}function Ri(V){return V.x}function Si(V){return V.y}function Vi(V,K,se,ge,Ie,Ve){var rt=Ie-se,pe=Ve-ge;if(rt!==0||pe!==0){var De=((V-se)*rt+(K-ge)*pe)/(rt*rt+pe*pe);De>1?(se=Ie,ge=Ve):De>0&&(se+=rt*De,ge+=pe*De)}return(rt=V-se)*rt+(pe=K-ge)*pe}function ua(V,K,se,ge){var Ie={id:V===void 0?null:V,type:K,geometry:se,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ve){var rt=Ve.geometry,pe=Ve.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")wi(Ve,rt);else if(pe==="Polygon"||pe==="MultiLineString")for(var De=0;De<rt.length;De++)wi(Ve,rt[De]);else if(pe==="MultiPolygon")for(De=0;De<rt.length;De++)for(var yt=0;yt<rt[De].length;yt++)wi(Ve,rt[De][yt])}(Ie),Ie}function wi(V,K){for(var se=0;se<K.length;se+=3)V.minX=Math.min(V.minX,K[se]),V.minY=Math.min(V.minY,K[se+1]),V.maxX=Math.max(V.maxX,K[se]),V.maxY=Math.max(V.maxY,K[se+1])}function xa(V,K,se,ge){if(K.geometry){var Ie=K.geometry.coordinates,Ve=K.geometry.type,rt=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),pe=[],De=K.id;if(se.promoteId?De=K.properties[se.promoteId]:se.generateId&&(De=ge||0),Ve==="Point")An(Ie,pe);else if(Ve==="MultiPoint")for(var yt=0;yt<Ie.length;yt++)An(Ie[yt],pe);else if(Ve==="LineString")yi(Ie,pe,rt,!1);else if(Ve==="MultiLineString"){if(se.lineMetrics){for(yt=0;yt<Ie.length;yt++)yi(Ie[yt],pe=[],rt,!1),V.push(ua(De,"LineString",pe,K.properties));return}zi(Ie,pe,rt,!1)}else if(Ve==="Polygon")zi(Ie,pe,rt,!0);else{if(Ve!=="MultiPolygon"){if(Ve==="GeometryCollection"){for(yt=0;yt<K.geometry.geometries.length;yt++)xa(V,{id:De,geometry:K.geometry.geometries[yt],properties:K.properties},se,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(yt=0;yt<Ie.length;yt++){var vr=[];zi(Ie[yt],vr,rt,!0),pe.push(vr)}}V.push(ua(De,Ve,pe,K.properties))}}function An(V,K){K.push($i(V[0])),K.push(ja(V[1])),K.push(0)}function yi(V,K,se,ge){for(var Ie,Ve,rt=0,pe=0;pe<V.length;pe++){var De=$i(V[pe][0]),yt=ja(V[pe][1]);K.push(De),K.push(yt),K.push(0),pe>0&&(rt+=ge?(Ie*yt-De*Ve)/2:Math.sqrt(Math.pow(De-Ie,2)+Math.pow(yt-Ve,2))),Ie=De,Ve=yt}var vr=K.length-3;K[2]=1,function Lt(Dt,gr,bn,ln){for(var Tt,on=ln,Vr=bn-gr>>1,Wr=bn-gr,ii=Dt[gr],en=Dt[gr+1],Ci=Dt[bn],ta=Dt[bn+1],gi=gr+3;gi<bn;gi+=3){var Pi=Vi(Dt[gi],Dt[gi+1],ii,en,Ci,ta);if(Pi>on)Tt=gi,on=Pi;else if(Pi===on){var _i=Math.abs(gi-Vr);_i<Wr&&(Tt=gi,Wr=_i)}}on>ln&&(Tt-gr>3&&Lt(Dt,gr,Tt,ln),Dt[Tt+2]=on,bn-Tt>3&&Lt(Dt,Tt,bn,ln))}(K,0,vr,se),K[vr+2]=1,K.size=Math.abs(rt),K.start=0,K.end=K.size}function zi(V,K,se,ge){for(var Ie=0;Ie<V.length;Ie++){var Ve=[];yi(V[Ie],Ve,se,ge),K.push(Ve)}}function $i(V){return V/360+.5}function ja(V){var K=Math.sin(V*Math.PI/180),se=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return se<0?0:se>1?1:se}function me(V,K,se,ge,Ie,Ve,rt,pe){if(ge/=K,Ve>=(se/=K)&&rt<ge)return V;if(rt<se||Ve>=ge)return null;for(var De=[],yt=0;yt<V.length;yt++){var vr=V[yt],Lt=vr.geometry,Dt=vr.type,gr=Ie===0?vr.minX:vr.minY,bn=Ie===0?vr.maxX:vr.maxY;if(gr>=se&&bn<ge)De.push(vr);else if(!(bn<se||gr>=ge)){var ln=[];if(Dt==="Point"||Dt==="MultiPoint")Ln(Lt,ln,se,ge,Ie);else if(Dt==="LineString")Va(Lt,ln,se,ge,Ie,!1,pe.lineMetrics);else if(Dt==="MultiLineString")zt(Lt,ln,se,ge,Ie,!1);else if(Dt==="Polygon")zt(Lt,ln,se,ge,Ie,!0);else if(Dt==="MultiPolygon")for(var Tt=0;Tt<Lt.length;Tt++){var on=[];zt(Lt[Tt],on,se,ge,Ie,!0),on.length&&ln.push(on)}if(ln.length){if(pe.lineMetrics&&Dt==="LineString"){for(Tt=0;Tt<ln.length;Tt++)De.push(ua(vr.id,Dt,ln[Tt],vr.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(ln.length===1?(Dt="LineString",ln=ln[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=ln.length===3?"Point":"MultiPoint"),De.push(ua(vr.id,Dt,ln,vr.tags))}}}return De.length?De:null}function Ln(V,K,se,ge,Ie){for(var Ve=0;Ve<V.length;Ve+=3){var rt=V[Ve+Ie];rt>=se&&rt<=ge&&(K.push(V[Ve]),K.push(V[Ve+1]),K.push(V[Ve+2]))}}function Va(V,K,se,ge,Ie,Ve,rt){for(var pe,De,yt=fs(V),vr=Ie===0?Ir:I,Lt=V.start,Dt=0;Dt<V.length-3;Dt+=3){var gr=V[Dt],bn=V[Dt+1],ln=V[Dt+2],Tt=V[Dt+3],on=V[Dt+4],Vr=Ie===0?gr:bn,Wr=Ie===0?Tt:on,ii=!1;rt&&(pe=Math.sqrt(Math.pow(gr-Tt,2)+Math.pow(bn-on,2))),Vr<se?Wr>se&&(De=vr(yt,gr,bn,Tt,on,se),rt&&(yt.start=Lt+pe*De)):Vr>ge?Wr<ge&&(De=vr(yt,gr,bn,Tt,on,ge),rt&&(yt.start=Lt+pe*De)):ir(yt,gr,bn,ln),Wr<se&&Vr>=se&&(De=vr(yt,gr,bn,Tt,on,se),ii=!0),Wr>ge&&Vr<=ge&&(De=vr(yt,gr,bn,Tt,on,ge),ii=!0),!Ve&&ii&&(rt&&(yt.end=Lt+pe*De),K.push(yt),yt=fs(V)),rt&&(Lt+=pe)}var en=V.length-3;gr=V[en],bn=V[en+1],ln=V[en+2],(Vr=Ie===0?gr:bn)>=se&&Vr<=ge&&ir(yt,gr,bn,ln),en=yt.length-3,Ve&&en>=3&&(yt[en]!==yt[0]||yt[en+1]!==yt[1])&&ir(yt,yt[0],yt[1],yt[2]),yt.length&&K.push(yt)}function fs(V){var K=[];return K.size=V.size,K.start=V.start,K.end=V.end,K}function zt(V,K,se,ge,Ie,Ve){for(var rt=0;rt<V.length;rt++)Va(V[rt],K,se,ge,Ie,Ve,!1)}function ir(V,K,se,ge){V.push(K),V.push(se),V.push(ge)}function Ir(V,K,se,ge,Ie,Ve){var rt=(Ve-K)/(ge-K);return V.push(Ve),V.push(se+(Ie-se)*rt),V.push(1),rt}function I(V,K,se,ge,Ie,Ve){var rt=(Ve-se)/(Ie-se);return V.push(K+(ge-K)*rt),V.push(Ve),V.push(1),rt}function sr(V,K){for(var se=[],ge=0;ge<V.length;ge++){var Ie,Ve=V[ge],rt=Ve.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Ie=On(Ve.geometry,K);else if(rt==="MultiLineString"||rt==="Polygon"){Ie=[];for(var pe=0;pe<Ve.geometry.length;pe++)Ie.push(On(Ve.geometry[pe],K))}else if(rt==="MultiPolygon")for(Ie=[],pe=0;pe<Ve.geometry.length;pe++){for(var De=[],yt=0;yt<Ve.geometry[pe].length;yt++)De.push(On(Ve.geometry[pe][yt],K));Ie.push(De)}se.push(ua(Ve.id,rt,Ie,Ve.tags))}return se}function On(V,K){var se=[];se.size=V.size,V.start!==void 0&&(se.start=V.start,se.end=V.end);for(var ge=0;ge<V.length;ge+=3)se.push(V[ge]+K,V[ge+1],V[ge+2]);return se}function ui(V,K){if(V.transformed)return V;var se,ge,Ie,Ve=1<<V.z,rt=V.x,pe=V.y;for(se=0;se<V.features.length;se++){var De=V.features[se],yt=De.geometry,vr=De.type;if(De.geometry=[],vr===1)for(ge=0;ge<yt.length;ge+=2)De.geometry.push(Zn(yt[ge],yt[ge+1],K,Ve,rt,pe));else for(ge=0;ge<yt.length;ge++){var Lt=[];for(Ie=0;Ie<yt[ge].length;Ie+=2)Lt.push(Zn(yt[ge][Ie],yt[ge][Ie+1],K,Ve,rt,pe));De.geometry.push(Lt)}}return V.transformed=!0,V}function Zn(V,K,se,ge,Ie,Ve){return[Math.round(se*(V*ge-Ie)),Math.round(se*(K*ge-Ve))]}function nn(V,K,se,ge,Ie){for(var Ve=K===Ie.maxZoom?0:Ie.tolerance/((1<<K)*Ie.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:ge,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<V.length;pe++){rt.numFeatures++,Ti(rt,V[pe],Ve,Ie);var De=V[pe].minX,yt=V[pe].minY,vr=V[pe].maxX,Lt=V[pe].maxY;De<rt.minX&&(rt.minX=De),yt<rt.minY&&(rt.minY=yt),vr>rt.maxX&&(rt.maxX=vr),Lt>rt.maxY&&(rt.maxY=Lt)}return rt}function Ti(V,K,se,ge){var Ie=K.geometry,Ve=K.type,rt=[];if(Ve==="Point"||Ve==="MultiPoint")for(var pe=0;pe<Ie.length;pe+=3)rt.push(Ie[pe]),rt.push(Ie[pe+1]),V.numPoints++,V.numSimplified++;else if(Ve==="LineString")Mi(rt,Ie,V,se,!1,!1);else if(Ve==="MultiLineString"||Ve==="Polygon")for(pe=0;pe<Ie.length;pe++)Mi(rt,Ie[pe],V,se,Ve==="Polygon",pe===0);else if(Ve==="MultiPolygon")for(var De=0;De<Ie.length;De++){var yt=Ie[De];for(pe=0;pe<yt.length;pe++)Mi(rt,yt[pe],V,se,!0,pe===0)}if(rt.length){var vr=K.tags||null;if(Ve==="LineString"&&ge.lineMetrics){for(var Lt in vr={},K.tags)vr[Lt]=K.tags[Lt];vr.mapbox_clip_start=Ie.start/Ie.size,vr.mapbox_clip_end=Ie.end/Ie.size}var Dt={geometry:rt,type:Ve==="Polygon"||Ve==="MultiPolygon"?3:Ve==="LineString"||Ve==="MultiLineString"?2:1,tags:vr};K.id!==null&&(Dt.id=K.id),V.features.push(Dt)}}function Mi(V,K,se,ge,Ie,Ve){var rt=ge*ge;if(ge>0&&K.size<(Ie?rt:ge))se.numPoints+=K.length/3;else{for(var pe=[],De=0;De<K.length;De+=3)(ge===0||K[De+2]>rt)&&(se.numSimplified++,pe.push(K[De]),pe.push(K[De+1])),se.numPoints++;Ie&&function(yt,vr){for(var Lt=0,Dt=0,gr=yt.length,bn=gr-2;Dt<gr;bn=Dt,Dt+=2)Lt+=(yt[Dt]-yt[bn])*(yt[Dt+1]+yt[bn+1]);if(Lt>0===vr)for(Dt=0,gr=yt.length;Dt<gr/2;Dt+=2){var ln=yt[Dt],Tt=yt[Dt+1];yt[Dt]=yt[gr-2-Dt],yt[Dt+1]=yt[gr-1-Dt],yt[gr-2-Dt]=ln,yt[gr-1-Dt]=Tt}}(pe,Ve),V.push(pe)}}function Ya(V,K){var se=(K=this.options=function(Ie,Ve){for(var rt in Ve)Ie[rt]=Ve[rt];return Ie}(Object.create(this.options),K)).debug;if(se&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Ie,Ve){var rt=[];if(Ie.type==="FeatureCollection")for(var pe=0;pe<Ie.features.length;pe++)xa(rt,Ie.features[pe],Ve,pe);else xa(rt,Ie.type==="Feature"?Ie:{geometry:Ie},Ve);return rt}(V,K);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Ie,Ve){var rt=Ve.buffer/Ve.extent,pe=Ie,De=me(Ie,1,-1-rt,rt,0,-1,2,Ve),yt=me(Ie,1,1-rt,2+rt,0,-1,2,Ve);return(De||yt)&&(pe=me(Ie,1,-rt,1+rt,0,-1,2,Ve)||[],De&&(pe=sr(De,1).concat(pe)),yt&&(pe=pe.concat(sr(yt,-1)))),pe}(ge,K)).length&&this.splitTile(ge,0,0,0),se&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(V,K,se){return 32*((1<<V)*se+K)+V}function va(V,K){var se=V.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var ge=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!ge)return K(null,null);var Ie=new ot(ge.features),Ve=dt(Ie);Ve.byteOffset===0&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),K(null,{vectorTile:Ie,rawData:Ve.buffer})}hn.prototype.load=function(V){var K=this.options,se=K.log,ge=K.minZoom,Ie=K.maxZoom,Ve=K.nodeSize;se&&console.time("total time");var rt="prepare "+V.length+" points";se&&console.time(rt),this.points=V;for(var pe=[],De=0;De<V.length;De++)V[De].geometry&&pe.push(Bn(V[De],De));this.trees[Ie+1]=new Cr(pe,Ri,Si,Ve,Float32Array),se&&console.timeEnd(rt);for(var yt=Ie;yt>=ge;yt--){var vr=+Date.now();pe=this._cluster(pe,yt),this.trees[yt]=new Cr(pe,Ri,Si,Ve,Float32Array),se&&console.log("z%d: %d clusters in %dms",yt,pe.length,+Date.now()-vr)}return se&&console.timeEnd("total time"),this},hn.prototype.getClusters=function(V,K){var se=((V[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,V[1])),Ie=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ve=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)se=-180,Ie=180;else if(se>Ie){var rt=this.getClusters([se,ge,180,Ve],K),pe=this.getClusters([-180,ge,Ie,Ve],K);return rt.concat(pe)}for(var De=this.trees[this._limitZoom(K)],yt=[],vr=0,Lt=De.range(Wn(se),si(Ve),Wn(Ie),si(ge));vr<Lt.length;vr+=1){var Dt=De.points[Lt[vr]];yt.push(Dt.numPoints?Gn(Dt):this.points[Dt.index])}return yt},hn.prototype.getChildren=function(V){var K=this._getOriginId(V),se=this._getOriginZoom(V),ge="No cluster with the specified id.",Ie=this.trees[se];if(!Ie)throw new Error(ge);var Ve=Ie.points[K];if(!Ve)throw new Error(ge);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,se-1)),pe=[],De=0,yt=Ie.within(Ve.x,Ve.y,rt);De<yt.length;De+=1){var vr=Ie.points[yt[De]];vr.parentId===V&&pe.push(vr.numPoints?Gn(vr):this.points[vr.index])}if(pe.length===0)throw new Error(ge);return pe},hn.prototype.getLeaves=function(V,K,se){var ge=[];return this._appendLeaves(ge,V,K=K||10,se=se||0,0),ge},hn.prototype.getTile=function(V,K,se){var ge=this.trees[this._limitZoom(V)],Ie=Math.pow(2,V),Ve=this.options,rt=Ve.radius/Ve.extent,pe=(se-rt)/Ie,De=(se+1+rt)/Ie,yt={features:[]};return this._addTileFeatures(ge.range((K-rt)/Ie,pe,(K+1+rt)/Ie,De),ge.points,K,se,Ie,yt),K===0&&this._addTileFeatures(ge.range(1-rt/Ie,pe,1,De),ge.points,Ie,se,Ie,yt),K===Ie-1&&this._addTileFeatures(ge.range(0,pe,rt/Ie,De),ge.points,-1,se,Ie,yt),yt.features.length?yt:null},hn.prototype.getClusterExpansionZoom=function(V){for(var K=this._getOriginZoom(V)-1;K<=this.options.maxZoom;){var se=this.getChildren(V);if(K++,se.length!==1)break;V=se[0].properties.cluster_id}return K},hn.prototype._appendLeaves=function(V,K,se,ge,Ie){for(var Ve=0,rt=this.getChildren(K);Ve<rt.length;Ve+=1){var pe=rt[Ve],De=pe.properties;if(De&&De.cluster?Ie+De.point_count<=ge?Ie+=De.point_count:Ie=this._appendLeaves(V,De.cluster_id,se,ge,Ie):Ie<ge?Ie++:V.push(pe),V.length===se)break}return Ie},hn.prototype._addTileFeatures=function(V,K,se,ge,Ie,Ve){for(var rt=0,pe=V;rt<pe.length;rt+=1){var De=K[pe[rt]],yt=De.numPoints,vr={type:1,geometry:[[Math.round(this.options.extent*(De.x*Ie-se)),Math.round(this.options.extent*(De.y*Ie-ge))]],tags:yt?hi(De):this.points[De.index].properties},Lt=void 0;yt?Lt=De.id:this.options.generateId?Lt=De.index:this.points[De.index].id&&(Lt=this.points[De.index].id),Lt!==void 0&&(vr.id=Lt),Ve.features.push(vr)}},hn.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},hn.prototype._cluster=function(V,K){for(var se=[],ge=this.options,Ie=ge.reduce,Ve=ge.minPoints,rt=ge.radius/(ge.extent*Math.pow(2,K)),pe=0;pe<V.length;pe++){var De=V[pe];if(!(De.zoom<=K)){De.zoom=K;for(var yt=this.trees[K+1],vr=yt.within(De.x,De.y,rt),Lt=De.numPoints||1,Dt=Lt,gr=0,bn=vr;gr<bn.length;gr+=1){var ln=yt.points[bn[gr]];ln.zoom>K&&(Dt+=ln.numPoints||1)}if(Dt>=Ve){for(var Tt=De.x*Lt,on=De.y*Lt,Vr=Ie&&Lt>1?this._map(De,!0):null,Wr=(pe<<5)+(K+1)+this.points.length,ii=0,en=vr;ii<en.length;ii+=1){var Ci=yt.points[en[ii]];if(!(Ci.zoom<=K)){Ci.zoom=K;var ta=Ci.numPoints||1;Tt+=Ci.x*ta,on+=Ci.y*ta,Ci.parentId=Wr,Ie&&(Vr||(Vr=this._map(De,!0)),Ie(Vr,this._map(Ci)))}}De.parentId=Wr,se.push(Ki(Tt/Dt,on/Dt,Wr,Dt,Vr))}else if(se.push(De),Dt>1)for(var gi=0,Pi=vr;gi<Pi.length;gi+=1){var _i=yt.points[Pi[gi]];_i.zoom<=K||(_i.zoom=K,se.push(_i))}}}return se},hn.prototype._getOriginId=function(V){return V-this.points.length>>5},hn.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},hn.prototype._map=function(V,K){if(V.numPoints)return K?aa({},V.properties):V.properties;var se=this.points[V.index].properties,ge=this.options.map(se);return K&&ge===se?aa({},ge):ge},Ya.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ya.prototype.splitTile=function(V,K,se,ge,Ie,Ve,rt){for(var pe=[V,K,se,ge],De=this.options,yt=De.debug;pe.length;){ge=pe.pop(),se=pe.pop(),K=pe.pop(),V=pe.pop();var vr=1<<K,Lt=hs(K,se,ge),Dt=this.tiles[Lt];if(!Dt&&(yt>1&&console.time("creation"),Dt=this.tiles[Lt]=nn(V,K,se,ge,De),this.tileCoords.push({z:K,x:se,y:ge}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,se,ge,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var gr="z"+K;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(Dt.source=V,Ie){if(K===De.maxZoom||K===Ie)continue;var bn=1<<Ie-K;if(se!==Math.floor(Ve/bn)||ge!==Math.floor(rt/bn))continue}else if(K===De.indexMaxZoom||Dt.numPoints<=De.indexMaxPoints)continue;if(Dt.source=null,V.length!==0){yt>1&&console.time("clipping");var ln,Tt,on,Vr,Wr,ii,en=.5*De.buffer/De.extent,Ci=.5-en,ta=.5+en,gi=1+en;ln=Tt=on=Vr=null,Wr=me(V,vr,se-en,se+ta,0,Dt.minX,Dt.maxX,De),ii=me(V,vr,se+Ci,se+gi,0,Dt.minX,Dt.maxX,De),V=null,Wr&&(ln=me(Wr,vr,ge-en,ge+ta,1,Dt.minY,Dt.maxY,De),Tt=me(Wr,vr,ge+Ci,ge+gi,1,Dt.minY,Dt.maxY,De),Wr=null),ii&&(on=me(ii,vr,ge-en,ge+ta,1,Dt.minY,Dt.maxY,De),Vr=me(ii,vr,ge+Ci,ge+gi,1,Dt.minY,Dt.maxY,De),ii=null),yt>1&&console.timeEnd("clipping"),pe.push(ln||[],K+1,2*se,2*ge),pe.push(Tt||[],K+1,2*se,2*ge+1),pe.push(on||[],K+1,2*se+1,2*ge),pe.push(Vr||[],K+1,2*se+1,2*ge+1)}}},Ya.prototype.getTile=function(V,K,se){var ge=this.options,Ie=ge.extent,Ve=ge.debug;if(V<0||V>24)return null;var rt=1<<V,pe=hs(V,K=(K%rt+rt)%rt,se);if(this.tiles[pe])return ui(this.tiles[pe],Ie);Ve>1&&console.log("drilling down to z%d-%d-%d",V,K,se);for(var De,yt=V,vr=K,Lt=se;!De&&yt>0;)yt--,vr=Math.floor(vr/2),Lt=Math.floor(Lt/2),De=this.tiles[hs(yt,vr,Lt)];return De&&De.source?(Ve>1&&console.log("found parent tile z%d-%d-%d",yt,vr,Lt),Ve>1&&console.time("drilling down"),this.splitTile(De.source,yt,vr,Lt,V,K,se),Ve>1&&console.timeEnd("drilling down"),this.tiles[pe]?ui(this.tiles[pe],Ie):null):null};var Ra=function(V){function K(se,ge,Ie,Ve){V.call(this,se,ge,Ie,va),Ve&&(this.loadGeoJSON=Ve)}return V&&(K.__proto__=V),(K.prototype=Object.create(V&&V.prototype)).constructor=K,K.prototype.loadData=function(se,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=se,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var se=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Ie=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ve=!!(Ie&&Ie.request&&Ie.request.collectResourceTiming)&&new v.RequestPerformance(Ie.request);this.loadGeoJSON(Ie,function(rt,pe){if(rt||!pe)return ge(rt);if(typeof pe!="object")return ge(new Error("Input data given to '"+Ie.source+"' is not a valid GeoJSON object."));(function Dt(gr,bn){var ln,Tt=gr&&gr.type;if(Tt==="FeatureCollection")for(ln=0;ln<gr.features.length;ln++)Dt(gr.features[ln],bn);else if(Tt==="GeometryCollection")for(ln=0;ln<gr.geometries.length;ln++)Dt(gr.geometries[ln],bn);else if(Tt==="Feature")Dt(gr.geometry,bn);else if(Tt==="Polygon")nr(gr.coordinates,bn);else if(Tt==="MultiPolygon")for(ln=0;ln<gr.coordinates.length;ln++)nr(gr.coordinates[ln],bn);return gr})(pe,!0);try{if(Ie.filter){var De=v.createExpression(Ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(function(Dt){return Dt.key+": "+Dt.message}).join(", "));var yt=pe.features.filter(function(Dt){return De.value.evaluate({zoom:0},Dt)});pe={type:"FeatureCollection",features:yt}}se._geoJSONIndex=Ie.cluster?new hn(function(Dt){var gr=Dt.superclusterOptions,bn=Dt.clusterProperties;if(!bn||!gr)return gr;for(var ln={},Tt={},on={accumulated:null,zoom:0},Vr={properties:null},Wr=Object.keys(bn),ii=0,en=Wr;ii<en.length;ii+=1){var Ci=en[ii],ta=bn[Ci],gi=ta[0],Pi=v.createExpression(ta[1]),_i=v.createExpression(typeof gi=="string"?[gi,["accumulated"],["get",Ci]]:gi);ln[Ci]=Pi.value,Tt[Ci]=_i.value}return gr.map=function(Jn){Vr.properties=Jn;for(var Xi={},La=0,oa=Wr;La<oa.length;La+=1){var Ii=oa[La];Xi[Ii]=ln[Ii].evaluate(on,Vr)}return Xi},gr.reduce=function(Jn,Xi){Vr.properties=Xi;for(var La=0,oa=Wr;La<oa.length;La+=1){var Ii=oa[La];on.accumulated=Jn[Ii],Jn[Ii]=Tt[Ii].evaluate(on,Vr)}},gr}(Ie)).load(pe.features):function(Dt,gr){return new Ya(Dt,gr)}(pe,Ie.geojsonVtOptions)}catch(Dt){return ge(Dt)}se.loaded={};var vr={};if(Ve){var Lt=Ve.finish();Lt&&(vr.resourceTiming={},vr.resourceTiming[Ie.source]=JSON.parse(JSON.stringify(Lt)))}ge(null,vr)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(se,ge){var Ie=this.loaded;return Ie&&Ie[se.uid]?V.prototype.reloadTile.call(this,se,ge):this.loadTile(se,ge)},K.prototype.loadGeoJSON=function(se,ge){if(se.request)v.getJSON(se.request,ge);else{if(typeof se.data!="string")return ge(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(se.data))}catch(Ie){return ge(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(se,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},K.prototype.getClusterExpansionZoom=function(se,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(Ie){ge(Ie)}},K.prototype.getClusterChildren=function(se,ge){try{ge(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(Ie){ge(Ie)}},K.prototype.getClusterLeaves=function(se,ge){try{ge(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(Ie){ge(Ie)}},K}(we),Sa=function(V){var K=this;this.self=V,this.actor=new v.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:Ra},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(se,ge){if(K.workerSourceTypes[se])throw new Error('Worker source with name "'+se+'" already registered.');K.workerSourceTypes[se]=ge},this.self.registerRTLTextPlugin=function(se){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=se.applyArabicShaping,v.plugin.processBidirectionalText=se.processBidirectionalText,v.plugin.processStyledBidirectionalText=se.processStyledBidirectionalText}};return Sa.prototype.setReferrer=function(V,K){this.referrer=K},Sa.prototype.setImages=function(V,K,se){for(var ge in this.availableImages[V]=K,this.workerSources[V]){var Ie=this.workerSources[V][ge];for(var Ve in Ie)Ie[Ve].availableImages=K}se()},Sa.prototype.setLayers=function(V,K,se){this.getLayerIndex(V).replace(K),se()},Sa.prototype.updateLayers=function(V,K,se){this.getLayerIndex(V).update(K.layers,K.removedIds),se()},Sa.prototype.loadTile=function(V,K,se){this.getWorkerSource(V,K.type,K.source).loadTile(K,se)},Sa.prototype.loadDEMTile=function(V,K,se){this.getDEMWorkerSource(V,K.source).loadTile(K,se)},Sa.prototype.reloadTile=function(V,K,se){this.getWorkerSource(V,K.type,K.source).reloadTile(K,se)},Sa.prototype.abortTile=function(V,K,se){this.getWorkerSource(V,K.type,K.source).abortTile(K,se)},Sa.prototype.removeTile=function(V,K,se){this.getWorkerSource(V,K.type,K.source).removeTile(K,se)},Sa.prototype.removeDEMTile=function(V,K){this.getDEMWorkerSource(V,K.source).removeTile(K)},Sa.prototype.removeSource=function(V,K,se){if(this.workerSources[V]&&this.workerSources[V][K.type]&&this.workerSources[V][K.type][K.source]){var ge=this.workerSources[V][K.type][K.source];delete this.workerSources[V][K.type][K.source],ge.removeSource!==void 0?ge.removeSource(K,se):se()}},Sa.prototype.loadWorkerSource=function(V,K,se){try{this.self.importScripts(K.url),se()}catch(ge){se(ge.toString())}},Sa.prototype.syncRTLPluginState=function(V,K,se){try{v.plugin.setState(K);var ge=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Ie=v.plugin.isParsed();se(Ie?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Ie)}}catch(Ve){se(Ve.toString())}},Sa.prototype.getAvailableImages=function(V){var K=this.availableImages[V];return K||(K=[]),K},Sa.prototype.getLayerIndex=function(V){var K=this.layerIndexes[V];return K||(K=this.layerIndexes[V]=new J),K},Sa.prototype.getWorkerSource=function(V,K,se){var ge=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][K]||(this.workerSources[V][K]={}),this.workerSources[V][K][se]||(this.workerSources[V][K][se]=new this.workerSourceTypes[K]({send:function(Ie,Ve,rt){ge.actor.send(Ie,Ve,rt,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][K][se]},Sa.prototype.getDEMWorkerSource=function(V,K){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][K]||(this.demWorkerSources[V][K]=new Mt),this.demWorkerSources[V][K]},Sa.prototype.enforceCacheSizeLimit=function(V,K){v.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Sa(self)),Sa}),$(["./shared"],function(v){"use strict";var ee=v.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var A,L,U=new Blob([""],{type:"text/javascript"}),W=URL.createObjectURL(U);try{L=new Worker(W),A=!0}catch(fe){A=!1}return L&&L.terminate(),URL.revokeObjectURL(W),A}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var A=document.createElement("canvas");A.width=A.height=1;var L=A.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===A.width}()?(p[w=b&&b.failIfMajorPerformanceCaveat]===void 0&&(p[w]=function(A){var L=function(W){var fe=document.createElement("canvas"),he=Object.create(f.webGLContextAttributes);return he.failIfMajorPerformanceCaveat=W,fe.probablySupportsContext?fe.probablySupportsContext("webgl",he)||fe.probablySupportsContext("experimental-webgl",he):fe.supportsContext?fe.supportsContext("webgl",he)||fe.supportsContext("experimental-webgl",he):fe.getContext("webgl",he)||fe.getContext("experimental-webgl",he)}(A);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),p[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var p={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),F={create:function(l,f,c){var p=v.window.document.createElement(l);return f!==void 0&&(p.className=f),c&&c.appendChild(p),p},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},J=v.window.document&&v.window.document.documentElement.style;function re(l){if(!J)return l[0];for(var f=0;f<l.length;f++)if(l[f]in J)return l[f];return l[0]}var Ee,ne=re(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);F.disableDrag=function(){J&&ne&&(Ee=J[ne],J[ne]="none")},F.enableDrag=function(){J&&ne&&(J[ne]=Ee)};var je=re(["transform","WebkitTransform"]);F.setTransform=function(l,f){l.style[je]=f};var we=!1;try{var et=Object.defineProperty({},"passive",{get:function(){we=!0}});v.window.addEventListener("test",et,et),v.window.removeEventListener("test",et,et)}catch(l){we=!1}F.addEventListener=function(l,f,c,p){p===void 0&&(p={}),l.addEventListener(f,c,"passive"in p&&we?p:p.capture)},F.removeEventListener=function(l,f,c,p){p===void 0&&(p={}),l.removeEventListener(f,c,"passive"in p&&we?p:p.capture)};var Mt=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",Mt,!0)};function nr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}F.suppressClick=function(){v.window.addEventListener("click",Mt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Mt,!0)},0)},F.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},F.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),p=[],b=0;b<f.length;b++)p.push(new v.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return p},F.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},F.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var _t=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var p=0,b=this.requestors;p<b.length;p+=1){var w=b[p];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,p){this._validate(c,p)&&(this.images[c]=p)},f.prototype._validate=function(c,p){var b=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(p.content,p)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,p){if(!c)return!0;for(var b=0,w=0,A=c;w<A.length;w+=1){var L=A[w];if(L[0]<b||L[1]<L[0]||p<L[1])return!1;b=L[1]}return!0},f.prototype._validateContent=function(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,p){var b=!0;if(!this.isLoaded())for(var w=0,A=c;w<A.length;w+=1)this.images[A[w]]||(b=!1);this.isLoaded()||b?this._notify(c,p):this.requestors.push({ids:c,callback:p})},f.prototype._notify=function(c,p){for(var b={},w=0,A=c;w<A.length;w+=1){var L=A[w];this.images[L]||this.fire(new v.Event("styleimagemissing",{id:L}));var U=this.images[L];U?b[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:v.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}p(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var p=this.patterns[c],b=this.getImage(c);if(!b)return null;if(p&&p.position.version===b.version)return p.position;if(p)p.position.version=b.version;else{var w={w:b.data.width+2,h:b.data.height+2,x:0,y:0},A=new v.ImagePosition(w,b);this.patterns[c]={bin:w,position:A}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var p in this.patterns)c.push(this.patterns[p].bin);var b=v.potpack(c),w=b.w,A=b.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:A||1}),this.patterns){var W=this.patterns[U].bin,fe=W.x+1,he=W.y+1,de=this.images[U].data,Le=de.width,Oe=de.height;v.RGBAImage.copy(de,L,{x:0,y:0},{x:fe,y:he},{width:Le,height:Oe}),v.RGBAImage.copy(de,L,{x:0,y:Oe-1},{x:fe,y:he-1},{width:Le,height:1}),v.RGBAImage.copy(de,L,{x:0,y:0},{x:fe,y:he+Oe},{width:Le,height:1}),v.RGBAImage.copy(de,L,{x:Le-1,y:0},{x:fe-1,y:he},{width:1,height:Oe}),v.RGBAImage.copy(de,L,{x:0,y:0},{x:fe+Le,y:he},{width:1,height:Oe})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var p=0,b=c;p<b.length;p+=1){var w=b[p];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var A=this.images[w];nr(A)&&this.updateImage(w,A)}}},f}(v.Evented),Xt=ut,Ct=ut,ot=1e20;function ut(l,f,c,p,b,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=p||.25,this.fontFamily=b||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var A=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=A,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.d=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Int16Array(A),this.middle=Math.round(A/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Jt(l,f,c,p,b,w,A){for(var L=0;L<f;L++){for(var U=0;U<c;U++)p[U]=l[U*f+L];for(X(p,b,w,A,c),U=0;U<c;U++)l[U*f+L]=b[U]}for(U=0;U<c;U++){for(L=0;L<f;L++)p[L]=l[U*f+L];for(X(p,b,w,A,f),L=0;L<f;L++)l[U*f+L]=Math.sqrt(b[L])}}function X(l,f,c,p,b){c[0]=0,p[0]=-ot,p[1]=+ot;for(var w=1,A=0;w<b;w++){for(var L=(l[w]+w*w-(l[c[A]]+c[A]*c[A]))/(2*w-2*c[A]);L<=p[A];)A--,L=(l[w]+w*w-(l[c[A]]+c[A]*c[A]))/(2*w-2*c[A]);c[++A]=w,p[A]=L,p[A+1]=+ot}for(w=0,A=0;w<b;w++){for(;p[A+1]<w;)A++;f[w]=(w-c[A])*(w-c[A])+l[c[A]]}}ut.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),p=0;p<this.size*this.size;p++){var b=f.data[4*p+3]/255;this.gridOuter[p]=b===1?0:b===0?ot:Math.pow(Math.max(0,.5-b),2),this.gridInner[p]=b===1?ot:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(Jt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Jt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),p=0;p<this.size*this.size;p++)c[p]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[p]-this.gridInner[p])/this.radius+this.cutoff))));return c},Xt.default=Ct;var Yt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Yt.prototype.setURL=function(l){this.url=l},Yt.prototype.getGlyphs=function(l,f){var c=this,p=[];for(var b in l)for(var w=0,A=l[b];w<A.length;w+=1)p.push({stack:b,id:A[w]});v.asyncAll(p,function(L,U){var W=L.stack,fe=L.id,he=c.entries[W];he||(he=c.entries[W]={glyphs:{},requests:{},ranges:{}});var de=he.glyphs[fe];if(de===void 0){if(de=c._tinySDF(he,W,fe))return he.glyphs[fe]=de,void U(null,{stack:W,id:fe,glyph:de});var Le=Math.floor(fe/256);if(256*Le>65535)U(new Error("glyphs > 65535 not supported"));else if(he.ranges[Le])U(null,{stack:W,id:fe,glyph:de});else{var Oe=he.requests[Le];Oe||(Oe=he.requests[Le]=[],Yt.loadGlyphRange(W,Le,c.url,c.requestManager,function(Xe,Ae){if(Ae){for(var He in Ae)c._doesCharSupportLocalGlyph(+He)||(he.glyphs[+He]=Ae[+He]);he.ranges[Le]=!0}for(var tt=0,xt=Oe;tt<xt.length;tt+=1)(0,xt[tt])(Xe,Ae);delete he.requests[Le]})),Oe.push(function(Xe,Ae){Xe?U(Xe):Ae&&U(null,{stack:W,id:fe,glyph:Ae[fe]||null})})}}else U(null,{stack:W,id:fe,glyph:de})},function(L,U){if(L)f(L);else if(U){for(var W={},fe=0,he=U;fe<he.length;fe+=1){var de=he[fe],Le=de.stack,Oe=de.id,Xe=de.glyph;(W[Le]||(W[Le]={}))[Oe]=Xe&&{id:Xe.id,bitmap:Xe.bitmap.clone(),metrics:Xe.metrics}}f(null,W)}})},Yt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Yt.prototype._tinySDF=function(l,f,c){var p=this.localIdeographFontFamily;if(p&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),b=l.tinySDF=new Yt.TinySDF(24,3,8,.25,p,w)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Yt.loadGlyphRange=function(l,f,c,p,b){var w=256*f,A=w+255,L=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+A),v.ResourceType.Glyphs);v.getArrayBuffer(L,function(U,W){if(U)b(U);else if(W){for(var fe={},he=0,de=v.parseGlyphPBF(W);he<de.length;he+=1){var Le=de[he];fe[Le.id]=Le}b(null,fe)}})},Yt.TinySDF=Xt;var dt=function(){this.specification=v.styleSpec.light.position};dt.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},dt.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var qe=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new dt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),ht=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,p){if(p===void 0&&(p={}),!this._validate(v.validateLight,c,p))for(var b in c){var w=c[b];v.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),w):this._transitionable.setValue(b,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,p,b){return(!b||b.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var p=[],b=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,A=!0;p.push({left:b,right:w,isDash:A,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var W=l[U];p.push({left:b=L*c,right:w=(L+=W)*c,isDash:A=!A,zeroLength:W===0})}return p},$e.prototype.addRoundDash=function(l,f,c){for(var p=f/2,b=-c;b<=c;b++)for(var w=this.width*(this.nextRow+c+b),A=0,L=l[A],U=0;U<this.width;U++){U/L.right>1&&(L=l[++A]);var W=Math.abs(U-L.left),fe=Math.abs(U-L.right),he=Math.min(W,fe),de=void 0,Le=b/c*(p+1);if(L.isDash){var Oe=p-Math.abs(Le);de=Math.sqrt(he*he+Oe*Oe)}else de=p-Math.sqrt(he*he+Le*Le);this.data[w+U]=Math.max(0,Math.min(255,de+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],p=l[f+1];c.zeroLength?l.splice(f,1):p&&p.isDash===c.isDash&&(p.left=c.left,l.splice(f,1))}var b=l[0],w=l[l.length-1];b.isDash===w.isDash&&(b.left=w.left-this.width,w.right=b.right+this.width);for(var A=this.width*this.nextRow,L=0,U=l[L],W=0;W<this.width;W++){W/U.right>1&&(U=l[++L]);var fe=Math.abs(W-U.left),he=Math.abs(W-U.right),de=Math.min(fe,he);this.data[A+W]=Math.max(0,Math.min(255,(U.isDash?de:-de)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,p=2*c+1;if(this.nextRow+p>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var b=0,w=0;w<l.length;w++)b+=l[w];if(b!==0){var A=this.width/b,L=this.getDashRanges(l,this.width,A);f?this.addRoundDash(L,A,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=p,this.dirty=!0,U},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Rt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var p=this.workerPool.acquire(this.id),b=0;b<p.length;b++){var w=new l.Actor(p[b],c,this.id);w.name="Worker "+b,this.actors.push(w)}};function yr(l,f,c){var p=function(b,w){if(b)return c(b);if(w){var A=v.pick(v.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(A.vectorLayers=w.vector_layers,A.vectorLayerIds=A.vectorLayers.map(function(L){return L.id})),A.tiles=f.canonicalizeTileset(A,l.url),c(null,A)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),p):v.browser.frame(function(){return p(null,l)})}Rt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(p,b){p.send(l,f,b)},c=c||function(){})},Rt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Rt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Rt.Actor=v.Actor;var Rr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Rr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Rr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),p=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=p&&l.y<w};var Hr=function(l){function f(c,p,b,w){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(p,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new v.ErrorEvent(p)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Rr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var p=this;return this.setSourceProperty(function(){p._options.tiles=c}),this},f.prototype.setUrl=function(c){var p=this;return this.setSourceProperty(function(){p.url=c,p._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(b,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function A(L,U){return delete c.request,c.aborted?p(null):L&&L.status!==404?p(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",w,A.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,A.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Te=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},p),v.extend(this,v.pick(p,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new v.ErrorEvent(p)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Rr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,p){var b=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(w,v.ResourceType.Tile),function(A,L){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(A)c.state="errored",p(A);else if(L){b.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=b.map.painter.context,W=U.gl;c.texture=b.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new v.Texture(U,L,W.RGBA,{useMipmap:!0}),c.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&W.texParameterf(W.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(b.dispatcher),p(null)}})},f.prototype.abortTile=function(c,p){c.request&&(c.request.cancel(),delete c.request),p()},f.prototype.unloadTile=function(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ye=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(A,L){A&&(c.state="errored",p(A)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",p(null))}c.request=v.getImage(this.map._requestManager.transformRequest(b,v.ResourceType.Tile),function(A,L){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(A)c.state="errored",p(A);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=v.window.ImageBitmap&&L instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?L:v.browser.getImageData(L,1),W={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",W,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var p=c.canonical,b=Math.pow(2,p.z),w=(p.x-1+b)%b,A=p.x===0?c.wrap-1:c.wrap,L=(p.x+1+b)%b,U=p.x+1===b?c.wrap+1:c.wrap,W={};return W[new v.OverscaledTileID(c.overscaledZ,A,p.z,w,p.y).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,U,p.z,L,p.y).key]={backfilled:!1},p.y>0&&(W[new v.OverscaledTileID(c.overscaledZ,A,p.z,w,p.y-1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,U,p.z,L,p.y-1).key]={backfilled:!1}),p.y+1<b&&(W[new v.OverscaledTileID(c.overscaledZ,A,p.z,w,p.y+1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,U,p.z,L,p.y+1).key]={backfilled:!1}),W},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Te),ke=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(w),this._data=p.data,this._options=v.extend({},p),this._collectResourceTiming=p.collectResourceTiming,this._resourceTiming=[],p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;var A=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*A,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*A,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?Math.min(p.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:v.EXTENT,radius:(p.clusterRadius||50)*A,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)c.fire(new v.ErrorEvent(p));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var p=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)p.fire(new v.ErrorEvent(b));else{var w={dataType:"source",sourceDataType:"content"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(w.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new v.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},p),this},f.prototype.getClusterChildren=function(c,p){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},p),this},f.prototype.getClusterLeaves=function(c,p,b,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:p,offset:b},w),this},f.prototype._updateWorkerData=function(c){var p=this;this._loaded=!1;var b=v.extend({},this.workerOptions),w=this._data;typeof w=="string"?(b.request=this.map._requestManager.transformRequest(v.browser.resolveURL(w),v.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(w),this.actor.send(this.type+".loadData",b,function(A,L){p._removed||L&&L.abandoned||(p._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[p.id]&&(p._resourceTiming=L.resourceTiming[p.id].slice(0)),p.actor.send(p.type+".coalesce",{source:b.source},null),c(A))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,p){var b=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(A,L){return delete c.request,c.unloadVectorData(),c.aborted?p(null):A?p(A):(c.loadVectorData(L,b.map.painter,w==="reloadTile"),p(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),At=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,p){var b=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(w,A){b._loaded=!0,w?b.fire(new v.ErrorEvent(w)):A&&(b.image=A,c&&(b.coordinates=c),p&&p(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var p=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){p.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var p=this;this.coordinates=c;var b=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(A){for(var L=1/0,U=1/0,W=-1/0,fe=-1/0,he=0,de=A;he<de.length;he+=1){var Le=de[he];L=Math.min(L,Le.x),U=Math.min(U,Le.y),W=Math.max(W,Le.x),fe=Math.max(fe,Le.y)}var Oe=Math.max(W-L,fe-U),Xe=Math.max(0,Math.floor(-Math.log(Oe)/Math.LN2)),Ae=Math.pow(2,Xe);return new v.CanonicalTileID(Xe,Math.floor((L+W)/2*Ae),Math.floor((U+fe)/2*Ae))}(b),this.minzoom=this.maxzoom=this.tileID.z;var w=b.map(function(A){return p.tileID.getTilePoint(A)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ft=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.roundZoom=!0,this.type="video",this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var p=this.options;this.urls=[];for(var b=0,w=p.urls;b<w.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(w[b],v.ResourceType.Source).url);v.getVideo(this.urls,function(A,L){c._loaded=!0,A?c.fire(new v.ErrorEvent(A)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var p=this.video.seekable;c<p.start(0)||c>p.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+p.start(0)+" and "+p.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(gt),qt=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(function(A){return!Array.isArray(A)||A.length!==2||A.some(function(L){return typeof L!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var p=this.map.painter.context,b=p.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(p,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var A=this.tiles[w];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,p=[this.canvas.width,this.canvas.height];c<p.length;c+=1){var b=p[c];if(isNaN(b)||b<=0)return!0}return!1},f}(gt),Cr={vector:Hr,raster:Te,"raster-dem":Ye,geojson:ke,video:Ft,image:gt,canvas:qt};function Hn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function hn(l,f,c,p,b,w){var A=function(Xe,Ae,He){if(Xe)for(var tt=0,xt=Xe;tt<xt.length;tt+=1){var Gt=Ae[xt[tt]];if(Gt&&Gt.source===He&&Gt.type==="fill-extrusion")return!0}else for(var Nt in Ae){var er=Ae[Nt];if(er.source===He&&er.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(p,L,A);U.sort(Ki);for(var W=[],fe=0,he=U;fe<he.length;fe+=1){var de=he[fe];W.push({wrappedTileID:de.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(f,c,l._state,de.queryGeometry,de.cameraQueryGeometry,de.scale,b,w,L,Hn(l.transform,de.tileID))})}var Le=function(Xe){for(var Ae={},He={},tt=0,xt=Xe;tt<xt.length;tt+=1){var Gt=xt[tt],Nt=Gt.queryResults,er=Gt.wrappedTileID,mr=He[er]=He[er]||{};for(var zr in Nt)for(var Br=Nt[zr],sn=mr[zr]=mr[zr]||{},kn=Ae[zr]=Ae[zr]||[],Dn=0,Cn=Br;Dn<Cn.length;Dn+=1){var Fi=Cn[Dn];sn[Fi.featureIndex]||(sn[Fi.featureIndex]=!0,kn.push(Fi))}}return Ae}(W);for(var Oe in Le)Le[Oe].forEach(function(Xe){var Ae=Xe.feature,He=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=He});return Le}function Ki(l,f){var c=l.tileID,p=f.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}var Bn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Bn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var p=c[f];p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value)}return this.data={},this.order=[],this},Bn.prototype.add=function(l,f,c){var p=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){p.remove(l,w)},c)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){var A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this},Bn.prototype.has=function(l){return l.wrapped().key in this.data},Bn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Bn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Bn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Bn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Bn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,p=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][p];return this.data[c].splice(p,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},Bn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Bn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var p=0,b=this.data[c];p<b.length;p+=1){var w=b[p];l(w.value)||f.push(w)}for(var A=0,L=f;A<L.length;A+=1){var U=L[A];this.remove(U.value.tileID,U)}};var Gn=function(l,f,c){this.context=l;var p=l.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Gn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Gn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var hi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Wn=function(l,f,c,p){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=p,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Wn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Wn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Wn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var p=f.attributes[this.attributes[c].name];p!==void 0&&l.enableVertexAttribArray(p)}},Wn.prototype.setVertexAttribPointers=function(l,f,c){for(var p=0;p<this.attributes.length;p++){var b=this.attributes[p],w=f.attributes[b.name];w!==void 0&&l.vertexAttribPointer(w,b.components,l[hi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var si=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};si.prototype.get=function(){return this.current},si.prototype.set=function(l){},si.prototype.getDefault=function(){return this.default},si.prototype.setDefault=function(){this.set(this.default)};var aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(si),Ri=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(si),Si=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(si),Vi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(si),ua=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(si),wi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(si),xa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(si),An=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(si),yi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(si),zi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(si),$i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(si),ja=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(si),me=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}},f}(si),Ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(si),Va=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(si),fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(si),zt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}},f}(si),ir=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(si),Ir=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(si),I=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(si),sr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(si),On=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(si),ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(si),Zn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(si),nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(si),Ti=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(si),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(si),Ya=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(si),hs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(si),va=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(si),Ra=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(si),Sa=function(l){function f(c,p){l.call(this,c),this.context=c,this.parent=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(si),V=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Sa),K=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Sa),se=function(l,f,c,p){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,b),p&&(this.depthAttachment=new K(l,b))};se.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,f,c){this.func=l,this.mask=f,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Ie=function(l,f,c,p,b,w){this.test=l,this.ref=f,this.mask=c,this.fail=p,this.depthFail=b,this.pass=w};Ie.disabled=new Ie({func:519,mask:0},0,0,7680,7680,7680);var Ve=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ve.disabled=new Ve(Ve.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ve.unblended=new Ve(Ve.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ve.alphaBlended=new Ve([1,771],v.Color.transparent,[!0,!0,!0,!0]);var rt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};rt.disabled=new rt(!1,1029,2305),rt.backCCW=new rt(!0,1029,2305);var pe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new aa(this),this.clearDepth=new Ri(this),this.clearStencil=new Si(this),this.colorMask=new Vi(this),this.depthMask=new ua(this),this.stencilMask=new wi(this),this.stencilFunc=new xa(this),this.stencilOp=new An(this),this.stencilTest=new yi(this),this.depthRange=new zi(this),this.depthTest=new $i(this),this.depthFunc=new ja(this),this.blend=new me(this),this.blendFunc=new Ln(this),this.blendColor=new Va(this),this.blendEquation=new fs(this),this.cullFace=new zt(this),this.cullFaceSide=new ir(this),this.frontFace=new Ir(this),this.program=new I(this),this.activeTexture=new sr(this),this.viewport=new On(this),this.bindFramebuffer=new ui(this),this.bindRenderbuffer=new Zn(this),this.bindTexture=new nn(this),this.bindVertexBuffer=new Ti(this),this.bindElementBuffer=new Mi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ya(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new va(this),this.pixelStoreUnpackFlipY=new Ra(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};pe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},pe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},pe.prototype.createIndexBuffer=function(l,f){return new Gn(this,l,f)},pe.prototype.createVertexBuffer=function(l,f,c){return new Wn(this,l,f,c)},pe.prototype.createRenderbuffer=function(l,f,c){var p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},pe.prototype.createFramebuffer=function(l,f,c){return new se(this,l,f,c)},pe.prototype.clear=function(l){var f=l.color,c=l.depth,p=this.gl,b=0;f&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p.clear(b)},pe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},pe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},pe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},pe.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Ve.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},pe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var De=function(l){function f(c,p,b){var w=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(A){A.dataType==="source"&&A.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(A,L,U,W){var fe=new Cr[L.type](A,L,U,W);if(fe.id!==A)throw new Error("Expected Source id to be "+A+" instead of "+fe.id);return v.bindAll(["load","abort","unload","serialize","prepare"],fe),fe}(c,p,b,this),this._tiles={},this._cache=new Bn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var p=this._tiles[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,p){return this._source.loadTile(c,p)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var p in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[p];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(yt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var p=this,b=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&b.push(this._tiles[w]);return c?b.sort(function(A,L){var U=A.tileID,W=L.tileID,fe=new v.Point(U.canonical.x,U.canonical.y)._rotate(p.transform.angle),he=new v.Point(W.canonical.x,W.canonical.y)._rotate(p.transform.angle);return U.overscaledZ-W.overscaledZ||he.y-fe.y||he.x-fe.x}).map(function(A){return A.tileID.key}):b.map(function(A){return A.tileID}).sort(yt).map(function(A){return A.key})},f.prototype.hasRenderableParent=function(c){var p=this.findLoadedParent(c,0);return!!p&&this._isIdRenderable(p.tileID.key)},f.prototype._isIdRenderable=function(c,p){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(p||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,p){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=p),this._loadTile(b,this._tileLoaded.bind(this,b,c,p)))},f.prototype._tileLoaded=function(c,p,b,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new v.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(p,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var p=this.getRenderableIds(),b=0;b<p.length;b++){var w=p[b];if(c.neighboringTiles&&c.neighboringTiles[w]){var A=this.getTileByID(w);L(c,A),L(A,c)}}function L(U,W){U.needsHillshadePrepare=!0;var fe=W.tileID.canonical.x-U.tileID.canonical.x,he=W.tileID.canonical.y-U.tileID.canonical.y,de=Math.pow(2,U.tileID.canonical.z),Le=W.tileID.key;fe===0&&he===0||Math.abs(he)>1||(Math.abs(fe)>1&&(Math.abs(fe+de)===1?fe+=de:Math.abs(fe-de)===1&&(fe-=de)),W.dem&&U.dem&&(U.dem.backfillBorder(W.dem,fe,he),U.neighboringTiles&&U.neighboringTiles[Le]&&(U.neighboringTiles[Le].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,p,b,w){for(var A in this._tiles){var L=this._tiles[A];if(!(w[A]||!L.hasData()||L.tileID.overscaledZ<=p||L.tileID.overscaledZ>b)){for(var U=L.tileID;L&&L.tileID.overscaledZ>p+1;){var W=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[W.key])&&L.hasData()&&(U=W)}for(var fe=U;fe.overscaledZ>p;)if(c[(fe=fe.scaledTo(fe.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,p){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=p?b:null}for(var w=c.overscaledZ-1;w>=p;w--){var A=c.scaledTo(w),L=this._getLoadedTile(A);if(L)return L}},f.prototype._getLoadedTile=function(c){var p=this._tiles[c.key];return p&&p.hasData()?p:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var p=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(p*b*5),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)},f.prototype.handleWrapJump=function(c){var p=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,p){var b={};for(var w in this._tiles){var A=this._tiles[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+p),b[A.tileID.key]=A}for(var L in this._tiles=b,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var p=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(mr){return new v.OverscaledTileID(mr.canonical.z,mr.wrap,mr.canonical.z,mr.canonical.x,mr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(mr){return p._source.hasTile(mr)}))):b=[];var w=c.coveringZoomLevel(this._source),A=Math.max(w-f.maxOverzooming,this._source.minzoom),L=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(b,w);if(vr(this._source.type)){for(var W={},fe={},he=0,de=Object.keys(U);he<de.length;he+=1){var Le=de[he],Oe=U[Le],Xe=this._tiles[Le];if(Xe&&!(Xe.fadeEndTime&&Xe.fadeEndTime<=v.browser.now())){var Ae=this.findLoadedParent(Oe,A);Ae&&(this._addTile(Ae.tileID),W[Ae.tileID.key]=Ae.tileID),fe[Le]=Oe}}for(var He in this._retainLoadedChildren(fe,w,L,U),W)U[He]||(this._coveredTiles[He]=!0,U[He]=W[He])}for(var tt in U)this._tiles[tt].clearFadeHold();for(var xt=0,Gt=v.keysDifference(this._tiles,U);xt<Gt.length;xt+=1){var Nt=Gt[xt],er=this._tiles[Nt];er.hasSymbolBuckets&&!er.holdingForFade()?er.setHoldDuration(this.map._fadeDuration):er.hasSymbolBuckets&&!er.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,p){for(var b={},w={},A=Math.max(p-f.maxOverzooming,this._source.minzoom),L=Math.max(p+f.maxUnderzooming,this._source.minzoom),U={},W=0,fe=c;W<fe.length;W+=1){var he=fe[W],de=this._addTile(he);b[he.key]=he,de.hasData()||p<this._source.maxzoom&&(U[he.key]=he)}this._retainLoadedChildren(U,p,L,b);for(var Le=0,Oe=c;Le<Oe.length;Le+=1){var Xe=Oe[Le],Ae=this._tiles[Xe.key];if(!Ae.hasData()){if(p+1>this._source.maxzoom){var He=Xe.children(this._source.maxzoom)[0],tt=this.getTile(He);if(tt&&tt.hasData()){b[He.key]=He;continue}}else{var xt=Xe.children(this._source.maxzoom);if(b[xt[0].key]&&b[xt[1].key]&&b[xt[2].key]&&b[xt[3].key])continue}for(var Gt=Ae.wasRequested(),Nt=Xe.overscaledZ-1;Nt>=A;--Nt){var er=Xe.scaledTo(Nt);if(w[er.key]||(w[er.key]=!0,!(Ae=this.getTile(er))&&Gt&&(Ae=this._addTile(er)),Ae&&(b[er.key]=er,Gt=Ae.wasRequested(),Ae.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var p=[],b=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){b=this._loadedParentTiles[w.key];break}p.push(w.key);var A=w.scaledTo(w.overscaledZ-1);if(b=this._getLoadedTile(A))break;w=A}for(var L=0,U=p;L<U.length;L+=1)this._loadedParentTiles[U[L]]=b}},f.prototype._addTile=function(c){var p=this._tiles[c.key];if(p)return p;(p=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,p),p.tileID=c,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,p)));var b=Boolean(p);return b||(p=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,c.key,p.state))),p?(p.uses++,this._tiles[c.key]=p,b||this._source.fire(new v.Event("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null},f.prototype._setTileReloadTimer=function(c,p){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=p.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},w))},f.prototype._removeTile=function(c){var p=this._tiles[c];p&&(p.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,p,b){var w=this,A=[],L=this.transform;if(!L)return A;for(var U=b?L.getCameraQueryGeometry(c):c,W=c.map(function(Nt){return L.pointCoordinate(Nt)}),fe=U.map(function(Nt){return L.pointCoordinate(Nt)}),he=this.getIds(),de=1/0,Le=1/0,Oe=-1/0,Xe=-1/0,Ae=0,He=fe;Ae<He.length;Ae+=1){var tt=He[Ae];de=Math.min(de,tt.x),Le=Math.min(Le,tt.y),Oe=Math.max(Oe,tt.x),Xe=Math.max(Xe,tt.y)}for(var xt=function(Nt){var er=w._tiles[he[Nt]];if(!er.holdingForFade()){var mr=er.tileID,zr=Math.pow(2,L.zoom-er.tileID.overscaledZ),Br=p*er.queryPadding*v.EXTENT/er.tileSize/zr,sn=[mr.getTilePoint(new v.MercatorCoordinate(de,Le)),mr.getTilePoint(new v.MercatorCoordinate(Oe,Xe))];if(sn[0].x-Br<v.EXTENT&&sn[0].y-Br<v.EXTENT&&sn[1].x+Br>=0&&sn[1].y+Br>=0){var kn=W.map(function(Cn){return mr.getTilePoint(Cn)}),Dn=fe.map(function(Cn){return mr.getTilePoint(Cn)});A.push({tile:er,tileID:mr,queryGeometry:kn,cameraQueryGeometry:Dn,scale:zr})}}},Gt=0;Gt<he.length;Gt++)xt(Gt);return A},f.prototype.getVisibleCoordinates=function(c){for(var p=this,b=this.getRenderableIds(c).map(function(U){return p._tiles[U].tileID}),w=0,A=b;w<A.length;w+=1){var L=A[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(vr(this._source.type))for(var c in this._tiles){var p=this._tiles[c];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,p,b){this._state.updateState(c=c||"_geojsonTileLayer",p,b)},f.prototype.removeFeatureState=function(c,p,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",p,b)},f.prototype.getFeatureState=function(c,p){return this._state.getState(c=c||"_geojsonTileLayer",p)},f.prototype.setDependencies=function(c,p,b){var w=this._tiles[c];w&&w.setDependencies(p,b)},f.prototype.reloadTilesForDependencies=function(c,p){for(var b in this._tiles)this._tiles[b].hasDependency(c,p)&&this._reloadTile(b,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,p)})},f}(v.Evented);function yt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),p=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||p-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function vr(l){return l==="raster"||l==="image"||l==="video"}function Lt(){return new v.window.Worker(rc.workerUrl)}De.maxOverzooming=10,De.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",gr=function(){this.active={}};gr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<gr.workerCount;)this.workers.push(new Lt);return this.active[l]=!0,this.workers.slice()},gr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},gr.prototype.isPreloaded=function(){return!!this.active[Dt]},gr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,ln=Math.floor(v.browser.hardwareConcurrency/2);function Tt(){return bn||(bn=new gr),bn}function on(l,f){var c={};for(var p in l)p!=="ref"&&(c[p]=l[p]);return v.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Vr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var p=0;p<l.length;p++)"ref"in l[p]&&(l[p]=on(l[p],f[l[p].ref]));return l}gr.workerCount=Math.max(Math.min(ln,6),1);var Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ii(l,f,c){c.push({command:Wr.addSource,args:[l,f[l]]})}function en(l,f,c){f.push({command:Wr.removeSource,args:[l]}),c[l]=!0}function Ci(l,f,c,p){en(l,c,p),ii(l,f,c)}function ta(l,f,c){var p;for(p in l[c])if(l[c].hasOwnProperty(p)&&p!=="data"&&!v.deepEqual(l[c][p],f[c][p]))return!1;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!v.deepEqual(l[c][p],f[c][p]))return!1;return!0}function gi(l,f,c,p,b,w){var A;for(A in f=f||{},l=l||{})l.hasOwnProperty(A)&&(v.deepEqual(l[A],f[A])||c.push({command:w,args:[p,A,f[A],b]}));for(A in f)f.hasOwnProperty(A)&&!l.hasOwnProperty(A)&&(v.deepEqual(l[A],f[A])||c.push({command:w,args:[p,A,f[A],b]}))}function Pi(l){return l.id}function _i(l,f){return l[f.id]=f,l}var Jn=function(l,f){this.reset(l,f)};Jn.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Jn.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],p=l*this.paddedLength+this.padding;c<p&&f<this._distances.length;)c=this._distances[++f];var b=f-1,w=this._distances[b],A=c-w,L=A>0?(p-w)/A:0;return this.points[b].mult(1-L).add(this.points[f].mult(L))};var Xi=function(l,f,c){var p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function La(l,f,c,p,b){var w=v.create();return f?(v.scale(w,w,[1/b,1/b,1]),c||v.rotateZ(w,w,p.angle)):v.multiply(w,p.labelPlaneMatrix,l),w}function oa(l,f,c,p,b){if(f){var w=v.clone(l);return v.scale(w,w,[b,b,1]),c||v.rotateZ(w,w,-p.angle),w}return p.glCoordMatrix}function Ii(l,f){var c=[l.x,l.y,0,1];Ba(c,c,f);var p=c[3];return{point:new v.Point(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Gi(l,f){return .5+l/f*.5}function Na(l,f){var c=l[0]/l[3],p=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&p>=-f[1]&&p<=f[1]}function tu(l,f,c,p,b,w,A,L){var U=p?l.textSizeData:l.iconSizeData,W=v.evaluateSizeForZoom(U,c.transform.zoom),fe=[256/c.width*2+1,256/c.height*2+1],he=p?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;he.clear();for(var de=l.lineVertexArray,Le=p?l.text.placedSymbolArray:l.icon.placedSymbolArray,Oe=c.transform.width/c.transform.height,Xe=!1,Ae=0;Ae<Le.length;Ae++){var He=Le.get(Ae);if(He.hidden||He.writingMode===v.WritingMode.vertical&&!Xe)fo(He.numGlyphs,he);else{Xe=!1;var tt=[He.anchorX,He.anchorY,0,1];if(v.transformMat4(tt,tt,f),Na(tt,fe)){var xt=Gi(c.transform.cameraToCenterDistance,tt[3]),Gt=v.evaluateSizeForFeature(U,W,He),Nt=A?Gt/xt:Gt*xt,er=new v.Point(He.anchorX,He.anchorY),mr=Ii(er,b).point,zr={},Br=ys(He,Nt,!1,L,f,b,w,l.glyphOffsetArray,de,he,mr,er,zr,Oe);Xe=Br.useVertical,(Br.notEnoughRoom||Xe||Br.needsFlipping&&ys(He,Nt,!0,L,f,b,w,l.glyphOffsetArray,de,he,mr,er,zr,Oe).notEnoughRoom)&&fo(He.numGlyphs,he)}else fo(He.numGlyphs,he)}}p?l.text.dynamicLayoutVertexBuffer.updateData(he):l.icon.dynamicLayoutVertexBuffer.updateData(he)}function wa(l,f,c,p,b,w,A,L,U,W,fe){var he=L.glyphStartIndex+L.numGlyphs,de=L.lineStartIndex,Le=L.lineStartIndex+L.lineLength,Oe=f.getoffsetX(L.glyphStartIndex),Xe=f.getoffsetX(he-1),Ae=ra(l*Oe,c,p,b,w,A,L.segment,de,Le,U,W,fe);if(!Ae)return null;var He=ra(l*Xe,c,p,b,w,A,L.segment,de,Le,U,W,fe);return He?{first:Ae,last:He}:null}function Ca(l,f,c,p){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*p?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ys(l,f,c,p,b,w,A,L,U,W,fe,he,de,Le){var Oe,Xe=f/24,Ae=l.lineOffsetX*Xe,He=l.lineOffsetY*Xe;if(l.numGlyphs>1){var tt=l.glyphStartIndex+l.numGlyphs,xt=l.lineStartIndex,Gt=l.lineStartIndex+l.lineLength,Nt=wa(Xe,L,Ae,He,c,fe,he,l,U,w,de);if(!Nt)return{notEnoughRoom:!0};var er=Ii(Nt.first.point,A).point,mr=Ii(Nt.last.point,A).point;if(p&&!c){var zr=Ca(l.writingMode,er,mr,Le);if(zr)return zr}Oe=[Nt.first];for(var Br=l.glyphStartIndex+1;Br<tt-1;Br++)Oe.push(ra(Xe*L.getoffsetX(Br),Ae,He,c,fe,he,l.segment,xt,Gt,U,w,de));Oe.push(Nt.last)}else{if(p&&!c){var sn=Ii(he,b).point,kn=l.lineStartIndex+l.segment+1,Dn=new v.Point(U.getx(kn),U.gety(kn)),Cn=Ii(Dn,b),Fi=Cn.signedDistanceFromCamera>0?Cn.point:ps(he,Dn,sn,1,b),$r=Ca(l.writingMode,sn,Fi,Le);if($r)return $r}var ai=ra(Xe*L.getoffsetX(l.glyphStartIndex),Ae,He,c,fe,he,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,de);if(!ai)return{notEnoughRoom:!0};Oe=[ai]}for(var ri=0,qn=Oe;ri<qn.length;ri+=1){var jn=qn[ri];v.addDynamicAttributes(W,jn.point,jn.angle)}return{}}function ps(l,f,c,p,b){var w=Ii(l.add(l.sub(f)._unit()),b).point,A=c.sub(w);return c.add(A._mult(p/A.mag()))}function ra(l,f,c,p,b,w,A,L,U,W,fe,he){var de=p?l-f:l+f,Le=de>0?1:-1,Oe=0;p&&(Le*=-1,Oe=Math.PI),Le<0&&(Oe+=Math.PI);for(var Xe=Le>0?L+A:L+A+1,Ae=b,He=b,tt=0,xt=0,Gt=Math.abs(de),Nt=[];tt+xt<=Gt;){if((Xe+=Le)<L||Xe>=U)return null;if(He=Ae,Nt.push(Ae),(Ae=he[Xe])===void 0){var er=new v.Point(W.getx(Xe),W.gety(Xe)),mr=Ii(er,fe);if(mr.signedDistanceFromCamera>0)Ae=he[Xe]=mr.point;else{var zr=Xe-Le;Ae=ps(tt===0?w:new v.Point(W.getx(zr),W.gety(zr)),er,He,Gt-tt+1,fe)}}tt+=xt,xt=He.dist(Ae)}var Br=(Gt-tt)/xt,sn=Ae.sub(He),kn=sn.mult(Br)._add(He);kn._add(sn._unit()._perp()._mult(c*Le));var Dn=Oe+Math.atan2(Ae.y-He.y,Ae.x-He.x);return Nt.push(kn),{point:kn,angle:Dn,path:Nt}}Xi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xi.prototype.insert=function(l,f,c,p,b){this._forEachCell(f,c,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(b)},Xi.prototype.insertCircle=function(l,f,c,p){this._forEachCell(f-p,c-p,f+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(p)},Xi.prototype._insertBoxCell=function(l,f,c,p,b,w){this.boxCells[b].push(w)},Xi.prototype._insertCircleCell=function(l,f,c,p,b,w){this.circleCells[b].push(w)},Xi.prototype._query=function(l,f,c,p,b,w){if(c<0||l>this.width||p<0||f>this.height)return!b&&[];var A=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=p){if(b)return!0;for(var L=0;L<this.boxKeys.length;L++)A.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var W=this.circles[3*U],fe=this.circles[3*U+1],he=this.circles[3*U+2];A.push({key:this.circleKeys[U],x1:W-he,y1:fe-he,x2:W+he,y2:fe+he})}return w?A.filter(w):A}return this._forEachCell(l,f,c,p,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?A.length>0:A},Xi.prototype._queryCircle=function(l,f,c,p,b){var w=l-c,A=l+c,L=f-c,U=f+c;if(A<0||w>this.width||U<0||L>this.height)return!p&&[];var W=[];return this._forEachCell(w,L,A,U,this._queryCellCircle,W,{hitTest:p,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),p?W.length>0:W},Xi.prototype.query=function(l,f,c,p,b){return this._query(l,f,c,p,!1,b)},Xi.prototype.hitTest=function(l,f,c,p,b){return this._query(l,f,c,p,!0,b)},Xi.prototype.hitTestCircle=function(l,f,c,p){return this._queryCircle(l,f,c,!0,p)},Xi.prototype._queryCell=function(l,f,c,p,b,w,A,L){var U=A.seenUids,W=this.boxCells[b];if(W!==null)for(var fe=this.bboxes,he=0,de=W;he<de.length;he+=1){var Le=de[he];if(!U.box[Le]){U.box[Le]=!0;var Oe=4*Le;if(l<=fe[Oe+2]&&f<=fe[Oe+3]&&c>=fe[Oe+0]&&p>=fe[Oe+1]&&(!L||L(this.boxKeys[Le]))){if(A.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Le],x1:fe[Oe],y1:fe[Oe+1],x2:fe[Oe+2],y2:fe[Oe+3]})}}}var Xe=this.circleCells[b];if(Xe!==null)for(var Ae=this.circles,He=0,tt=Xe;He<tt.length;He+=1){var xt=tt[He];if(!U.circle[xt]){U.circle[xt]=!0;var Gt=3*xt;if(this._circleAndRectCollide(Ae[Gt],Ae[Gt+1],Ae[Gt+2],l,f,c,p)&&(!L||L(this.circleKeys[xt]))){if(A.hitTest)return w.push(!0),!0;var Nt=Ae[Gt],er=Ae[Gt+1],mr=Ae[Gt+2];w.push({key:this.circleKeys[xt],x1:Nt-mr,y1:er-mr,x2:Nt+mr,y2:er+mr})}}}},Xi.prototype._queryCellCircle=function(l,f,c,p,b,w,A,L){var U=A.circle,W=A.seenUids,fe=this.boxCells[b];if(fe!==null)for(var he=this.bboxes,de=0,Le=fe;de<Le.length;de+=1){var Oe=Le[de];if(!W.box[Oe]){W.box[Oe]=!0;var Xe=4*Oe;if(this._circleAndRectCollide(U.x,U.y,U.radius,he[Xe+0],he[Xe+1],he[Xe+2],he[Xe+3])&&(!L||L(this.boxKeys[Oe])))return w.push(!0),!0}}var Ae=this.circleCells[b];if(Ae!==null)for(var He=this.circles,tt=0,xt=Ae;tt<xt.length;tt+=1){var Gt=xt[tt];if(!W.circle[Gt]){W.circle[Gt]=!0;var Nt=3*Gt;if(this._circlesCollide(He[Nt],He[Nt+1],He[Nt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Gt])))return w.push(!0),!0}}},Xi.prototype._forEachCell=function(l,f,c,p,b,w,A,L){for(var U=this._convertToXCellCoord(l),W=this._convertToYCellCoord(f),fe=this._convertToXCellCoord(c),he=this._convertToYCellCoord(p),de=U;de<=fe;de++)for(var Le=W;Le<=he;Le++)if(b.call(this,l,f,c,p,this.xCellCount*Le+de,w,A,L))return},Xi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Xi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Xi.prototype._circlesCollide=function(l,f,c,p,b,w){var A=p-l,L=b-f,U=c+w;return U*U>A*A+L*L},Xi.prototype._circleAndRectCollide=function(l,f,c,p,b,w,A){var L=(w-p)/2,U=Math.abs(l-(p+L));if(U>L+c)return!1;var W=(A-b)/2,fe=Math.abs(f-(b+W));if(fe>W+c)return!1;if(U<=L||fe<=W)return!0;var he=U-L,de=fe-W;return he*he+de*de<=c*c};var Bu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fo(l,f){for(var c=0;c<l;c++){var p=f.length;f.resize(p+4),f.float32.set(Bu,3*p)}}function Ba(l,f,c){var p=f[0],b=f[1];return l[0]=c[0]*p+c[4]*b+c[12],l[1]=c[1]*p+c[5]*b+c[13],l[3]=c[3]*p+c[7]*b+c[15],l}var eo=function(l,f,c){f===void 0&&(f=new Xi(l.width+200,l.height+200,25)),c===void 0&&(c=new Xi(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Ji(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}eo.prototype.placeCollisionBox=function(l,f,c,p,b){var w=this.projectAndGetPerspectiveRatio(p,l.anchorPointX,l.anchorPointY),A=c*w.perspectiveRatio,L=l.x1*A+w.point.x,U=l.y1*A+w.point.y,W=l.x2*A+w.point.x,fe=l.y2*A+w.point.y;return!this.isInsideGrid(L,U,W,fe)||!f&&this.grid.hitTest(L,U,W,fe,b)?{box:[],offscreen:!1}:{box:[L,U,W,fe],offscreen:this.isOffscreen(L,U,W,fe)}},eo.prototype.placeCollisionCircles=function(l,f,c,p,b,w,A,L,U,W,fe,he,de){var Le=[],Oe=new v.Point(f.anchorX,f.anchorY),Xe=Ii(Oe,w),Ae=Gi(this.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),He=(W?b/Ae:b*Ae)/v.ONE_EM,tt=Ii(Oe,A).point,xt=wa(He,p,f.lineOffsetX*He,f.lineOffsetY*He,!1,tt,Oe,f,c,A,{}),Gt=!1,Nt=!1,er=!0;if(xt){for(var mr=.5*he*Ae+de,zr=new v.Point(-100,-100),Br=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),sn=new Jn,kn=xt.first,Dn=xt.last,Cn=[],Fi=kn.path.length-1;Fi>=1;Fi--)Cn.push(kn.path[Fi]);for(var $r=1;$r<Dn.path.length;$r++)Cn.push(Dn.path[$r]);var ai=2.5*mr;if(L){var ri=Cn.map(function(su){return Ii(su,L)});Cn=ri.some(function(su){return su.signedDistanceFromCamera<=0})?[]:ri.map(function(su){return su.point})}var qn=[];if(Cn.length>0){for(var jn=Cn[0].clone(),pi=Cn[0].clone(),Xn=1;Xn<Cn.length;Xn++)jn.x=Math.min(jn.x,Cn[Xn].x),jn.y=Math.min(jn.y,Cn[Xn].y),pi.x=Math.max(pi.x,Cn[Xn].x),pi.y=Math.max(pi.y,Cn[Xn].y);qn=jn.x>=zr.x&&pi.x<=Br.x&&jn.y>=zr.y&&pi.y<=Br.y?[Cn]:pi.x<zr.x||jn.x>Br.x||pi.y<zr.y||jn.y>Br.y?[]:v.clipLine([Cn],zr.x,zr.y,Br.x,Br.y)}for(var Vn=0,qi=qn;Vn<qi.length;Vn+=1){var Li;sn.reset(qi[Vn],.25*mr),Li=sn.length<=.5*mr?1:Math.ceil(sn.paddedLength/ai)+1;for(var vo=0;vo<Li;vo++){var Oo=vo/Math.max(Li-1,1),Ia=sn.lerp(Oo),mo=Ia.x+100,zs=Ia.y+100;Le.push(mo,zs,mr,0);var xs=mo-mr,$u=zs-mr,rs=mo+mr,Eo=zs+mr;if(er=er&&this.isOffscreen(xs,$u,rs,Eo),Nt=Nt||this.isInsideGrid(xs,$u,rs,Eo),!l&&this.grid.hitTestCircle(mo,zs,mr,fe)&&(Gt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Gt}}}}return{circles:!U&&Gt||!Nt?[]:Le,offscreen:er,collisionDetected:Gt}},eo.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,p=1/0,b=-1/0,w=-1/0,A=0,L=l;A<L.length;A+=1){var U=L[A],W=new v.Point(U.x+100,U.y+100);c=Math.min(c,W.x),p=Math.min(p,W.y),b=Math.max(b,W.x),w=Math.max(w,W.y),f.push(W)}for(var fe={},he={},de=0,Le=this.grid.query(c,p,b,w).concat(this.ignoredGrid.query(c,p,b,w));de<Le.length;de+=1){var Oe=Le[de],Xe=Oe.key;if(fe[Xe.bucketInstanceId]===void 0&&(fe[Xe.bucketInstanceId]={}),!fe[Xe.bucketInstanceId][Xe.featureIndex]){var Ae=[new v.Point(Oe.x1,Oe.y1),new v.Point(Oe.x2,Oe.y1),new v.Point(Oe.x2,Oe.y2),new v.Point(Oe.x1,Oe.y2)];v.polygonIntersectsPolygon(f,Ae)&&(fe[Xe.bucketInstanceId][Xe.featureIndex]=!0,he[Xe.bucketInstanceId]===void 0&&(he[Xe.bucketInstanceId]=[]),he[Xe.bucketInstanceId].push(Xe.featureIndex))}}return he},eo.prototype.insertCollisionBox=function(l,f,c,p,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:b},l[0],l[1],l[2],l[3])},eo.prototype.insertCollisionCircles=function(l,f,c,p,b){for(var w=f?this.ignoredGrid:this.grid,A={bucketInstanceId:c,featureIndex:p,collisionGroupID:b},L=0;L<l.length;L+=4)w.insertCircle(A,l[L],l[L+1],l[L+2])},eo.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var p=[f,c,0,1];return Ba(p,p,l),{point:new v.Point((p[0]/p[3]+1)/2*this.transform.width+100,(-p[1]/p[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}},eo.prototype.isOffscreen=function(l,f,c,p){return c<100||l>=this.screenRightBoundary||p<100||f>this.screenBottomBoundary},eo.prototype.isInsideGrid=function(l,f,c,p){return c>=0&&l<this.gridRightBoundary&&p>=0&&f<this.gridBottomBoundary},eo.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var Go=function(l,f,c,p){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):p&&c?1:0,this.placed=c};Go.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ho=function(l,f,c,p,b){this.text=new Go(l?l.text:null,f,c,b),this.icon=new Go(l?l.icon:null,f,p,b)};Ho.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var zu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},_o=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Wo=function(l,f,c,p,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=b},ma=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function ho(l,f,c,p,b){var w=v.getAnchorAlignment(l),A=-(w.horizontalAlign-.5)*f,L=-(w.verticalAlign-.5)*c,U=v.evaluateVariableOffset(l,p);return new v.Point(A+U[0]*b,L+U[1]*b)}function Xo(l,f,c,p,b,w){var A=l.x1,L=l.x2,U=l.y1,W=l.y2,fe=l.anchorPointX,he=l.anchorPointY,de=new v.Point(f,c);return p&&de._rotate(b?w:-w),{x1:A+de.x,y1:U+de.y,x2:L+de.x,y2:W+de.y,anchorPointX:fe,anchorPointY:he}}ma.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var to=function(l,f,c,p){this.transform=l.clone(),this.collisionIndex=new eo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ma(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}};function ru(l,f,c,p,b){l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0)}to.prototype.getBucketParts=function(l,f,c,p){var b=c.getBucket(f),w=c.latestFeatureIndex;if(b&&w&&f.id===b.layerIds[0]){var A=c.collisionBoxArray,L=b.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),W=c.tileSize/v.EXTENT,fe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),he=L.get("text-pitch-alignment")==="map",de=L.get("text-rotation-alignment")==="map",Le=Ji(c,1,this.transform.zoom),Oe=La(fe,he,de,this.transform,Le),Xe=null;if(he){var Ae=oa(fe,he,de,this.transform,Le);Xe=v.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[b.bucketInstanceId]=new Wo(b.bucketInstanceId,w,b.sourceLayerIndex,b.index,c.tileID);var He={bucket:b,layout:L,posMatrix:fe,textLabelPlaneMatrix:Oe,labelToScreenMatrix:Xe,scale:U,textPixelRatio:W,holdingForFade:c.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(var tt=0,xt=b.sortKeyRanges;tt<xt.length;tt+=1){var Gt=xt[tt];l.push({sortKey:Gt.sortKey,symbolInstanceStart:Gt.symbolInstanceStart,symbolInstanceEnd:Gt.symbolInstanceEnd,parameters:He})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:He})}},to.prototype.attemptAnchorPlacement=function(l,f,c,p,b,w,A,L,U,W,fe,he,de,Le,Oe){var Xe,Ae=[he.textOffset0,he.textOffset1],He=ho(l,c,p,Ae,b),tt=this.collisionIndex.placeCollisionBox(Xo(f,He.x,He.y,w,A,this.transform.angle),fe,L,U,W.predicate);if(!Oe||this.collisionIndex.placeCollisionBox(Xo(Oe,He.x,He.y,w,A,this.transform.angle),fe,L,U,W.predicate).box.length!==0)return tt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[he.crossTileID].anchor),this.variableOffsets[he.crossTileID]={textOffset:Ae,width:c,height:p,anchor:l,textBoxScale:b,prevAnchor:Xe},this.markUsedJustification(de,l,he,Le),de.allowVerticalPlacement&&(this.markUsedOrientation(de,Le,he),this.placedOrientations[he.crossTileID]=Le),{shift:He,placedGlyphBoxes:tt}):void 0},to.prototype.placeLayerBucketPart=function(l,f,c){var p=this,b=l.parameters,w=b.bucket,A=b.layout,L=b.posMatrix,U=b.textLabelPlaneMatrix,W=b.labelToScreenMatrix,fe=b.textPixelRatio,he=b.holdingForFade,de=b.collisionBoxArray,Le=b.partiallyEvaluatedTextSize,Oe=b.collisionGroup,Xe=A.get("text-optional"),Ae=A.get("icon-optional"),He=A.get("text-allow-overlap"),tt=A.get("icon-allow-overlap"),xt=A.get("text-rotation-alignment")==="map",Gt=A.get("text-pitch-alignment")==="map",Nt=A.get("icon-text-fit")!=="none",er=A.get("symbol-z-order")==="viewport-y",mr=He&&(tt||!w.hasIconData()||Ae),zr=tt&&(He||!w.hasTextData()||Xe);!w.collisionArrays&&de&&w.deserializeCollisionBoxes(de);var Br=function($r,ai){if(!f[$r.crossTileID])if(he)p.placements[$r.crossTileID]=new zu(!1,!1,!1);else{var ri,qn=!1,jn=!1,pi=!0,Xn=null,Vn={box:null,offscreen:null},qi={box:null,offscreen:null},Li=null,vo=null,Oo=0,Ia=0,mo=0;ai.textFeatureIndex?Oo=ai.textFeatureIndex:$r.useRuntimeCollisionCircles&&(Oo=$r.featureIndex),ai.verticalTextFeatureIndex&&(Ia=ai.verticalTextFeatureIndex);var zs=ai.textBox;if(zs){var xs=function(na){var Zs=v.WritingMode.horizontal;if(w.allowVerticalPlacement&&!na&&p.prevPlacement){var ns=p.prevPlacement.placedOrientations[$r.crossTileID];ns&&(p.placedOrientations[$r.crossTileID]=ns,p.markUsedOrientation(w,Zs=ns,$r))}return Zs},$u=function(na,Zs){if(w.allowVerticalPlacement&&$r.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var ns=0,is=w.writingModes;ns<is.length&&(is[ns]===v.WritingMode.vertical?(Vn=Zs(),qi=Vn):Vn=na(),!(Vn&&Vn.box&&Vn.box.length));ns+=1);else Vn=na()};if(A.get("text-variable-anchor")){var rs=A.get("text-variable-anchor");if(p.prevPlacement&&p.prevPlacement.variableOffsets[$r.crossTileID]){var Eo=p.prevPlacement.variableOffsets[$r.crossTileID];rs.indexOf(Eo.anchor)>0&&(rs=rs.filter(function(na){return na!==Eo.anchor})).unshift(Eo.anchor)}var su=function(na,Zs,ns){for(var is=na.x2-na.x1,ic=na.y2-na.y1,kc=$r.textBoxScale,of=Nt&&!tt?Zs:null,Ks={box:[],offscreen:!1},ac=He?2*rs.length:rs.length,uu=0;uu<ac;++uu){var ml=p.attemptAnchorPlacement(rs[uu%rs.length],na,is,ic,kc,xt,Gt,fe,L,Oe,uu>=rs.length,$r,w,ns,of);if(ml&&(Ks=ml.placedGlyphBoxes)&&Ks.box&&Ks.box.length){qn=!0,Xn=ml.shift;break}}return Ks};$u(function(){return su(zs,ai.iconBox,v.WritingMode.horizontal)},function(){var na=ai.verticalTextBox;return w.allowVerticalPlacement&&!(Vn&&Vn.box&&Vn.box.length)&&$r.numVerticalGlyphVertices>0&&na?su(na,ai.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Vn&&(qn=Vn.box,pi=Vn.offscreen);var Lc=xs(Vn&&Vn.box);if(!qn&&p.prevPlacement){var nc=p.prevPlacement.variableOffsets[$r.crossTileID];nc&&(p.variableOffsets[$r.crossTileID]=nc,p.markUsedJustification(w,nc.anchor,$r,Lc))}}else{var As=function(na,Zs){var ns=p.collisionIndex.placeCollisionBox(na,He,fe,L,Oe.predicate);return ns&&ns.box&&ns.box.length&&(p.markUsedOrientation(w,Zs,$r),p.placedOrientations[$r.crossTileID]=Zs),ns};$u(function(){return As(zs,v.WritingMode.horizontal)},function(){var na=ai.verticalTextBox;return w.allowVerticalPlacement&&$r.numVerticalGlyphVertices>0&&na?As(na,v.WritingMode.vertical):{box:null,offscreen:null}}),xs(Vn&&Vn.box&&Vn.box.length)}}if(qn=(ri=Vn)&&ri.box&&ri.box.length>0,pi=ri&&ri.offscreen,$r.useRuntimeCollisionCircles){var Ju=w.text.placedSymbolArray.get($r.centerJustifiedTextSymbolIndex),Qu=v.evaluateSizeForFeature(w.textSizeData,Le,Ju),qs=A.get("text-padding");Li=p.collisionIndex.placeCollisionCircles(He,Ju,w.lineVertexArray,w.glyphOffsetArray,Qu,L,U,W,c,Gt,Oe.predicate,$r.collisionCircleDiameter,qs),qn=He||Li.circles.length>0&&!Li.collisionDetected,pi=pi&&Li.offscreen}if(ai.iconFeatureIndex&&(mo=ai.iconFeatureIndex),ai.iconBox){var vl=function(na){var Zs=Nt&&Xn?Xo(na,Xn.x,Xn.y,xt,Gt,p.transform.angle):na;return p.collisionIndex.placeCollisionBox(Zs,tt,fe,L,Oe.predicate)};jn=qi&&qi.box&&qi.box.length&&ai.verticalIconBox?(vo=vl(ai.verticalIconBox)).box.length>0:(vo=vl(ai.iconBox)).box.length>0,pi=pi&&vo.offscreen}var Us=Xe||$r.numHorizontalGlyphVertices===0&&$r.numVerticalGlyphVertices===0,io=Ae||$r.numIconVertices===0;if(Us||io?io?Us||(jn=jn&&qn):qn=jn&&qn:jn=qn=jn&&qn,qn&&ri&&ri.box&&p.collisionIndex.insertCollisionBox(ri.box,A.get("text-ignore-placement"),w.bucketInstanceId,qi&&qi.box&&Ia?Ia:Oo,Oe.ID),jn&&vo&&p.collisionIndex.insertCollisionBox(vo.box,A.get("icon-ignore-placement"),w.bucketInstanceId,mo,Oe.ID),Li&&(qn&&p.collisionIndex.insertCollisionCircles(Li.circles,A.get("text-ignore-placement"),w.bucketInstanceId,Oo,Oe.ID),c)){var yu=w.bucketInstanceId,Iu=p.collisionCircleArrays[yu];Iu===void 0&&(Iu=p.collisionCircleArrays[yu]=new _o);for(var _u=0;_u<Li.circles.length;_u+=4)Iu.circles.push(Li.circles[_u+0]),Iu.circles.push(Li.circles[_u+1]),Iu.circles.push(Li.circles[_u+2]),Iu.circles.push(Li.collisionDetected?1:0)}p.placements[$r.crossTileID]=new zu(qn||mr,jn||zr,pi||w.justReloaded),f[$r.crossTileID]=!0}};if(er)for(var sn=w.getSortedSymbolIndexes(this.transform.angle),kn=sn.length-1;kn>=0;--kn){var Dn=sn[kn];Br(w.symbolInstances.get(Dn),w.collisionArrays[Dn])}else for(var Cn=l.symbolInstanceStart;Cn<l.symbolInstanceEnd;Cn++)Br(w.symbolInstances.get(Cn),w.collisionArrays[Cn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Fi=this.collisionCircleArrays[w.bucketInstanceId];v.invert(Fi.invProjMatrix,L),Fi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},to.prototype.markUsedJustification=function(l,f,c,p){var b;b=p===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var w=0,A=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<A.length;w+=1){var L=A[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=b>=0&&L!==b?0:c.crossTileID)}},to.prototype.markUsedOrientation=function(l,f,c){for(var p=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,b=f===v.WritingMode.vertical?f:0,w=0,A=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<A.length;w+=1)l.text.placedSymbolArray.get(A[w]).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},to.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var p=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},w=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],W=b[L];W?(this.opacities[L]=new Ho(W,p,U.text,U.icon),c=c||U.text!==W.text.placed||U.icon!==W.icon.placed):(this.opacities[L]=new Ho(null,p,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var fe in b){var he=b[fe];if(!this.opacities[fe]){var de=new Ho(he,p,!1,!1);de.isHidden()||(this.opacities[fe]=de,c=c||he.text.placed||he.icon.placed)}}for(var Le in w)this.variableOffsets[Le]||!this.opacities[Le]||this.opacities[Le].isHidden()||(this.variableOffsets[Le]=w[Le]);for(var Oe in A)this.placedOrientations[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.placedOrientations[Oe]=A[Oe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},to.prototype.updateLayerOpacities=function(l,f){for(var c={},p=0,b=f;p<b.length;p+=1){var w=b[p],A=w.getBucket(l);A&&w.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,c,w.collisionBoxArray)}},to.prototype.updateBucketOpacities=function(l,f,c){var p=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,w=new Ho(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),L=b.get("icon-allow-overlap"),U=b.get("text-variable-anchor"),W=b.get("text-rotation-alignment")==="map",fe=b.get("text-pitch-alignment")==="map",he=b.get("icon-text-fit")!=="none",de=new Ho(null,0,A&&(L||!l.hasIconData()||b.get("icon-optional")),L&&(A||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Le=function(He,tt,xt){for(var Gt=0;Gt<tt/4;Gt++)He.opacityVertexArray.emplaceBack(xt)},Oe=function(He){var tt=l.symbolInstances.get(He),xt=tt.numHorizontalGlyphVertices,Gt=tt.numVerticalGlyphVertices,Nt=tt.crossTileID,er=p.opacities[Nt];f[Nt]?er=w:er||(p.opacities[Nt]=er=de),f[Nt]=!0;var mr=tt.numIconVertices>0,zr=p.placedOrientations[tt.crossTileID],Br=zr===v.WritingMode.vertical,sn=zr===v.WritingMode.horizontal||zr===v.WritingMode.horizontalOnly;if(xt>0||Gt>0){var kn=pt(er.text);Le(l.text,xt,Br?jt:kn),Le(l.text,Gt,sn?jt:kn);var Dn=er.text.isHidden();[tt.rightJustifiedTextSymbolIndex,tt.centerJustifiedTextSymbolIndex,tt.leftJustifiedTextSymbolIndex].forEach(function(Vn){Vn>=0&&(l.text.placedSymbolArray.get(Vn).hidden=Dn||Br?1:0)}),tt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(tt.verticalPlacedTextSymbolIndex).hidden=Dn||sn?1:0);var Cn=p.variableOffsets[tt.crossTileID];Cn&&p.markUsedJustification(l,Cn.anchor,tt,zr);var Fi=p.placedOrientations[tt.crossTileID];Fi&&(p.markUsedJustification(l,"left",tt,Fi),p.markUsedOrientation(l,Fi,tt))}if(mr){var $r=pt(er.icon),ai=!(he&&tt.verticalPlacedIconSymbolIndex&&Br);tt.placedIconSymbolIndex>=0&&(Le(l.icon,tt.numIconVertices,ai?$r:jt),l.icon.placedSymbolArray.get(tt.placedIconSymbolIndex).hidden=er.icon.isHidden()),tt.verticalPlacedIconSymbolIndex>=0&&(Le(l.icon,tt.numVerticalIconVertices,ai?jt:$r),l.icon.placedSymbolArray.get(tt.verticalPlacedIconSymbolIndex).hidden=er.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ri=l.collisionArrays[He];if(ri){var qn=new v.Point(0,0);if(ri.textBox||ri.verticalTextBox){var jn=!0;if(U){var pi=p.variableOffsets[Nt];pi?(qn=ho(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textBoxScale),W&&qn._rotate(fe?p.transform.angle:-p.transform.angle)):jn=!1}ri.textBox&&ru(l.textCollisionBox.collisionVertexArray,er.text.placed,!jn||Br,qn.x,qn.y),ri.verticalTextBox&&ru(l.textCollisionBox.collisionVertexArray,er.text.placed,!jn||sn,qn.x,qn.y)}var Xn=Boolean(!sn&&ri.verticalIconBox);ri.iconBox&&ru(l.iconCollisionBox.collisionVertexArray,er.icon.placed,Xn,he?qn.x:0,he?qn.y:0),ri.verticalIconBox&&ru(l.iconCollisionBox.collisionVertexArray,er.icon.placed,!Xn,he?qn.x:0,he?qn.y:0)}}},Xe=0;Xe<l.symbolInstances.length;Xe++)Oe(Xe);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},to.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},to.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},to.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},to.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},to.prototype.setStale=function(){this.stale=!0};var bc=Math.pow(2,25),Os=Math.pow(2,24),ie=Math.pow(2,17),xe=Math.pow(2,16),Qe=Math.pow(2,9),Ot=Math.pow(2,8),Fr=Math.pow(2,1);function pt(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*bc+f*Os+c*ie+f*xe+c*Qe+f*Ot+c*Fr+f}var jt=0,ro=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ro.prototype.continuePlacement=function(l,f,c,p,b){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,p,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(A,L){return A.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var Qi=function(l,f,c,p,b,w,A){this.placement=new to(l,b,w,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1};Qi.prototype.isDone=function(){return this._done},Qi.prototype.continuePlacement=function(l,f,c){for(var p=this,b=v.browser.now(),w=function(){var U=v.browser.now()-b;return!p._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var A=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ro(A)),this._inProgressLayer.continuePlacement(c[A.source],this.placement,this._showCollisionBoxes,A,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Qi.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ga=512/v.EXTENT/2,Yo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var p=0;p<f.length;p++){var b=f.get(p),w=b.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};Yo.prototype.getScaledCoordinates=function(l,f){var c=Ga/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},Yo.prototype.findMatches=function(l,f,c){for(var p=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var w=l.get(b);if(!w.crossTileID){var A=this.indexedSymbolInstances[w.key];if(A)for(var L=this.getScaledCoordinates(w,f),U=0,W=A;U<W.length;U+=1){var fe=W[U];if(Math.abs(fe.coord.x-L.x)<=p&&Math.abs(fe.coord.y-L.y)<=p&&!c[fe.crossTileID]){c[fe.crossTileID]=!0,w.crossTileID=fe.crossTileID;break}}}}};var En=function(){this.maxCrossTileID=0};En.prototype.generate=function(){return++this.maxCrossTileID};var vn=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};vn.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var p=this.indexes[c],b={};for(var w in p){var A=p[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),b[A.tileID.key]=A}this.indexes[c]=b}this.lng=l},vn.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var p=0;p<f.symbolInstances.length;p++)f.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var A=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in A){var U=A[L];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,b)}else{var W=A[l.scaledTo(Number(w)).key];W&&W.findMatches(f.symbolInstances,l,b)}}for(var fe=0;fe<f.symbolInstances.length;fe++){var he=f.symbolInstances.get(fe);he.crossTileID||(he.crossTileID=c.generate(),b[he.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Yo(l,f.symbolInstances,f.bucketInstanceId),!0},vn.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var p=0,b=f.indexedSymbolInstances[c];p<b.length;p+=1)delete this.usedCrossTileIDs[l][b[p].crossTileID]},vn.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var p=this.indexes[c];for(var b in p)l[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[b]),delete p[b],f=!0)}return f};var Qt=function(){this.layerIndexes={},this.crossTileIDs=new En,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Qt.prototype.addLayer=function(l,f,c){var p=this.layerIndexes[l.id];p===void 0&&(p=this.layerIndexes[l.id]=new vn);var b=!1,w={};p.handleWrapJump(c);for(var A=0,L=f;A<L.length;A+=1){var U=L[A],W=U.getBucket(l);W&&l.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(U.tileID,W,this.crossTileIDs)&&(b=!0),w[W.bucketInstanceId]=!0)}return p.removeStaleBuckets(w)&&(b=!0),b},Qt.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(p){f[p]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var No=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},be=v.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Gs=v.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),nu=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var p,b=v.styleSpec.$root[c];b.required&&(p=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=p)}return l}(),ds=function(l){function f(c,p){var b=this;p===void 0&&(p={}),l.call(this),this.map=c,this.dispatcher=new Rt(Tt(),this),this.imageManager=new _t,this.imageManager.setEventedParent(this),this.glyphManager=new Yt(c._requestManager,p.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new Qt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(A){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},function(L,U){if(v.triggerPluginCompletionEvent(L),U&&U.every(function(fe){return fe}))for(var W in w.sourceCaches)w.sourceCaches[W].reload()})}),this.on("data",function(A){if(A.dataType==="source"&&A.sourceDataType==="metadata"){var L=b.sourceCaches[A.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var W in b._layers){var fe=b._layers[W];fe.source===U.id&&b._validateLayer(fe)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var w=typeof p.validate=="boolean"?p.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);var A=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(A,function(L,U){b._request=null,L?b.fire(new v.ErrorEvent(L)):U&&b._load(U,w)})},f.prototype.loadJSON=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){b._request=null,b._load(c,p.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(nu,!1)},f.prototype._load=function(c,p){if(!p||!No(this,v.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Vr(this.stylesheet.layers);this._order=w.map(function(W){return W.id}),this._layers={},this._serializedLayers={};for(var A=0,L=w;A<L.length;A+=1){var U=L[A];(U=v.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ht(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var p=this;this._spriteRequest=function(b,w,A){var L,U,W,fe=v.browser.devicePixelRatio>1?"@2x":"",he=v.getJSON(w.transformRequest(w.normalizeSpriteURL(b,fe,".json"),v.ResourceType.SpriteJSON),function(Oe,Xe){he=null,W||(W=Oe,L=Xe,Le())}),de=v.getImage(w.transformRequest(w.normalizeSpriteURL(b,fe,".png"),v.ResourceType.SpriteImage),function(Oe,Xe){de=null,W||(W=Oe,U=Xe,Le())});function Le(){if(W)A(W);else if(L&&U){var Oe=v.browser.getImageData(U),Xe={};for(var Ae in L){var He=L[Ae],tt=He.width,xt=He.height,Gt=He.x,Nt=He.y,er=He.sdf,mr=He.pixelRatio,zr=He.stretchX,Br=He.stretchY,sn=He.content,kn=new v.RGBAImage({width:tt,height:xt});v.RGBAImage.copy(Oe,kn,{x:Gt,y:Nt},{x:0,y:0},{width:tt,height:xt}),Xe[Ae]={data:kn,pixelRatio:mr,sdf:er,stretchX:zr,stretchY:Br,content:sn}}A(null,Xe)}}return{cancel:function(){he&&(he.cancel(),he=null),de&&(de.cancel(),de=null)}}}(c,this.map._requestManager,function(b,w){if(p._spriteRequest=null,b)p.fire(new v.ErrorEvent(b));else if(w)for(var A in w)p.imageManager.addImage(A,w[A]);p.imageManager.setLoaded(!0),p._availableImages=p.imageManager.listImages(),p.dispatcher.broadcast("setImages",p._availableImages),p.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var p=this.sourceCaches[c.source];if(p){var b=c.sourceLayer;if(b){var w=p.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(b)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var p=[],b=0,w=c;b<w.length;b+=1){var A=this._layers[w[b]];A.type!=="custom"&&p.push(A.serialize())}return p},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var p in this._layers)if(this._layers[p].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var p=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var A in(b.length||w.length)&&this._updateWorkerLayers(b,w),this._updatedSources){var L=this._updatedSources[A];L==="reload"?this._reloadSource(A):L==="clear"&&this._clearSource(A)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var W={};for(var fe in this.sourceCaches){var he=this.sourceCaches[fe];W[fe]=he.used,he.used=!1}for(var de=0,Le=this._order;de<Le.length;de+=1){var Oe=this._layers[Le[de]];Oe.recalculate(c,this._availableImages),!Oe.isHidden(c.zoom)&&Oe.source&&(this.sourceCaches[Oe.source].used=!0)}for(var Xe in W){var Ae=this.sourceCaches[Xe];W[Xe]!==Ae.used&&Ae.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Xe}))}this.light.recalculate(c),this.z=c.zoom,p&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var p=this;if(this._checkLoaded(),No(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Vr(c.layers);var b=function(A,L){if(!A)return[{command:Wr.setStyle,args:[L]}];var U=[];try{if(!v.deepEqual(A.version,L.version))return[{command:Wr.setStyle,args:[L]}];v.deepEqual(A.center,L.center)||U.push({command:Wr.setCenter,args:[L.center]}),v.deepEqual(A.zoom,L.zoom)||U.push({command:Wr.setZoom,args:[L.zoom]}),v.deepEqual(A.bearing,L.bearing)||U.push({command:Wr.setBearing,args:[L.bearing]}),v.deepEqual(A.pitch,L.pitch)||U.push({command:Wr.setPitch,args:[L.pitch]}),v.deepEqual(A.sprite,L.sprite)||U.push({command:Wr.setSprite,args:[L.sprite]}),v.deepEqual(A.glyphs,L.glyphs)||U.push({command:Wr.setGlyphs,args:[L.glyphs]}),v.deepEqual(A.transition,L.transition)||U.push({command:Wr.setTransition,args:[L.transition]}),v.deepEqual(A.light,L.light)||U.push({command:Wr.setLight,args:[L.light]});var W={},fe=[];(function(de,Le,Oe,Xe){var Ae;for(Ae in Le=Le||{},de=de||{})de.hasOwnProperty(Ae)&&(Le.hasOwnProperty(Ae)||en(Ae,Oe,Xe));for(Ae in Le)Le.hasOwnProperty(Ae)&&(de.hasOwnProperty(Ae)?v.deepEqual(de[Ae],Le[Ae])||(de[Ae].type==="geojson"&&Le[Ae].type==="geojson"&&ta(de,Le,Ae)?Oe.push({command:Wr.setGeoJSONSourceData,args:[Ae,Le[Ae].data]}):Ci(Ae,Le,Oe,Xe)):ii(Ae,Le,Oe))})(A.sources,L.sources,fe,W);var he=[];A.layers&&A.layers.forEach(function(de){W[de.source]?U.push({command:Wr.removeLayer,args:[de.id]}):he.push(de)}),U=U.concat(fe),function(de,Le,Oe){Le=Le||[];var Xe,Ae,He,tt,xt,Gt,Nt,er=(de=de||[]).map(Pi),mr=Le.map(Pi),zr=de.reduce(_i,{}),Br=Le.reduce(_i,{}),sn=er.slice(),kn=Object.create(null);for(Xe=0,Ae=0;Xe<er.length;Xe++)Br.hasOwnProperty(He=er[Xe])?Ae++:(Oe.push({command:Wr.removeLayer,args:[He]}),sn.splice(sn.indexOf(He,Ae),1));for(Xe=0,Ae=0;Xe<mr.length;Xe++)sn[sn.length-1-Xe]!==(He=mr[mr.length-1-Xe])&&(zr.hasOwnProperty(He)?(Oe.push({command:Wr.removeLayer,args:[He]}),sn.splice(sn.lastIndexOf(He,sn.length-Ae),1)):Ae++,Oe.push({command:Wr.addLayer,args:[Br[He],Gt=sn[sn.length-Xe]]}),sn.splice(sn.length-Xe,0,He),kn[He]=!0);for(Xe=0;Xe<mr.length;Xe++)if(tt=zr[He=mr[Xe]],xt=Br[He],!kn[He]&&!v.deepEqual(tt,xt))if(v.deepEqual(tt.source,xt.source)&&v.deepEqual(tt["source-layer"],xt["source-layer"])&&v.deepEqual(tt.type,xt.type)){for(Nt in gi(tt.layout,xt.layout,Oe,He,null,Wr.setLayoutProperty),gi(tt.paint,xt.paint,Oe,He,null,Wr.setPaintProperty),v.deepEqual(tt.filter,xt.filter)||Oe.push({command:Wr.setFilter,args:[He,xt.filter]}),v.deepEqual(tt.minzoom,xt.minzoom)&&v.deepEqual(tt.maxzoom,xt.maxzoom)||Oe.push({command:Wr.setLayerZoomRange,args:[He,xt.minzoom,xt.maxzoom]}),tt)tt.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?gi(tt[Nt],xt[Nt],Oe,He,Nt.slice(6),Wr.setPaintProperty):v.deepEqual(tt[Nt],xt[Nt])||Oe.push({command:Wr.setLayerProperty,args:[He,Nt,xt[Nt]]}));for(Nt in xt)xt.hasOwnProperty(Nt)&&!tt.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?gi(tt[Nt],xt[Nt],Oe,He,Nt.slice(6),Wr.setPaintProperty):v.deepEqual(tt[Nt],xt[Nt])||Oe.push({command:Wr.setLayerProperty,args:[He,Nt,xt[Nt]]}))}else Oe.push({command:Wr.removeLayer,args:[He]}),Gt=sn[sn.lastIndexOf(He)+1],Oe.push({command:Wr.addLayer,args:[xt,Gt]})}(he,L.layers,U)}catch(de){console.warn("Unable to compute style diff:",de),U=[{command:Wr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(A){return!(A.command in Gs)});if(b.length===0)return!1;var w=b.filter(function(A){return!(A.command in be)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(A){return A.command}).join(", ")+".");return b.forEach(function(A){A.command!=="setTransition"&&p[A.command].apply(p,A.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,p){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,p),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,p){this.imageManager.updateImage(c,p)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,p,b){var w=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(p).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,p,null,b))){this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);var A=this.sourceCaches[c]=new De(c,p,this.dispatcher);A.style=this,A.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:A.serialize(),sourceId:c}}),A.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var p in this._layers)if(this._layers[p].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+p+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,p){this._checkLoaded(),this.sourceCaches[c].getSource().setData(p),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new v.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var A;if(c.type==="custom"){if(No(this,v.validateCustomStyleLayer(c)))return;A=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=v.clone$1(c),c=v.extend(c,{source:w})),this._validate(v.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},b))return;A=v.createStyleLayer(c),this._validateLayer(A),A.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[A.id]=A.serialize()}var L=p?this._order.indexOf(p):this._order.length;if(p&&L===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=A,this._removedLayers[w]&&A.source&&A.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}},f.prototype.moveLayer=function(c,p){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==p){var b=this._order.indexOf(c);this._order.splice(b,1);var w=p?this._order.indexOf(p):this._order.length;p&&w===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var p=this._layers[c];if(p){p.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,p,b){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===p&&w.maxzoom===b||(p!=null&&(w.minzoom=p),b!=null&&(w.maxzoom=b),this._updateLayer(w)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!v.deepEqual(w.filter,p))return p==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(v.validateStyle.filter,"layers."+w.id+".filter",p,null,b)||(w.filter=v.clone$1(p),this._updateLayer(w)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var A=this.getLayer(c);A?v.deepEqual(A.getLayoutProperty(p),b)||(A.setLayoutProperty(p,b,w),this._updateLayer(A)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,p){var b=this.getLayer(c);if(b)return b.getLayoutProperty(p);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var A=this.getLayer(c);A?v.deepEqual(A.getPaintProperty(p),b)||(A.setPaintProperty(p,b,w)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,p){return this.getLayer(c).getPaintProperty(p)},f.prototype.setFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=c.sourceLayer,A=this.sourceCaches[b];if(A!==void 0){var L=A.getSource().type;L==="geojson"&&w?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),A.setFeatureState(w,c.id,p)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=this.sourceCaches[b];if(w!==void 0){var A=w.getSource().type,L=A==="vector"?c.sourceLayer:void 0;A!=="vector"||L?p&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,p):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var p=c.source,b=c.sourceLayer,w=this.sourceCaches[p];if(w!==void 0){if(w.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(b,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var p=this,b=function(zr){return p._layers[zr].type==="fill-extrusion"},w={},A=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(b(U)){w[U]=L;for(var W=0,fe=c;W<fe.length;W+=1){var he=fe[W][U];if(he)for(var de=0,Le=he;de<Le.length;de+=1)A.push(Le[de])}}}A.sort(function(zr,Br){return Br.intersectionZ-zr.intersectionZ});for(var Oe=[],Xe=this._order.length-1;Xe>=0;Xe--){var Ae=this._order[Xe];if(b(Ae))for(var He=A.length-1;He>=0;He--){var tt=A[He].feature;if(w[tt.layer.id]<Xe)break;Oe.push(tt),A.pop()}else for(var xt=0,Gt=c;xt<Gt.length;xt+=1){var Nt=Gt[xt][Ae];if(Nt)for(var er=0,mr=Nt;er<mr.length;er+=1)Oe.push(mr[er].feature)}}return Oe},f.prototype.queryRenderedFeatures=function(c,p,b){p&&p.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);var w={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var A=0,L=p.layers;A<L.length;A+=1){var U=L[A],W=this._layers[U];if(!W)return this.fire(new v.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[W.source]=!0}}var fe=[];for(var he in p.availableImages=this._availableImages,this.sourceCaches)p.layers&&!w[he]||fe.push(hn(this.sourceCaches[he],this._layers,this._serializedLayers,c,p,b));return this.placement&&fe.push(function(de,Le,Oe,Xe,Ae,He,tt){for(var xt={},Gt=He.queryRenderedSymbols(Xe),Nt=[],er=0,mr=Object.keys(Gt).map(Number);er<mr.length;er+=1)Nt.push(tt[mr[er]]);Nt.sort(Ki);for(var zr=function(){var Cn=sn[Br],Fi=Cn.featureIndex.lookupSymbolFeatures(Gt[Cn.bucketInstanceId],Le,Cn.bucketIndex,Cn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,de);for(var $r in Fi){var ai=xt[$r]=xt[$r]||[],ri=Fi[$r];ri.sort(function(pi,Xn){var Vn=Cn.featureSortOrder;if(Vn){var qi=Vn.indexOf(pi.featureIndex);return Vn.indexOf(Xn.featureIndex)-qi}return Xn.featureIndex-pi.featureIndex});for(var qn=0,jn=ri;qn<jn.length;qn+=1)ai.push(jn[qn])}},Br=0,sn=Nt;Br<sn.length;Br+=1)zr();var kn=function(Cn){xt[Cn].forEach(function(Fi){var $r=Fi.feature,ai=Oe[de[Cn].source].getFeatureState($r.layer["source-layer"],$r.id);$r.source=$r.layer.source,$r.layer["source-layer"]&&($r.sourceLayer=$r.layer["source-layer"]),$r.state=ai})};for(var Dn in xt)kn(Dn);return xt}(this._layers,this._serializedLayers,this.sourceCaches,c,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(fe)},f.prototype.querySourceFeatures=function(c,p){p&&p.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);var b=this.sourceCaches[c];return b?function(w,A){for(var L=w.getRenderableIds().map(function(Le){return w.getTileByID(Le)}),U=[],W={},fe=0;fe<L.length;fe++){var he=L[fe],de=he.tileID.canonical.key;W[de]||(W[de]=!0,he.querySourceFeatures(U,A))}return U}(b,p):[]},f.prototype.addSourceType=function(c,p,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,p){p===void 0&&(p={}),this._checkLoaded();var b=this.light.getLight(),w=!1;for(var A in c)if(!v.deepEqual(c[A],b[A])){w=!0;break}if(w){var L={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,p),this.light.updateTransitions(L)}},f.prototype._validate=function(c,p,b,w,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&No(this,c.call(v.validateStyle,v.extend({key:p,style:this.serialize(),value:b,styleSpec:v.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var p in this.sourceCaches)this.sourceCaches[p].clearTiles(),this.sourceCaches[p].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var p in this.sourceCaches)this.sourceCaches[p].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,p,b,w,A){A===void 0&&(A=!1);for(var L=!1,U=!1,W={},fe=0,he=this._order;fe<he.length;fe+=1){var de=this._layers[he[fe]];if(de.type==="symbol"){if(!W[de.source]){var Le=this.sourceCaches[de.source];W[de.source]=Le.getRenderableIds(!0).map(function(tt){return Le.getTileByID(tt)}).sort(function(tt,xt){return xt.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(xt.tileID)?-1:1)})}var Oe=this.crossTileSymbolIndex.addLayer(de,W[de.source],c.center.lng);L=L||Oe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new Qi(c,this._order,A,p,b,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var Xe=0,Ae=this._order;Xe<Ae.length;Xe+=1){var He=this._layers[Ae[Xe]];He.type==="symbol"&&this.placement.updateLayerOpacities(He,W[He.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,p,b){this.imageManager.getImages(p.icons,b),this._updateTilesForChangedImages();var w=this.sourceCaches[p.source];w&&w.setDependencies(p.tileID.key,p.type,p.icons)},f.prototype.getGlyphs=function(c,p,b){this.glyphManager.getGlyphs(p.stacks,b)},f.prototype.getResource=function(c,p,b){return v.makeRequest(p,b)},f}(v.Evented);ds.getSourceType=function(l){return Cr[l]},ds.setSourceType=function(l,f){Cr[l]=f},ds.registerForPluginStateChange=v.registerForPluginStateChange;var sa=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),po=Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Xl=Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ec=Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Uu=Hi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Sc=Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Sl=Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Zu=Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),iu=Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ju=Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),y=Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),C=Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),N=Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),q=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_e=Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),lt=Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),vt=Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),lr=Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Er=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Mn=Hi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),li=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),$n=Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yi=Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fa=Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Pa=Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Hi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=w?w.concat(b):b,L={};return{fragmentSource:l=l.replace(c,function(U,W,fe,he,de){return L[de]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
varying `+fe+" "+he+" "+de+`;
#else
uniform `+fe+" "+he+" u_"+de+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+de+`
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,W,fe,he,de){var Le=he==="float"?"vec2":"vec4",Oe=de.match(/color/)?"color":Le;return L[de]?W==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+fe+" "+Le+" a_"+de+`;
varying `+fe+" "+he+" "+de+`;
#else
uniform `+fe+" "+he+" u_"+de+`;
#endif
`:Oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = a_"+de+`;
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = unpack_mix_"+Oe+"(a_"+de+", u_"+de+`_t);
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+fe+" "+Le+" a_"+de+`;
#else
uniform `+fe+" "+he+" u_"+de+`;
#endif
`:Oe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+fe+" "+he+" "+de+" = a_"+de+`;
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+fe+" "+he+" "+de+" = unpack_mix_"+Oe+"(a_"+de+", u_"+de+`_t);
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`}),staticAttributes:p,staticUniforms:A}}var Mo=Object.freeze({__proto__:null,prelude:po,background:Xl,backgroundPattern:Ec,circle:Uu,clippingMask:Sc,heatmap:Sl,heatmapTexture:Zu,collisionBox:iu,collisionCircle:ju,debug:y,fill:C,fillOutline:N,fillOutlinePattern:O,fillPattern:q,fillExtrusion:_e,fillExtrusionPattern:We,hillshadePrepare:lt,hillshade:vt,line:lr,lineGradient:Er,linePattern:Mn,lineSDF:li,raster:$n,symbolIcon:Yi,symbolSDF:fa,symbolTextAndIcon:Pa}),_s=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function sl(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var p=l[c].split(" ");f.push(p.pop())}return f}_s.prototype.bind=function(l,f,c,p,b,w,A,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==p.length,W=0;!U&&W<p.length;W++)this.boundPaintVertexBuffers[W]!==p[W]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===b&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),A&&A.bind(),b&&b.dynamicDraw&&b.bind(),L&&L.bind()):this.freshBind(f,c,p,b,w,A,L)},_s.prototype.freshBind=function(l,f,c,p,b,w,A){var L,U=l.numAttributes,W=this.context,fe=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=A;else{L=W.currentNumAttributes||0;for(var he=U;he<L;he++)fe.disableVertexAttribArray(he)}f.enableAttributes(fe,l);for(var de=0,Le=c;de<Le.length;de+=1)Le[de].enableAttributes(fe,l);w&&w.enableAttributes(fe,l),A&&A.enableAttributes(fe,l),f.bind(),f.setVertexAttribPointers(fe,l,b);for(var Oe=0,Xe=c;Oe<Xe.length;Oe+=1){var Ae=Xe[Oe];Ae.bind(),Ae.setVertexAttribPointers(fe,l,b)}w&&(w.bind(),w.setVertexAttribPointers(fe,l,b)),p&&p.bind(),A&&(A.bind(),A.setVertexAttribPointers(fe,l,b)),W.currentNumAttributes=U},_s.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Gc=function(l,f,c,p,b,w){var A=l.gl;this.program=A.createProgram();for(var L=sl(c.staticAttributes),U=p?p.getBinderAttributes():[],W=L.concat(U),fe=c.staticUniforms?sl(c.staticUniforms):[],he=p?p.getBinderUniforms():[],de=[],Le=0,Oe=fe.concat(he);Le<Oe.length;Le+=1){var Xe=Oe[Le];de.indexOf(Xe)<0&&de.push(Xe)}var Ae=p?p.defines():[];w&&Ae.push("#define OVERDRAW_INSPECTOR;");var He=Ae.concat(po.fragmentSource,c.fragmentSource).join(`
`),tt=Ae.concat(po.vertexSource,c.vertexSource).join(`
`),xt=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(xt,He),A.compileShader(xt),A.attachShader(this.program,xt);var Gt=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(Gt,tt),A.compileShader(Gt),A.attachShader(this.program,Gt),this.attributes={};var Nt={};this.numAttributes=W.length;for(var er=0;er<this.numAttributes;er++)W[er]&&(A.bindAttribLocation(this.program,er,W[er]),this.attributes[W[er]]=er);A.linkProgram(this.program),A.deleteShader(Gt),A.deleteShader(xt);for(var mr=0;mr<de.length;mr++){var zr=de[mr];if(zr&&!Nt[zr]){var Br=A.getUniformLocation(this.program,zr);Br&&(Nt[zr]=Br)}}this.fixedUniforms=b(l,Nt),this.binderUniforms=p?p.getUniforms(l,Nt):[]}}};function Vu(l,f,c){var p=1/Ji(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,A=w*(c.tileID.canonical.x+c.tileID.wrap*b),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[A>>16,L>>16],u_pixel_coord_lower:[65535&A,65535&L]}}Gc.prototype.draw=function(l,f,c,p,b,w,A,L,U,W,fe,he,de,Le,Oe,Xe){var Ae,He=l.gl;if(!this.failedToCreate){for(var tt in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(p),l.setColorMode(b),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[tt].set(A[tt]);Le&&Le.setUniforms(l,this.binderUniforms,he,{zoom:de});for(var xt=(Ae={},Ae[He.LINES]=2,Ae[He.TRIANGLES]=3,Ae[He.LINE_STRIP]=1,Ae)[f],Gt=0,Nt=fe.get();Gt<Nt.length;Gt+=1){var er=Nt[Gt],mr=er.vaos||(er.vaos={});(mr[L]||(mr[L]=new _s)).bind(l,this,U,Le?Le.getPaintVertexBuffers():[],W,er.vertexOffset,Oe,Xe),He.drawElements(f,er.primitiveLength*xt,He.UNSIGNED_SHORT,er.primitiveOffset*xt*2)}}};var wc=function(l,f,c,p){var b=f.style.light,w=b.properties.get("position"),A=[w.x,w.y,w.z],L=v.create$1();b.properties.get("anchor")==="viewport"&&v.fromRotation(L,-f.transform.angle),v.transformMat3(A,A,L);var U=b.properties.get("color");return{u_matrix:l,u_lightpos:A,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:p}},wu=function(l,f,c,p,b,w,A){return v.extend(wc(l,f,c,p),Vu(w,f,A),{u_height_factor:-Math.pow(2,b.overscaledZ)/A.tileSize/8})},cu=function(l){return{u_matrix:l}},xo=function(l,f,c,p){return v.extend(cu(l),Vu(c,f,p))},ha=function(l,f){return{u_matrix:l,u_world:f}},th=function(l,f,c,p,b){return v.extend(xo(l,f,c,p),{u_world:b})},rh=function(l,f,c,p){var b,w,A=l.transform;if(p.paint.get("circle-pitch-alignment")==="map"){var L=Ji(c,1,A.zoom);b=!0,w=[L,L]}else b=!1,w=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:w}},uo=function(l,f,c){var p=Ji(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[f.pixelsToGLUnits[0]/(p*b),f.pixelsToGLUnits[1]/(p*b)],u_overscale_factor:w}},Mf=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},fu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Rs=function(l){return{u_matrix:l}},Cc=function(l,f,c,p){return{u_matrix:l,u_extrude_scale:Ji(f,1,c),u_intensity:p}},ul=function(l,f,c){var p=l.transform;return{u_matrix:Pf(l,f,c),u_ratio:1/Ji(f,1,p.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ba=function(l,f,c,p){return v.extend(ul(l,f,c),{u_image:0,u_image_height:p})},wl=function(l,f,c,p){var b=l.transform,w=es(f,b);return{u_matrix:Pf(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/Ji(f,1,b.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Yl=function(l,f,c,p,b){var w=l.lineAtlas,A=es(f,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(p.from,L),W=w.getDash(p.to,L),fe=U.width*b.fromScale,he=W.width*b.toScale;return v.extend(ul(l,f,c),{u_patternscale_a:[A/fe,-U.height/2],u_patternscale_b:[A/he,-W.height/2],u_sdfgamma:w.width/(256*Math.min(fe,he)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:W.y,u_mix:b.t})};function es(l,f){return 1/Ji(l,1,f.tileZoom)}function Pf(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var nh=function(l,f,c,p,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(w=b.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:ih(b.paint.get("raster-hue-rotate"))};var w,A};function ih(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Hc,ll=function(l,f,c,p,b,w,A,L,U,W){var fe=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:fe.cameraToCenterDistance,u_pitch:fe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:fe.width/fe.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+p,u_texsize:W,u_texture:0}},Bo=function(l,f,c,p,b,w,A,L,U,W,fe){var he=b.transform;return v.extend(ll(l,f,c,p,b,w,A,L,U,W),{u_gamma_scale:p?Math.cos(he._pitch)*he.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+fe})},Cu=function(l,f,c,p,b,w,A,L,U,W){return v.extend(Bo(l,f,c,p,b,w,A,L,!0,U,!0),{u_texsize_icon:W,u_texture_icon:1})},Gu=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},zo=function(l,f,c,p,b,w){return v.extend(function(A,L,U,W){var fe=U.imageManager.getPattern(A.from.toString()),he=U.imageManager.getPattern(A.to.toString()),de=U.imageManager.getPixelSize(),Le=de.width,Oe=de.height,Xe=Math.pow(2,W.tileID.overscaledZ),Ae=W.tileSize*Math.pow(2,U.transform.tileZoom)/Xe,He=Ae*(W.tileID.canonical.x+W.tileID.wrap*Xe),tt=Ae*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:fe.tl,u_pattern_br_a:fe.br,u_pattern_tl_b:he.tl,u_pattern_br_b:he.br,u_texsize:[Le,Oe],u_mix:L.t,u_pattern_size_a:fe.displaySize,u_pattern_size_b:he.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Ji(W,1,U.transform.tileZoom),u_pixel_coord_upper:[He>>16,tt>>16],u_pixel_coord_lower:[65535&He,65535&tt]}}(p,w,c,b),{u_matrix:l,u_opacity:f})},Cl={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Hu(l,f,c,p,b,w,A){for(var L=l.context,U=L.gl,W=l.useProgram("collisionBox"),fe=[],he=0,de=0,Le=0;Le<p.length;Le++){var Oe=p[Le],Xe=f.getTile(Oe),Ae=Xe.getBucket(c);if(Ae){var He=Oe.posMatrix;b[0]===0&&b[1]===0||(He=l.translatePosMatrix(Oe.posMatrix,Xe,b,w));var tt=A?Ae.textCollisionBox:Ae.iconCollisionBox,xt=Ae.collisionCircleArray;if(xt.length>0){var Gt=v.create(),Nt=He;v.mul(Gt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Gt,Gt,Ae.placementViewportMatrix),fe.push({circleArray:xt,circleOffset:de,transform:Nt,invTransform:Gt}),de=he+=xt.length/4}tt&&W.draw(L,U.LINES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),rt.disabled,uo(He,l.transform,Xe),c.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,l.transform.zoom,null,null,tt.collisionVertexBuffer)}}if(A&&fe.length){var er=l.useProgram("collisionCircle"),mr=new v.StructArrayLayout2f1f2i16;mr.resize(4*he),mr._trim();for(var zr=0,Br=0,sn=fe;Br<sn.length;Br+=1)for(var kn=sn[Br],Dn=0;Dn<kn.circleArray.length/4;Dn++){var Cn=4*Dn,Fi=kn.circleArray[Cn+0],$r=kn.circleArray[Cn+1],ai=kn.circleArray[Cn+2],ri=kn.circleArray[Cn+3];mr.emplace(zr++,Fi,$r,ai,ri,0),mr.emplace(zr++,Fi,$r,ai,ri,1),mr.emplace(zr++,Fi,$r,ai,ri,2),mr.emplace(zr++,Fi,$r,ai,ri,3)}(!Hc||Hc.length<2*he)&&(Hc=function(Li){var vo=2*Li,Oo=new v.StructArrayLayout3ui6;Oo.resize(vo),Oo._trim();for(var Ia=0;Ia<vo;Ia++){var mo=6*Ia;Oo.uint16[mo+0]=4*Ia+0,Oo.uint16[mo+1]=4*Ia+1,Oo.uint16[mo+2]=4*Ia+2,Oo.uint16[mo+3]=4*Ia+2,Oo.uint16[mo+4]=4*Ia+3,Oo.uint16[mo+5]=4*Ia+0}return Oo}(he));for(var qn=L.createIndexBuffer(Hc,!0),jn=L.createVertexBuffer(mr,v.collisionCircleLayout.members,!0),pi=0,Xn=fe;pi<Xn.length;pi+=1){var Vn=Xn[pi],qi=Mf(Vn.transform,Vn.invTransform,l.transform);er.draw(L,U.TRIANGLES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),rt.disabled,qi,c.id,jn,qn,v.SegmentVector.simpleSegment(0,2*Vn.circleOffset,Vn.circleArray.length,Vn.circleArray.length/2),null,l.transform.zoom,null,null,null)}jn.destroy(),qn.destroy()}}var Hs=v.identity(new Float32Array(16));function Wc(l,f,c,p,b,w){var A=v.getAnchorAlignment(l),L=-(A.horizontalAlign-.5)*f,U=-(A.verticalAlign-.5)*c,W=v.evaluateVariableOffset(l,p);return new v.Point((L/b+W[0])*w,(U/b+W[1])*w)}function Xc(l,f,c,p,b,w,A,L,U,W,fe){var he=l.text.placedSymbolArray,de=l.text.dynamicLayoutVertexArray,Le=l.icon.dynamicLayoutVertexArray,Oe={};de.clear();for(var Xe=0;Xe<he.length;Xe++){var Ae=he.get(Xe),He=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:p[Ae.crossTileID];if(He){var tt=new v.Point(Ae.anchorX,Ae.anchorY),xt=Ii(tt,c?L:A),Gt=Gi(w.cameraToCenterDistance,xt.signedDistanceFromCamera),Nt=b.evaluateSizeForFeature(l.textSizeData,W,Ae)*Gt/v.ONE_EM;c&&(Nt*=l.tilePixelRatio/U);for(var er=Wc(He.anchor,He.width,He.height,He.textOffset,He.textBoxScale,Nt),mr=c?Ii(tt.add(er),A).point:xt.point.add(f?er.rotate(-w.angle):er),zr=l.allowVerticalPlacement&&Ae.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Br=0;Br<Ae.numGlyphs;Br++)v.addDynamicAttributes(de,mr,zr);fe&&Ae.associatedIconIndex>=0&&(Oe[Ae.associatedIconIndex]={shiftedAnchor:mr,angle:zr})}else fo(Ae.numGlyphs,de)}if(fe){Le.clear();for(var sn=l.icon.placedSymbolArray,kn=0;kn<sn.length;kn++){var Dn=sn.get(kn);if(Dn.hidden)fo(Dn.numGlyphs,Le);else{var Cn=Oe[kn];if(Cn)for(var Fi=0;Fi<Dn.numGlyphs;Fi++)v.addDynamicAttributes(Le,Cn.shiftedAnchor,Cn.angle);else fo(Dn.numGlyphs,Le)}}l.icon.dynamicLayoutVertexBuffer.updateData(Le)}l.text.dynamicLayoutVertexBuffer.updateData(de)}function Yc(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Wu(l,f,c,p,b,w,A,L,U,W,fe,he){for(var de=l.context,Le=de.gl,Oe=l.transform,Xe=L==="map",Ae=U==="map",He=Xe&&c.layout.get("symbol-placement")!=="point",tt=Xe&&!Ae&&!He,xt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Gt=!1,Nt=l.depthModeForSublayer(0,ge.ReadOnly),er=c.layout.get("text-variable-anchor"),mr=[],zr=0,Br=p;zr<Br.length;zr+=1){var sn=Br[zr],kn=f.getTile(sn),Dn=kn.getBucket(c);if(Dn){var Cn=b?Dn.text:Dn.icon;if(Cn&&Cn.segments.get().length){var Fi=Cn.programConfigurations.get(c.id),$r=b||Dn.sdfIcons,ai=b?Dn.textSizeData:Dn.iconSizeData,ri=Ae||Oe.pitch!==0,qn=l.useProgram(Yc($r,b,Dn),Fi),jn=v.evaluateSizeForZoom(ai,Oe.zoom),pi=void 0,Xn=[0,0],Vn=void 0,qi=void 0,Li=null,vo=void 0;if(b)Vn=kn.glyphAtlasTexture,qi=Le.LINEAR,pi=kn.glyphAtlasTexture.size,Dn.iconsInText&&(Xn=kn.imageAtlasTexture.size,Li=kn.imageAtlasTexture,vo=ri||l.options.rotating||l.options.zooming||ai.kind==="composite"||ai.kind==="camera"?Le.LINEAR:Le.NEAREST);else{var Oo=c.layout.get("icon-size").constantOr(0)!==1||Dn.iconsNeedLinear;Vn=kn.imageAtlasTexture,qi=$r||l.options.rotating||l.options.zooming||Oo||ri?Le.LINEAR:Le.NEAREST,pi=kn.imageAtlasTexture.size}var Ia=Ji(kn,1,l.transform.zoom),mo=La(sn.posMatrix,Ae,Xe,l.transform,Ia),zs=oa(sn.posMatrix,Ae,Xe,l.transform,Ia),xs=er&&Dn.hasTextData(),$u=c.layout.get("icon-text-fit")!=="none"&&xs&&Dn.hasIconData();He&&tu(Dn,sn.posMatrix,l,b,mo,zs,Ae,W);var rs=l.translatePosMatrix(sn.posMatrix,kn,w,A),Eo=He||b&&er||$u?Hs:mo,su=l.translatePosMatrix(zs,kn,w,A,!0),Lc=$r&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,nc={program:qn,buffers:Cn,uniformValues:$r?Dn.iconsInText?Cu(ai.kind,jn,tt,Ae,l,rs,Eo,su,pi,Xn):Bo(ai.kind,jn,tt,Ae,l,rs,Eo,su,b,pi,!0):ll(ai.kind,jn,tt,Ae,l,rs,Eo,su,b,pi),atlasTexture:Vn,atlasTextureIcon:Li,atlasInterpolation:qi,atlasInterpolationIcon:vo,isSDF:$r,hasHalo:Lc};if(xt&&Dn.canOverlap){Gt=!0;for(var As=0,Ju=Cn.segments.get();As<Ju.length;As+=1){var Qu=Ju[As];mr.push({segments:new v.SegmentVector([Qu]),sortKey:Qu.sortKey,state:nc})}}else mr.push({segments:Cn.segments,sortKey:0,state:nc})}}}Gt&&mr.sort(function(Iu,_u){return Iu.sortKey-_u.sortKey});for(var qs=0,vl=mr;qs<vl.length;qs+=1){var Us=vl[qs],io=Us.state;if(de.activeTexture.set(Le.TEXTURE0),io.atlasTexture.bind(io.atlasInterpolation,Le.CLAMP_TO_EDGE),io.atlasTextureIcon&&(de.activeTexture.set(Le.TEXTURE1),io.atlasTextureIcon&&io.atlasTextureIcon.bind(io.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),io.isSDF){var yu=io.uniformValues;io.hasHalo&&(yu.u_is_halo=1,ql(io.buffers,Us.segments,c,l,io.program,Nt,fe,he,yu)),yu.u_is_halo=0}ql(io.buffers,Us.segments,c,l,io.program,Nt,fe,he,io.uniformValues)}}function ql(l,f,c,p,b,w,A,L,U){var W=p.context;b.draw(W,W.gl.TRIANGLES,w,A,L,rt.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,p.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Ac(l,f,c,p,b,w,A){var L,U,W,fe,he,de=l.context.gl,Le=c.paint.get("fill-pattern"),Oe=Le&&Le.constantOr(1),Xe=c.getCrossfadeParameters();A?(U=Oe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=de.LINES):(U=Oe?"fillPattern":"fill",L=de.TRIANGLES);for(var Ae=0,He=p;Ae<He.length;Ae+=1){var tt=He[Ae],xt=f.getTile(tt);if(!Oe||xt.patternsLoaded()){var Gt=xt.getBucket(c);if(Gt){var Nt=Gt.programConfigurations.get(c.id),er=l.useProgram(U,Nt);Oe&&(l.context.activeTexture.set(de.TEXTURE0),xt.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Xe));var mr=Le.constantOr(null);if(mr&&xt.imageAtlas){var zr=xt.imageAtlas,Br=zr.patternPositions[mr.to.toString()],sn=zr.patternPositions[mr.from.toString()];Br&&sn&&Nt.setConstantPatternPositions(Br,sn)}var kn=l.translatePosMatrix(tt.posMatrix,xt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(A){fe=Gt.indexBuffer2,he=Gt.segments2;var Dn=[de.drawingBufferWidth,de.drawingBufferHeight];W=U==="fillOutlinePattern"&&Oe?th(kn,l,Xe,xt,Dn):ha(kn,Dn)}else fe=Gt.indexBuffer,he=Gt.segments,W=Oe?xo(kn,l,Xe,xt):cu(kn);er.draw(l.context,L,b,l.stencilModeForClipping(tt),w,rt.disabled,W,c.id,Gt.layoutVertexBuffer,fe,he,c.paint,l.transform.zoom,Nt)}}}}function qc(l,f,c,p,b,w,A){for(var L=l.context,U=L.gl,W=c.paint.get("fill-extrusion-pattern"),fe=W.constantOr(1),he=c.getCrossfadeParameters(),de=c.paint.get("fill-extrusion-opacity"),Le=0,Oe=p;Le<Oe.length;Le+=1){var Xe=Oe[Le],Ae=f.getTile(Xe),He=Ae.getBucket(c);if(He){var tt=He.programConfigurations.get(c.id),xt=l.useProgram(fe?"fillExtrusionPattern":"fillExtrusion",tt);fe&&(l.context.activeTexture.set(U.TEXTURE0),Ae.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),tt.updatePaintBuffers(he));var Gt=W.constantOr(null);if(Gt&&Ae.imageAtlas){var Nt=Ae.imageAtlas,er=Nt.patternPositions[Gt.to.toString()],mr=Nt.patternPositions[Gt.from.toString()];er&&mr&&tt.setConstantPatternPositions(er,mr)}var zr=l.translatePosMatrix(Xe.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Br=c.paint.get("fill-extrusion-vertical-gradient"),sn=fe?wu(zr,l,Br,de,Xe,he,Ae):wc(zr,l,Br,de);xt.draw(L,L.gl.TRIANGLES,b,w,A,rt.backCCW,sn,c.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,c.paint,l.transform.zoom,tt)}}}function Tc(l,f,c,p,b,w){var A=l.context,L=A.gl,U=f.fbo;if(U){var W=l.useProgram("hillshade");A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var fe=function(he,de,Le){var Oe=Le.paint.get("hillshade-shadow-color"),Xe=Le.paint.get("hillshade-highlight-color"),Ae=Le.paint.get("hillshade-accent-color"),He=Le.paint.get("hillshade-illumination-direction")*(Math.PI/180);Le.paint.get("hillshade-illumination-anchor")==="viewport"&&(He-=he.transform.angle);var tt,xt,Gt,Nt=!he.options.moving;return{u_matrix:he.transform.calculatePosMatrix(de.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(tt=de.tileID,xt=Math.pow(2,tt.canonical.z),Gt=tt.canonical.y,[new v.MercatorCoordinate(0,Gt/xt).toLngLat().lat,new v.MercatorCoordinate(0,(Gt+1)/xt).toLngLat().lat]),u_light:[Le.paint.get("hillshade-exaggeration"),He],u_shadow:Oe,u_highlight:Xe,u_accent:Ae}}(l,f,c);W.draw(A,L.TRIANGLES,p,b,w,rt.disabled,fe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function ah(l,f,c,p,b,w){var A=l.context,L=A.gl,U=f.dem;if(U&&U.data){var W=U.dim,fe=U.stride,he=U.getPixels();if(A.activeTexture.set(L.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(fe),f.demTexture){var de=f.demTexture;de.update(he,{premultiply:!1}),de.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(A,he,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);A.activeTexture.set(L.TEXTURE0);var Le=f.fbo;if(!Le){var Oe=new v.Texture(A,{width:W,height:W,data:null},L.RGBA);Oe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Le=f.fbo=A.createFramebuffer(W,W,!0)).colorAttachment.set(Oe.texture)}A.bindFramebuffer.set(Le.framebuffer),A.viewport.set([0,0,W,W]),l.useProgram("hillshadePrepare").draw(A,L.TRIANGLES,p,b,w,rt.disabled,function(Xe,Ae){var He=Ae.stride,tt=v.create();return v.ortho(tt,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(tt,tt,[0,-v.EXTENT,0]),{u_matrix:tt,u_image:1,u_dimension:[He,He],u_zoom:Xe.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Mc(l,f,c,p,b){var w=p.paint.get("raster-fade-duration");if(w>0){var A=v.browser.now(),L=(A-l.timeAdded)/w,U=f?(A-f.timeAdded)/w:-1,W=c.getSource(),fe=b.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),he=!f||Math.abs(f.tileID.overscaledZ-fe)>Math.abs(l.tileID.overscaledZ-fe),de=he&&l.refreshedUponExpiration?1:v.clamp(he?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}var cl=new v.Color(1,0,0,1),Kc=new v.Color(0,1,0,1),$c=new v.Color(0,0,1,1),Au=new v.Color(1,0,1,1),Jc=new v.Color(0,1,1,1);function If(l,f,c,p){Al(l,0,f+c/2,l.transform.width,c,p)}function oh(l,f,c,p){Al(l,f-c/2,0,c,l.transform.height,p)}function Al(l,f,c,p,b,w){var A=l.context,L=A.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,p*v.browser.devicePixelRatio,b*v.browser.devicePixelRatio),A.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Yh(l,f,c){var p=l.context,b=p.gl,w=c.posMatrix,A=l.useProgram("debug"),L=ge.disabled,U=Ie.disabled,W=l.colorModeForRenderPass();p.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),A.draw(p,b.LINE_STRIP,L,U,W,rt.disabled,fu(w,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var fe=f.getTileByID(c.key).latestRawTileData,he=Math.floor((fe&&fe.byteLength||0)/1024),de=f.getTile(c).tileSize,Le=512/Math.min(de,512)*(c.overscaledZ/l.transform.zoom)*.5,Oe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Oe+=" => "+c.overscaledZ),function(Xe,Ae){Xe.initDebugOverlayCanvas();var He=Xe.debugOverlayCanvas,tt=Xe.context.gl,xt=Xe.debugOverlayCanvas.getContext("2d");xt.clearRect(0,0,He.width,He.height),xt.shadowColor="white",xt.shadowBlur=2,xt.lineWidth=1.5,xt.strokeStyle="white",xt.textBaseline="top",xt.font="bold 36px Open Sans, sans-serif",xt.fillText(Ae,5,5),xt.strokeText(Ae,5,5),Xe.debugOverlayTexture.update(He),Xe.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(l,Oe+" "+he+"kb"),A.draw(p,b.TRIANGLES,L,U,Ve.alphaBlended,rt.disabled,fu(w,v.Color.transparent,Le),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var ts={symbol:function(l,f,c,p,b){if(l.renderPass==="translucent"){var w=Ie.disabled,A=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,W,fe,he,de,Le){for(var Oe=U.transform,Xe=he==="map",Ae=de==="map",He=0,tt=L;He<tt.length;He+=1){var xt=tt[He],Gt=fe.getTile(xt),Nt=Gt.getBucket(W);if(Nt&&Nt.text&&Nt.text.segments.get().length){var er=v.evaluateSizeForZoom(Nt.textSizeData,Oe.zoom),mr=Ji(Gt,1,U.transform.zoom),zr=La(xt.posMatrix,Ae,Xe,U.transform,mr),Br=W.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(er){var sn=Math.pow(2,Oe.zoom-Gt.tileID.overscaledZ);Xc(Nt,Xe,Ae,Le,v.symbolSize,Oe,zr,xt.posMatrix,sn,er,Br)}}}}(p,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&Wu(l,f,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,A),c.paint.get("text-opacity").constantOr(1)!==0&&Wu(l,f,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,A),f.map.showCollisionBoxes&&(Hu(l,f,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Hu(l,f,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||w.constantOr(1)!==0&&A.constantOr(1)!==0){for(var U=l.context,W=U.gl,fe=l.depthModeForSublayer(0,ge.ReadOnly),he=Ie.disabled,de=l.colorModeForRenderPass(),Le=[],Oe=0;Oe<p.length;Oe++){var Xe=p[Oe],Ae=f.getTile(Xe),He=Ae.getBucket(c);if(He){var tt=He.programConfigurations.get(c.id),xt={programConfiguration:tt,program:l.useProgram("circle",tt),layoutVertexBuffer:He.layoutVertexBuffer,indexBuffer:He.indexBuffer,uniformValues:rh(l,Xe,Ae,c)};if(L)for(var Gt=0,Nt=He.segments.get();Gt<Nt.length;Gt+=1){var er=Nt[Gt];Le.push({segments:new v.SegmentVector([er]),sortKey:er.sortKey,state:xt})}else Le.push({segments:He.segments,sortKey:0,state:xt})}}L&&Le.sort(function(kn,Dn){return kn.sortKey-Dn.sortKey});for(var mr=0,zr=Le;mr<zr.length;mr+=1){var Br=zr[mr],sn=Br.state;sn.program.draw(U,W.TRIANGLES,fe,he,de,rt.disabled,sn.uniformValues,c.id,sn.layoutVertexBuffer,sn.indexBuffer,Br.segments,c.paint,l.transform.zoom,sn.programConfiguration)}}}},heatmap:function(l,f,c,p){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,w=b.gl,A=Ie.disabled,L=new Ve([w.ONE,w.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Le,Oe,Xe){var Ae=Le.gl;Le.activeTexture.set(Ae.TEXTURE1),Le.viewport.set([0,0,Oe.width/4,Oe.height/4]);var He=Xe.heatmapFbo;if(He)Ae.bindTexture(Ae.TEXTURE_2D,He.colorAttachment.get()),Le.bindFramebuffer.set(He.framebuffer);else{var tt=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,tt),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),He=Xe.heatmapFbo=Le.createFramebuffer(Oe.width/4,Oe.height/4,!1),function(xt,Gt,Nt,er){var mr=xt.gl;mr.texImage2D(mr.TEXTURE_2D,0,mr.RGBA,Gt.width/4,Gt.height/4,0,mr.RGBA,xt.extRenderToTextureHalfFloat?xt.extTextureHalfFloat.HALF_FLOAT_OES:mr.UNSIGNED_BYTE,null),er.colorAttachment.set(Nt)}(Le,Oe,tt,He)}})(b,l,c),b.clear({color:v.Color.transparent});for(var U=0;U<p.length;U++){var W=p[U];if(!f.hasRenderableParent(W)){var fe=f.getTile(W),he=fe.getBucket(c);if(he){var de=he.programConfigurations.get(c.id);l.useProgram("heatmap",de).draw(b,w.TRIANGLES,ge.disabled,A,L,rt.disabled,Cc(W.posMatrix,fe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,l.transform.zoom,de)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Le,Oe){var Xe=Le.context,Ae=Xe.gl,He=Oe.heatmapFbo;if(He){Xe.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,He.colorAttachment.get()),Xe.activeTexture.set(Ae.TEXTURE1);var tt=Oe.colorRampTexture;tt||(tt=Oe.colorRampTexture=new v.Texture(Xe,Oe.colorRamp,Ae.RGBA)),tt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Le.useProgram("heatmapTexture").draw(Xe,Ae.TRIANGLES,ge.disabled,Ie.disabled,Le.colorModeForRenderPass(),rt.disabled,function(xt,Gt,Nt,er){var mr=v.create();v.ortho(mr,0,xt.width,xt.height,0,0,1);var zr=xt.context.gl;return{u_matrix:mr,u_world:[zr.drawingBufferWidth,zr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Gt.paint.get("heatmap-opacity")}}(Le,Oe),Oe.id,Le.viewportBuffer,Le.quadTriangleIndexBuffer,Le.viewportSegments,Oe.paint,Le.transform.zoom)}}(l,c))},line:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(b.constantOr(1)!==0&&w.constantOr(1)!==0)for(var A=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),W=c.paint.get("line-pattern"),fe=W.constantOr(1),he=c.paint.get("line-gradient"),de=c.getCrossfadeParameters(),Le=fe?"linePattern":U?"lineSDF":he?"lineGradient":"line",Oe=l.context,Xe=Oe.gl,Ae=!0,He=0,tt=p;He<tt.length;He+=1){var xt=tt[He],Gt=f.getTile(xt);if(!fe||Gt.patternsLoaded()){var Nt=Gt.getBucket(c);if(Nt){var er=Nt.programConfigurations.get(c.id),mr=l.context.program.get(),zr=l.useProgram(Le,er),Br=Ae||zr.program!==mr,sn=W.constantOr(null);if(sn&&Gt.imageAtlas){var kn=Gt.imageAtlas,Dn=kn.patternPositions[sn.to.toString()],Cn=kn.patternPositions[sn.from.toString()];Dn&&Cn&&er.setConstantPatternPositions(Dn,Cn)}var Fi=fe?wl(l,Gt,c,de):U?Yl(l,Gt,c,U,de):he?ba(l,Gt,c,Nt.lineClipsArray.length):ul(l,Gt,c);if(fe)Oe.activeTexture.set(Xe.TEXTURE0),Gt.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),er.updatePaintBuffers(de);else if(U&&(Br||l.lineAtlas.dirty))Oe.activeTexture.set(Xe.TEXTURE0),l.lineAtlas.bind(Oe);else if(he){var $r=Nt.gradients[c.id],ai=$r.texture;if(c.gradientVersion!==$r.version){var ri=256;if(c.stepInterpolant){var qn=f.getSource().maxzoom,jn=xt.canonical.z===qn?Math.ceil(1<<l.transform.maxZoom-xt.canonical.z):1;ri=v.clamp(v.nextPowerOfTwo(Nt.maxLineLength/v.EXTENT*1024*jn),256,Oe.maxTextureSize)}$r.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ri,image:$r.gradient||void 0,clips:Nt.lineClipsArray}),$r.texture?$r.texture.update($r.gradient):$r.texture=new v.Texture(Oe,$r.gradient,Xe.RGBA),$r.version=c.gradientVersion,ai=$r.texture}Oe.activeTexture.set(Xe.TEXTURE0),ai.bind(c.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}zr.draw(Oe,Xe.TRIANGLES,A,l.stencilModeForClipping(xt),L,rt.disabled,Fi,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,c.paint,l.transform.zoom,er,Nt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,p){var b=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var A=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&b.constantOr(v.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var W=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Ac(l,f,c,p,W,A,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var fe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Ac(l,f,c,p,fe,A,!0)}}},"fill-extrusion":function(l,f,c,p){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var w=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))qc(l,f,c,p,w,Ie.disabled,Ve.disabled),qc(l,f,c,p,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var A=l.colorModeForRenderPass();qc(l,f,c,p,w,Ie.disabled,A)}}},hillshade:function(l,f,c,p){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,w=l.depthModeForSublayer(0,ge.ReadOnly),A=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(p):[{},p],U=L[0],W=0,fe=L[1];W<fe.length;W+=1){var he=fe[W],de=f.getTile(he);de.needsHillshadePrepare&&l.renderPass==="offscreen"?ah(l,de,c,w,Ie.disabled,A):l.renderPass==="translucent"&&Tc(l,de,c,w,U[he.overscaledZ],A)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,p){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&p.length)for(var b=l.context,w=b.gl,A=f.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),W=A instanceof gt?[{},p]:l.stencilConfigForOverlap(p),fe=W[0],he=W[1],de=he[he.length-1].overscaledZ,Le=!l.options.moving,Oe=0,Xe=he;Oe<Xe.length;Oe+=1){var Ae=Xe[Oe],He=l.depthModeForSublayer(Ae.overscaledZ-de,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,w.LESS),tt=f.getTile(Ae),xt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Le);tt.registerFadeDuration(c.paint.get("raster-fade-duration"));var Gt=f.findLoadedParent(Ae,0),Nt=Mc(tt,Gt,f,c,l.transform),er=void 0,mr=void 0,zr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),tt.texture.bind(zr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(w.TEXTURE1),Gt?(Gt.texture.bind(zr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),er=Math.pow(2,Gt.tileID.overscaledZ-tt.tileID.overscaledZ),mr=[tt.tileID.canonical.x*er%1,tt.tileID.canonical.y*er%1]):tt.texture.bind(zr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Br=nh(xt,mr||[0,0],er||1,Nt,c);A instanceof gt?L.draw(b,w.TRIANGLES,He,Ie.disabled,U,rt.disabled,Br,c.id,A.boundsBuffer,l.quadTriangleIndexBuffer,A.boundsSegments):L.draw(b,w.TRIANGLES,He,fe[Ae.overscaledZ],U,rt.disabled,Br,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var p=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var w=l.context,A=w.gl,L=l.transform,U=L.tileSize,W=c.paint.get("background-pattern");if(!l.isPatternMissing(W)){var fe=!W&&p.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===fe){var he=Ie.disabled,de=l.depthModeForSublayer(0,fe==="opaque"?ge.ReadWrite:ge.ReadOnly),Le=l.colorModeForRenderPass(),Oe=l.useProgram(W?"backgroundPattern":"background"),Xe=L.coveringTiles({tileSize:U});W&&(w.activeTexture.set(A.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),He=0,tt=Xe;He<tt.length;He+=1){var xt=tt[He],Gt=l.transform.calculatePosMatrix(xt.toUnwrapped()),Nt=W?zo(Gt,b,l,W,{tileID:xt,tileSize:U},Ae):Gu(Gt,b,p);Oe.draw(w,A.TRIANGLES,de,he,Le,rt.disabled,Nt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var p=0;p<c.length;p++)Yh(l,f,c[p])},custom:function(l,f,c){var p=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var w=b.prerender;w&&(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),w.call(b,p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(Ie.disabled);var A=b.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);p.setDepthMode(A),b.render(p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}},Ha=function(l,f){this.context=new pe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=De.maxUnderzooming+De.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qt,this.gpuTimers={}};Ha.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,p=this.style._order;c<p.length;c+=1)this.style._layers[p[c]].resize()},Ha.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,sa.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,sa.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var p=new v.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(v.EXTENT,0,v.EXTENT,0),p.emplaceBack(0,v.EXTENT,0,v.EXTENT),p.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(p,At.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var b=new v.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,sa.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var w=new v.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var A=new v.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Ie({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Ha.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ge.disabled,this.stencilClearMode,Ve.disabled,rt.disabled,Rs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ha.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,p=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ve.disabled),c.setDepthMode(ge.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,A=f;w<A.length;w+=1){var L=A[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;b.draw(c,p.TRIANGLES,ge.disabled,new Ie({func:p.ALWAYS,mask:0},U,255,p.KEEP,p.KEEP,p.REPLACE),Ve.disabled,rt.disabled,Rs(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ha.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Ie({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Ha.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Ie({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Ha.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,p=l.sort(function(U,W){return W.overscaledZ-U.overscaledZ}),b=p[p.length-1].overscaledZ,w=p[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var A={},L=0;L<w;L++)A[L+b]=new Ie({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[A,p]}return[(f={},f[b]=Ie.disabled,f),p]},Ha.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ve([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ve.unblended:Ve.alphaBlended},Ha.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var p=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[p,p])},Ha.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ha.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var p=this.style._order,b=this.style.sourceCaches;for(var w in b){var A=b[w];A.used&&A.prepare(this.context)}var L,U,W={},fe={},he={};for(var de in b){var Le=b[de];W[de]=Le.getVisibleCoordinates(),fe[de]=W[de].slice().reverse(),he[de]=Le.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Oe=0;Oe<p.length;Oe++)if(this.style._layers[p[Oe]].is3D()){this.opaquePassCutoff=Oe;break}this.renderPass="offscreen";for(var Xe=0,Ae=p;Xe<Ae.length;Xe+=1){var He=this.style._layers[Ae[Xe]];if(He.hasOffscreenPass()&&!He.isHidden(this.transform.zoom)){var tt=fe[He.source];(He.type==="custom"||tt.length)&&this.renderLayer(this,b[He.source],He,tt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){var xt=this.style._layers[p[this.currentLayer]],Gt=b[xt.source],Nt=W[xt.source];this._renderTileClippingMasks(xt,Nt),this.renderLayer(this,Gt,xt,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){var er=this.style._layers[p[this.currentLayer]],mr=b[er.source],zr=(er.type==="symbol"?he:fe)[er.source];this._renderTileClippingMasks(er,W[er.source]),this.renderLayer(this,mr,er,zr)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Br){Br.source&&!Br.isHidden(c.transform.zoom)&&(Br.source!==(U&&U.id)&&(U=c.style.sourceCaches[Br.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&ts.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Br){var sn=Br.transform.padding;If(Br,Br.transform.height-(sn.top||0),3,cl),If(Br,sn.bottom||0,3,Kc),oh(Br,sn.left||0,3,$c),oh(Br,Br.transform.width-(sn.right||0),3,Au);var kn=Br.transform.centerPoint;(function(Dn,Cn,Fi,$r){Al(Dn,Cn-1,Fi-10,2,20,$r),Al(Dn,Cn-10,Fi-1,20,2,$r)})(Br,kn.x,Br.transform.height-kn.y,Jc)}(this),this.context.setDefault()},Ha.prototype.renderLayer=function(l,f,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||p.length)&&(this.id=c.id,this.gpuTimingStart(c),ts[c.type](l,f,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ha.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Ha.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ha.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ha.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var p=l[c],b=this.context.extTimerQuery,w=b.getQueryObjectEXT(p.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(p.query),f[c]=w}return f},Ha.prototype.translatePosMatrix=function(l,f,c,p,b){if(!c[0]&&!c[1])return l;var w=b?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(w){var A=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*A,c[0]*A+c[1]*L]}var U=[b?c[0]:Ji(f,c[0],this.transform.zoom),b?c[1]:Ji(f,c[1],this.transform.zoom),0],W=new Float32Array(16);return v.translate(W,l,U),W},Ha.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Ha.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Ha.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Ha.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Gc(this.context,l,Mo[l],f,Cl[l],this._showOverdrawInspector)),this.cache[c]},Ha.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ha.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ha.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ha.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Kl=function(l,f){this.points=l,this.planes=f};Kl.fromInvProjectionMatrix=function(l,f,c){var p=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(A){return v.transformMat4([],A,l)}).map(function(A){return v.scale$1([],A,1/A[3]/f*p)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(A){var L=v.sub([],b[A[0]],b[A[1]]),U=v.sub([],b[A[2]],b[A[1]]),W=v.normalize([],v.cross([],L,U)),fe=-v.dot(W,b[A[1]]);return W.concat(fe)});return new Kl(b,w)};var Tl=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Tl.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),p=v.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],p[b]=f[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new Tl(c,p)},Tl.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Tl.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Tl.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,p=0;p<l.planes.length;p++){for(var b=l.planes[p],w=0,A=0;A<f.length;A++)w+=v.dot$1(b,f[A])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,W=-Number.MAX_VALUE,fe=0;fe<l.points.length;fe++){var he=l.points[fe][L]-this.min[L];U=Math.min(U,he),W=Math.max(W,he)}if(W<0||U>this.max[L]-this.min[L])return 0}return 1};var au=function(l,f,c,p){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),p===void 0&&(p=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=p};au.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},au.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),p=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,p)},au.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},au.prototype.clone=function(){return new au(this.top,this.bottom,this.left,this.right)},au.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Di=function(l,f,c,p,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new au,this._posMatrixCache={},this._alignedPosMatrixCache={}},ka={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Di.prototype.clone=function(){var l=new Di(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},ka.minZoom.get=function(){return this._minZoom},ka.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},ka.maxZoom.get=function(){return this._maxZoom},ka.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},ka.minPitch.get=function(){return this._minPitch},ka.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},ka.maxPitch.get=function(){return this._maxPitch},ka.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},ka.renderWorldCopies.get=function(){return this._renderWorldCopies},ka.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},ka.worldSize.get=function(){return this.tileSize*this.scale},ka.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ka.size.get=function(){return new v.Point(this.width,this.height)},ka.bearing.get=function(){return-this.angle/Math.PI*180},ka.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ka.pitch.get=function(){return this._pitch/Math.PI*180},ka.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},ka.fov.get=function(){return this._fov/Math.PI*180},ka.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},ka.zoom.get=function(){return this._zoom},ka.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},ka.center.get=function(){return this._center},ka.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},ka.padding.get=function(){return this._edgeInsets.toJSON()},ka.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},ka.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Di.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Di.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Di.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Di.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),p=this.pointCoordinate(new v.Point(this.width,0)),b=this.pointCoordinate(new v.Point(this.width,this.height)),w=this.pointCoordinate(new v.Point(0,this.height)),A=Math.floor(Math.min(c.x,p.x,b.x,w.x)),L=Math.floor(Math.max(c.x,p.x,b.x,w.x)),U=A-1;U<=L+1;U++)U!==0&&f.push(new v.UnwrappedTileID(U,l));return f},Di.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var p=v.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),w=[b*p.x,b*p.y,0],A=Kl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var U=function(Br){return{aabb:new Tl([Br*b,0,0],[(Br+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Br,fullyVisible:!1}},W=[],fe=[],he=f,de=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Le=1;Le<=3;Le++)W.push(U(-Le)),W.push(U(Le));for(W.push(U(0));W.length>0;){var Oe=W.pop(),Xe=Oe.x,Ae=Oe.y,He=Oe.fullyVisible;if(!He){var tt=Oe.aabb.intersects(A);if(tt===0)continue;He=tt===2}var xt=Oe.aabb.distanceX(w),Gt=Oe.aabb.distanceY(w),Nt=Math.max(Math.abs(xt),Math.abs(Gt));if(Oe.zoom===he||Nt>3+(1<<he-Oe.zoom)-2&&Oe.zoom>=L)fe.push({tileID:new v.OverscaledTileID(Oe.zoom===he?de:Oe.zoom,Oe.wrap,Oe.zoom,Xe,Ae),distanceSq:v.sqrLen([w[0]-.5-Xe,w[1]-.5-Ae])});else for(var er=0;er<4;er++){var mr=(Xe<<1)+er%2,zr=(Ae<<1)+(er>>1);W.push({aabb:Oe.aabb.quadrant(er),zoom:Oe.zoom+1,x:mr,y:zr,wrap:Oe.wrap,fullyVisible:He})}}return fe.sort(function(Br,sn){return Br.distanceSq-sn.distanceSq}).map(function(Br){return Br.tileID})},Di.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},ka.unmodified.get=function(){return this._unmodified},Di.prototype.zoomScale=function(l){return Math.pow(2,l)},Di.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Di.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Di.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},ka.point.get=function(){return this.project(this.center)},Di.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),p=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),w=new v.MercatorCoordinate(b.x-(c.x-p.x),b.y-(c.y-p.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Di.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Di.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Di.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Di.prototype.coordinateLocation=function(l){return l.toLngLat()},Di.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var p=f[3],b=c[3],w=f[1]/p,A=c[1]/b,L=f[2]/p,U=c[2]/b,W=L===U?0:(0-L)/(U-L);return new v.MercatorCoordinate(v.number(f[0]/p,c[0]/b,W)/this.worldSize,v.number(w,A,W)/this.worldSize)},Di.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Di.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Di.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Di.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Di.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,p=f?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];var b=l.canonical,w=this.worldSize/this.zoomScale(b.z),A=b.x+Math.pow(2,b.z)*l.wrap,L=v.identity(new Float64Array(16));return v.translate(L,L,[A*w,b.y*w,0]),v.scale(L,L,[w/v.EXTENT,w/v.EXTENT,1]),v.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),p[c]=new Float32Array(L),p[c]},Di.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Di.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,p,b=-90,w=90,A=-180,L=180,U=this.size,W=this._unmodified;if(this.latRange){var fe=this.latRange;b=v.mercatorYfromLat(fe[1])*this.worldSize,l=(w=v.mercatorYfromLat(fe[0])*this.worldSize)-b<U.y?U.y/(w-b):0}if(this.lngRange){var he=this.lngRange;A=v.mercatorXfromLng(he[0])*this.worldSize,f=(L=v.mercatorXfromLng(he[1])*this.worldSize)-A<U.x?U.x/(L-A):0}var de=this.point,Le=Math.max(f||0,l||0);if(Le)return this.center=this.unproject(new v.Point(f?(L+A)/2:de.x,l?(w+b)/2:de.y)),this.zoom+=this.scaleZoom(Le),this._unmodified=W,void(this._constraining=!1);if(this.latRange){var Oe=de.y,Xe=U.y/2;Oe-Xe<b&&(p=b+Xe),Oe+Xe>w&&(p=w-Xe)}if(this.lngRange){var Ae=de.x,He=U.x/2;Ae-He<A&&(c=A+He),Ae+He>L&&(c=L-He)}c===void 0&&p===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:de.x,p!==void 0?p:de.y))),this._unmodified=W,this._constraining=!1}},Di.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),p=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,w=b.x,A=b.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),U=this.height/50,W=new Float64Array(16);v.perspective(W,this._fov,this.width/this.height,U,L),W[8]=2*-l.x/this.width,W[9]=2*l.y/this.height,v.scale(W,W,[1,-1,1]),v.translate(W,W,[0,0,-this.cameraToCenterDistance]),v.rotateX(W,W,this._pitch),v.rotateZ(W,W,this.angle),v.translate(W,W,[-w,-A,0]),this.mercatorMatrix=v.scale([],W,[this.worldSize,this.worldSize,this.worldSize]),v.scale(W,W,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=W,this.invProjMatrix=v.invert([],this.projMatrix);var fe=this.width%2/2,he=this.height%2/2,de=Math.cos(this.angle),Le=Math.sin(this.angle),Oe=w-Math.round(w)+de*fe+Le*he,Xe=A-Math.round(A)+de*he+Le*fe,Ae=new Float64Array(W);if(v.translate(Ae,Ae,[Oe>.5?Oe-1:Oe,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Ae,W=v.create(),v.scale(W,W,[this.width/2,-this.height/2,1]),v.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=v.create(),v.scale(W,W,[1,-1,1]),v.translate(W,W,[-1,-1,0]),v.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(W=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Di.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Di.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Di.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,p=f.y,b=f.x,w=f.y,A=0,L=l;A<L.length;A+=1){var U=L[A];c=Math.min(c,U.x),p=Math.min(p,U.y),b=Math.max(b,U.x),w=Math.max(w,U.y)}return[new v.Point(c,p),new v.Point(b,p),new v.Point(b,w),new v.Point(c,w),new v.Point(c,p)]},Object.defineProperties(Di.prototype,ka);var Ls=function(l){var f,c,p,b;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,p=null,b=function(){p=null,c&&(f(),p=setTimeout(b,300),c=!1)},function(){return c=!0,p||b(),p})};Ls.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ls.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ls.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),w=Math.round(f.lng*b)/b,A=Math.round(f.lat*b)/b,L=this._map.getBearing(),U=this._map.getPitch(),W="";if(W+=l?"/"+w+"/"+A+"/"+c:c+"/"+A+"/"+w,(L||U)&&(W+="/"+Math.round(10*L)/10),U&&(W+="/"+Math.round(U)),this._hashName){var fe=this._hashName,he=!1,de=v.window.location.hash.slice(1).split("&").map(function(Le){var Oe=Le.split("=")[0];return Oe===fe?(he=!0,Oe+"="+W):Le}).filter(function(Le){return Le});return he||de.push(fe+"="+W),"#"+de.join("&")}return"#"+W},Ls.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(p){return p.split("=")}).forEach(function(p){p[0]===f._hashName&&(l=p)}),(l&&l[1]||"").split("/")):c.split("/")},Ls.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},Ls.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var Qc={linearity:.3,easing:v.bezier(0,0,.3,1)},fl=v.extend({deceleration:2500,maxSpeed:1400},Qc),ef=v.extend({deceleration:20,maxSpeed:1400},Qc),qh=v.extend({deceleration:1e3,maxSpeed:360},Qc),Kh=v.extend({deceleration:1e3,maxSpeed:90},Qc),Pc=function(l){this._map=l,this.clear()};function $l(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Xu(l,f,c){var p=c.maxSpeed,b=c.linearity,w=c.deceleration,A=v.clamp(l*b/(f/1e3),-p,p),L=Math.abs(A)/(w*b);return{easing:c.easing,duration:1e3*L,amount:A*(L/2)}}Pc.prototype.clear=function(){this._inertiaBuffer=[]},Pc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},Pc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Pc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,p=this._inertiaBuffer;c<p.length;c+=1){var b=p[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(f.pan.mag()){var L=Xu(f.pan.mag(),w,v.extend({},fl,l||{}));A.offset=f.pan.mult(L.amount/f.pan.mag()),A.center=this._map.transform.center,$l(A,L)}if(f.zoom){var U=Xu(f.zoom,w,ef);A.zoom=this._map.transform.zoom+U.amount,$l(A,U)}if(f.bearing){var W=Xu(f.bearing,w,qh);A.bearing=this._map.transform.bearing+v.clamp(W.amount,-179,179),$l(A,W)}if(f.pitch){var fe=Xu(f.pitch,w,Kh);A.pitch=this._map.transform.pitch+fe.amount,$l(A,fe)}if(A.zoom||A.bearing){var he=f.pinchAround===void 0?f.around:f.pinchAround;A.around=he?this._map.unproject(he):this._map.getCenter()}return this.clear(),v.extend(A,{noMoveStart:!0})}};var Po=function(l){function f(p,b,w,A){A===void 0&&(A={});var L=F.mousePos(b.getCanvasContainer(),w),U=b.unproject(L);l.call(this,p,v.extend({point:L,lngLat:U,originalEvent:w},A)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Jl=function(l){function f(p,b,w){var A=p==="touchend"?w.changedTouches:w.touches,L=F.touchPos(b.getCanvasContainer(),A),U=L.map(function(he){return b.unproject(he)}),W=L.reduce(function(he,de,Le,Oe){return he.add(de.div(Oe.length))},new v.Point(0,0)),fe=b.unproject(W);l.call(this,p,{points:L,point:W,lngLats:U,lngLat:fe,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Ql=function(l){function f(p,b,w){l.call(this,p,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),qa=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};qa.prototype.reset=function(){delete this._mousedownPos},qa.prototype.wheel=function(l){return this._firePreventable(new Ql(l.type,this._map,l))},qa.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new Po(l.type,this._map,l))},qa.prototype.mouseup=function(l){this._map.fire(new Po(l.type,this._map,l))},qa.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Po(l.type,this._map,l))},qa.prototype.dblclick=function(l){return this._firePreventable(new Po(l.type,this._map,l))},qa.prototype.mouseover=function(l){this._map.fire(new Po(l.type,this._map,l))},qa.prototype.mouseout=function(l){this._map.fire(new Po(l.type,this._map,l))},qa.prototype.touchstart=function(l){return this._firePreventable(new Jl(l.type,this._map,l))},qa.prototype.touchmove=function(l){this._map.fire(new Jl(l.type,this._map,l))},qa.prototype.touchend=function(l){this._map.fire(new Jl(l.type,this._map,l))},qa.prototype.touchcancel=function(l){this._map.fire(new Jl(l.type,this._map,l))},qa.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},qa.prototype.isEnabled=function(){return!0},qa.prototype.isActive=function(){return!1},qa.prototype.enable=function(){},qa.prototype.disable=function(){};var mn=function(l){this._map=l};mn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},mn.prototype.mousemove=function(l){this._map.fire(new Po(l.type,this._map,l))},mn.prototype.mousedown=function(){this._delayContextMenu=!0},mn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Po("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},mn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Po(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},mn.prototype.isEnabled=function(){return!0},mn.prototype.isActive=function(){return!1},mn.prototype.enable=function(){},mn.prototype.disable=function(){};var no=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Yu(l,f){for(var c={},p=0;p<l.length;p++)c[l[p].identifier]=f[p];return c}no.prototype.isEnabled=function(){return!!this._enabled},no.prototype.isActive=function(){return!!this._active},no.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},no.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},no.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(F.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},no.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var p=this._startPos;this._lastPos=c,this._box||(this._box=F.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(p.x,c.x),w=Math.max(p.x,c.x),A=Math.min(p.y,c.y),L=Math.max(p.y,c.y);F.setTransform(this._box,"translate("+b+"px,"+A+"px)"),this._box.style.width=w-b+"px",this._box.style.height=L-A+"px"}}},no.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var p=this._startPos,b=f;if(this.reset(),F.suppressClick(),p.x!==b.x||p.y!==b.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(p,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},no.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},no.prototype.blur=function(){this.reset()},no.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos},no.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var qu=function(l){this.reset(),this.numTouches=l.numTouches};qu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},qu.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){for(var b=new v.Point(0,0),w=0,A=p;w<A.length;w+=1)b._add(A[w]);return b.div(p.length)}(f),this.touches=Yu(c,f)))},qu.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var p=Yu(c,f);for(var b in this.touches){var w=p[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}},qu.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var p=!this.aborted&&this.centroid;if(this.reset(),p)return p}};var hu=function(l){this.singleTap=new qu(l),this.numTaps=l.numTaps,this.reset()};hu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},hu.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},hu.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},hu.prototype.touchend=function(l,f,c){var p=this.singleTap.touchend(l,f,c);if(p){var b=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(p)<30;if(b&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}};var ks=function(){this._zoomIn=new hu({numTouches:1,numTaps:2}),this._zoomOut=new hu({numTouches:2,numTaps:1}),this.reset()};ks.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ks.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},ks.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},ks.prototype.touchend=function(l,f,c){var p=this,b=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(b)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:l})}}):void 0},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var Of={0:1,2:2},Kr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kr.prototype.blur=function(){this.reset()},Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(l,f){return!1},Kr.prototype._move=function(l,f){return{}},Kr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=F.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Kr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(p,b){var w=Of[b];return p.buttons===void 0||(p.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Kr.prototype.mouseupWindow=function(l){this._lastPoint&&F.mouseButton(l)===this._eventButton&&(this._moved&&F.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var tf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,p){l.prototype.mousedown.call(this,c,p),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,p){return p===0&&!c.ctrlKey},f.prototype._move=function(c,p){return{around:p,panDelta:p.sub(c)}},f}(Kr),Rf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=.8*(p.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),Tu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=-.5*(p.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),za=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};za.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},za.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},za.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},za.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},za.prototype.touchcancel=function(){this.reset()},za.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var p=Yu(c,f),b=new v.Point(0,0),w=new v.Point(0,0),A=0;for(var L in p){var U=p[L],W=this._touches[L];W&&(b._add(U),w._add(U.sub(W)),A++,p[L]=U)}if(this._touches=p,!(A<this._minTouches)&&w.mag()){var fe=w.div(A);if(this._sum._add(fe),!(this._sum.mag()<this._clickTolerance))return{around:b.div(A),panDelta:fe}}},za.prototype.enable=function(){this._enabled=!0},za.prototype.disable=function(){this._enabled=!1,this.reset()},za.prototype.isEnabled=function(){return this._enabled},za.prototype.isActive=function(){return this._active};var Ds=function(){this.reset()};function rf(l,f,c){for(var p=0;p<l.length;p++)if(l[p].identifier===c)return f[p]}function Mu(l,f){return Math.log(l/f)/Math.LN2}Ds.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ds.prototype._start=function(l){},Ds.prototype._move=function(l,f,c){return{}},Ds.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Ds.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var p=this._firstTwoTouches,b=p[1],w=rf(c,f,p[0]),A=rf(c,f,b);if(w&&A){var L=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],L,l)}}},Ds.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var p=this._firstTwoTouches,b=p[1],w=rf(c,f,p[0]),A=rf(c,f,b);w&&A||(this._active&&F.suppressClick(),this.reset())}},Ds.prototype.touchcancel=function(){this.reset()},Ds.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active};var ws=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,b),pinchAround:p}},f}(Ds);function bo(l,f){return 180*l.angleWith(f)/Math.PI}var sh=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bo(this._vector,b),pinchAround:p}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var p=25/(Math.PI*this._minDiameter)*360,b=bo(c,this._startVector);return Math.abs(b)<p},f}(Ds);function ga(l){return Math.abs(l.y)>Math.abs(l.x)}var Lf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ga(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,p,b){var w=c[0].sub(this._lastPoints[0]),A=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,A,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,p,b){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,A=p.mag()>=2;if(w||A){if(!w||!A)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var L=c.y>0==p.y>0;return ga(c)&&ga(p)&&L}},f}(Ds),uh={panStep:100,bearingStep:15,pitchStep:10},Ws=function(){var l=uh;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Cs(l){return l*(2-l)}Ws.prototype.blur=function(){this.reset()},Ws.prototype.reset=function(){this._active=!1},Ws.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,p=0,b=0,w=0,A=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?p=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?p=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),A=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,b=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Cs,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+p*f._bearingStep,pitch:L.getPitch()+b*f._pitchStep,offset:[-w*f._panStep,-A*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},Ws.prototype.enable=function(){this._enabled=!0},Ws.prototype.disable=function(){this._enabled=!1,this.reset()},Ws.prototype.isEnabled=function(){return this._enabled},Ws.prototype.isActive=function(){return this._active},Ws.prototype.disableRotation=function(){this._rotationDisabled=!0},Ws.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Oi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(p*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Oi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Oi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=F.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,p=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&p!==0&&(p=1/p);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*p))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,A=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,U=this._easing,W=!1;if(this._type==="wheel"&&L&&U){var fe=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),he=U(fe);w=v.number(L,A,he),fe<1?this._frameId||(this._frameId=!0):W=!0}else w=A,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,p=(v.browser.now()-c.start)/c.duration,b=c.easing(p+.01)-c.easing(p),w=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-w*w);f=v.bezier(w,A,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1};var pu=function(l,f){this._clickZoom=l,this._tapZoom=f};pu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},pu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},pu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},pu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var pa=function(){this.reset()};pa.prototype.reset=function(){this._active=!1},pa.prototype.blur=function(){this.reset()},pa.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},pa.prototype.enable=function(){this._enabled=!0},pa.prototype.disable=function(){this._enabled=!1,this.reset()},pa.prototype.isEnabled=function(){return this._enabled},pa.prototype.isActive=function(){return this._active};var lo=function(){this._tap=new hu({numTouches:1,numTaps:1}),this.reset()};lo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},lo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},lo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var p=f[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},lo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},lo.prototype.touchcancel=function(){this.reset()},lo.prototype.enable=function(){this._enabled=!0},lo.prototype.disable=function(){this._enabled=!1,this.reset()},lo.prototype.isEnabled=function(){return this._enabled},lo.prototype.isActive=function(){return this._active};var Fs=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};Fs.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Fs.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Fs.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Fs.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ou=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};ou.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ou.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ou.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ou.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ns=function(l,f,c,p){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0};Ns.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ns.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ns.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ns.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ns.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ns.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var vs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Bs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function Pn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var wn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pc(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var p=0,b=this._listeners;p<b.length;p+=1){var w=b[p],A=w[0];F.addEventListener(A,w[1],A===v.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};wn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],p=c[0];F.removeEventListener(p,c[1],p===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},wn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new qa(f,l));var p=f.boxZoom=new no(f,l);this._add("boxZoom",p);var b=new ks,w=new pa;f.doubleClickZoom=new pu(w,b),this._add("tapZoom",b),this._add("clickZoom",w);var A=new lo;this._add("tapDragZoom",A);var L=f.touchPitch=new Lf;this._add("touchPitch",L);var U=new Rf(l),W=new Tu(l);f.dragRotate=new ou(l,U,W),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);var fe=new tf(l),he=new za(l);f.dragPan=new Fs(c,fe,he),this._add("mousePan",fe),this._add("touchPan",he,["touchZoom","touchRotate"]);var de=new sh,Le=new ws;f.touchZoomRotate=new Ns(c,Le,de,A),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]);var Oe=f.scrollZoom=new Oi(f,this);this._add("scrollZoom",Oe,["mousePan"]);var Xe=f.keyboard=new Ws;this._add("keyboard",Xe),this._add("blockableMapEvent",new mn(f));for(var Ae=0,He=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<He.length;Ae+=1){var tt=He[Ae];l.interactive&&l[tt]&&f[tt].enable(l[tt])}},wn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},wn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},wn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},wn.prototype.isMoving=function(){return Boolean(vs(this._eventsInProgress))||this.isZooming()},wn.prototype._blockedByActive=function(l,f,c){for(var p in l)if(p!==c&&(!f||f.indexOf(p)<0))return!0;return!1},wn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},wn.prototype._getMapTouches=function(l){for(var f=[],c=0,p=l;c<p.length;c+=1){var b=p[c];this._el.contains(b.target)&&f.push(b)}return f},wn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,p={needsRenderFrame:!1},b={},w={},A=l.touches?this._getMapTouches(l.touches):void 0,L=A?F.touchPos(this._el,A):F.mousePos(this._el,l),U=0,W=this._handlers;U<W.length;U+=1){var fe=W[U],he=fe.handlerName,de=fe.handler,Le=fe.allowed;if(de.isEnabled()){var Oe=void 0;this._blockedByActive(w,Le,he)?de.reset():de[f||l.type]&&(Oe=de[f||l.type](l,L,A),this.mergeHandlerResult(p,b,Oe,he,c),Oe&&Oe.needsRenderFrame&&this._triggerRenderFrame()),(Oe||de.isActive())&&(w[he]=de)}}var Xe={};for(var Ae in this._previousActiveHandlers)w[Ae]||(Xe[Ae]=c);this._previousActiveHandlers=w,(Object.keys(Xe).length||Pn(p))&&(this._changes.push([p,b,Xe]),this._triggerRenderFrame()),(Object.keys(w).length||Pn(p))&&this._map._stop(!0),this._updatingCamera=!1;var He=p.cameraAnimation;He&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],He(this._map))},wn.prototype.mergeHandlerResult=function(l,f,c,p,b){if(c){v.extend(l,c);var w={handlerName:p,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},wn.prototype._applyChanges=function(){for(var l={},f={},c={},p=0,b=this._changes;p<b.length;p+=1){var w=b[p],A=w[0],L=w[1],U=w[2];A.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(A.panDelta)),A.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(l.around=A.around),A.pinchAround!==void 0&&(l.pinchAround=A.pinchAround),A.noInertia&&(l.noInertia=A.noInertia),v.extend(f,L),v.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},wn.prototype._updateMapTransform=function(l,f,c){var p=this._map,b=p.transform;if(!Pn(l))return this._fireEvents(f,c,!0);var w=l.panDelta,A=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,W=l.around,fe=l.pinchAround;fe!==void 0&&(W=fe),p._stop(!0),W=W||p.transform.centerPoint;var he=b.pointLocation(w?W.sub(w):W);L&&(b.bearing+=L),U&&(b.pitch+=U),A&&(b.zoom+=A),b.setLocationAtPoint(he,W),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},wn.prototype._fireEvents=function(l,f,c){var p=this,b=vs(this._eventsInProgress),w=vs(l),A={};for(var L in l)this._eventsInProgress[L]||(A[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!b&&w&&this._fireEvent("movestart",w.originalEvent),A)this._fireEvent(U,A[U]);for(var W in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(W,l[W].originalEvent);var fe,he={};for(var de in this._eventsInProgress){var Le=this._eventsInProgress[de],Oe=Le.handlerName,Xe=Le.originalEvent;this._handlersById[Oe].isActive()||(delete this._eventsInProgress[de],he[de+"end"]=fe=f[Oe]||Xe)}for(var Ae in he)this._fireEvent(Ae,he[Ae]);var He=vs(this._eventsInProgress);if(c&&(b||w)&&!He){this._updatingCamera=!0;var tt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),xt=function(Gt){return Gt!==0&&-p._bearingSnap<Gt&&Gt<p._bearingSnap};tt?(xt(tt.bearing||this._map.getBearing())&&(tt.bearing=0),this._map.easeTo(tt,{originalEvent:fe})):(this._map.fire(new v.Event("moveend",{originalEvent:fe})),xt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},wn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},wn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new Bs("renderFrame",{timeStamp:f})),l._applyChanges()})},wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var ec=function(l){function f(c,p){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,p){return this.jumpTo({center:c},p)},f.prototype.panBy=function(c,p,b){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},p),b)},f.prototype.panTo=function(c,p,b){return this.easeTo(v.extend({center:c},p),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,p){return this.jumpTo({zoom:c},p),this},f.prototype.zoomTo=function(c,p,b){return this.easeTo(v.extend({zoom:c},p),b)},f.prototype.zoomIn=function(c,p){return this.zoomTo(this.getZoom()+1,c,p),this},f.prototype.zoomOut=function(c,p){return this.zoomTo(this.getZoom()-1,c,p),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,p){return this.jumpTo({bearing:c},p),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,p){return this.jumpTo({padding:c},p),this},f.prototype.rotateTo=function(c,p,b){return this.easeTo(v.extend({bearing:c},p),b)},f.prototype.resetNorth=function(c,p){return this.rotateTo(0,v.extend({duration:1e3},c),p),this},f.prototype.resetNorthPitch=function(c,p){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),p),this},f.prototype.snapToNorth=function(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,p){return this.jumpTo({pitch:c},p),this},f.prototype.cameraForBounds=function(c,p){c=v.LngLatBounds.convert(c);var b=p&&p.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,p)},f.prototype._cameraForBoxAndBearing=function(c,p,b,w){var A={top:0,bottom:0,right:0,left:0};if(typeof(w=v.extend({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=v.extend(A,w.padding);var U=this.transform,W=U.padding,fe=U.project(v.LngLat.convert(c)),he=U.project(v.LngLat.convert(p)),de=fe.rotate(-b*Math.PI/180),Le=he.rotate(-b*Math.PI/180),Oe=new v.Point(Math.max(de.x,Le.x),Math.max(de.y,Le.y)),Xe=new v.Point(Math.min(de.x,Le.x),Math.min(de.y,Le.y)),Ae=Oe.sub(Xe),He=(U.width-(W.left+W.right+w.padding.left+w.padding.right))/Ae.x,tt=(U.height-(W.top+W.bottom+w.padding.top+w.padding.bottom))/Ae.y;if(!(tt<0||He<0)){var xt=Math.min(U.scaleZoom(U.scale*Math.min(He,tt)),w.maxZoom),Gt=typeof w.offset.x=="number"?new v.Point(w.offset.x,w.offset.y):v.Point.convert(w.offset),Nt=new v.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(b*Math.PI/180),er=Gt.add(Nt).mult(U.scale/U.zoomScale(xt));return{center:U.unproject(fe.add(he).div(2).sub(er)),zoom:xt,bearing:b}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,p,b){return this._fitInternal(this.cameraForBounds(c,p),p,b)},f.prototype.fitScreenCoordinates=function(c,p,b,w,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(p)),b,w),w,A)},f.prototype._fitInternal=function(c,p,b){return c?(delete(p=v.extend(c,p)).padding,p.linear?this.easeTo(p,b):this.flyTo(p,b)):this},f.prototype.jumpTo=function(c,p){this.stop();var b=this.transform,w=!1,A=!1,L=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(w=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=v.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(A=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(L=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new v.Event("movestart",p)).fire(new v.Event("move",p)),w&&this.fire(new v.Event("zoomstart",p)).fire(new v.Event("zoom",p)).fire(new v.Event("zoomend",p)),A&&this.fire(new v.Event("rotatestart",p)).fire(new v.Event("rotate",p)).fire(new v.Event("rotateend",p)),L&&this.fire(new v.Event("pitchstart",p)).fire(new v.Event("pitch",p)).fire(new v.Event("pitchend",p)),this.fire(new v.Event("moveend",p))},f.prototype.easeTo=function(c,p){var b=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,A=this.getZoom(),L=this.getBearing(),U=this.getPitch(),W=this.getPadding(),fe="zoom"in c?+c.zoom:A,he="bearing"in c?this._normalizeBearing(c.bearing,L):L,de="pitch"in c?+c.pitch:U,Le="padding"in c?c.padding:w.padding,Oe=v.Point.convert(c.offset),Xe=w.centerPoint.add(Oe),Ae=w.pointLocation(Xe),He=v.LngLat.convert(c.center||Ae);this._normalizeCenter(He);var tt,xt,Gt=w.project(Ae),Nt=w.project(He).sub(Gt),er=w.zoomScale(fe-A);c.around&&(tt=v.LngLat.convert(c.around),xt=w.locationPoint(tt));var mr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||fe!==A,this._rotating=this._rotating||L!==he,this._pitching=this._pitching||de!==U,this._padding=!w.isPaddingEqual(Le),this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,mr),this._ease(function(zr){if(b._zooming&&(w.zoom=v.number(A,fe,zr)),b._rotating&&(w.bearing=v.number(L,he,zr)),b._pitching&&(w.pitch=v.number(U,de,zr)),b._padding&&(w.interpolatePadding(W,Le,zr),Xe=w.centerPoint.add(Oe)),tt)w.setLocationAtPoint(tt,xt);else{var Br=w.zoomScale(w.zoom-A),sn=fe>A?Math.min(2,er):Math.max(.5,er),kn=Math.pow(sn,1-zr),Dn=w.unproject(Gt.add(Nt.mult(zr*kn)).mult(Br));w.setLocationAtPoint(w.renderWorldCopies?Dn.wrap():Dn,Xe)}b._fireMoveEvents(p)},function(zr){b._afterEase(p,zr)},c),this},f.prototype._prepareEase=function(c,p,b){b===void 0&&(b={}),this._moving=!0,p||b.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,p){if(!this._easeId||!p||this._easeId!==p){delete this._easeId;var b=this._zooming,w=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new v.Event("zoomend",c)),w&&this.fire(new v.Event("rotateend",c)),A&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,p){var b=this;if(!c.essential&&v.browser.prefersReducedMotion){var w=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,p)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var A=this.transform,L=this.getZoom(),U=this.getBearing(),W=this.getPitch(),fe=this.getPadding(),he="zoom"in c?v.clamp(+c.zoom,A.minZoom,A.maxZoom):L,de="bearing"in c?this._normalizeBearing(c.bearing,U):U,Le="pitch"in c?+c.pitch:W,Oe="padding"in c?c.padding:A.padding,Xe=A.zoomScale(he-L),Ae=v.Point.convert(c.offset),He=A.centerPoint.add(Ae),tt=A.pointLocation(He),xt=v.LngLat.convert(c.center||tt);this._normalizeCenter(xt);var Gt=A.project(tt),Nt=A.project(xt).sub(Gt),er=c.curve,mr=Math.max(A.width,A.height),zr=mr/Xe,Br=Nt.mag();if("minZoom"in c){var sn=v.clamp(Math.min(c.minZoom,L,he),A.minZoom,A.maxZoom),kn=mr/A.zoomScale(sn-L);er=Math.sqrt(kn/Br*2)}var Dn=er*er;function Cn(Xn){var Vn=(zr*zr-mr*mr+(Xn?-1:1)*Dn*Dn*Br*Br)/(2*(Xn?zr:mr)*Dn*Br);return Math.log(Math.sqrt(Vn*Vn+1)-Vn)}function Fi(Xn){return(Math.exp(Xn)-Math.exp(-Xn))/2}function $r(Xn){return(Math.exp(Xn)+Math.exp(-Xn))/2}var ai=Cn(0),ri=function(Xn){return $r(ai)/$r(ai+er*Xn)},qn=function(Xn){return mr*(($r(ai)*(Fi(Vn=ai+er*Xn)/$r(Vn))-Fi(ai))/Dn)/Br;var Vn},jn=(Cn(1)-ai)/er;if(Math.abs(Br)<1e-6||!isFinite(jn)){if(Math.abs(mr-zr)<1e-6)return this.easeTo(c,p);var pi=zr<mr?-1:1;jn=Math.abs(Math.log(zr/mr))/er,qn=function(){return 0},ri=function(Xn){return Math.exp(pi*er*Xn)}}return c.duration="duration"in c?+c.duration:1e3*jn/("screenSpeed"in c?+c.screenSpeed/er:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==de,this._pitching=Le!==W,this._padding=!A.isPaddingEqual(Oe),this._prepareEase(p,!1),this._ease(function(Xn){var Vn=Xn*jn,qi=1/ri(Vn);A.zoom=Xn===1?he:L+A.scaleZoom(qi),b._rotating&&(A.bearing=v.number(U,de,Xn)),b._pitching&&(A.pitch=v.number(W,Le,Xn)),b._padding&&(A.interpolatePadding(fe,Oe,Xn),He=A.centerPoint.add(Ae));var Li=Xn===1?xt:A.unproject(Gt.add(Nt.mult(qn(Vn))).mult(qi));A.setLocationAtPoint(A.renderWorldCopies?Li.wrap():Li,He),b._fireMoveEvents(p)},function(){return b._afterEase(p)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,p)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,p,b){b.animate===!1||b.duration===0?(c(1),p()):(this._easeStart=v.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,p){c=v.wrap(c,-180,180);var b=Math.abs(c-p);return Math.abs(c-360-p)<b&&(c-=360),Math.abs(c+360-p)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var p=this.transform;if(p.renderWorldCopies&&!p.lngRange){var b=c.lng-p.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(v.Evented),ms=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ms.prototype.getDefaultPosition=function(){return"bottom-right"},ms.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ms.prototype.onRemove=function(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ms.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},ms.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ms.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(p,b,w){return b.value&&(p+=b.key+"="+b.value+(w<f.length-1?"&":"")),p},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ms.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ms.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var p in c){var b=c[p];if(b.used){var w=b.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var A=(l=l.filter(function(L,U){for(var W=U+1;W<l.length;W++)if(l[W].indexOf(L)>=0)return!1;return!0})).join(" | ");A!==this._attribHTML&&(this._attribHTML=A,l.length?(this._innerContainer.innerHTML=A,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ms.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var du=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};du.prototype.onAdd=function(l){this._map=l,this._container=F.create("div","mapboxgl-ctrl");var f=F.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},du.prototype.onRemove=function(){F.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},du.prototype.getDefaultPosition=function(){return"bottom-left"},du.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},du.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},du.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var qo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};qo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},qo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,p=f?this._queue.concat(f):this._queue;c<p.length;c+=1){var b=p[c];if(b.id===l)return void(b.cancelled=!0)}},qo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,p=f;c<p.length;c+=1){var b=p[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},qo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ea={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ic=v.window.HTMLImageElement,Oc=v.window.HTMLElement,da=v.window.ImageBitmap,Aa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Rc=function(l){function f(p){var b=this;if((p=v.extend({},Aa,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Di(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies);if(l.call(this,w,p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new qo,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Ea,p.locale),this._clickTolerance=p.clickTolerance,this._requestManager=new v.RequestManager(p.transformRequest,p.accessToken),typeof p.container=="string"){if(this._container=v.window.document.getElementById(p.container),!this._container)throw new Error("Container '"+p.container+"' not found.")}else{if(!(p.container instanceof Oc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wn(this,p),this._hash=p.hash&&new Ls(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,v.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new ms({customAttribution:p.customAttribution})),this.addControl(new du,p.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(A){b._update(A.dataType==="style"),b.fire(new v.Event(A.dataType+"data",A))}),this.on("dataloading",function(A){b.fire(new v.Event(A.dataType+"dataloading",A))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(p,b){if(b===void 0&&(b=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=p.onAdd(this);this._controls.push(p);var A=this._controlPositions[b];return b.indexOf("bottom")!==-1?A.insertBefore(w,A.firstChild):A.appendChild(w),this},f.prototype.removeControl=function(p){if(!p||!p.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(p);return b>-1&&this._controls.splice(b,1),p.onRemove(this),this},f.prototype.hasControl=function(p){return this._controls.indexOf(p)>-1},f.prototype.resize=function(p){var b=this._containerDimensions(),w=b[0],A=b[1];if(w===this.transform.width&&A===this.transform.height)return this;this._resizeCanvas(w,A),this.transform.resize(w,A),this.painter.resize(w,A);var L=!this._moving;return L&&this.fire(new v.Event("movestart",p)).fire(new v.Event("move",p)),this.fire(new v.Event("resize",p)),L&&this.fire(new v.Event("moveend",p)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(p){return this.transform.setMaxBounds(v.LngLatBounds.convert(p)),this._update()},f.prototype.setMinZoom=function(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(p){if((p=p==null?60:p)>60)throw new Error("maxPitch must be less than or equal to 60");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(p){return this.transform.renderWorldCopies=p,this._update()},f.prototype.project=function(p){return this.transform.locationPoint(v.LngLat.convert(p))},f.prototype.unproject=function(p){return this.transform.pointLocation(v.Point.convert(p))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(p,b,w){var A,L=this;if(p==="mouseenter"||p==="mouseover"){var U=!1;return{layer:b,listener:w,delegates:{mousemove:function(fe){var he=L.getLayer(b)?L.queryRenderedFeatures(fe.point,{layers:[b]}):[];he.length?U||(U=!0,w.call(L,new Po(p,L,fe.originalEvent,{features:he}))):U=!1},mouseout:function(){U=!1}}}}if(p==="mouseleave"||p==="mouseout"){var W=!1;return{layer:b,listener:w,delegates:{mousemove:function(fe){(L.getLayer(b)?L.queryRenderedFeatures(fe.point,{layers:[b]}):[]).length?W=!0:W&&(W=!1,w.call(L,new Po(p,L,fe.originalEvent)))},mouseout:function(fe){W&&(W=!1,w.call(L,new Po(p,L,fe.originalEvent)))}}}}return{layer:b,listener:w,delegates:(A={},A[p]=function(fe){var he=L.getLayer(b)?L.queryRenderedFeatures(fe.point,{layers:[b]}):[];he.length&&(fe.features=he,w.call(L,fe),delete fe.features)},A)}},f.prototype.on=function(p,b,w){if(w===void 0)return l.prototype.on.call(this,p,b);var A=this._createDelegatedListener(p,b,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(A),A.delegates)this.on(L,A.delegates[L]);return this},f.prototype.once=function(p,b,w){if(w===void 0)return l.prototype.once.call(this,p,b);var A=this._createDelegatedListener(p,b,w);for(var L in A.delegates)this.once(L,A.delegates[L]);return this},f.prototype.off=function(p,b,w){var A=this;return w===void 0?l.prototype.off.call(this,p,b):(this._delegatedListeners&&this._delegatedListeners[p]&&function(L){for(var U=L[p],W=0;W<U.length;W++){var fe=U[W];if(fe.layer===b&&fe.listener===w){for(var he in fe.delegates)A.off(he,fe.delegates[he]);return U.splice(W,1),A}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(p,b){if(!this.style)return[];var w;if(b!==void 0||p===void 0||p instanceof v.Point||Array.isArray(p)||(b=p,p=void 0),b=b||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof p[0]=="number")w=[v.Point.convert(p)];else{var A=v.Point.convert(p[0]),L=v.Point.convert(p[1]);w=[A,new v.Point(L.x,A.y),L,new v.Point(A.x,L.y),A]}return this.style.queryRenderedFeatures(w,b,this.transform)},f.prototype.querySourceFeatures=function(p,b){return this.style.querySourceFeatures(p,b)},f.prototype.setStyle=function(p,b){return(b=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(p,b))},f.prototype._getUIString=function(p){var b=this._locale[p];if(b==null)throw new Error("Missing UI string '"+p+"'");return b},f.prototype._updateStyle=function(p,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new ds(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(p,b){var w=this;if(typeof p=="string"){var A=this._requestManager.normalizeStyleURL(p),L=this._requestManager.transformRequest(A,v.ResourceType.Style);v.getJSON(L,function(U,W){U?w.fire(new v.ErrorEvent(U)):W&&w._updateDiff(W,b)})}else typeof p=="object"&&this._updateDiff(p,b)},f.prototype._updateDiff=function(p,b){try{this.style.setState(p)&&this._update(!0)}catch(w){v.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(p,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(p,b){return this._lazyInitEmptyStyle(),this.style.addSource(p,b),this._update(!0)},f.prototype.isSourceLoaded=function(p){var b=this.style&&this.style.sourceCaches[p];if(b!==void 0)return b.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+p+"'")))},f.prototype.areTilesLoaded=function(){var p=this.style&&this.style.sourceCaches;for(var b in p){var w=p[b]._tiles;for(var A in w){var L=w[A];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(p,b,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,b,w)},f.prototype.removeSource=function(p){return this.style.removeSource(p),this._update(!0)},f.prototype.getSource=function(p){return this.style.getSource(p)},f.prototype.addImage=function(p,b,w){w===void 0&&(w={});var A=w.pixelRatio;A===void 0&&(A=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,W=w.stretchY,fe=w.content;if(this._lazyInitEmptyStyle(),b instanceof Ic||da&&b instanceof da){var he=v.browser.getImageData(b);this.style.addImage(p,{data:new v.RGBAImage({width:he.width,height:he.height},he.data),pixelRatio:A,stretchX:U,stretchY:W,content:fe,sdf:L,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var de=b;this.style.addImage(p,{data:new v.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:A,stretchX:U,stretchY:W,content:fe,sdf:L,version:0,userImage:de}),de.onAdd&&de.onAdd(this,p)}},f.prototype.updateImage=function(p,b){var w=this.style.getImage(p);if(!w)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var A=b instanceof Ic||da&&b instanceof da?v.browser.getImageData(b):b,L=A.width,U=A.height,W=A.data;return L===void 0||U===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(W,!(b instanceof Ic||da&&b instanceof da)),void this.style.updateImage(p,w))},f.prototype.hasImage=function(p){return p?!!this.style.getImage(p):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(p){this.style.removeImage(p)},f.prototype.loadImage=function(p,b){v.getImage(this._requestManager.transformRequest(p,v.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(p,b){return this._lazyInitEmptyStyle(),this.style.addLayer(p,b),this._update(!0)},f.prototype.moveLayer=function(p,b){return this.style.moveLayer(p,b),this._update(!0)},f.prototype.removeLayer=function(p){return this.style.removeLayer(p),this._update(!0)},f.prototype.getLayer=function(p){return this.style.getLayer(p)},f.prototype.setLayerZoomRange=function(p,b,w){return this.style.setLayerZoomRange(p,b,w),this._update(!0)},f.prototype.setFilter=function(p,b,w){return w===void 0&&(w={}),this.style.setFilter(p,b,w),this._update(!0)},f.prototype.getFilter=function(p){return this.style.getFilter(p)},f.prototype.setPaintProperty=function(p,b,w,A){return A===void 0&&(A={}),this.style.setPaintProperty(p,b,w,A),this._update(!0)},f.prototype.getPaintProperty=function(p,b){return this.style.getPaintProperty(p,b)},f.prototype.setLayoutProperty=function(p,b,w,A){return A===void 0&&(A={}),this.style.setLayoutProperty(p,b,w,A),this._update(!0)},f.prototype.getLayoutProperty=function(p,b){return this.style.getLayoutProperty(p,b)},f.prototype.setLight=function(p,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(p,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(p,b){return this.style.setFeatureState(p,b),this._update()},f.prototype.removeFeatureState=function(p,b){return this.style.removeFeatureState(p,b),this._update()},f.prototype.getFeatureState=function(p){return this.style.getFeatureState(p)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var p=0,b=0;return this._container&&(p=this._container.clientWidth||400,b=this._container.clientHeight||300),[p,b]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=F.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=F.create("div","mapboxgl-canvas-container",p);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=F.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var A=this._controlContainer=F.create("div","mapboxgl-control-container",p),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=F.create("div","mapboxgl-ctrl-"+U,A)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(p,b){var w=v.browser.devicePixelRatio||1;this._canvas.width=w*p,this._canvas.height=w*b,this._canvas.style.width=p+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var p=v.extend({},ee.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);b?(this.painter=new Ha(b,this.transform),v.webpSupported.testSupport(b)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:p}))},f.prototype._contextRestored=function(p){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:p}))},f.prototype._onMapScroll=function(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(p){return this._update(),this._renderTaskQueue.add(p)},f.prototype._cancelRenderFrame=function(p){this._renderTaskQueue.remove(p)},f.prototype._render=function(p){var b,w=this,A=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,b),A=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var W=this.transform.zoom,fe=v.browser.now();this.style.zoomHistory.update(W,fe);var he=new v.EvaluationParameters(W,{now:fe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=he.crossFadingFactor();de===1&&de===this._crossFadingFactor||(U=!0,this._crossFadingFactor=de),this.style.update(he)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Le=v.browser.now()-A;L.endQueryEXT(L.TIME_ELAPSED_EXT,b),setTimeout(function(){var Ae=L.getQueryObjectEXT(b,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(b),w.fire(new v.Event("gpu-timing-frame",{cpuTime:Le,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Oe=this.painter.collectGpuTimers();setTimeout(function(){var Ae=w.painter.queryGpuTimers(Oe);w.fire(new v.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var Xe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Xe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Xe||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var p=0,b=this._controls;p<b.length;p+=1)b[p].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Ml(this._canvasContainer),Ml(this._controlContainer),Ml(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var p=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(b){p._frame=null,p._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(p){this._trackResize&&this.resize({originalEvent:p})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(p){this._showPadding!==p&&(this._showPadding=p,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(p){this._vertices=p,this._update()},f.prototype._setCacheLimits=function(p,b){v.setCacheLimits(p,b)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(ec);function Ml(l){l.parentNode&&l.parentNode.removeChild(l)}var vu={showCompass:!0,showZoom:!0,visualizePitch:!1},Xs=function(l){var f=this;this.options=v.extend({},vu,l),this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=F.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Xs.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Xs.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Xs.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Io(this._map,this._compass,this.options.visualizePitch)),this._container},Xs.prototype.onRemove=function(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Xs.prototype._createButton=function(l,f){var c=F.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Xs.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var Io=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Rf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Tu({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),F.addEventListener(f,"mousedown",this.mousedown),F.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(f,"touchmove",this.touchmove),F.addEventListener(f,"touchend",this.touchend),F.addEventListener(f,"touchcancel",this.reset)};function hl(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var p=new v.LngLat(l.lng-360,l.lat),b=new v.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(p).distSqr(f)<w?l=p:c.locationPoint(b).distSqr(f)<w&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var A=c.locationPoint(l);if(A.x>=0&&A.y>=0&&A.x<=c.width&&A.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Io.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),F.disableDrag()},Io.prototype.move=function(l,f){var c=this.map,p=this.mouseRotate.mousemoveWindow(l,f);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},Io.prototype.off=function(){var l=this.element;F.removeEventListener(l,"mousedown",this.mousedown),F.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(l,"touchmove",this.touchmove),F.removeEventListener(l,"touchend",this.touchend),F.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Io.prototype.offTemp=function(){F.enableDrag(),F.removeEventListener(v.window,"mousemove",this.mousemove),F.removeEventListener(v.window,"mouseup",this.mouseup)},Io.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),F.mousePos(this.element,l)),F.addEventListener(v.window,"mousemove",this.mousemove),F.addEventListener(v.window,"mouseup",this.mouseup)},Io.prototype.mousemove=function(l){this.move(l,F.mousePos(this.element,l))},Io.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Io.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Io.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Io.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Io.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var mu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nf(l,f,c){var p=l.classList;for(var b in mu)p.remove("mapboxgl-"+c+"-anchor-"+b);p.add("mapboxgl-"+c+"-anchor-"+f)}var Pl,Il=function(l){function f(c,p){if(l.call(this),(c instanceof v.window.HTMLElement||p)&&(c=v.extend({element:c},p)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");var b=F.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var w=F.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var A=F.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");var L=F.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<W.length;U+=1){var fe=W[U],he=F.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",fe.rx),he.setAttributeNS(null,"ry",fe.ry),L.appendChild(he)}var de=F.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"fill",this._color);var Le=F.createNS("http://www.w3.org/2000/svg","path");Le.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),de.appendChild(Le);var Oe=F.createNS("http://www.w3.org/2000/svg","g");Oe.setAttributeNS(null,"opacity","0.25"),Oe.setAttributeNS(null,"fill","#000000");var Xe=F.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Oe.appendChild(Xe);var Ae=F.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var He=F.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"transform","translate(8.0, 8.0)");var tt=F.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");var xt=F.createNS("http://www.w3.org/2000/svg","circle");xt.setAttributeNS(null,"fill","#FFFFFF"),xt.setAttributeNS(null,"cx","5.5"),xt.setAttributeNS(null,"cy","5.5"),xt.setAttributeNS(null,"r","5.4999962"),He.appendChild(tt),He.appendChild(xt),A.appendChild(L),A.appendChild(de),A.appendChild(Oe),A.appendChild(Ae),A.appendChild(He),b.appendChild(A),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Gt){Gt.preventDefault()}),this._element.addEventListener("mousedown",function(Gt){Gt.preventDefault()}),nf(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var p=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(24.6+p)],"bottom-right":[-p,-1*(24.6+p)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var p=c.code,b=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var p=c.originalEvent.target,b=this._element;this._popup&&(p===b||b.contains(p))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(p="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,mu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+p)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),Ol={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},tc=0,pl=!1,lh=function(l){function f(c){l.call(this),this.options=v.extend({},Ol,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var p;return this._map=c,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),p=this._setupUI,Pl!==void 0?p(Pl):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(b){p(Pl=b.state!=="denied")}):p(Pl=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,tc=0,pl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var p=this._map.getMaxBounds(),b=c.coords;return p&&(b.longitude<p.getWest()||b.longitude>p.getEast()||b.latitude<p.getSouth()||b.latitude>p.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var p=new v.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,w=this._map.getBearing(),A=v.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(p.toBounds(b),A,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var p=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,p=this._map.unproject([0,c]),b=this._map.unproject([1,c]),w=p.distanceTo(b),A=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=A+"px",this._circleElement.style.height=A+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&pl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var p=this;if(this._container.addEventListener("contextmenu",function(A){return A.preventDefault()}),this._geolocateButton=F.create("button","mapboxgl-ctrl-geolocate",this._container),F.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Il(this._dotElement),this._circleElement=F.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Il({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(A){A.geolocateSource||p._watchState!=="ACTIVE_LOCK"||A.originalEvent&&A.originalEvent.type==="resize"||(p._watchState="BACKGROUND",p._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),p._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),p.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tc--,pl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++tc>1?(c={maximumAge:6e5,timeout:0},pl=!0):(c=this.options.positionOptions,pl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),Ku={maxWidth:100,unit:"metric"},Pu=function(l){this.options=v.extend({},Ku,l),v.bindAll(["_onMove","setUnit"],this)};function kf(l,f,c){var p=c&&c.maxWidth||100,b=l._container.clientHeight/2,w=l.unproject([0,b]),A=l.unproject([p,b]),L=w.distanceTo(A);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?dl(f,p,U/5280,l._getUIString("ScaleControl.Miles")):dl(f,p,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?dl(f,p,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?dl(f,p,L/1e3,l._getUIString("ScaleControl.Kilometers")):dl(f,p,L,l._getUIString("ScaleControl.Meters"))}function dl(l,f,c,p){var b,w,A,L=(b=c,(w=Math.pow(10,(""+Math.floor(b)).length-1))*(A=(A=b/w)>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(U){var W=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*W)/W}(A)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+p}Pu.prototype.getDefaultPosition=function(){return"bottom-left"},Pu.prototype._onMove=function(){kf(this._map,this._container,this.options)},Pu.prototype.onAdd=function(l){return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Pu.prototype.onRemove=function(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Pu.prototype.setUnit=function(l){this.options.unit=l,kf(this._map,this._container,this.options)};var Ys=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ys.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ys.prototype.onRemove=function(){F.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ys.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Ys.prototype._setupUI=function(){var l=this._fullscreenButton=F.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ys.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ys.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ys.prototype._isFullscreen=function(){return this._fullscreen},Ys.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ys.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var af={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},gu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ch=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(af),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var p,b=v.window.document.createDocumentFragment(),w=v.window.document.createElement("body");for(w.innerHTML=c;p=w.firstChild;)b.appendChild(p);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=F.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var p=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=F.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=F.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(he){return p._container.classList.add(he)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,A=function he(de){if(de){if(typeof de=="number"){var Le=Math.round(Math.sqrt(.5*Math.pow(de,2)));return{center:new v.Point(0,0),top:new v.Point(0,de),"top-left":new v.Point(Le,Le),"top-right":new v.Point(-Le,Le),bottom:new v.Point(0,-de),"bottom-left":new v.Point(Le,-Le),"bottom-right":new v.Point(-Le,-Le),left:new v.Point(de,0),right:new v.Point(-de,0)}}if(de instanceof v.Point||Array.isArray(de)){var Oe=v.Point.convert(de);return{center:Oe,top:Oe,"top-left":Oe,"top-right":Oe,bottom:Oe,"bottom-left":Oe,"bottom-right":Oe,left:Oe,right:Oe}}return{center:v.Point.convert(de.center||[0,0]),top:v.Point.convert(de.top||[0,0]),"top-left":v.Point.convert(de["top-left"]||[0,0]),"top-right":v.Point.convert(de["top-right"]||[0,0]),bottom:v.Point.convert(de.bottom||[0,0]),"bottom-left":v.Point.convert(de["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(de["bottom-right"]||[0,0]),left:v.Point.convert(de.left||[0,0]),right:v.Point.convert(de.right||[0,0])}}return he(new v.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,W=this._container.offsetHeight;L=b.y+A.bottom.y<W?["top"]:b.y>this._map.transform.height-W?["bottom"]:[],b.x<U/2?L.push("left"):b.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var fe=b.add(A[w]).round();F.setTransform(this._container,mu[w]+" translate("+fe.x+"px,"+fe.y+"px)"),nf(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(gu);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),rc={version:v.version,supported:ee,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Rc,NavigationControl:Xs,GeolocateControl:lh,AttributionControl:ms,ScaleControl:Pu,FullscreenControl:Ys,Popup:ch,Marker:Il,Style:ds,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Tt().acquire(Dt)},clearPrewarmedResources:function(){var l=bn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Dt),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return gr.workerCount},set workerCount(l){gr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return rc}),Y})},28660:function(Ue,H,R){var Y=R(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var $;(function(v){(function(ee){var F=typeof R.g=="object"?R.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),J=re(v);typeof F.Reflect=="undefined"?F.Reflect=v:J=re(F.Reflect,J),ee(J);function re(Ee,ne){return function(je,we){typeof Ee[je]!="function"&&Object.defineProperty(Ee,je,{configurable:!0,writable:!0,value:we}),ne&&ne(je,we)}}})(function(ee){var F=Object.prototype.hasOwnProperty,J=typeof Symbol=="function",re=J&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ee=J&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",je={__proto__:[]}instanceof Array,we=!ne&&!je,et={create:ne?function(){return fs(Object.create(null))}:je?function(){return fs({__proto__:null})}:function(){return fs({})},has:we?function(zt,ir){return F.call(zt,ir)}:function(zt,ir){return ir in zt},get:we?function(zt,ir){return F.call(zt,ir)?zt[ir]:void 0}:function(zt,ir){return zt[ir]}},Mt=Object.getPrototypeOf(Function),nr=typeof Y=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",_t=!nr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:me(),Xt=!nr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ln(),Ct=!nr&&typeof WeakMap=="function"?WeakMap:Va(),ot=new Ct;function ut(zt,ir,Ir,I){if(hn(Ir)){if(!Si(zt))throw new TypeError;if(!ua(ir))throw new TypeError;return Rr(zt,ir)}else{if(!Si(zt))throw new TypeError;if(!Gn(ir))throw new TypeError;if(!Gn(I)&&!hn(I)&&!Ki(I))throw new TypeError;return Ki(I)&&(I=void 0),Ir=Ri(Ir),Hr(zt,ir,Ir,I)}}ee("decorate",ut);function Jt(zt,ir){function Ir(I,sr){if(!Gn(I))throw new TypeError;if(!hn(sr)&&!wi(sr))throw new TypeError;Ft(zt,ir,I,sr)}return Ir}ee("metadata",Jt);function X(zt,ir,Ir,I){if(!Gn(Ir))throw new TypeError;return hn(I)||(I=Ri(I)),Ft(zt,ir,Ir,I)}ee("defineMetadata",X);function Yt(zt,ir,Ir){if(!Gn(ir))throw new TypeError;return hn(Ir)||(Ir=Ri(Ir)),Ye(zt,ir,Ir)}ee("hasMetadata",Yt);function dt(zt,ir,Ir){if(!Gn(ir))throw new TypeError;return hn(Ir)||(Ir=Ri(Ir)),ke(zt,ir,Ir)}ee("hasOwnMetadata",dt);function qe(zt,ir,Ir){if(!Gn(ir))throw new TypeError;return hn(Ir)||(Ir=Ri(Ir)),At(zt,ir,Ir)}ee("getMetadata",qe);function ht(zt,ir,Ir){if(!Gn(ir))throw new TypeError;return hn(Ir)||(Ir=Ri(Ir)),gt(zt,ir,Ir)}ee("getOwnMetadata",ht);function $e(zt,ir){if(!Gn(zt))throw new TypeError;return hn(ir)||(ir=Ri(ir)),qt(zt,ir)}ee("getMetadataKeys",$e);function Rt(zt,ir){if(!Gn(zt))throw new TypeError;return hn(ir)||(ir=Ri(ir)),Cr(zt,ir)}ee("getOwnMetadataKeys",Rt);function yr(zt,ir,Ir){if(!Gn(ir))throw new TypeError;hn(Ir)||(Ir=Ri(Ir));var I=Te(ir,Ir,!1);if(hn(I)||!I.delete(zt))return!1;if(I.size>0)return!0;var sr=ot.get(ir);return sr.delete(Ir),sr.size>0||ot.delete(ir),!0}ee("deleteMetadata",yr);function Rr(zt,ir){for(var Ir=zt.length-1;Ir>=0;--Ir){var I=zt[Ir],sr=I(ir);if(!hn(sr)&&!Ki(sr)){if(!ua(sr))throw new TypeError;ir=sr}}return ir}function Hr(zt,ir,Ir,I){for(var sr=zt.length-1;sr>=0;--sr){var On=zt[sr],ui=On(ir,Ir,I);if(!hn(ui)&&!Ki(ui)){if(!Gn(ui))throw new TypeError;I=ui}}return I}function Te(zt,ir,Ir){var I=ot.get(zt);if(hn(I)){if(!Ir)return;I=new _t,ot.set(zt,I)}var sr=I.get(ir);if(hn(sr)){if(!Ir)return;sr=new _t,I.set(ir,sr)}return sr}function Ye(zt,ir,Ir){var I=ke(zt,ir,Ir);if(I)return!0;var sr=ja(ir);return Ki(sr)?!1:Ye(zt,sr,Ir)}function ke(zt,ir,Ir){var I=Te(ir,Ir,!1);return hn(I)?!1:si(I.has(zt))}function At(zt,ir,Ir){var I=ke(zt,ir,Ir);if(I)return gt(zt,ir,Ir);var sr=ja(ir);if(!Ki(sr))return At(zt,sr,Ir)}function gt(zt,ir,Ir){var I=Te(ir,Ir,!1);if(!hn(I))return I.get(zt)}function Ft(zt,ir,Ir,I){var sr=Te(Ir,I,!0);sr.set(zt,ir)}function qt(zt,ir){var Ir=Cr(zt,ir),I=ja(zt);if(I===null)return Ir;var sr=qt(I,ir);if(sr.length<=0)return Ir;if(Ir.length<=0)return sr;for(var On=new Xt,ui=[],Zn=0,nn=Ir;Zn<nn.length;Zn++){var Ti=nn[Zn],Mi=On.has(Ti);Mi||(On.add(Ti),ui.push(Ti))}for(var Ya=0,hs=sr;Ya<hs.length;Ya++){var Ti=hs[Ya],Mi=On.has(Ti);Mi||(On.add(Ti),ui.push(Ti))}return ui}function Cr(zt,ir){var Ir=[],I=Te(zt,ir,!1);if(hn(I))return Ir;for(var sr=I.keys(),On=An(sr),ui=0;;){var Zn=zi(On);if(!Zn)return Ir.length=ui,Ir;var nn=yi(Zn);try{Ir[ui]=nn}catch(Ti){try{$i(On)}finally{throw Ti}}ui++}}function Hn(zt){if(zt===null)return 1;switch(typeof zt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return zt===null?1:6;default:return 6}}function hn(zt){return zt===void 0}function Ki(zt){return zt===null}function Bn(zt){return typeof zt=="symbol"}function Gn(zt){return typeof zt=="object"?zt!==null:typeof zt=="function"}function hi(zt,ir){switch(Hn(zt)){case 0:return zt;case 1:return zt;case 2:return zt;case 3:return zt;case 4:return zt;case 5:return zt}var Ir=ir===3?"string":ir===5?"number":"default",I=xa(zt,re);if(I!==void 0){var sr=I.call(zt,Ir);if(Gn(sr))throw new TypeError;return sr}return Wn(zt,Ir==="default"?"number":Ir)}function Wn(zt,ir){if(ir==="string"){var Ir=zt.toString;if(Vi(Ir)){var I=Ir.call(zt);if(!Gn(I))return I}var sr=zt.valueOf;if(Vi(sr)){var I=sr.call(zt);if(!Gn(I))return I}}else{var sr=zt.valueOf;if(Vi(sr)){var I=sr.call(zt);if(!Gn(I))return I}var On=zt.toString;if(Vi(On)){var I=On.call(zt);if(!Gn(I))return I}}throw new TypeError}function si(zt){return!!zt}function aa(zt){return""+zt}function Ri(zt){var ir=hi(zt,3);return Bn(ir)?ir:aa(ir)}function Si(zt){return Array.isArray?Array.isArray(zt):zt instanceof Object?zt instanceof Array:Object.prototype.toString.call(zt)==="[object Array]"}function Vi(zt){return typeof zt=="function"}function ua(zt){return typeof zt=="function"}function wi(zt){switch(Hn(zt)){case 3:return!0;case 4:return!0;default:return!1}}function xa(zt,ir){var Ir=zt[ir];if(Ir!=null){if(!Vi(Ir))throw new TypeError;return Ir}}function An(zt){var ir=xa(zt,Ee);if(!Vi(ir))throw new TypeError;var Ir=ir.call(zt);if(!Gn(Ir))throw new TypeError;return Ir}function yi(zt){return zt.value}function zi(zt){var ir=zt.next();return ir.done?!1:ir}function $i(zt){var ir=zt.return;ir&&ir.call(zt)}function ja(zt){var ir=Object.getPrototypeOf(zt);if(typeof zt!="function"||zt===Mt||ir!==Mt)return ir;var Ir=zt.prototype,I=Ir&&Object.getPrototypeOf(Ir);if(I==null||I===Object.prototype)return ir;var sr=I.constructor;return typeof sr!="function"||sr===zt?ir:sr}function me(){var zt={},ir=[],Ir=function(){function ui(Zn,nn,Ti){this._index=0,this._keys=Zn,this._values=nn,this._selector=Ti}return ui.prototype["@@iterator"]=function(){return this},ui.prototype[Ee]=function(){return this},ui.prototype.next=function(){var Zn=this._index;if(Zn>=0&&Zn<this._keys.length){var nn=this._selector(this._keys[Zn],this._values[Zn]);return Zn+1>=this._keys.length?(this._index=-1,this._keys=ir,this._values=ir):this._index++,{value:nn,done:!1}}return{value:void 0,done:!0}},ui.prototype.throw=function(Zn){throw this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),Zn},ui.prototype.return=function(Zn){return this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),{value:Zn,done:!0}},ui}();return function(){function ui(){this._keys=[],this._values=[],this._cacheKey=zt,this._cacheIndex=-2}return Object.defineProperty(ui.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ui.prototype.has=function(Zn){return this._find(Zn,!1)>=0},ui.prototype.get=function(Zn){var nn=this._find(Zn,!1);return nn>=0?this._values[nn]:void 0},ui.prototype.set=function(Zn,nn){var Ti=this._find(Zn,!0);return this._values[Ti]=nn,this},ui.prototype.delete=function(Zn){var nn=this._find(Zn,!1);if(nn>=0){for(var Ti=this._keys.length,Mi=nn+1;Mi<Ti;Mi++)this._keys[Mi-1]=this._keys[Mi],this._values[Mi-1]=this._values[Mi];return this._keys.length--,this._values.length--,Zn===this._cacheKey&&(this._cacheKey=zt,this._cacheIndex=-2),!0}return!1},ui.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=zt,this._cacheIndex=-2},ui.prototype.keys=function(){return new Ir(this._keys,this._values,I)},ui.prototype.values=function(){return new Ir(this._keys,this._values,sr)},ui.prototype.entries=function(){return new Ir(this._keys,this._values,On)},ui.prototype["@@iterator"]=function(){return this.entries()},ui.prototype[Ee]=function(){return this.entries()},ui.prototype._find=function(Zn,nn){return this._cacheKey!==Zn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Zn)),this._cacheIndex<0&&nn&&(this._cacheIndex=this._keys.length,this._keys.push(Zn),this._values.push(void 0)),this._cacheIndex},ui}();function I(ui,Zn){return ui}function sr(ui,Zn){return Zn}function On(ui,Zn){return[ui,Zn]}}function Ln(){return function(){function zt(){this._map=new _t}return Object.defineProperty(zt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),zt.prototype.has=function(ir){return this._map.has(ir)},zt.prototype.add=function(ir){return this._map.set(ir,ir),this},zt.prototype.delete=function(ir){return this._map.delete(ir)},zt.prototype.clear=function(){this._map.clear()},zt.prototype.keys=function(){return this._map.keys()},zt.prototype.values=function(){return this._map.values()},zt.prototype.entries=function(){return this._map.entries()},zt.prototype["@@iterator"]=function(){return this.keys()},zt.prototype[Ee]=function(){return this.keys()},zt}()}function Va(){var zt=16,ir=et.create(),Ir=I();return function(){function nn(){this._key=I()}return nn.prototype.has=function(Ti){var Mi=sr(Ti,!1);return Mi!==void 0?et.has(Mi,this._key):!1},nn.prototype.get=function(Ti){var Mi=sr(Ti,!1);return Mi!==void 0?et.get(Mi,this._key):void 0},nn.prototype.set=function(Ti,Mi){var Ya=sr(Ti,!0);return Ya[this._key]=Mi,this},nn.prototype.delete=function(Ti){var Mi=sr(Ti,!1);return Mi!==void 0?delete Mi[this._key]:!1},nn.prototype.clear=function(){this._key=I()},nn}();function I(){var nn;do nn="@@WeakMap@@"+Zn();while(et.has(ir,nn));return ir[nn]=!0,nn}function sr(nn,Ti){if(!F.call(nn,Ir)){if(!Ti)return;Object.defineProperty(nn,Ir,{value:et.create()})}return nn[Ir]}function On(nn,Ti){for(var Mi=0;Mi<Ti;++Mi)nn[Mi]=Math.random()*255|0;return nn}function ui(nn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(nn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(nn)):On(new Uint8Array(nn),nn):On(new Array(nn),nn)}function Zn(){var nn=ui(zt);nn[6]=nn[6]&79|64,nn[8]=nn[8]&191|128;for(var Ti="",Mi=0;Mi<zt;++Mi){var Ya=nn[Mi];(Mi===4||Mi===6||Mi===8)&&(Ti+="-"),Ya<16&&(Ti+="0"),Ti+=Ya.toString(16).toLowerCase()}return Ti}}function fs(zt){return zt.__=void 0,delete zt.__,zt}})})($||($={}))},69848:function(Ue){(function(H,R){Ue.exports=R()})(this,function(){"use strict";function H(dt,qe,ht,$e,Rt,yr){if(!(Rt-$e<=ht)){var Rr=$e+Rt>>1;R(dt,qe,Rr,$e,Rt,yr%2),H(dt,qe,ht,$e,Rr-1,yr+1),H(dt,qe,ht,Rr+1,Rt,yr+1)}}function R(dt,qe,ht,$e,Rt,yr){for(;Rt>$e;){if(Rt-$e>600){var Rr=Rt-$e+1,Hr=ht-$e+1,Te=Math.log(Rr),Ye=.5*Math.exp(2*Te/3),ke=.5*Math.sqrt(Te*Ye*(Rr-Ye)/Rr)*(Hr-Rr/2<0?-1:1),At=Math.max($e,Math.floor(ht-Hr*Ye/Rr+ke)),gt=Math.min(Rt,Math.floor(ht+(Rr-Hr)*Ye/Rr+ke));R(dt,qe,ht,At,gt,yr)}var Ft=qe[2*ht+yr],qt=$e,Cr=Rt;for(Y(dt,qe,$e,ht),qe[2*Rt+yr]>Ft&&Y(dt,qe,$e,Rt);qt<Cr;){for(Y(dt,qe,qt,Cr),qt++,Cr--;qe[2*qt+yr]<Ft;)qt++;for(;qe[2*Cr+yr]>Ft;)Cr--}qe[2*$e+yr]===Ft?Y(dt,qe,$e,Cr):(Cr++,Y(dt,qe,Cr,Rt)),Cr<=ht&&($e=Cr+1),ht<=Cr&&(Rt=Cr-1)}}function Y(dt,qe,ht,$e){$(dt,ht,$e),$(qe,2*ht,2*$e),$(qe,2*ht+1,2*$e+1)}function $(dt,qe,ht){var $e=dt[qe];dt[qe]=dt[ht],dt[ht]=$e}function v(dt,qe,ht,$e,Rt,yr,Rr){for(var Hr=[0,dt.length-1,0],Te=[],Ye,ke;Hr.length;){var At=Hr.pop(),gt=Hr.pop(),Ft=Hr.pop();if(gt-Ft<=Rr){for(var qt=Ft;qt<=gt;qt++)Ye=qe[2*qt],ke=qe[2*qt+1],Ye>=ht&&Ye<=Rt&&ke>=$e&&ke<=yr&&Te.push(dt[qt]);continue}var Cr=Math.floor((Ft+gt)/2);Ye=qe[2*Cr],ke=qe[2*Cr+1],Ye>=ht&&Ye<=Rt&&ke>=$e&&ke<=yr&&Te.push(dt[Cr]);var Hn=(At+1)%2;(At===0?ht<=Ye:$e<=ke)&&(Hr.push(Ft),Hr.push(Cr-1),Hr.push(Hn)),(At===0?Rt>=Ye:yr>=ke)&&(Hr.push(Cr+1),Hr.push(gt),Hr.push(Hn))}return Te}function ee(dt,qe,ht,$e,Rt,yr){for(var Rr=[0,dt.length-1,0],Hr=[],Te=Rt*Rt;Rr.length;){var Ye=Rr.pop(),ke=Rr.pop(),At=Rr.pop();if(ke-At<=yr){for(var gt=At;gt<=ke;gt++)F(qe[2*gt],qe[2*gt+1],ht,$e)<=Te&&Hr.push(dt[gt]);continue}var Ft=Math.floor((At+ke)/2),qt=qe[2*Ft],Cr=qe[2*Ft+1];F(qt,Cr,ht,$e)<=Te&&Hr.push(dt[Ft]);var Hn=(Ye+1)%2;(Ye===0?ht-Rt<=qt:$e-Rt<=Cr)&&(Rr.push(At),Rr.push(Ft-1),Rr.push(Hn)),(Ye===0?ht+Rt>=qt:$e+Rt>=Cr)&&(Rr.push(Ft+1),Rr.push(ke),Rr.push(Hn))}return Hr}function F(dt,qe,ht,$e){var Rt=dt-ht,yr=qe-$e;return Rt*Rt+yr*yr}var J=function(dt){return dt[0]},re=function(dt){return dt[1]},Ee=function(qe,ht,$e,Rt,yr){ht===void 0&&(ht=J),$e===void 0&&($e=re),Rt===void 0&&(Rt=64),yr===void 0&&(yr=Float64Array),this.nodeSize=Rt,this.points=qe;for(var Rr=qe.length<65536?Uint16Array:Uint32Array,Hr=this.ids=new Rr(qe.length),Te=this.coords=new yr(qe.length*2),Ye=0;Ye<qe.length;Ye++)Hr[Ye]=Ye,Te[2*Ye]=ht(qe[Ye]),Te[2*Ye+1]=$e(qe[Ye]);H(Hr,Te,Rt,0,Hr.length-1,0)};Ee.prototype.range=function(qe,ht,$e,Rt){return v(this.ids,this.coords,qe,ht,$e,Rt,this.nodeSize)},Ee.prototype.within=function(qe,ht,$e){return ee(this.ids,this.coords,qe,ht,$e,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(dt){return dt}},je=Math.fround||function(dt){return function(qe){return dt[0]=+qe,dt[0]}}(new Float32Array(1)),we=function(qe){this.options=Jt(Object.create(ne),qe),this.trees=new Array(this.options.maxZoom+1)};we.prototype.load=function(qe){var ht=this.options,$e=ht.log,Rt=ht.minZoom,yr=ht.maxZoom,Rr=ht.nodeSize;$e&&console.time("total time");var Hr="prepare "+qe.length+" points";$e&&console.time(Hr),this.points=qe;for(var Te=[],Ye=0;Ye<qe.length;Ye++)!qe[Ye].geometry||Te.push(Mt(qe[Ye],Ye));this.trees[yr+1]=new Ee(Te,X,Yt,Rr,Float32Array),$e&&console.timeEnd(Hr);for(var ke=yr;ke>=Rt;ke--){var At=+Date.now();Te=this._cluster(Te,ke),this.trees[ke]=new Ee(Te,X,Yt,Rr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",ke,Te.length,+Date.now()-At)}return $e&&console.timeEnd("total time"),this},we.prototype.getClusters=function(qe,ht){var $e=((qe[0]+180)%360+360)%360-180,Rt=Math.max(-90,Math.min(90,qe[1])),yr=qe[2]===180?180:((qe[2]+180)%360+360)%360-180,Rr=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)$e=-180,yr=180;else if($e>yr){var Hr=this.getClusters([$e,Rt,180,Rr],ht),Te=this.getClusters([-180,Rt,yr,Rr],ht);return Hr.concat(Te)}for(var Ye=this.trees[this._limitZoom(ht)],ke=Ye.range(Xt($e),Ct(Rr),Xt(yr),Ct(Rt)),At=[],gt=0,Ft=ke;gt<Ft.length;gt+=1){var qt=Ft[gt],Cr=Ye.points[qt];At.push(Cr.numPoints?nr(Cr):this.points[Cr.index])}return At},we.prototype.getChildren=function(qe){var ht=this._getOriginId(qe),$e=this._getOriginZoom(qe),Rt="No cluster with the specified id.",yr=this.trees[$e];if(!yr)throw new Error(Rt);var Rr=yr.points[ht];if(!Rr)throw new Error(Rt);for(var Hr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),Te=yr.within(Rr.x,Rr.y,Hr),Ye=[],ke=0,At=Te;ke<At.length;ke+=1){var gt=At[ke],Ft=yr.points[gt];Ft.parentId===qe&&Ye.push(Ft.numPoints?nr(Ft):this.points[Ft.index])}if(Ye.length===0)throw new Error(Rt);return Ye},we.prototype.getLeaves=function(qe,ht,$e){ht=ht||10,$e=$e||0;var Rt=[];return this._appendLeaves(Rt,qe,ht,$e,0),Rt},we.prototype.getTile=function(qe,ht,$e){var Rt=this.trees[this._limitZoom(qe)],yr=Math.pow(2,qe),Rr=this.options,Hr=Rr.extent,Te=Rr.radius,Ye=Te/Hr,ke=($e-Ye)/yr,At=($e+1+Ye)/yr,gt={features:[]};return this._addTileFeatures(Rt.range((ht-Ye)/yr,ke,(ht+1+Ye)/yr,At),Rt.points,ht,$e,yr,gt),ht===0&&this._addTileFeatures(Rt.range(1-Ye/yr,ke,1,At),Rt.points,yr,$e,yr,gt),ht===yr-1&&this._addTileFeatures(Rt.range(0,ke,Ye/yr,At),Rt.points,-1,$e,yr,gt),gt.features.length?gt:null},we.prototype.getClusterExpansionZoom=function(qe){for(var ht=this._getOriginZoom(qe)-1;ht<=this.options.maxZoom;){var $e=this.getChildren(qe);if(ht++,$e.length!==1)break;qe=$e[0].properties.cluster_id}return ht},we.prototype._appendLeaves=function(qe,ht,$e,Rt,yr){for(var Rr=this.getChildren(ht),Hr=0,Te=Rr;Hr<Te.length;Hr+=1){var Ye=Te[Hr],ke=Ye.properties;if(ke&&ke.cluster?yr+ke.point_count<=Rt?yr+=ke.point_count:yr=this._appendLeaves(qe,ke.cluster_id,$e,Rt,yr):yr<Rt?yr++:qe.push(Ye),qe.length===$e)break}return yr},we.prototype._addTileFeatures=function(qe,ht,$e,Rt,yr,Rr){for(var Hr=0,Te=qe;Hr<Te.length;Hr+=1){var Ye=Te[Hr],ke=ht[Ye],At=ke.numPoints,gt=void 0,Ft=void 0,qt=void 0;if(At)gt=_t(ke),Ft=ke.x,qt=ke.y;else{var Cr=this.points[ke.index];gt=Cr.properties,Ft=Xt(Cr.geometry.coordinates[0]),qt=Ct(Cr.geometry.coordinates[1])}var Hn={type:1,geometry:[[Math.round(this.options.extent*(Ft*yr-$e)),Math.round(this.options.extent*(qt*yr-Rt))]],tags:gt},hn=void 0;At?hn=ke.id:this.options.generateId?hn=ke.index:this.points[ke.index].id&&(hn=this.points[ke.index].id),hn!==void 0&&(Hn.id=hn),Rr.features.push(Hn)}},we.prototype._limitZoom=function(qe){return Math.max(this.options.minZoom,Math.min(+qe,this.options.maxZoom+1))},we.prototype._cluster=function(qe,ht){for(var $e=[],Rt=this.options,yr=Rt.radius,Rr=Rt.extent,Hr=Rt.reduce,Te=Rt.minPoints,Ye=yr/(Rr*Math.pow(2,ht)),ke=0;ke<qe.length;ke++){var At=qe[ke];if(!(At.zoom<=ht)){At.zoom=ht;for(var gt=this.trees[ht+1],Ft=gt.within(At.x,At.y,Ye),qt=At.numPoints||1,Cr=qt,Hn=0,hn=Ft;Hn<hn.length;Hn+=1){var Ki=hn[Hn],Bn=gt.points[Ki];Bn.zoom>ht&&(Cr+=Bn.numPoints||1)}if(Cr>qt&&Cr>=Te){for(var Gn=At.x*qt,hi=At.y*qt,Wn=Hr&&qt>1?this._map(At,!0):null,si=(ke<<5)+(ht+1)+this.points.length,aa=0,Ri=Ft;aa<Ri.length;aa+=1){var Si=Ri[aa],Vi=gt.points[Si];if(!(Vi.zoom<=ht)){Vi.zoom=ht;var ua=Vi.numPoints||1;Gn+=Vi.x*ua,hi+=Vi.y*ua,Vi.parentId=si,Hr&&(Wn||(Wn=this._map(At,!0)),Hr(Wn,this._map(Vi)))}}At.parentId=si,$e.push(et(Gn/Cr,hi/Cr,si,Cr,Wn))}else if($e.push(At),Cr>1)for(var wi=0,xa=Ft;wi<xa.length;wi+=1){var An=xa[wi],yi=gt.points[An];yi.zoom<=ht||(yi.zoom=ht,$e.push(yi))}}}return $e},we.prototype._getOriginId=function(qe){return qe-this.points.length>>5},we.prototype._getOriginZoom=function(qe){return(qe-this.points.length)%32},we.prototype._map=function(qe,ht){if(qe.numPoints)return ht?Jt({},qe.properties):qe.properties;var $e=this.points[qe.index].properties,Rt=this.options.map($e);return ht&&Rt===$e?Jt({},Rt):Rt};function et(dt,qe,ht,$e,Rt){return{x:je(dt),y:je(qe),zoom:Infinity,id:ht,parentId:-1,numPoints:$e,properties:Rt}}function Mt(dt,qe){var ht=dt.geometry.coordinates,$e=ht[0],Rt=ht[1];return{x:je(Xt($e)),y:je(Ct(Rt)),zoom:Infinity,index:qe,parentId:-1}}function nr(dt){return{type:"Feature",id:dt.id,properties:_t(dt),geometry:{type:"Point",coordinates:[ot(dt.x),ut(dt.y)]}}}function _t(dt){var qe=dt.numPoints,ht=qe>=1e4?Math.round(qe/1e3)+"k":qe>=1e3?Math.round(qe/100)/10+"k":qe;return Jt(Jt({},dt.properties),{cluster:!0,cluster_id:dt.id,point_count:qe,point_count_abbreviated:ht})}function Xt(dt){return dt/360+.5}function Ct(dt){var qe=Math.sin(dt*Math.PI/180),ht=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return ht<0?0:ht>1?1:ht}function ot(dt){return(dt-.5)*360}function ut(dt){var qe=(180-dt*360)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function Jt(dt,qe){for(var ht in qe)dt[ht]=qe[ht];return dt}function X(dt){return dt.x}function Yt(dt){return dt.y}return we})},75752:function(Ue){Ue.exports.RADIUS=6378137,Ue.exports.FLATTENING=1/298.257223563,Ue.exports.POLAR_RADIUS=63567523142e-4}}]);
